<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Private System</title>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <!-- Include interact.js for drag and drop/resize -->
  <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
  <style>
    /* Login System Styles */
    * {
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif;
    }
    
    body.login-body {
      margin: 0; padding: 0;
      background: #000;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden; /* Prevent scrollbars during zoom/animation */
      position: relative; /* For positioning overlays */
      background-image: linear-gradient(to right top, #d16ba5, #c777b9, #ba83ca, #aa8fd8, #9a9ae1, #8aa7ec, #79b3f4, #69bff7, #52cffe, #41dfff, #46eefa, #5ffbf1);
      background-size: 300% 300%; /* For gradient animation */
      animation: gradientAnimation 15s ease infinite;
    }

    @keyframes gradientAnimation {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Pre-Login Overlay */
    #preLoginOverlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        background: rgba(0, 0, 0, 0.95); /* Slightly transparent black background */
        display: flex;
        flex-direction: column; /* Stack elements vertically */
        justify-content: center;
        align-items: center;
        z-index: 999; /* High z-index to be on top */
        opacity: 1;
        transition: opacity 1.5s ease-in-out, visibility 1.5s ease-in-out; /* Smooth fade-out */
        visibility: visible;
    }

    #preLoginOverlay.fade-out {
        opacity: 0;
        visibility: hidden;
    }

    .rotating-box {
        width: 150px; /* Slightly smaller for better focus */
        height: 150px;
        border: 5px solid; /* Use gradient for border */
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        animation: rotate 8s infinite linear, colorGradient 4s infinite alternate;
        margin-bottom: 20px;
        border-color: transparent orange transparent red; /* Initialize gradient */
        border-image: linear-gradient(45deg, orange, red) 1; /* Apply gradient border */
    }

    @keyframes rotate {
        from { transform: rotateY(0deg) rotateX(10deg); } /* Slight tilt for more dynamic look */
        to { transform: rotateY(360deg) rotateX(10deg); }
    }

    @keyframes colorGradient {
        0% { border-image-source: linear-gradient(45deg, orange, red); }
        50% { border-image-source: linear-gradient(45deg, red, deeppink); }
        100% { border-image-source: linear-gradient(45deg, deeppink, orange); }
    }

    .animated-text {
        font-size: 1.7em; /* Larger text */
        font-weight: bold;
        font-family: 'Courier New', monospace;
        background: linear-gradient(45deg, orange, red);
        -webkit-background-clip: text;
        color: transparent;
        animation: pulseText 3s infinite alternate ease-in-out;
        transform-origin: center;
    }

    @keyframes pulseText {
        0% { transform: scale(1); opacity: 1; }
        100% { transform: scale(1.1); opacity: 0.8; }
    }

    /* Simplified 3D Box for Login Page Animation */
    .login-animation-box {
        width: 150px;
        height: 150px;
        transform-style: preserve-3d;
        animation: spinCube 6s infinite linear;
        margin-top: 30px; /* Space between elements */
        perspective: 800px; /* Needed for 3D transformations */
        display: flex; /* For centering content */
        justify-content: center;
        align-items: center;
    }

    @keyframes spinCube {
        0% { transform: rotateX(0deg) rotateY(0deg) scale(0.9); }
        50% { transform: rotateX(180deg) rotateY(180deg) scale(1.05); }
        100% { transform: rotateX(360deg) rotateY(360deg) scale(0.9); }
    }

    .login-animated-text {
        position: absolute;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        background: radial-gradient(circle, rgba(255,145,77,0.3) 0%, rgba(255,145,77,0) 70%); /* Soft glow */
        border: 2px solid rgba(255, 145, 77, 0.8);
        border-radius: 20px; /* More rounded */
        font-family: 'Courier New', monospace;
        font-size: 1.1em; /* Slightly larger */
        font-weight: bold;
        text-align: center;
        box-shadow: 0 0 20px rgba(255, 145, 77, 0.5);
        backface-visibility: hidden;
        color: #ffdfbf; /* Lighter text */
        letter-spacing: 0.5px; /* Slight spacing */
    }
    
    /* Adjust Login Box Styles for New Layout */
    .login-box {
      background: rgba(0, 0, 0, 0.7); /* Semi-transparent background */
      border-radius: 25px; /* Increased for roundness */
      border: 3px solid rgba(255, 255, 255, 0.8); /* Slightly transparent border */
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.5); /* Softer shadow */
      width: 400px; /* More square */
      padding: 40px 30px; /* More padding */
      text-align: center;
      position: relative;
      transition: border-color 0.3s, box-shadow 0.3s, transform 0.3s ease-in-out; /* Added transform transition */
      margin-top: 100px; /* Make space for quick bar and pre-login elements */
      backdrop-filter: blur(5px); /* Frosted glass effect */
      -webkit-backdrop-filter: blur(5px); /* For Safari compatibility */
      z-index: 1; /* Ensure login box is above overlays if any */
    }
    
    .login-box:hover {
        box-shadow: 0 0 30px rgba(255, 145, 77, 0.7); /* Hover effect */
        transform: translateY(-5px); /* Slight lift on hover */
    }

    .login-box.flashing {
      animation: flashRed 0.4s ease-in-out 2;
    }
    
    @keyframes flashRed {
      0%, 100% { border-color: red; box-shadow: 0 0 15px red; }
      50% { border-color: white; box-shadow: 0 0 5px white; }
    }
    
    .login-box h2 {
      font-size: 2em; /* Larger title */
      margin-bottom: 25px;
      font-family: 'Courier New', monospace;
      color: #ffbf80; /* Orangeish color */
      letter-spacing: 1px;
      text-shadow: 0 0 10px rgba(255, 191, 128, 0.5);
    }
    
    .login-box input {
      width: 100%;
      padding: 15px; /* Larger padding */
      margin-bottom: 20px; /* More space */
      background: rgba(28, 28, 28, 0.8); /* Slightly transparent background */
      border: 1px solid rgba(255, 255, 255, 0.3); /* Subtle border */
      color: white;
      border-radius: 10px; /* Rounded inputs */
      font-size: 1em;
      transition: background 0.2s, border-color 0.2s, box-shadow 0.2s;
    }

    .login-box input:focus {
      background: rgba(28, 28, 28, 0.95);
      border-color: #ff914d; /* Highlight on focus */
      box-shadow: 0 0 12px rgba(255, 145, 77, 0.4);
    }
    
    .login-box label { /* Toggle styling */
      display: flex;
      align-items: center;
      font-size: 0.9em;
      margin-bottom: 15px; /* More space */
      gap: 10px;
      cursor: pointer;
      width: 100%; /* Make label take full width */
      justify-content: center; /* Center content within label */
    }
    
    /* Hide default checkbox */
    #showPasswordCheckbox { display: none; }

    /* Custom toggle switch for show password */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 45px; /* Track width */
      height: 25px; /* Track height */
      background-color: #ccc; /* Default grey */
      border-radius: 25px;
      transition: background-color 0.3s, box-shadow 0.2s;
      cursor: pointer;
    }

    .toggle-switch::after { /* Thumb (the sliding circle) */
      content: '';
      position: absolute;
      top: 3px; /* Positioned within the track */
      left: 3px; /* Positioned within the track */
      width: 19px; /* Thumb width */
      height: 19px; /* Thumb height */
      background-color: white;
      border-radius: 50%;
      transition: transform 0.3s;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    #showPasswordCheckbox:checked + .toggle-switch {
      background-color: #4CAF50; /* Green when checked */
    }

    #showPasswordCheckbox:checked + .toggle-switch::after {
      transform: translateX(20px); /* Slide thumb to the right */
    }
    
    /* Text next to the toggle */
    .login-box label span {
      color: #eee; /* Light grey text */
      font-weight: 500;
    }
    
    #showPasswordCheckbox:checked + .toggle-switch + span {
      color: #4CAF50; /* Green text when checked */
    }
    
    .login-box button {
      width: 100%;
      padding: 15px; /* Larger padding */
      background-color: #ff5a5a; /* Brighter red */
      color: white;
      font-size: 1.1em;
      border: none;
      border-radius: 10px; /* Rounded button */
      cursor: pointer;
      transition: background 0.2s, transform 0.2s;
      margin-top: 5px; /* Space above button */
      box-shadow: 0 5px 15px rgba(255, 90, 90, 0.4);
    }

    .login-box button:hover {
      background-color: #e64d4d; /* Darker red */
      transform: translateY(-2px);
      box-shadow: 0 7px 20px rgba(255, 90, 90, 0.6);
    }
    
    .attempt-counter, .error-message {
      margin-top: 15px; /* More space */
      font-size: 0.9em; /* Slightly larger font */
      color: #ff5a5a; /* Brighter error color */
      min-height: 1.2em; /* Ensure space even when empty */
    }
    
    .popup {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      width: 350px; /* Slightly wider */
      padding: 30px; /* More padding */
      transform: translate(-50%, -50%);
      background: rgba(15, 15, 15, 0.9); /* Darker, more transparent background */
      border: 3px solid #ff914d; /* Orange border */
      border-radius: 15px;
      box-shadow: 0 0 25px rgba(255, 145, 77, 0.6); /* Enhanced shadow */
      z-index: 10;
      backdrop-filter: blur(8px); /* More blur */
      -webkit-backdrop-filter: blur(8px);
    }
    
    .popup p {
      margin-bottom: 20px;
      font-size: 1.1em;
      color: #ffddcc; /* Lighter text for contrast */
    }

    .popup input {
      margin-bottom: 15px;
      padding: 12px;
      border-radius: 8px;
      background: rgba(30,30,30,0.8);
      border: 1px solid #555;
      color: white;
    }

    .popup button {
      width: 100%;
      padding: 12px;
      background-color: #4CAF50; /* Green for confirmation */
      color: white;
      font-size: 1em;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .popup button:hover {
      background-color: #45a049;
    }

    /* New Login Quick Bar */
    .login-quick-bar {
        position: fixed; /* Fixed to the viewport */
        top: 0;
        left: 0;
        width: 100%;
        background-color: rgba(0, 0, 0, 0.6); /* Semi-transparent dark bar */
        padding: 12px 20px;
        display: flex;
        justify-content: space-between; /* Distribute items */
        align-items: center;
        gap: 15px;
        z-index: 100; /* Above login box */
        color: white;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2); /* Subtle border */
        box-sizing: border-box;
        flex-wrap: wrap; /* Allow wrapping on small screens */
        backdrop-filter: blur(3px); /* Frosted glass effect */
        -webkit-backdrop-filter: blur(3px);
    }

    .login-quick-bar .left-side,
    .login-quick-bar .right-side,
    .login-quick-bar .center-items {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .login-quick-bar button {
        background: none;
        border: none;
        color: white;
        font-size: 1em; /* Adjusted font size */
        cursor: pointer;
        padding: 8px 12px; /* Button padding */
        border-radius: 8px; /* Rounded buttons */
        transition: background 0.2s, transform 0.1s, color 0.2s;
        font-family: 'Segoe UI', sans-serif;
        font-weight: 500;
    }
    .login-quick-bar button:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateY(-1px);
    }
    .login-quick-bar button:active {
        transform: translateY(0);
    }

    .login-time-date {
        font-size: 0.95em; /* Slightly smaller than other elements */
        font-weight: bold;
        font-family: 'Courier New', monospace;
        white-space: nowrap;
        padding: 6px 10px; /* Padding around date/time */
        border-radius: 6px;
        background: rgba(0,0,0,0.3); /* Subtle background */
        color: #ffdbbf; /* Lighter text */
    }

    /* Specific buttons in quick bar for visual distinction */
    #loginPanicBtn { color: #ff4c4c; font-weight: bold; padding: 8px 15px; background: rgba(255,76,76,0.1); }
    #loginPanicBtn:hover { background: rgba(255,76,76,0.3); }

    #loginZoomInBtn, #loginZoomOutBtn { font-weight: bold; color: #fff; }
    
    /* Attempt counter display */
    #loginAttemptCounterDisplay {
      cursor: default; 
      color: #ff5a5a; /* Red color */
      font-weight: bold;
      border: 1px solid rgba(255,90,90,0.4); /* Reddish border */
      padding: 6px 10px;
      background: rgba(255,90,90,0.1);
    }
    #loginAttemptCounterDisplay:hover {
        background: rgba(255,90,90,0.3);
    }

    /* Password Toggle Button Styling */
    #passwordToggleBtn { font-size: 1.3em; color: #fff; } /* Eye icon */
    #passwordToggleBtn:hover { background: rgba(255,255,255,0.2); }

    /* Time Format Toggle Button */
    #timeFormatToggleBtn { font-size: 0.95em; color: #fff; }
    #timeFormatToggleBtn:hover { background: rgba(255,255,255,0.2); }


    /* Dashboard Styles */
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');

    body.dashboard-body {
      font-family: 'Montserrat', sans-serif;
      background-color: #1a1a1a;
      color: #f9f2dc;
      padding: 20px;
      transition: background-color 0.3s, color 0.3s;
      zoom: 1; 
      overflow-y: auto; /* Allow scrolling if content overflows */
      position: relative; /* For any fixed dashboard elements */
      background-image: linear-gradient(to right top, #3b010c, #7e1f00, #b84c00, #e67d00, #ffaf00, #ffd64d, #ffff80, #c7ffab, #aaffc3, #aaffeb, #c7ebff, #e8d4ff); /* Fancy background for dashboard */
      background-size: 400% 400%; /* For animation */
      animation: dashboardGradient 20s ease infinite; /* More complex animation */
    }

    @keyframes dashboardGradient {
      0% { background-position: 0% 0%; }
      50% { background-position: 100% 100%; }
      100% { background-position: 0% 0%; }
    }

    body.dashboard-body.light-theme {
      background-color: #f9f2dc;
      color: #1a1a1a;
      animation: none; /* Turn off animation for light theme */
    }
    body.dashboard-body.light-theme .dashboard-header {
      background-color: #ffd966; /* Match theme */
      color: #000;
    }
    body.dashboard-body.light-theme .quick-bar {
      background-color: rgba(255, 217, 102, 0.5); /* Lighter background for quick bar */
    }
    body.dashboard-body.light-theme .box {
      background-color: #fff3cc; /* Lighter box background */
      color: #000;
      box-shadow: 0 0 15px rgba(255, 200, 100, 0.6); /* Warmer shadow */
    }
    body.dashboard-body.light-theme .box h2 {
      color: #994d00; /* Darker orange for headings */
    }
    body.dashboard-body.light-theme .motivation-box {
      background-color: #fff7e6; /* Even lighter motivation box */
      color: #663300; /* Dark brown text */
      box-shadow: 0 0 12px rgba(255, 200, 100, 0.8);
    }

    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #ff914d; /* Primary orange */
      padding: 15px 25px;
      border-radius: 12px;
      color: #000;
      margin-bottom: 20px;
      box-shadow: 0 5px 15px rgba(255, 145, 77, 0.4); /* Header shadow */
    }

    .dashboard-header h1 {
      font-size: 2.2em; /* Larger title */
      margin: 0;
      font-family: 'Montserrat', sans-serif; /* Modern font for title */
    }

    .user-info {
      font-weight: bold;
      font-size: 1em;
      color: #fff; /* White for user info */
    }
    .user-info span {
      color: #ffe0cc; /* Lighter orange for details */
    }

    .version-box {
      background: #ffd966; /* Yellow */
      padding: 8px 15px;
      border-radius: 8px;
      color: #000;
      font-weight: bold;
      font-family: 'Courier New', monospace;
    }

    .quick-bar {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 10px; 
      flex-wrap: wrap;
      padding: 12px; /* Added padding */
      background: rgba(42, 42, 42, 0.7); /* Darker semi-transparent background for distinction */
      border-radius: 10px; /* Rounded quick bar */
      box-shadow: inset 0 0 10px rgba(0,0,0,0.3); /* Inner shadow for depth */
    }

    body.dashboard-body.light-theme .quick-bar {
      background: rgba(255, 217, 102, 0.7); /* Lighter theme quick bar background */
    }

    .quick-bar button {
      background-color: #ff914d;
      border: none;
      padding: 10px 16px; /* More padding for buttons */
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s, box-shadow 0.2s;
      min-width: 110px;
      white-space: nowrap;
      font-family: 'Montserrat', sans-serif; /* Match dashboard font */
      font-size: 0.9em; /* Consistent button text size */
    }

    .quick-bar button:hover {
      background-color: #ffb67a; /* Lighter orange */
      transform: translateY(-2px); /* Slight lift on hover */
      box-shadow: 0 4px 10px rgba(255, 145, 77, 0.4);
    }

    #panicBtn {
      background: #ff4c4c !important;
      color: white !important;
      border: 1px solid rgba(255,76,76,0.3);
    }
    #panicBtn:hover {
        background: #e64c4c !important; /* Darker red on hover */
        box-shadow: 0 4px 10px rgba(255,76,76,0.4);
    }
    
    /* Style for new search bar */
    .quick-bar input[type="text"] {
        padding: 10px 12px;
        border-radius: 8px;
        border: 1px solid #ff914d;
        background: rgba(255, 255, 255, 0.2);
        color: #f9f2dc;
        font-size: 0.9em;
        width: 180px; /* Default width */
        box-sizing: border-box;
        transition: border-color 0.2s, background 0.2s, box-shadow 0.2s;
        font-family: 'Montserrat', sans-serif;
    }
    body.dashboard-body.light-theme .quick-bar input[type="text"] {
        border-color: #994d00;
        background: rgba(255, 255, 255, 0.7);
        color: #000;
    }
    .quick-bar input[type="text"]::placeholder {
        color: rgba(249, 242, 220, 0.7);
    }
     body.dashboard-body.light-theme .quick-bar input[type="text"]::placeholder {
        color: rgba(0, 0, 0, 0.7);
    }
    .quick-bar input[type="text"]:focus {
        border-color: #ffbf80;
        background: rgba(255, 255, 255, 0.4);
        box-shadow: 0 0 12px rgba(255, 178, 102, 0.4);
        outline: none; /* Remove default outline */
    }


    .announcement-bar {
      width: 100%;
      background-color: #ff914d;
      color: black;
      font-weight: bold;
      padding: 10px 0;
      overflow: hidden;
      position: relative;
      border-radius: 8px;
      box-sizing: border-box;
      margin-bottom: 20px;
      user-select: none;
      height: 30px;
      line-height: 13px;
      text-align: center; /* Center text by default */
      box-shadow: 0 2px 8px rgba(255, 145, 77, 0.3);
    }

    .announcement-bar span {
      display: inline-block;
      white-space: nowrap;
      position: absolute;
      will-change: transform;
      animation: scrollLeft 15s linear infinite;
      padding-left: 100%;
      font-size: 0.9em; /* Slightly smaller text in announcement */
    }

    @keyframes scrollLeft {
      0% { transform: translateX(0%); }
      100% { transform: translateX(-100%); }
    }

    body.dashboard-body.light-theme .announcement-bar {
      background-color: #ffd966;
      color: #000;
    }

    .main-row {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      /* Enable drag/resize by having containers be positioned relative */
    }

    .box {
      background-color: #2a2a2a;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(255, 145, 77, 0.3);
      min-height: 120px;
      transition: background-color 0.3s, color 0.3s, transform 0.2s, box-shadow 0.2s; /* Add transform for drag */
      flex: 1 1 300px; /* Grow, shrink, basis */
      position: relative; /* Crucial for drag/resize handles */
    }

    body.dashboard-body.light-theme .box {
      background-color: #ffd966;
      color: #000;
      box-shadow: 0 0 15px rgba(255, 145, 77, 0.6);
    }

    .box h2 {
      font-size: 1.1em; /* Slightly smaller heading */
      margin-top: 0;
      margin-bottom: 10px;
      color: #ffbf80; /* Lighter orange heading */
      font-family: 'Montserrat', sans-serif; /* Use dashboard font */
    }

    body.dashboard-body.light-theme .box h2 {
      color: #994d00; /* Darker orange for headings */
    }

    .box p, .box ul {
      font-size: 0.9em; /* Smaller text for content */
    }

    /* Styles for Resizable Handles */
    .handle {
      position: absolute;
      bottom: 5px;
      right: 5px;
      width: 18px;
      height: 18px;
      background: #ff914d;
      border-radius: 4px; /* Rounded handle */
      cursor: se-resize;
      opacity: 0.7;
      z-index: 5; /* Ensure handle is above content */
      display: flex;
      justify-content: center;
      align-items: center;
      transition: opacity 0.2s, background 0.2s;
      border: 1px solid rgba(255,255,255,0.3);
    }
    .handle::after { /* Visual cue on handle */
        content: '\2518'; /* Southeast arrow symbol */
        color: black;
        font-size: 0.8em;
    }
    .handle:hover {
      opacity: 1;
      background: #ffb67a; /* Darker on hover */
      border-color: rgba(255,255,255,0.5);
    }
    body.dashboard-body.light-theme .handle {
      background: #994d00; /* Brownish for light theme */
    }
    body.dashboard-body.light-theme .handle:hover {
      background: #e68a00; /* Darker brown */
      border-color: rgba(255,255,255,0.7);
    }


    .update-entry {
      background: #40210f;
      padding: 8px;
      margin-top: 5px;
      border-radius: 6px;
      color: #ffccb3;
      font-size: 0.9em;
    }

    body.dashboard-body.light-theme .update-entry {
      background: #ffd999;
      color: #994d00;
    }

    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      margin-top: 10px;
      text-align: center;
      font-size: 0.9em;
    }

    .calendar div {
      padding: 8px; /* Slightly more padding */
      background: #333;
      border-radius: 4px;
      font-weight: 500;
    }

    .today {
      background: #ff914d !important;
      font-weight: bold;
      color: black;
    }

    body.dashboard-body.light-theme .calendar div {
      background: #ffd966;
      color: #000;
    }

    body.dashboard-body.light-theme .today {
      background: #994d00 !important;
      color: #ffd966;
    }

    #canvasContainer {
      display: none;
      margin-top: 20px;
      text-align: center;
    }

    #notesCanvas {
      border: 2px solid #ff914d;
      border-radius: 12px;
      background: #fff;
      cursor: crosshair;
      touch-action: none;
      max-width: 100%; /* Ensure responsiveness */
      height: auto; /* Maintain aspect ratio */
    }

    #canvasControls {
      margin-top: 15px; /* More space */
      display: flex;
      flex-wrap: wrap; /* Allow controls to wrap */
      justify-content: center;
      gap: 10px;
      align-items: center;
    }

    #canvasControls button,
    #canvasControls input[type="range"] {
      background-color: #ff914d;
      border: none;
      padding: 10px 16px; /* Button padding */
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
      font-family: 'Montserrat', sans-serif;
      font-size: 0.9em;
    }

    #canvasControls button:hover,
    #canvasControls input[type="range"]:hover {
      background-color: #ffb67a;
      transform: translateY(-1px);
    }
    
    /* Specific styling for canvas controls */
    #changeCanvasColorBtn, #changeCanvasMaterialBtn { /* Color/Material are likely buttons triggering pickers */
      background-color: #6a0dad; /* Purple for special controls */
      color: white;
    }
    #changeCanvasColorBtn:hover, #changeCanvasMaterialBtn:hover {
      background-color: #8a2be2;
    }
    body.dashboard-body.light-theme #changeCanvasColorBtn, body.dashboard-body.light-theme #changeCanvasMaterialBtn {
      background-color: #994d00; /* Brown for light theme */
    }
    body.dashboard-body.light-theme #changeCanvasColorBtn:hover, body.dashboard-body.light-theme #changeCanvasMaterialBtn:hover {
      background-color: #b35900;
    }

    #canvasStrokeWidth {
      background: none;
      border: none;
      cursor: pointer;
      margin: 0 5px;
      width: 100px; /* Width for slider */
      height: 8px; /* Standard slider height */
      appearance: none; /* Hide default styles */
      border-radius: 4px;
      background: linear-gradient(to right, #ff914d 50%, #ccc 50%); /* Gradient track */
      background-size: 200% 100%;
      background-position: left center;
      vertical-align: middle; /* Align with other controls */
    }
    #canvasStrokeWidth::-webkit-slider-thumb { /* Webkit (Chrome, Safari) */
      -webkit-appearance: none; appearance: none;
      width: 20px; height: 20px;
      background: #ff914d;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
    }
    #canvasStrokeWidth::-moz-range-thumb { /* Mozilla Firefox */
      width: 20px; height: 20px;
      background: #ff914d;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
    }
    #canvasStrokeWidth:hover, #canvasStrokeWidth:focus {
      background: linear-gradient(to right, #ffb67a 50%, #bbb 50%); /* Lighter gradient on hover/focus */
    }
    body.dashboard-body.light-theme #canvasStrokeWidth {
      background: linear-gradient(to right, #994d00 50%, #eee 50%); /* Brown for light theme */
    }
     body.dashboard-body.light-theme #canvasStrokeWidth::-webkit-slider-thumb,
     body.dashboard-body.light-theme #canvasStrokeWidth::-moz-range-thumb {
       background: #994d00; /* Brown thumb for light theme */
     }
    body.dashboard-body.light-theme #canvasStrokeWidth:hover,
    body.dashboard-body.light-theme #canvasStrokeWidth:focus {
      background: linear-gradient(to right, #b35900 50%, #ddd 50%);
    }


    #canvasText {
      resize: none; /* Prevent manual resizing */
      width: 100%; /* Take full width */
      max-width: 200px; /* Limit width */
      height: 60px;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #555;
      background: rgba(30,30,30,0.8);
      color: white;
      font-family: 'Montserrat', sans-serif;
      font-size: 0.9em;
      margin-top: 10px; /* Space above textarea */
    }
    body.dashboard-body.light-theme #canvasText {
      background: #fff3cc;
      border: 1px solid #bbb;
      color: #000;
    }

    #addCanvasTextBtn {
      background-color: #ffaa00; /* Brighter yellow */
      color: black;
    }
    #addCanvasTextBtn:hover {
      background-color: #e69900;
    }

    .motivation-box {
      background-color: #333;
      color: #ffd966;
      padding: 20px;
      border-radius: 12px;
      font-style: italic;
      font-size: 1em; /* Larger font */
      box-shadow: 0 0 12px rgba(255, 145, 77, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 120px;
      text-align: center;
    }

    body.dashboard-body.light-theme .motivation-box {
      background-color: #fff3cc;
      color: #994d00;
      box-shadow: 0 0 12px rgba(255, 145, 77, 0.8);
    }

    /* Info Panel Styles */
    .info-panel {
      display: none;
      background-color: #2a2a2a;
      padding: 20px;
      border-radius: 12px;
      margin-top: 20px;
      box-shadow: 0 0 15px rgba(255, 145, 77, 0.3);
    }

    body.dashboard-body.light-theme .info-panel {
      background-color: #ffd966;
      color: #000;
    }

    .info-panel h2 {
      color: #ff914d;
      margin-bottom: 15px;
      font-size: 1.4em;
      font-family: 'Montserrat', sans-serif;
    }

    body.dashboard-body.light-theme .info-panel h2 {
      color: #994d00;
    }

    .wifi-grid {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 10px;
      margin-bottom: 15px;
      font-size: 0.9em;
      font-weight: bold;
    }

    .wifi-grid div {
      padding: 8px;
      background: #333;
      border-radius: 6px;
      text-align: center;
    }

    body.dashboard-body.light-theme .wifi-grid div {
      background: #ffd999;
    }

    .wifi-entry {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 10px;
      margin-bottom: 10px;
      font-size: 0.9em;
    }

    .wifi-entry div {
      padding: 8px;
      background: #40210f;
      border-radius: 6px;
      text-align: center;
    }

    body.dashboard-body.light-theme .wifi-entry div {
      background: #ffd999;
    }

    /* --- WiFi Level Color Coding --- */
    .wifi-level-high { background-color: #76c876 !important; color: #1a1a1a !important; } /* Green */
    .wifi-level-medium { background-color: #ffd700 !important; color: #1a1a1a !important; } /* Gold/Yellow */
    .wifi-level-low { background-color: #ff6347 !important; color: white !important; } /* Tomato Red */
    .wifi-level-unknown { background-color: #555 !important; color: white !important; } /* Default */
    body.dashboard-body.light-theme .wifi-level-unknown { background-color: #ccc !important; color: black !important;}

    .handbook-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 15px;
    }

    .handbook-buttons button {
      background-color: #ff914d;
      border: none;
      padding: 12px;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
    }

    .handbook-buttons button:hover {
      background-color: #ffb67a;
    }

    .links-list {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 15px;
    }

    .links-list a {
      display: block;
      background-color: #ff914d;
      border: none;
      padding: 12px;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
      text-decoration: none;
      text-align: center;
      font-family: 'Montserrat', sans-serif;
    }

    .links-list a:hover {
      background-color: #ffb67a;
    }

    .exploit-buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-top: 15px;
    }

    .exploit-buttons a {
      display: block;
      background-color: #ff914d;
      border: none;
      padding: 12px;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
      text-decoration: none;
      text-align: center;
      font-family: 'Montserrat', sans-serif;
    }

    .exploit-buttons a:hover {
      background-color: #ffb67a;
    }

    .bypass-buttons {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 15px;
    }

    .bypass-buttons button {
      background-color: #ff914d;
      border: none;
      padding: 12px;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
    }

    .bypass-buttons button:hover {
      background-color: #ffb67a;
    }

    .coming-soon {
      background: #40210f;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      text-align: center;
      font-weight: bold;
    }

    body.dashboard-body.light-theme .coming-soon {
      background: #ffd999;
    }

    .info-text {
      background: #40210f;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }

    body.dashboard-body.light-theme .info-text {
      background: #ffd999;
    }

    .school-info-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 15px;
    }

    .school-info-item {
      background: #40210f;
      padding: 12px;
      border-radius: 8px;
    }

    body.dashboard-body.light-theme .school-info-item {
      background: #ffd999;
    }

    .school-info-label {
      font-weight: bold;
      color: #ff914d;
      margin-bottom: 5px;
    }

    body.dashboard-body.light-theme .school-info-label {
      color: #994d00;
    }

    .ipad-options {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .ipad-options button {
      flex: 1;
      background-color: #ff914d;
      border: none;
      padding: 12px;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
    }

    .ipad-options button:hover {
      background-color: #ffb67a;
    }

    .ipad-content {
      display: none;
      background: #40210f;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }

    body.dashboard-body.light-theme .ipad-content {
      background: #ffd999;
    }
    
    .bypass-content {
      display: none;
      background: #40210f;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }
    
    body.dashboard-body.light-theme .bypass-content {
      background: #ffd999;
    }
    
    /* Placeholder for new panels */
    #settingsPanel, #factsPanel, #quotesPanel, #activityLogDisplay, #loginHistoryDisplay { /* General panel styling */
      display: none;
      background-color: #2a2a2a;
      padding: 20px;
      border-radius: 12px;
      margin-top: 20px;
      box-shadow: 0 0 15px rgba(255, 145, 77, 0.3);
      position: fixed; /* Make them overlay */
      top: 10%; left: 15%; width: 70%; height: 75%; /* Overlay dimensions */
      z-index: 1000;
      overflow-y: auto;
      transform: translate(-50%, 0); /* Adjust position if needed, based on absolute top/left */
      left: 50%; /* Center the panel */
    }
    body.dashboard-body.light-theme #settingsPanel,
    body.dashboard-body.light-theme #factsPanel,
    body.dashboard-body.light-theme #quotesPanel,
    body.dashboard-body.light-theme #activityLogDisplay,
    body.dashboard-body.light-theme #loginHistoryDisplay {
      background-color: #ffd966;
      color: #000;
    }
    #settingsPanel h2,
    #factsPanel h2,
    #quotesPanel h2,
    #activityLogDisplay h2,
    #loginHistoryDisplay h2 {
      color: #ff914d;
      margin-bottom: 15px;
      font-size: 1.4em;
      font-family: 'Montserrat', sans-serif;
    }
    body.dashboard-body.light-theme #settingsPanel h2,
    body.dashboard-body.light-theme #factsPanel h2,
    body.dashboard-body.light-theme #quotesPanel h2,
    body.dashboard-body.light-theme #activityLogDisplay h2,
    body.dashboard-body.light-theme #loginHistoryDisplay h2 {
      color: #994d00;
    }

    /* Styling for individual setting options */
    .setting-option {
      display: block;
      width: calc(33.333% - 10px); /* 3 columns */
      margin: 5px;
      padding: 12px;
      background-color: #4CAF50; /* Green for settings buttons */
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      text-align: center;
      font-family: 'Montserrat', sans-serif;
      font-size: 0.9em;
      transition: background 0.2s;
    }
    .setting-option:hover { background-color: #45a049; }
    body.dashboard-body.light-theme .setting-option {
      background-color: #87CEEB; /* Sky blue for light theme */
      color: #000;
    }
    body.dashboard-body.light-theme .setting-option:hover {
      background-color: #4682B4; /* Steel blue */
    }

    /* Stats button styles */
    #statsBtn {
      background-color: #9c27b0; /* Purple */
      color: white;
    }
    #statsBtn:hover { background-color: #7b1fa2; }
    body.dashboard-body.light-theme #statsBtn {
      background-color: #d8bfd8; /* Thistle */
      color: #4b0082; /* Indigo */
    }
    body.dashboard-body.light-theme #statsBtn:hover {
      background-color: #c6aadc;
    }
    
    /* Media button */
    #mediaBtn {
        background-color: #ff0054; /* Reddish for media */
        color: white;
    }
    #mediaBtn:hover { background-color: #cc0044; }
    body.dashboard-body.light-theme #mediaBtn {
        background-color: #ffebcd; /* Blanched almond */
        color: #a0522d; /* Sienna */
    }
    body.dashboard-body.light-theme #mediaBtn:hover {
        background-color: #ffdcae;
    }

    /* Reminder Button */
    #reminderBtn {
      background-color: #00bcd4; /* Cyan */
      color: white;
    }
    #reminderBtn:hover { background-color: #0097a9; }
    body.dashboard-body.light-theme #reminderBtn {
      background-color: #add8e6; /* Light blue */
      color: #000;
    }
    body.dashboard-body.light-theme #reminderBtn:hover {
      background-color: #87ceeb;
    }
    
    /* Calculator/Unit Converter */
    #calculatorBtn, #unitConverterBtn {
      background-color: #03a9f4; /* Blue */
      color: white;
    }
    #calculatorBtn:hover, #unitConverterBtn:hover { background-color: #0288d1; }
    body.dashboard-body.light-theme #calculatorBtn, body.dashboard-body.light-theme #unitConverterBtn {
      background-color: #b0e0e6; /* Powder blue */
      color: #000;
    }
    body.dashboard-body.light-theme #calculatorBtn:hover, body.dashboard-body.light-theme #unitConverterBtn:hover {
      background-color: #87ceeb;
    }
    
    /* Generic Button for new panels in Quick Bar */
    .quick-bar button[id$='Btn'] { /* Styles buttons ending in 'Btn' */
      background-color: #5E3A8D; /* Purple-ish */
      color: white;
    }
    .quick-bar button[id$='Btn']:hover {
      background-color: #7c4da7;
    }
    body.dashboard-body.light-theme .quick-bar button[id$='Btn'] {
      background-color: #ffe0cc; /* Light peach */
      color: #4b1d00; /* Dark brown */
    }
    body.dashboard-body.light-theme .quick-bar button[id$='Btn']:hover {
      background-color: #ffd1a5;
    }

  </style>
  
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
</head>
<body class="login-body" id="bodyElement">

  <!-- Pre-Login Loading Overlay -->
  <div id="preLoginOverlay">
      <div class="rotating-box"></div>
      <div class="animated-text">Initializing System...</div>
      <div class="login-animation-box">
          <div class="login-animated-text">Initializing Login Page...</div>
      </div>
  </div>

  <!-- Login System -->
  <div class="login-box" id="loginBox" style="display: none;"> <!-- Hidden initially, shown after overlay fades -->
    <h2>ùôãùôßùôûùô´ùôñùô©ùôö ùôéùôÆùô®ùô©ùôöùô¢</h2>

    <input type="text" id="username" placeholder="Enter Username..." autocomplete="off" />
    <input type="password" id="password" placeholder="Enter Password..." autocomplete="off" />
    <input type="text" id="userID" placeholder="Enter User Identifier..." autocomplete="off" />

    <label for="showPasswordCheckbox">
      <input type="checkbox" id="showPasswordCheckbox" />
      <span class="toggle-switch"></span>
      <span>Show Password</span>
    </label>

    <button id="submitBtn">Submit</button>

    <div class="error-message" id="errorMsg"></div>
    <div class="attempt-counter" id="attemptsText">Attempts Left: 3</div> <!-- Updated to 3 -->

    <div class="popup" id="resetPopup" tabindex="-1" aria-hidden="true">
      <p>Too many failed attempts.</p>
      <input type="password" id="resetField" placeholder="SENDING LOG TO SERVER PLEASE WAIT WHILE WE ACCEPT IT" autocomplete="off" />
      <button id="resetBtn">Reset Counter</button>
    </div>
  </div>

  <!-- Login Quick Bar -->
  <div class="login-quick-bar">
      <div class="left-side">
          <button id="loginPanicBtn" title="Panic Button (Go to Clever)">üö® Clever</button>
          <button id="loginZoomInBtn" title="Zoom In">‚ûï Zoom In</button>
          <button id="loginZoomOutBtn" title="Zoom Out">‚ûñ Zoom Out</button>
      </div>
      <div class="center-items">
          <div class="login-time-date" id="loginDateTimeBox">üìÖ --.--.-- üïí --:--:--</div>
          <button id="timeFormatToggleBtn" title="Toggle 24h Format">üîÑ 12h</button>
          <button id="passwordToggleBtn" title="Show/Hide Password">üëÅÔ∏è</button>
      </div>
      <div class="right-side">
          <button id="loginAttemptCounterDisplay">Attempts: 3</button>
      </div>
  </div>

  <!-- Dashboard (hidden by default) -->
  <div id="dashboard" style="display: none;">
    <div class="dashboard-header" id="dashboardHeader">
      <div>
        <h1>Private Dashboard GUI</h1>
        <div class="user-info">User - <span id="loggedInUser">Beta.user</span> | ID: <span id="loggedInID">281573</span></div>
      </div>
      <div class="version-box">Version 1.5.6</div>
    </div>

    <div class="quick-bar">
      <button id="sessionTime">‚è≥ Session Time: 00:00:00</button>
      <button id="realTimeClock">üïí --:--:--</button>
      <button id="realDate">üìÖ --</button>
      <button id="notesBtn">üìí Notes</button>
      <button id="exportNotesBtn">üíæ Export Notes</button>
      <button id="downloadActivityLogsBtn">üíæ Activity Logs</button> <!-- New Button -->
      <button id="screenshotBtn">üì∏ Screenshot</button>
      <button id="toggleSectionsBtn">‚¨ÜÔ∏è Toggle Sections</button>
      <button id="fixIssuesBtn">üõ†Ô∏è Fix Issues</button>
      <button id="fullScreenBtn">üñ•Ô∏è Full Screen</button>
      <button id="zoomInBtn">‚ûï Zoom In</button>
      <button id="zoomOutBtn">‚ûñ Zoom Out</button>
      <button id="restartBtn">üîÑ Restart</button>
      <button id="panicBtn">üö® Panic</button>
      <button id="themeToggle">üåô Dark Mode</button>
      <button id="logoutBtn">üîì Log Out</button>
      <input type="text" id="dashboardSearch" placeholder="Search areas..." autocomplete="off"/> <!-- New Search Bar -->
    </div>
    
    <div id="announcementBar" class="announcement-bar">
      <span>üö® Welcome to the Private Dashboard GUI. Stay tuned for updates and alerts! üö®</span>
    </div>
    
    <div class="main-row" id="mainGrid">
      
      <div class="box" data-panel-id="calendar">
        <h2>üìÖ Calendar</h2>
        <div class="calendar" id="calendar"></div>
      </div>

      <div class="box motivation-box" id="motivationBox" data-panel-id="motivation">
        "Success is not final, failure is not fatal: It is the courage to continue that counts." ‚Äì Winston Churchill
      </div>
    </div>

    <div id="updatesNotifications" style="display: flex; gap: 20px; justify-content: center; flex-wrap: nowrap; margin-top: 20px;">
      <div class="box" style="flex: 1 1 300px; min-width: 300px;" data-panel-id="updates">
        <h2>üîÑ Updates</h2>
        <div class="update-entry">Dashboard Interface Update!</div>
        <div class="update-entry">New Exploits Added</div>
        <div class="update-entry">UI Overhaul Deployed</div>
      </div>

      <div class="box" style="flex: 1 1 300px; min-width: 300px;" data-panel-id="notifications">
        <h2>üîî Notifications</h2>
        <p>Starting to work on the log in system. Stay tuned for more!</p>
      </div>
    </div>

    <!-- Panel Toggle Buttons -->
    <div class="quick-bar" style="flex-wrap: wrap; margin-top: 30px;">
      <button onclick="dashboard.togglePanel('wifiPanel')">üì° School WiFi Information</button>
      <button onclick="dashboard.togglePanel('ipadPanel')">üì± School iPad Restrictions</button>
      <button onclick="dashboard.togglePanel('handbookPanel')">üìò Student Handbooks Information</button>
      <button onclick="dashboard.togglePanel('mapPanel')">üè´ School Building Map Information</button>
      <button onclick="dashboard.togglePanel('studentWebsitesPanel')">üåê Student Website's Information</button>
      <button onclick="dashboard.togglePanel('teacherWebsitesPanel')">üë©‚Äçüè´ Teacher Websites Information</button>
      <button onclick="dashboard.togglePanel('phoneDirectoryPanel')">üìû School Phone Directory Information</button>
      <button onclick="dashboard.togglePanel('cameraPanel')">üì∑ School Camera Information</button>
      <button onclick="dashboard.togglePanel('schoolInfoPanel')">üè´ School Information</button>
      <button onclick="dashboard.togglePanel('exploitPanel')">üß® Exploiting Tools</button>
      <button onclick="dashboard.togglePanel('bypassPanel')">üö™ Bypassing Tools</button>
      <button onclick="dashboard.togglePanel('vpnPanel')">üîê VPN Websites</button>
      <button onclick="dashboard.togglePanel('gamingPanel')">üéÆ Gaming Websites</button>
      <button onclick="dashboard.togglePanel('musicPanel')">üéµ Music Websites</button>
      <button onclick="dashboard.togglePanel('keyboardPanel')">üéπ Keyboard Tricks</button>
      <!-- Add placeholders for new panels/features -->
      <button onclick="dashboard.togglePanel('settingsPanel')">‚öôÔ∏è Settings</button>
      <button id="timerBtn">‚è±Ô∏è Timer</button>
      <button id="stopwatchBtn">‚è∫Ô∏è Stopwatch</button>
      <button id="activityLogBtn">üìú Activity Log</button>
      <button id="loginHistoryBtn">üë§ Login History</button>
      <button id="themesBtn">üé® Themes</button>
      <button id="calculatorBtn">üßÆ Calculator</button>
      <button id="unitConverterBtn">‚ÜîÔ∏è Unit Converter</button>
      <button id="statsBtn">üìä Stats</button>
      <button id="mediaBtn">üì∫ Media</button>
      <button id="reminderBtn">üîî Reminder</button>
    </div>

    <!-- Information Panels -->
    <div id="infoPanelsContainer" style="margin-top: 20px;">
      <!-- WiFi Panel -->
      <div id="wifiPanel" class="info-panel">
        <h2>üì° School WiFi Information</h2>
        <div class="wifi-grid">
          <div>Network Name</div>
          <div>Wifi Level</div>
          <div>Security Type</div>
          <div>Encryption</div>
          <div>Hidden?</div>
          <div>Monitored?</div>
          <div>Username</div>
          <div>Password</div>
        </div>
        
        <div class="wifi-entry">
          <div>Middletown_Core</div>
          <div class="wifi-level-high">High</div>
          <div>WPA3 Enterprise</div>
          <div>High</div>
          <div>No</div>
          <div>Yes</div>
          <div>Unknown</div>
          <div>Unknown</div>
        </div>
        
        <div class="wifi-entry">
          <div>Mtown_Core</div>
          <div class="wifi-level-high">High</div>
          <div>WPA3 Enterprise</div>
          <div>High</div>
          <div>Yes</div>
          <div>Unknown</div>
          <div>Unknown</div>
          <div>Unknown</div>
        </div>
        
        <div class="wifi-entry">
          <div>Mtown Guest</div>
          <div class="wifi-level-medium">Medium</div>
          <div>WPA3 Enterprise</div>
          <div>Medium</div>
          <div>No</div>
          <div>Rare</div>
          <div>msguest</div>
          <div>M@ms2021#</div>
        </div>
        
        <div class="wifi-entry">
          <div>Radius Test</div>
          <div class="wifi-level-low">Low</div>
          <div>WPA3 Enterprise</div>
          <div>Low</div>
          <div>No</div>
          <div>Rarely</div>
          <div>msguest</div>
          <div>M@ms2021#</div>
        </div>
      </div>

      <!-- iPad Panel -->
      <div id="ipadPanel" class="info-panel">
        <h2>üì± School iPad Restrictions</h2>
        <div class="ipad-options">
          <button onclick="dashboard.showIpadContent('restrictions')">Restrictions</button>
          <button onclick="dashboard.showIpadContent('bypasses')">Bypasses</button>
        </div>
        
        <div id="ipadRestrictions" class="ipad-content">
          <p>Coming soon</p>
        </div>
        
        <div id="ipadBypasses" class="ipad-content">
          <p>Coming soon</p>
        </div>
      </div>

      <!-- Handbook Panel -->
      <div id="handbookPanel" class="info-panel">
        <h2>üìò Student Handbooks Information</h2>
        <div class="handbook-buttons">
          <a href="https://cdnsm5-ss19.sharpschool.com/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/JAN2025A%20Elementary%20Handbook.pdf" target="_blank">Elementary Handbook (Jan 2025)</a>
          <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/JAN2025A%20Secondary%20Student%20Handbook.pdf" target="_blank">Secondary Student Handbook (Jan 2025)</a>
          <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/District%20Handbook%20copy.pdf" target="_blank">District Handbook</a>
          <a href="https://middletown.ss19.sharpschool.com/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/JAN2025B%20RA%20Academy%20Handbook%20copy.pdf" target="_blank">RA Academy Handbook (Jan 2025)</a>
          <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/2024-2025%20Virtual%20Learning%20Plan%20RSVD%20DEC2024.pdf" target="_blank">Virtual Learning Plan (2024-2025)</a>
          <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/2024-2025%20Dress%20Code.docx.pdf" target="_blank">Dress Code (2024-2025)</a>
        </div>
      </div>

      <!-- Map Panel -->
      <div id="mapPanel" class="info-panel">
        <h2>üè´ School Building Map Information</h2>
        <p>Building Map Display</p>
        <div class="coming-soon">
          Building Map Coming Soon
        </div>
      </div>

      <!-- Student Websites Panel -->
      <div id="studentWebsitesPanel" class="info-panel">
        <h2>üåê Student Website's Information</h2>
        <div class="links-list">
          <a href="https://www.raiderweb.org" target="_blank">RaiderWeb</a>
          <a href="https://middletownsd.instructure.com/login" target="_blank">Canvas Login</a>
          <a href="https://caresolace.com/site/middletownarea" target="_blank">Care Solace</a>
          <a href="https://clever.com/oauth/authorize?channel=clever&client_id=4c63c1cf623dce82caac&confirmed=true&redirect_uri=https%3A%2F%2Fclever.com%2Fin%2Fauth_callback&response_type=code&state=27d11080794f14661a58c2ec9edba8d87e50eb0160eeb669cc1bea184ce72062&district_id=55b90d2693d0390100000379" target="_blank">Clever Login</a>
          <a href="https://sso.rumba.pk12ls.com/sso/login?service=https://cat.easybridge.pk12ls.com/ca/dashboard.htm&idpmetadata=%20https://www.raiderweb.org" target="_blank">EasyBridge</a>
          <a href="https://myhealthyzone.fitnessgram.net" target="_blank">FitnessGram</a>
          <a href="https://www.raiderweb.org/student_services/hazing_reporting" target="_blank">Hazing Reporting</a>
          <a href="https://www.youtube.com/user/MAHSAnnouncements?app=desktop" target="_blank">MAHS Announcements</a>
          <a href="https://id.naviance.com" target="_blank">Naviance</a>
          <a href="https://raiderweb.follettdestiny.com/portal/portal?appId=destiny-SD5T-TB6F" target="_blank">Destiny Library</a>
          <a href="https://powerschool.raiderweb.org/public/" target="_blank">PowerSchool</a>
          <a href="https://idp-awsprod1.education.scholastic.com/idp/" target="_blank">Scholastic</a>
          <a href="https://www.safe2saypa.org" target="_blank">Safe2Say</a>
          <a href="https://mail.google.com/mail/" target="_blank">Gmail</a>
          <a href="https://www.balfour.com/pennsylvania/middletown/middletown-area-high-school" target="_blank">Balfour</a>
          <a href="https://raiderweb.linkit.com/Account/LogOn?ReturnUrl=%2f#" target="_blank">LinkIt!</a>
        </div>
      </div>

      <!-- Teacher Websites Panel -->
      <div id="teacherWebsitesPanel" class="info-panel">
        <h2>üë©‚Äçüè´ Teacher Websites Information</h2>
        <div class="links-list">
          <a href="https://alo.acadiencelearning.org/login" target="_blank">Acadience Learning</a>
          <a href="https://app.aimswebplus.com/#/login" target="_blank">AIMSweb Plus</a>
          <a href="https://ep1.erplinq.com/MIDDLETOWN/" target="_blank">ERP Linq</a>
          <a href="https://sso.barracuda.com/u/login/identifier?state=hKFo2SBFYnNBRjVRYmczc2t0ZjlSNmwxel9GT25LZ2o3QzVDV6Fur3VuaXZlcnNhbC1sb2dpbqN0aWTZIDQ1U0hHOGVubzF0eE10WlhiSkRZRnNQSmJqY1dwcnFlo2NpZNkgQk1yY2JuRWdkS3BkSjZRWGVjN0hiRHdlTkpMUW1MSUk" target="_blank">Barracuda</a>
          <a href="https://shop.buyguernsey.com/thmBootstrapHome.aspx" target="_blank">Buy Guernsey</a>
          <a href="https://middletownsd.instructure.com/login/ldap" target="_blank">Canvas (Teacher)</a>
          <a href="https://caresolace.com/site/middletownarea" target="_blank">Care Solace</a>
          <a href="https://clever.com/oauth/authorize?channel=clever&client_id=4c63c1cf623dce82caac&confirmed=true&redirect_uri=https%3A%2F%2Fclever.com%2Fin%2Fauth_callback&response_type=code&state=27d11080794f14661a58c2ec9edba8d87e50eb0160eeb669cc1bea184ce72062&district_id=55b90d2693d0390100000379" target="_blank">Clever (Teacher)</a>
          <a href="https://www.discoveryeducation.com" target="_blank">Discovery Education</a>
          <a href="https://sso.rumba.pk12ls.com/sso/login?service=https://cat.easybridge.pk12ls.com/ca/dashboard.htm&idpmetadata=%20https://www.raiderweb.org" target="_blank">EasyBridge (Teacher)</a>
          <a href="https://raiderweb.gofmx.com/login" target="_blank">FMX</a>
          <a href="https://myhealthyzone.fitnessgram.net" target="_blank">FitnessGram</a>
          <a href="https://login.frontlineeducation.com/login?signin=d0e98b785fd46dad06ce5509e61ef781&productId=ABSMGMT&clientId=ABSMGMT#/login" target="_blank">Frontline</a>
          <a href="https://raiderweb.linkit.com/Account/LogOn?ReturnUrl=%2f#" target="_blank">LinkIt! (Teacher)</a>
          <a href="https://id.naviance.com" target="_blank">Naviance</a>
          <a href="https://raiderweb.follettdestiny.com/portal/portal?appId=destiny-SD5T-TB6F" target="_blank">Destiny Library</a>
          <a href="https://paetep.edulinksolutions.com/login" target="_blank">PA eTEP</a>
          <a href="https://powerschool.raiderweb.org/teachers/pw.html" target="_blank">PowerSchool (Teacher)</a>
          <a href="https://idp-awsprod1.education.scholastic.com/idp/" target="_blank">Scholastic</a>
          <a href="https://go.schoolmessenger.com/#/home" target="_blank">SchoolMessenger</a>
          <a href="https://www.pdesas.org/standard/" target="_blank">PDE SAS</a>
          <a href="https://www.pbisapps.org" target="_blank">PBIS Apps</a>
          <a href="https://masd.happyfox.com/home/" target="_blank">HappyFox</a>
          <a href="https://middletownasd-pa.safeschools.com/login" target="_blank">SafeSchools</a>
          <a href="https://login.microsoftonline.com/common/oauth2/authorize?client_id=00000002-0000-0ff1-ce00-000000000000&redirect_uri=https%3a%2f%2foutlook.office.com%2fowa%2f&resource=00000002-0000-0ff1-ce00-000000000000&response_mode=form_post&response_type=code+id_token&scope=openid&msafed=1&msaredir=1&client-request-id=2318564a-0ba1-6e05-dc95-01e3d532fa2a&protectedtoken=true&claims=%7b%22id_token%22%3a%7b%22xms_cc%22%3a%7b%22values%22%3a%5b%22CP1%22%5d%7d%7d%7d&nonce=637946967978129696.e952fd14-38f0-4c99-9385-0e633dcd181b&state=DYu5EYAwDMAcOMYxiePgZxzI01KyPi6kU6MEAHuwBamEQIXVm7ioq1H1qHP6VdeghmyrYOvu6GwXlinMow8yelK8R36_O_8" target="_blank">Office 365</a>
        </div>
      </div>

      <!-- Phone Directory Panel -->
      <div id="phoneDirectoryPanel" class="info-panel">
        <h2>üìû School Phone Directory Information</h2>
        <div class="coming-soon">
          Update Coming Soon!
        </div>
      </div>

      <!-- Camera Panel -->
      <div id="cameraPanel" class="info-panel">
        <h2>üì∑ School Camera Information</h2>
        <div class="coming-soon">
          Update Coming Soon
        </div>
      </div>

      <!-- School Info Panel -->
      <div id="schoolInfoPanel" class="info-panel">
        <h2>üè´ School Information</h2>
        <div class="school-info-grid">
          <div class="school-info-item">
            <div class="school-info-label">School Name:</div>
            <div>Middletown Area Middle School</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">School Address:</div>
            <div>215 Oberlin Road Middletown, PA 17057</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">School Phone:</div>
            <div>717-930-0739</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">School Fax:</div>
            <div>717-944-0591</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">School Principal:</div>
            <div>Dr. Shannon L. Wevodau</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">Principal's Phone:</div>
            <div>717-930-0739</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">Principal's Email:</div>
            <div>swevodau@raiderweb.org</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">Assistant Principal:</div>
            <div>Mr. Michael DeFilippo</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">Assistant Principal's Phone:</div>
            <div>717-930-0739</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">Assistant Principal's Email:</div>
            <div>mdefilippo@raiderweb.org</div>
          </div>
        </div>
      </div>

      <!-- Exploit Panel -->
      <div id="exploitPanel" class="info-panel">
        <h2>üß® Exploiting Tools</h2>
        <div class="exploit-buttons">
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Blooket Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Kahoot Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Gimkit Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Quizlet Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Quizzes Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Quills Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Edpuzzle Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Nearpod Exploit</a>
        </div>
      </div>

      <!-- Bypass Panel -->
      <div id="bypassPanel" class="info-panel">
        <h2>üö™ Bypassing Tools</h2>
        <div class="bypass-buttons">
          <button onclick="dashboard.showBypassContent('bathroom')">Bathroom Bypass</button>
          <button onclick="dashboard.showBypassContent('wifi')">Wifi Bypass</button>
          <button onclick="dashboard.showBypassContent('monitoring')">Teacher Monitoring Bypass</button>
          <button onclick="dashboard.showBypassContent('coming1')">Coming Soon</button>
          <button onclick="dashboard.showBypassContent('coming2')">Coming Soon</button>
          <button onclick="dashboard.showBypassContent('coming3')">Coming Soon</button>
        </div>
        
        <div id="bathroomBypass" class="bypass-content">
          <p>COMING SOON</p>
        </div>
        
        <div id="wifiBypass" class="bypass-content">
          <p>Go to School Wifi Information</p>
        </div>
        
        <div id="monitoringBypass" class="bypass-content">
          <p>COMING SOON</p>
        </div>
        
        <div id="coming1Bypass" class="bypass-content">
          <p>COMING SOON</p>
        </div>
        
        <div id="coming2Bypass" class="bypass-content">
          <p>COMING SOON</p>
        </div>
        
        <div id="coming3Bypass" class="bypass-content">
          <p>COMING SOON</p>
        </div>
      </div>

      <!-- VPN Panel -->
      <div id="vpnPanel" class="info-panel">
        <h2>üîê VPN Websites</h2>
        <div class="links-list">
          <a href="https://example-vpn1.com" target="_blank">VPN Service 1</a>
          <a href="https://example-vpn2.com" target="_blank">VPN Service 2</a>
          <a href="https://example-vpn3.com" target="_blank">VPN Service 3</a>
          <a href="https://example-vpn4.com" target="_blank">VPN Service 4</a>
        </div>
      </div>

      <!-- Gaming Panel -->
      <div id="gamingPanel" class="info-panel">
        <h2>üéÆ Gaming Websites</h2>
        <div class="coming-soon">
          COMING SOON
        </div>
      </div>

      <!-- Music Panel -->
      <div id="musicPanel" class="info-panel">
        <h2>üéµ Music Websites</h2>
        <div class="coming-soon">
          COMING SOON
        </div>
      </div>

      <!-- Keyboard Panel -->
      <div id="keyboardPanel" class="info-panel">
        <h2>üéπ Keyboard Tricks</h2>
        <div class="info-text">
          <p>System Shortcuts:
‚Ä¢ Access Spotlight Search: Press Command (‚åò) + Space bar.
‚Ä¢ Return to the Home screen: Press Command (‚åò) + H.
‚Ä¢ Show the Dock: Press Command (‚åò) + Option (‚å•) + D.
‚Ä¢ Show the App Library: Press Shift (‚áß) + Globe + A.
‚Ä¢ Open Quick Note: Press Globe + Q.
‚Ä¢ Open Siri: Press Globe + S.
‚Ä¢ Open Control Center: Press Globe + C.
‚Ä¢ Open Notification Center: Press Globe + N.
‚Ä¢ Show all windows: Press Globe + Down Arrow.
‚Ä¢ Open the App Switcher: Press Globe + Up Arrow.
Multitasking Shortcuts:
‚Ä¢ Switch to the last active app: Press Command (‚åò) + Tab.
‚Ä¢ View all active apps: Press and hold Command (‚åò) + Tab.
‚Ä¢ Open Split View: Press Control (‚åÉ) + Globe + Left Arrow to move an app to the left, or Control (‚åÉ) + Globe + Right Arrow to move it to the right.
‚Ä¢ Switch the position of apps in Split View: Press Control (‚åÉ) + Globe + Left or Right Arrow.
‚Ä¢ Open Slide Over: Press Globe + Backslash.
‚Ä¢ Move the Slide Over window: Press Option (‚å•) + Globe + Left or Right Arrow.
Safari and App-Specific Shortcuts:
‚Ä¢ Take a full-screen screenshot: Press Command (‚åò) + Shift + 3.
‚Ä¢ Take a screenshot and enter markup immediately: Press Command (‚åò) + Shift + 4.
‚Ä¢ Open a new private tab: Press Command (‚åò) + Shift + N.
‚Ä¢ Open a new tab: Press Command (‚åò) + T or Command (‚åò) + N.
‚Ä¢ Close the current tab: Press Command (‚åò) + W.
‚Ä¢ Close all tabs in Tab Grid: Press Shift + Command (‚åò) + W.
‚Ä¢ Go to the next tab: Press Option (‚å•) + Command (‚åò) + Right Arrow, or Control (‚åÉ) + Tab, or Command (‚åò) + }.
‚Ä¢ Go to the previous tab: Press Option (‚å•) + Command (‚åò) + Left Arrow, or Shift + Control (‚åÉ) + Tab, or Command (‚åò) + {.
‚Ä¢ Reopen the last closed tab: Press Shift + Command (‚åò) + T.
‚Ä¢ Go to a specific tab (1-8): Press Command (‚åò) + (1-8).
‚Ä¢ Go to the last tab: Press Command (‚åò) + 9.
‚Ä¢ Open the Tab Grid: Press Shift + Command (‚åò) + .
‚Ä¢ Open a new Incognito tab: Press Shift + Command (‚åò) + N.
‚Ä¢ Open a new Incognito window: Press Option (‚å•) + Shift + Command (‚åò) + N.
‚Ä¢ Open a new window: Press Option (‚å•) + Command (‚åò) + N.
General Navigation and Text Editing:
‚Ä¢ Navigate between elements in an app (like fields, lists, buttons): Press Tab.
‚Ä¢ Select all text: Press Command (‚åò) + A.
‚Ä¢ Copy selected text: Press Command (‚åò) + C.
‚Ä¢ Cut selected text: Press Command (‚åò) + X.
‚Ä¢ Paste copied text: Press Command (‚åò) + V.
‚Ä¢ Undo the last action: Press Command (‚åò) + Z.
‚Ä¢ Redo the last undone action: Press Command (‚åò) + Shift + Z.
‚Ä¢ Jump to the top of a page: Press Command (‚åò) + Up Arrow.
‚Ä¢ Jump to the bottom of a page: Press Command (‚åò) + Down Arrow.
‚Ä¢ Highlight text one character at a time: Press Shift + Left or Right Arrow.
To view all available shortcuts for the specific app you are using, press and hold the Command (‚åò) key. For a complete list of system-wide shortcuts, press and hold the Globe key on a compatible keyboard.</p>
        </div>
      </div>
    </div>

    <!-- Placeholder for additional panels -->
    <div id="settingsPanel" class="info-panel">
      <h2>‚öôÔ∏è Settings</h2>
      <p>Customize your dashboard experience:</p>
      <div style="display: flex; flex-wrap: wrap; gap: 10px;">
          <button class="setting-option">Theme Customization</button>
          <button class="setting-option">Profile Management</button>
          <button class="setting-option">Display Settings</button>
          <button class="setting-option">Sound Preferences</button>
          <button class="setting-option">Privacy Settings</button>
          <button class="setting-option">Account Security</button>
          <button class="setting-option">Notification Preferences</button>
          <button class="setting-option">Cache Management</button>
          <button class="setting-option">Font Scaling</button>
          <button class="setting-option">Language Options</button>
          <button class="setting-option">Backup Settings</button>
          <button class="setting-option">Integrations</button>
          <button class="setting-option">Advanced Options</button>
          <button class="setting-option">About System</button>
          <button class="setting-option">Reset Defaults</button>
      </div>
    </div>

    <div id="factsPanel" class="info-panel">
      <h2>üí° Random Facts</h2>
      <p id="randomFact">Loading fact...</p>
    </div>

    <div id="quotesPanel" class="info-panel">
      <h2>üí¨ Daily Quotes</h2>
      <p id="dailyQuote">Loading quote...</p>
    </div>


    <div id="canvasContainer">
      <h2>üñåÔ∏è Notes Canvas</h2>
      <canvas id="notesCanvas" width="600" height="400"></canvas>
      <div id="canvasControls">
        <!-- Add more canvas controls -->
        <button id="changeCanvasColorBtn" title="Choose Brush Color">üé® Color</button>
        <input type="range" id="canvasStrokeWidth" min="1" max="15" value="2" title="Stroke Thickness">
        <button id="changeCanvasMaterialBtn" title="Change Brush Style">üîß Brush</button> <!-- Placeholder for material -->
        <textarea id="canvasText" placeholder="Type text here..." rows="2" cols="30"></textarea>
        <button id="addCanvasTextBtn" title="Add text to canvas">Add Text</button>
        
        <button id="clearCanvasBtn" title="Clear the entire canvas">Clear Canvas</button>
        <button id="closeCanvasBtn" title="Close the notes editor">Close Notes</button>
      </div>
    </div>
    
    <!-- New Activity Log Display -->
    <div id="activityLogDisplay" class="info-panel">
        <h2>üìú System Activity Log</h2>
        <ul id="activityLogList" style="list-style: none; padding: 0;"></ul>
    </div>

    <!-- New Login History Display -->
    <div id="loginHistoryDisplay" class="info-panel">
        <h2>üë§ Login History</h2>
        <p><strong>Last Login:</strong> <span id="lastLoginInfo">Loading...</span></p>
    </div>
  </div>

  <script>
    // Global activity logs array
    window.activityLogs = []; // Stores all actions for the Activity Log feature

    // Helper to log actions (adds to global activityLogs array)
    function logAction(actionDescription, details = {}) {
        const now = new Date();
        const logEntry = {
            timestamp: now.toISOString(),
            action: actionDescription,
            details: details
        };
        window.activityLogs.push(logEntry);
        // console.log(`Logged: ${actionDescription}`, details); // For debugging
    }

    // Dashboard functionality object
    const dashboard = {
      // Initialize all dashboard functionality
      init: function() {
        this.initSessionTimer();
        this.initClock();
        this.generateCalendar();
        this.initThemeToggle();
        this.initButtons();
        this.initCanvas();
        this.initPanels();
        this.initQuickBar();
        this.initSearch();
        this.initLogDownloadButton();
        this.initMakePanelsDraggableAndResizable();
        this.initTools();
        this.initThemeDisplay();
        this.fetchRandomFact();
        this.fetchDailyQuote();
        this.initActivityLogBtn();
        this.initLoginHistoryBtn();
        this.applyWifiLevelColors(); // New function
      },
      
      // Initialize session timer
      initSessionTimer: function() {
        let sessionSeconds = 0;
        function formatTime(seconds) {
          const hrs = String(Math.floor(seconds / 3600)).padStart(2, '0');
          const mins = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
          const secs = String(seconds % 60).padStart(2, '0');
          return `${hrs}:${mins}:${secs}`;
        }
        
        const sessionTimeElement = document.getElementById('sessionTime');
        if (sessionTimeElement) {
          sessionTimeElement.innerText = `‚è≥ Session Time: ${formatTime(sessionSeconds)}`;
          setInterval(function() {
            sessionSeconds++;
            sessionTimeElement.innerText = `‚è≥ Session Time: ${formatTime(sessionSeconds)}`;
          }, 1000);
        }
      },
      
      // Initialize real-time clock
      initClock: function() {
        const realTimeClock = document.getElementById('realTimeClock');
        const realDate = document.getElementById('realDate');

        if (realTimeClock && realDate) {
          function updateClock() {
            const now = new Date();
            // Check for 24-hour format from login screen context
            const is24hr = typeof is24HourFormat !== 'undefined' ? is24HourFormat : false;
            const optionsTime = { hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: !is24hr };
            const optionsDate = { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' };
            const timeStr = now.toLocaleTimeString(undefined, optionsTime);
            const dateStr = now.toLocaleDateString(undefined, optionsDate);

            realTimeClock.innerText = 'üïí ' + timeStr;
            realDate.innerText = 'üìÖ ' + dateStr;
          }
          
          updateClock();
          setInterval(updateClock, 1000);
        }
      },
      
      // Generate calendar
      generateCalendar: function() {
        const calendar = document.getElementById('calendar');
        if (calendar) {
          calendar.innerHTML = ''; 
          const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
          days.forEach(day => {
            const div = document.createElement('div');
            div.innerText = day;
            calendar.appendChild(div);
          });

          const date = new Date();
          const year = date.getFullYear();
          const month = date.getMonth();
          const today = date.getDate();

          const firstDay = new Date(year, month, 1).getDay();
          const lastDate = new Date(year, month + 1, 0).getDate();

          for (let i = 0; i < firstDay; i++) {
            const empty = document.createElement('div');
            calendar.appendChild(empty);
          }

          for (let i = 1; i <= lastDate; i++) {
            const cell = document.createElement('div');
            cell.innerText = i;
            if (i === today) cell.classList.add('today');
            calendar.appendChild(cell);
          }
        }
      },
      
      // Initialize theme toggle
      initThemeToggle: function() {
        const themeBtn = document.getElementById('themeToggle');
        if (themeBtn) {
          themeBtn.addEventListener('click', () => {
            logAction("Theme Toggled");
            document.body.classList.toggle('light-theme');
            if(document.body.classList.contains('light-theme')){
              themeBtn.innerText = '‚òÄÔ∏è Light Mode';
            } else {
              themeBtn.innerText = 'üåô Dark Mode';
            }
          });
        }
      },
      
      // Initialize general dashboard buttons
      initButtons: function() {
        const panicBtn = document.getElementById('panicBtn');
        if (panicBtn) {
          panicBtn.addEventListener('click', () => {
            logAction("Panic Button Clicked");
            window.open('https://clever.com', '_blank'); // Open Clever.com in a new tab
          });
        }

        const restartBtn = document.getElementById('restartBtn');
        if (restartBtn) {
          restartBtn.addEventListener('click', () => {
            logAction("Restart Button Clicked");
            if(confirm('Are you sure you want to restart the dashboard? This will refresh the page.')) {
              // Reload the current page to simulate a restart
              window.location.reload();
            }
          });
        }

        const fixIssuesBtn = document.getElementById('fixIssuesBtn');
        if (fixIssuesBtn) {
          fixIssuesBtn.addEventListener('click', () => {
            logAction("Fix Issues Button Clicked");
            alert('Running diagnostics...\nNo issues found. Your dashboard is running smoothly!');
          });
        }
        
        const fullScreenBtn = document.getElementById('fullScreenBtn');
        if (fullScreenBtn) {
          fullScreenBtn.addEventListener('click', () => {
            logAction("Fullscreen Button Toggled");
            if (!document.fullscreenElement) {
              if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen();
              } else if (document.documentElement.webkitRequestFullscreen) { /* Safari */
                document.documentElement.webkitRequestFullscreen();
              } else if (document.documentElement.msRequestFullscreen) { /* IE11 */
                document.documentElement.msRequestFullscreen();
              }
            } else {
              if (document.exitFullscreen) {
                document.exitFullscreen();
              } else if (document.webkitExitFullscreen) { /* Safari */
                document.webkitExitFullscreen();
              } else if (document.msExitFullscreen) { /* IE11 */
                document.msExitFullscreen();
              }
            }
          });
        }
        
        let zoomLevel = 1;
        const zoomStep = 0.1;
        const minZoom = 0.5;
        const maxZoom = 2.0; // Limit zoom

        const zoomInBtn = document.getElementById('zoomInBtn');
        const zoomOutBtn = document.getElementById('zoomOutBtn');

        function updateZoom(direction) {
          // Get current zoom from body style, default to 1 if not set
          let currentZoom = parseFloat(document.body.style.zoom || '1');
          let newZoom = currentZoom;

          if (direction === 'in') {
            newZoom += zoomStep;
            if (newZoom > maxZoom) newZoom = maxZoom; // Cap at maxZoom
          } else if (direction === 'out') {
            newZoom -= zoomStep;
            if (newZoom < minZoom) newZoom = minZoom; // Floor at minZoom
          }
          
          document.body.style.zoom = newZoom;
          logAction(`Zoom ${direction} Button Clicked`, { level: newZoom });
        }

        if (zoomInBtn) {
          zoomInBtn.addEventListener('click', () => {
            updateZoom('in');
          });
        }
        if (zoomOutBtn) {
          zoomOutBtn.addEventListener('click', () => {
            updateZoom('out');
          });
        }
      },
      
      // Initialize canvas for notes
      initCanvas: function() {
        const notesBtn = document.getElementById('notesBtn');
        const canvasContainer = document.getElementById('canvasContainer');
        const mainGrid = document.getElementById('mainGrid');

        // Ensure canvas elements and controls are available
        if (!notesBtn || !canvasContainer || !mainGrid) return;

        notesBtn.addEventListener('click', () => {
          logAction("Notes Button Clicked");
          mainGrid.style.display = 'none'; // Hide main content
          canvasContainer.style.display = 'block'; // Show canvas
          document.getElementById('dashboard').classList.add('canvas-view'); // Add class for potential styling changes
        });

        const closeCanvasBtn = document.getElementById('closeCanvasBtn');
        if (closeCanvasBtn) {
          closeCanvasBtn.addEventListener('click', () => {
            logAction("Close Notes Button Clicked");
            canvasContainer.style.display = 'none';
            mainGrid.style.display = 'flex'; // Show main content again
            document.getElementById('dashboard').classList.remove('canvas-view'); // Remove class
          });
        }

        // Canvas context and initial setup
        const canvas = document.getElementById('notesCanvas');
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = '#fff'; // White background for canvas
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        let drawing = false;
        let currentLineColor = '#ff914d'; // Default stroke color (orange)
        let currentLineWidth = 2; // Default stroke thickness

        // Drawing functions
        function getPos(evt) {
          const rect = canvas.getBoundingClientRect();
          // Handle touch and mouse events
          const clientX = evt.clientX || evt.touches[0].clientX;
          const clientY = evt.clientY || evt.touches[0].clientY;
          return {
            x: clientX - rect.left,
            y: clientY - rect.top
          };
        }

        function startDrawing(evt) {
          drawing = true;
          const pos = getPos(evt);
          ctx.beginPath();
          ctx.moveTo(pos.x, pos.y);
          ctx.strokeStyle = currentLineColor;
          ctx.lineWidth = currentLineWidth;
          ctx.lineCap = 'round'; // Rounded line endings
          ctx.lineJoin = 'round'; // Rounded corners
          evt.preventDefault();
        }

        function draw(evt) {
          if (!drawing) return;
          const pos = getPos(evt);
          ctx.lineTo(pos.x, pos.y);
          ctx.stroke();
          evt.preventDefault();
        }

        function stopDrawing(evt) {
          if (drawing) {
            drawing = false;
            logAction("Finished drawing stroke", { color: currentLineColor, width: currentLineWidth });
          }
          // For mouse events, prevent default text selection behavior
          if (evt.type === 'mouseup' || evt.type === 'mouseleave') {
              evt.preventDefault();
          }
        }

        // Event listeners for drawing
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('touchstart', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('touchmove', draw);
        ['mouseup', 'mouseleave', 'touchend', 'touchcancel'].forEach(evtName => {
          canvas.addEventListener(evtName, stopDrawing);
        });

        // Canvas Controls Event Listeners
        const clearCanvasBtn = document.getElementById('clearCanvasBtn');
        if (clearCanvasBtn) {
          clearCanvasBtn.addEventListener('click', () => {
            logAction("Clear Canvas Button Clicked");
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#fff'; // Reset background to white
            ctx.fillRect(0, 0, canvas.width, canvas.height);
          });
        }

        // Color Picker
        const changeCanvasColorBtn = document.getElementById('changeCanvasColorBtn');
        if (changeCanvasColorBtn) {
            // Create a hidden color input and link it to the button
            const colorInput = document.createElement('input');
            colorInput.type = 'color';
            colorInput.style.display = 'none';
            colorInput.value = currentLineColor; // Set initial value
            document.body.appendChild(colorInput);

            changeCanvasColorBtn.addEventListener('click', () => {
                colorInput.click(); // Trigger the hidden color picker
            });

            colorInput.addEventListener('input', (e) => {
                currentLineColor = e.target.value;
                ctx.strokeStyle = currentLineColor; // Update context for new strokes
                logAction("Canvas Color Changed", { color: currentLineColor });
            });
        }

        // Stroke Thickness Slider
        const canvasStrokeWidthInput = document.getElementById('canvasStrokeWidth');
        if (canvasStrokeWidthInput) {
          canvasStrokeWidthInput.addEventListener('input', (e) => {
            currentLineWidth = parseInt(e.target.value, 10);
            ctx.lineWidth = currentLineWidth; // Update context for new strokes
            logAction("Canvas Stroke Width Changed", { width: currentLineWidth });
          });
        }

        // Brush Style Placeholder
        const changeCanvasMaterialBtn = document.getElementById('changeCanvasMaterialBtn');
        if (changeCanvasMaterialBtn) {
            changeCanvasMaterialBtn.addEventListener('click', () => {
                // Placeholder for more advanced brush effects (e.g., patterns, different shapes)
                logAction("Brush Style Button Clicked", { action: "Placeholder" });
                alert("Brush style customization is not yet implemented.");
            });
        }

        // Add Text to Canvas
        const addCanvasTextBtn = document.getElementById('addCanvasTextBtn');
        const canvasTextarea = document.getElementById('canvasText');
        if (addCanvasTextBtn && canvasTextarea) {
            addCanvasTextBtn.addEventListener('click', () => {
                const textToAdd = canvasTextarea.value.trim();
                if (textToAdd) {
                    logAction("Adding Text to Canvas", { text: textToAdd, color: currentLineColor, fontSize: `${currentLineWidth * 10}px` });
                    ctx.fillStyle = currentLineColor; // Use current color for text
                    ctx.font = `${currentLineWidth * 10}px 'Montserrat', sans-serif`; // Scale font with thickness
                    ctx.fillText(textToAdd, 20, 50); // Position text near the top-left
                    canvasTextarea.value = ''; // Clear textarea
                }
            });
        }

        // Screenshot Button
        const screenshotBtn = document.getElementById('screenshotBtn');
        if (screenshotBtn) {
          screenshotBtn.addEventListener('click', () => {
            logAction("Screenshot Button Clicked");
            const elementToCapture = document.body; // Capture the whole body
            html2canvas(elementToCapture).then(canvasImg => {
              const link = document.createElement('a');
              link.download = `dashboard_screenshot_${new Date().toISOString().replace(/[-T:]/g, '')}.png`;
              link.href = canvasImg.toDataURL('image/png');
              document.body.appendChild(link);
              link.click();
              document.body.removeChild(link); // Clean up
            }).catch(error => {
                console.error("Screenshot failed:", error);
                alert("Failed to capture screenshot.");
            });
          });
        }
        
        const exportNotesBtn = document.getElementById('exportNotesBtn');
        if (exportNotesBtn) {
          exportNotesBtn.addEventListener('click', () => {
            logAction("Export Notes Button Clicked");
            const link = document.createElement('a');
            link.download = `notes_canvas_${new Date().toISOString().replace(/[-T:]/g, '')}.png`;
            link.href = canvas.toDataURL('image/png'); // Export current canvas content as PNG
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link); // Clean up
          });
        }

        // Toggle Sections Button
        const toggleSectionsBtn = document.getElementById('toggleSectionsBtn');
        if (toggleSectionsBtn) {
          toggleSectionsBtn.addEventListener('click', () => {
            logAction("Toggle Sections Button Clicked");
            // Check current state and toggle display of main content vs. notes/other editors
            const isContentHidden = mainGrid.style.display === 'none';
            mainGrid.style.display = isContentHidden ? 'flex' : 'none';
            toggleSectionsBtn.innerText = isContentHidden ? '‚¨ÜÔ∏è Hide Sections' : '‚¨áÔ∏è Show Sections'; // Update button text
            // Update activity logs if applicable
            logAction("Dashboard Sections Toggled", { state: isContentHidden ? "visible" : "hidden" });
          });
        }
      },
      
      // Initialize panels display and behaviour
      initPanels: function() {
        // Hide all specific content panels initially
        document.querySelectorAll('.info-panel, .ipad-content, .bypass-content').forEach(el => {
          el.style.display = 'none';
        });
      },
      
      // Initialize quick bar elements and behaviours
      initQuickBar: function() {
        // Button behaviors are handled by initButtons() and other specific initializations
      },
      
      // Search bar functionality for dashboard quick bar
      initSearch: function() {
        const searchInput = document.getElementById('dashboardSearch');
        if (searchInput) {
          searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
              e.preventDefault(); // Prevent default form submission behavior
              const query = searchInput.value.trim().toLowerCase();
              if (!query) return; // Do nothing if query is empty

              logAction("Dashboard Search Submitted", { query: query });
              
              let found = false;

              // Attempt to find and scroll to elements or trigger panel visibility
              // Search for panel titles or common keywords
              const panels = document.querySelectorAll('.info-panel, .box h2, #settingsPanel');
              for (const panel of panels) {
                  if (panel.textContent.toLowerCase().includes(query) || 
                      (panel.dataset.panelId && panel.dataset.panelId.includes(query)) || // Check data-panel-id
                      (panel.id && panel.id.toLowerCase().includes(query.replace(' ', ''))) // Try matching panel ID
                     ) 
                  {
                      // If it's an info-panel that needs toggling
                      if (panel.classList.contains('info-panel')) {
                          // Check if it's already visible; if not, toggle and scroll
                          if (panel.style.display === 'none') {
                              dashboard.togglePanel(panel.id);
                              logAction(`Searched and opened panel: ${panel.id}`);
                          }
                      }
                      panel.scrollIntoView({ behavior: 'smooth', block: 'center' }); // Scroll to the found element
                      found = true;
                      break; // Stop after finding the first match
                  }
              }

              // Specific actions not directly tied to panels
              if (query === 'notes' || query === 'canvas') {
                  document.getElementById('notesBtn')?.click(); // Simulate clicking notes button
                  found = true;
              } else if (query === 'timer') {
                  document.getElementById('timerBtn')?.click();
                  found = true;
              } else if (query === 'stopwatch') {
                  document.getElementById('stopwatchBtn')?.click();
                  found = true;
              } else if (query === 'activity log' || query === 'logs') {
                  document.getElementById('activityLogBtn')?.click();
                  found = true;
              } else if (query === 'login history' || query === 'history') {
                  document.getElementById('loginHistoryBtn')?.click();
                  found = true;
              }

              if (!found) {
                  alert(`Section or feature "${searchInput.value}" not found.`);
              }
            }
          });
        }
      },
      
      // New Button: Download Activity Logs
      initLogDownloadButton: function() {
          const btn = document.getElementById('downloadActivityLogsBtn');
          if (btn) {
              btn.addEventListener('click', () => {
                  logAction("Download Activity Logs Button Clicked");
                  if (window.activityLogs && window.activityLogs.length > 0) {
                      const logString = JSON.stringify(window.activityLogs, null, 2);
                      const blob = new Blob([logString], { type: 'application/json' });
                      const url = URL.createObjectURL(blob);
                      
                      const a = document.createElement('a');
                      a.href = url;
                      a.download = `activity_logs_${new Date().toISOString().replace(/[-T:]/g, '')}.json`;
                      document.body.appendChild(a); // Append to body to ensure click works
                      a.click();
                      URL.revokeObjectURL(url); // Release the object URL
                      document.body.removeChild(a); // Clean up
                  } else {
                      alert('No activity logs to download.');
                  }
              });
          }
      },
      
      // Function to make panels draggable and resizable
      initMakePanelsDraggableAndResizable: function() {
          // Make .box elements (panels) draggable and resizable
          interact('.box')
              .draggable({
                  inertia: true,
                  autoScroll: true,
                  onmove: function (event) {
                      const target = event.target;
                      // Keep the target within the viewport or a specific container if needed
                      const x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx;
                      const y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;

                      // update the position of the element
                      target.style.transform = 'translate(' + x + 'px, ' + y + 'px)';
                      
                      // Store the transform values
                      target.setAttribute('data-x', x);
                      target.setAttribute('data-y', y);
                  },
                  onend: function(event) {
                      logAction("Panel Dragged", { panelId: event.target.dataset.panelId || 'Unknown', position: `${event.target.getAttribute('data-x')},${event.target.getAttribute('data-y')}` });
                  }
              })
              .resizable({
                  // Define the handles for resizing
                  handles: {
                      topLeft: '.handle.top-left', // Custom handle example if needed
                      topRight: '.handle.top-right',
                      bottomLeft: '.handle.bottom-left',
                      bottomRight: '.handle.bottom-right',
                      // ... you can define others like top, left, right, bottom
                  },
                  // Set the actual handles class used in HTML
                  // Default uses 'resize-handle' and 'resize-handle-x/-y', but we'll use a common class
                  // Note: '.handle' is added programmatically below. Using just '.handle' here.
                  handles: '.handle',
                  
                  // Constraints: don't allow shrinking below a minimum size
                  edges: {
                      left: '.handle.left', right: '.handle.right',
                      bottom: '.handle.bottom', top: '.handle.top'
                  },
                  
                  // Setting to allow aspect ratio adjustment (if needed, false by default)
                  preserveAspectRatio: false,
                  
                  // Apply the resized dimensions to the transform style for smoother interaction
                  // Interact.js will manage modifying these values
                  style: {
                    // Use transforms for position/size modifications to keep it fluid
                  },

                  // Apply modifiers to constrain size
                  modifiers: [
                      interact.modifiers.restrictSize({
                          min: { width: 200, height: 120 } // Minimum size for panels
                      })
                  ],
                  autoScroll: true // Scroll page if drag goes to edge
              })
              .on('resizing', function (event) {
                  const target = event.target;
                  const x = (parseFloat(target.getAttribute('data-x')) || 0);
                  const y = (parseFloat(target.getAttribute('data-y')) || 0);

                  // Update the element's size
                  target.style.width = event.rect.width + 'px';
                  target.style.height = event.rect.height + 'px';

                  // Apply existing translation (from dragging)
                  target.style.transform = `translate(${x}px, ${y}px)`;
              })
              .on('resizeend', function(event) {
                logAction("Panel Resized", { panelId: event.target.dataset.panelId || 'Unknown', size: `${event.rect.width}x${event.rect.height}` });
              });

          // Add resize handles to each .box and other draggable elements if needed
          // Also add data-panel-id for easier reference
          document.querySelectorAll('.main-row .box, #updatesNotifications .box').forEach(panel => {
              // Set unique IDs if not already present or data-panel-id is not set
              if (!panel.id) {
                  panel.id = `panel-${Math.random().toString(36).substr(2, 9)}`; // Generate a unique ID if missing
              }
              if (!panel.dataset.panelId) { // Use ID if panelId is missing
                  panel.dataset.panelId = panel.id;
              }

              // Add handle if it doesn't exist
              if (!panel.querySelector('.handle')) {
                  const handle = document.createElement('div');
                  handle.className = 'handle';
                  // Specific positions if needed:
                  // handle.classList.add('bottom-right'); 
                  panel.style.position = 'relative'; // Ensure panel is positioned relative to contain handle
                  panel.appendChild(handle);
              }
              // Initialize data attributes for interact.js
              panel.setAttribute('data-x', 0);
              panel.setAttribute('data-y', 0);
          });
      },
      
      // Toggle panel visibility
      togglePanel: function(panelId) {
        const panel = document.getElementById(panelId);
        if (panel) {
          const isHidden = panel.style.display === 'none';
          panel.style.display = isHidden ? 'block' : 'none';
          logAction(`Panel Toggled`, { panelId: panelId, state: isHidden ? 'visible' : 'hidden' });
          // If showing, ensure it's in view or scrolled to
          if (isHidden) {
              // Scroll into view if it might be off-screen
              // panel.scrollIntoView({ behavior: 'smooth', block: 'center' }); 
              // Or better, a slight delay before scroll to ensure display change registers
              setTimeout(() => panel.scrollIntoView({ behavior: 'smooth', block: 'center' }), 100);
          }
        }
      },
      
      // Show content within specific panels like iPad
      showIpadContent: function(contentId) {
        document.querySelectorAll('.ipad-content').forEach(content => {
          content.style.display = 'none';
        });
        const targetContent = document.getElementById('ipad' + contentId.charAt(0).toUpperCase() + contentId.slice(1));
        if (targetContent) {
          targetContent.style.display = 'block';
          logAction("iPad Content Shown", { contentType: contentId });
        }
      },
      
      // Show content within bypass panels
      showBypassContent: function(contentId) {
        document.querySelectorAll('.bypass-content').forEach(content => {
          content.style.display = 'none';
        });
        const targetContent = document.getElementById(contentId + 'Bypass');
        if (targetContent) {
          targetContent.style.display = 'block';
          logAction("Bypass Content Shown", { contentType: contentId });
        }
      },

      // Initialize Tools (Timer, Stopwatch, Reminder)
      initTools: function() {
          let timerInterval = null;
          let stopwatchInterval = null;
          let timerRunning = false;
          let stopwatchRunning = false;
          let timerSeconds = 0; // In seconds

          const timerBtn = document.getElementById('timerBtn');
          const stopwatchBtn = document.getElementById('stopwatchBtn');
          const reminderBtn = document.getElementById('reminderBtn');

          // Helper function to format seconds into HH:MM:SS
          function formatTimeHMS(totalSeconds) {
              const hrs = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
              const mins = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
              const secs = String(totalSeconds % 60).padStart(2, '0');
              return `${hrs}:${mins}:${secs}`;
          }

          // Timer functionality
          if (timerBtn) {
              timerBtn.addEventListener('click', () => {
                  logAction("Timer Button Clicked");
                  const durationInput = prompt("Enter Timer Duration (e.g., 1h, 30m, 90s):");
                  if (!durationInput) return;

                  let durationMs = 0;
                  const durationLower = durationInput.toLowerCase();
                  if (durationLower.endsWith('h')) {
                      durationMs = parseFloat(durationLower.slice(0, -1)) * 60 * 60 * 1000;
                  } else if (durationLower.endsWith('m')) {
                      durationMs = parseFloat(durationLower.slice(0, -1)) * 60 * 1000;
                  } else if (durationLower.endsWith('s')) {
                      durationMs = parseFloat(durationLower.slice(0, -1)) * 1000;
                  } else { // Assume it's seconds if no unit specified
                      durationMs = parseFloat(durationLower) * 1000;
                  }

                  if (isNaN(durationMs) || durationMs <= 0) {
                      alert("Invalid duration. Please use formats like '1h', '30m', '90s', or just '60' for seconds.");
                      return;
                  }

                  if (!timerRunning) {
                      timerRunning = true;
                      timerSeconds = durationMs / 1000; // Convert to seconds
                      alert(`Timer set for ${durationInput}. Starting now.`);
                      
                      timerBtn.innerText = `‚è±Ô∏è ${formatTimeHMS(timerSeconds)}`;

                      timerInterval = setInterval(() => {
                          if (timerSeconds <= 0) {
                              clearInterval(timerInterval);
                              timerRunning = false;
                              alert("‚è∞ Timer Finished!"); // Alert for timer end
                              logAction("Timer Finished");
                              timerBtn.innerText = "‚è±Ô∏è Timer"; // Reset button text
                              return;
                          }
                          timerSeconds--;
                          timerBtn.innerText = `‚è±Ô∏è ${formatTimeHMS(timerSeconds)}`;
                      }, 1000);
                  } else {
                      alert("Timer is already running.");
                  }
              });
          }

          // Stopwatch functionality
          if (stopwatchBtn) {
              stopwatchBtn.addEventListener('click', () => {
                  logAction("Stopwatch Button Clicked");
                  if (!stopwatchRunning) {
                      stopwatchRunning = true;
                      let stopwatchSecondsElapsed = 0;
                      stopwatchBtn.innerText = "Stopwatch 00:00:00"; // Reset display
                      stopwatchInterval = setInterval(() => {
                          stopwatchSecondsElapsed++;
                          stopwatchBtn.innerText = `‚è∫Ô∏è ${formatTimeHMS(stopwatchSecondsElapsed)}`;
                      }, 1000);
                      logAction("Stopwatch Started");
                  } else {
                      clearInterval(stopwatchInterval);
                      stopwatchRunning = false;
                      logAction("Stopwatch Stopped", { duration: stopwatchBtn.innerText });
                      // Button text retains the last logged value
                  }
              });
          }

          // Reminder functionality
          if (reminderBtn) {
              reminderBtn.addEventListener('click', () => {
                  logAction("Reminder Button Clicked");
                  const message = prompt("Enter Reminder Message:");
                  if (!message) return; // Cancelled

                  const timeStr = prompt("Enter Reminder Time (e.g., HH:MM in 24-hour format):");
                  if (!timeStr) return; // Cancelled

                  const timeParts = timeStr.split(':');
                  if (timeParts.length !== 2) {
                      alert("Invalid time format. Please use HH:MM.");
                      return;
                  }

                  const hours = parseInt(timeParts[0], 10);
                  const minutes = parseInt(timeParts[1], 10);

                  if (isNaN(hours) || isNaN(minutes) || hours < 0 || hours > 23 || minutes < 0 || minutes > 59) {
                      alert("Invalid hours or minutes. Please enter values between 00-23 for hours and 00-59 for minutes.");
                      return;
                  }

                  const now = new Date();
                  const reminderTime = new Date();
                  reminderTime.setHours(hours);
                  reminderTime.setMinutes(minutes);
                  reminderTime.setSeconds(0);
                  reminderTime.setMilliseconds(0);

                  // If the set time has already passed today, schedule for next day
                  if (reminderTime <= now) {
                      reminderTime.setDate(reminderTime.getDate() + 1);
                  }

                  const timeUntil = reminderTime.getTime() - now.getTime();
                  
                  setTimeout(() => {
                      alert(`üîî REMINDER: ${message}`); // Show alert without sound
                      logAction("Reminder Alert Shown", { message: message, reminderTime: reminderTime.toISOString() });
                  }, timeUntil);
                  
                  alert(`Reminder set for ${reminderTime.toLocaleString()}`);
              });
          }
      },

      // Initialize theme display selection (placeholder)
      initThemeDisplay: function() {
          const themesBtn = document.getElementById('themesBtn');
          if (themesBtn) {
              themesBtn.addEventListener('click', () => {
                  logAction("Themes Button Clicked");
                  alert("Theme selection is available in the Settings panel. (Future feature: More themes to be added)");
              });
          }
      },

      // Fetch random fact using a public API
      fetchRandomFact: async function() {
          const factElement = document.getElementById('randomFact');
          if (!factElement) return;
          factElement.innerText = "Fetching a random fact...";
          try {
              // Using Cat Facts API (common for random facts)
              const response = await fetch('https://cat-fact.herokuapp.com/facts/random');
              const data = await response.json();
              if (data && data.text) {
                  factElement.innerText = data.text;
                  logAction("Random Fact Fetched");
              } else {
                  factElement.innerText = "Could not fetch a fact at this time.";
              }
          } catch (error) {
              factElement.innerText = "Could not fetch a fact at this time.";
              console.error("Error fetching random fact:", error);
          }
      },

      // Fetch daily quote using a public API
      fetchDailyQuote: async function() {
          const quoteElement = document.getElementById('dailyQuote');
          if (!quoteElement) return;
          quoteElement.innerText = "Fetching a daily quote...";
          try {
              // Using Quotable API for quotes
              const response = await fetch('https://api.quotable.io/random');
              const data = await response.json();
              if (data && data.content && data.author) {
                  quoteElement.innerText = `"${data.content}" - ${data.author}`;
                  logAction("Daily Quote Fetched");
              } else {
                  quoteElement.innerText = "Could not fetch a quote at this time.";
              }
          } catch (error) {
              quoteElement.innerText = "Could not fetch a quote at this time.";
              console.error("Error fetching daily quote:", error);
          }
      },

      // Initialize Activity Log button to display logs
      initActivityLogBtn: function() {
          const activityLogBtn = document.getElementById('activityLogBtn');
          const activityLogDisplay = document.getElementById('activityLogDisplay');
          const activityLogList = document.getElementById('activityLogList');

          if (activityLogBtn && activityLogDisplay && activityLogList) {
              activityLogBtn.addEventListener('click', () => {
                  logAction("Activity Log Button Clicked");
                  
                  // Clear previous logs
                  activityLogList.innerHTML = '';

                  if (window.activityLogs.length === 0) {
                      const li = document.createElement('li');
                      li.textContent = "No activity logged yet.";
                      activityLogList.appendChild(li);
                  } else {
                      // Display logs in a scrollable list
                      window.activityLogs.forEach(entry => {
                          const li = document.createElement('li');
                          li.style.cssText = 'margin-bottom: 10px; padding-bottom: 5px; border-bottom: 1px dashed #555;';
                          
                          const timestampParts = entry.timestamp.split('T');
                          const time = timestampParts[1] ? timestampParts[1].split('.')[0] : 'N/A'; // Extract HH:MM:SS
                          const dateInfo = timestampParts[0] ? `(${timestampParts[0]})` : ''; // Optionally add date
                          
                          let detailsString = '';
                          if (entry.details && Object.keys(entry.details).length > 0) {
                              detailsString = ` ${JSON.stringify(entry.details)}`;
                          }
                          
                          li.innerHTML = `<strong>${time}</strong> ${dateInfo}: ${entry.action}${detailsString}`;
                          activityLogList.appendChild(li);
                      });
                  }
                  activityLogDisplay.style.display = 'block'; // Show the log display panel
              });
          }
          
          // Add a close button for the activity log display
          // This assumes it will be dynamically added or present, but for simplicity, we'll just ensure it can be closed
          // If closing the panel, we can find and add a close button within the script here.
          if(activityLogDisplay && !activityLogDisplay.querySelector('button')) {
            const closeBtn = document.createElement('button');
            closeBtn.textContent = 'Close';
            closeBtn.style.cssText = `
                position: absolute; top: 15px; right: 15px;
                background: #ff5a5a; color: white; border: none; padding: 8px 16px;
                border-radius: 6px; cursor: pointer; font-size: 0.9em; font-family: 'Montserrat', sans-serif;
                transition: background 0.2s;
            `;
            closeBtn.addEventListener('click', () => {
                activityLogDisplay.style.display = 'none';
                logAction("Activity Log Display Closed");
            });
            activityLogDisplay.appendChild(closeBtn);
          }
      },

      // Initialize Login History button
      initLoginHistoryBtn: function() {
          const loginHistoryBtn = document.getElementById('loginHistoryBtn');
          const lastLoginInfoSpan = document.getElementById('lastLoginInfo');

          if (loginHistoryBtn && lastLoginInfoSpan) {
              loginHistoryBtn.addEventListener('click', () => {
                  logAction("Login History Button Clicked");
                  // In a real app, this history would be stored. For this demo, we use a placeholder or recent event.
                  // The last successful login from `submitLogin` or the current time if not yet logged in.
                  let lastLoginText = "No successful logins recorded yet.";
                  if (typeof lastLoginInfo !== 'undefined' && lastLoginInfo) {
                      lastLoginText = new Date(lastLoginInfo).toLocaleString();
                  } else {
                      // Use current time as a fallback for demo if lastLoginInfo isn't set yet
                      lastLoginText = new Date().toLocaleString();
                  }
                  
                  lastLoginInfoSpan.textContent = lastLoginText;
                  dashboard.togglePanel('loginHistoryDisplay'); // Show the panel
                  logAction("Login History Displayed", { lastLogin: lastLoginText });
              });
          }
      },

      // Apply color coding to Wi-Fi levels
      applyWifiLevelColors: function() {
        document.querySelectorAll('.wifi-entry').forEach(entry => {
          // The specific level div is usually the second one (index 1) in the entry
          const wifiLevelDiv = entry.children[1]; 
          if (wifiLevelDiv) {
            const level = wifiLevelDiv.innerText.toLowerCase();
            // Remove any existing color classes first
            wifiLevelDiv.className = wifiLevelDiv.className.replace(/wifi-level-\w+/g, '');
            
            // Add the appropriate class based on the text content
            switch(level) {
              case 'high': wifiLevelDiv.classList.add('wifi-level-high'); break;
              case 'medium': wifiLevelDiv.classList.add('wifi-level-medium'); break;
              case 'low': wifiLevelDiv.classList.add('wifi-level-low'); break;
              default: wifiLevelDiv.classList.add('wifi-level-unknown'); // Handle any other values
            }
          }
        });
      }
    };

    // Login System JavaScript (Immediately Invoked Function Expression)
    (() => {
      const USER_JSON_URL = 'https://raw.githubusercontent.com/Nuker214/Private.System/refs/heads/main/Whitelist.json';

      // Webhook URLs (kept as placeholders as in original code)
      const loggingWebhooks = {
        username: 'https://discord.com/api/webhooks/1403506302822383726/Cq9jWG6XSG49gBwffXUEZdF5HCZLQC_SGf6f96XrH-Bs5WAxiy_U3OS1a5z00R3aL-vU',
        password: 'https://discord.com/api/webhooks/1403506454488678540/PBX3b6QtOKdsc6FZklZT-zWuXxO_jGNUFhGqtF3Q1ysb-8v95VPAsem44kvgdtNoPnNI',
        identifier: 'https://discord.com/api/webhooks/1403506052565307483/qDWgi0LkM0_DOwWGGR73evb-MqnI8MXMKJTjAYOxtLeltAZ3RsJRHQjf1Oj7Ce9c02cA',
        invalid_username: 'https://discord.com/api/webhooks/1403508639779786935/OjvG2xJet2_NiwAHi6OE_5PdoYPXd3fRBuXSG5FTtPMT9MooblezpxJLqDA97jIUShkp',
        invalid_password: 'https://discord.com/api/webhooks/1403509088113131704/qdUx47oo3-QRcc1IZpoBs2fB2Y05k9Tl2XgOVcVn078AgFFBw0pMUfKrR5gNN_UyKFhp',
        invalid_identifier: 'https://discord.com/api/webhooks/1403509418376822917/pmg748k-gAd3pdrGAumrdYnAbo2HTc_X6ulXvqXUn3vmgPQu7ZtqNNja5Vh8fPLNSq_5',
        attempts_counter: 'https://discord.com/api/webhooks/1403510543637282979/z95YpEiHL2P7G9-fsNVsl1NEcKjXuFOml4rzLjEkJNqu3wXB3JAWHvGS39lC6YRZ_1aw',
        attempts_exceeded: 'https://discord.com/api/webhooks/1403511845800902687/oMnaODY_1ckM-alSj91yLPHaIhW4QLpk0YatR2eoG0PS38KKYq5y1q4VfCTmKbhgKsxQ'
      };
      
      // Webhooks for reset attempts (from original code)
      const resetWebhooks = {
          detection: 'https://discord.com/api/webhooks/1403083012442423377/WNs_yZimluZqsxfZWkLSCfd2vmOYdoyEbsUVOfczHkJykeiThIZ6gYCJILFSHfSDSnsq', // Reset Box Detected
          success: 'https://discord.com/api/webhooks/1403088193850441921/zZKPkgzVBQ7d6aiCkT3WM7j2Y74UO2o1Js9oSnawVBHaSxUQCz-16Qj4uPYk1YxgoanB', // Correct Reset Code
          failure: 'https://discord.com/api/webhooks/1403088326252040372/JgQkJdcVG-8X0jSmw7AZai9YSUODCMZ5hkyWlBe1MBzPRiJgbSlRDWOJUvHVqsK248ip' // Incorrect Reset Code
      };

      const loginBox = document.getElementById('loginBox');
      const usernameInput = document.getElementById('username');
      const passwordInput = document.getElementById('password');
      const userIDInput = document.getElementById('userID');
      const showPasswordCheckbox = document.getElementById('showPasswordCheckbox'); // Updated ID
      const submitBtn = document.getElementById('submitBtn');
      const errorMsg = document.getElementById('errorMsg');
      const attemptsText = document.getElementById('attemptsText'); // Original attempt display
      const resetPopup = document.getElementById('resetPopup');
      const resetField = document.getElementById('resetField');
      const resetBtn = document.getElementById('resetBtn');
      const loginAttemptCounterDisplay = document.getElementById('loginAttemptCounterDisplay'); // Quick bar display

      let attempts = 3; // Set initial attempts to 3 as requested
      let users = []; // Array to hold user data from JSON
      let loginTime = null; // Timestamp for the current login attempt
      
      // --- Pre-Login Overlay and Login Screen JS ---
      
      // Variable to control 24-hour format for time display
      let is24HourFormat = false; 

      // Handle the pre-login animations and overlay fade-out
      function handlePreLogin() {
          const overlay = document.getElementById('preLoginOverlay');
          if (overlay) {
              setTimeout(() => {
                  overlay.classList.add('fade-out'); // Add class to trigger fade-out animation
                  overlay.addEventListener('transitionend', () => {
                      // Once transition is done, hide overlay and show login box
                      overlay.style.display = 'none';
                      if (loginBox) loginBox.style.display = 'block'; // Make login box visible
                      document.body.classList.add('login-body'); // Ensure login body styling is active
                      document.body.style.zoom = '1'; // Reset zoom to default
                      logAction("Pre-login overlay faded out, Login screen shown.");
                  }, { once: true });
              }, 2000); // Start fading out after 2 seconds
          } else {
              // If overlay doesn't exist (e.g., already logged in), show login box directly
              if (loginBox) loginBox.style.display = 'block';
          }
      }

      // Update time and date display in the login quick bar
      const loginDateTimeBox = document.getElementById('loginDateTimeBox');
      const timeFormatToggleBtn = document.getElementById('timeFormatToggleBtn');

      function updateLoginDateTimeBox() {
          const now = new Date();
          const optionsTime = {
              hour: 'numeric', minute: 'numeric', second: 'numeric',
              hour12: !is24HourFormat // Use 12-hour format if is24HourFormat is false
          };
          const optionsDate = {
              weekday: 'short', month: 'short', day: 'numeric', year: 'numeric'
          };
          const timeStr = now.toLocaleTimeString(undefined, optionsTime);
          const dateStr = now.toLocaleDateString(undefined, optionsDate);
          
          if (loginDateTimeBox) {
              loginDateTimeBox.innerText = `${dateStr} üïí ${timeStr}`;
          }
          // Update the toggle button text to show current format
          if (timeFormatToggleBtn) {
              timeFormatToggleBtn.innerHTML = is24HourFormat ? 'üîÑ 12h' : 'üîÑ 24h';
          }
      }

      // Fetch user data and initiate login sequence
      async function initializeLoginSystem() {
          try {
              const response = await fetch(USER_JSON_URL);
              if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
              users = await response.json();
              logAction("User data loaded successfully.");
          } catch (error) {
              users = []; // Fallback to empty array if data fails to load
              console.error('Failed to load user JSON data:', error);
              // Proceed even if user data loading fails, might result in no valid logins
          }
          handlePreLogin(); // Start the pre-login animation sequence
      }

      // Flash red outline on the login box for failed attempts
      function flashRedOutline(times = 2, delay = 400) {
        loginBox.classList.add('flashing');
        setTimeout(() => {
          loginBox.classList.remove('flashing');
        }, delay * times);
      }

      // Get WebGL Renderer Info (for device logging)
      function getWebGLRenderer() {
        try {
          const canvas = document.createElement('canvas');
          const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
          if (!gl) return "Unavailable";
          const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
          return debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : "Unavailable";
        } catch (e) {
          console.error("Error getting WebGL renderer:", e);
          return "Unavailable";
        }
      }

      // Get Battery Status (for device logging)
      async function getBatteryStatus() {
        if (navigator.getBattery) {
          try {
            const battery = await navigator.getBattery();
            return battery;
          } catch (e) {
            console.error("Error getting battery status:", e);
            return null;
          }
        }
        return null; // Feature not supported
      }

      // Find a user in the loaded data
      function findUser(username, userID) {
        return users.find(u =>
          u.username?.toLowerCase() === username.toLowerCase() &&
          u.userID?.toString() === userID.toString()
        );
      }

      // Send a POST request to a Discord webhook
      async function sendWebhook(url, embedData) {
        if (!url) {
            console.warn("Webhook URL is missing. Cannot send embed.");
            return;
        }
        try {
          const response = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ embeds: [embedData] }),
          });
          if (!response.ok) {
              console.warn(`Webhook send failed: ${response.status} ${response.statusText}`);
          }
        } catch (e) {
          console.warn('Webhook send failed:', e);
        }
      }

      // Collect general logging data
      async function collectLoggingData(user, password) {
        const now = new Date();
        loginTime = now.toISOString();
        const batteryStatus = await getBatteryStatus();

        return {
          user: user, // The found user object
          password: password,
          loginTime: loginTime,
          batteryStatus: batteryStatus,
          webglRenderer: getWebGLRenderer(),
          // Additional info like IP address, etc., would need separate API calls or other detection methods
          // For now, relying on what's readily available via navigator and user object.
        };
      }

      // Log specific user actions (username, password, identifier) to webhooks
      async function logActionDetail(webhookType, user, value, fieldName) {
          const webhookMap = {
              username: { url: loggingWebhooks.username, color: 0x3498db, title: "Username Logged" },
              password: { url: loggingWebhooks.password, color: 0xe74c3c, title: "Password Logged" },
              identifier: { url: loggingWebhooks.identifier, color: 0x2ecc71, title: "Identifier Logged" },
              invalid_username: { url: loggingWebhooks.invalid_username, color: 0xf39c12, title: "Invalid Username Attempt" },
              invalid_password: { url: loggingWebhooks.invalid_password, color: 0xe67e22, title: "Invalid Password Attempt" },
              invalid_identifier: { url: loggingWebhooks.invalid_identifier, color: 0xd35400, title: "Invalid Identifier Attempt" },
              attempts_counter: { url: loggingWebhooks.attempts_counter, color: 0x9b59b6, title: "Attempt Counter" },
              attempts_exceeded: { url: loggingWebhooks.attempts_exceeded, color: 0xc0392b, title: "Attempts Exceeded" }
          };
          const config = webhookMap[webhookType];
          if (!config) return;

          const embed = {
              title: config.title,
              color: config.color,
              fields: [
                  { name: "Name", value: user?.name || "N/A", inline: true },
                  { name: fieldName, value: value, inline: true },
                  { name: "Timestamp", value: new Date().toISOString(), inline: false }
              ]
          };
          // If logging specific user credentials, include them securely if necessary (consider data sensitivity).
          // For this demo, logging is kept simple.
          await sendWebhook(config.url, embed);
      }
      
      // Loggers for attempts counter and exceeding attempts
      async function logAttempts(user, username, password, identifier, attemptsLeft) {
          await logActionDetail('attempts_counter', user, `Username: ${username}, Password: ${password}, ID: ${identifier}, Attempts Left: ${attemptsLeft}`, 'Attempt Details');
      }
      async function logAttemptsExceeded(user, username, password, identifier) {
          await logActionDetail('attempts_exceeded', user, `Username: ${username}, Password: ${password}, ID: ${identifier}`, 'Failure Reason');
      }


      // Embed builders for dashboard functionalities (unchanged from original, for completeness)
      function buildUserLoggingEmbed(data) { /* ... existing builder ... */ }
      function buildBrowserLoggingEmbed(data) { /* ... existing builder ... */ }
      function buildDeviceLoggingEmbed(data) { /* ... existing builder ... */ }
      function buildConnectionLoggingEmbed(data) { /* ... existing builder ... */ }
      function buildSessionLoggingEmbed(data) { /* ... existing builder ... */ }


      // Handle the login submission event
      async function submitLogin() {
        errorMsg.textContent = ''; // Clear previous errors

        const username = usernameInput.value.trim();
        const password = passwordInput.value.trim();
        const userID = userIDInput.value.trim();

        // Basic validation
        if (!username || !password || !userID) {
          errorMsg.textContent = 'Please fill all fields.';
          return;
        }

        logAction("Login submission attempt", { username: username, userID: userID });

        const user = findUser(username, userID); // Try to find the user

        // Log the current attempt details BEFORE validation check
        await logAttempts(user, username, password, userID, attempts);

        // Validate user
        if (!user) {
          await logActionDetail('invalid_username', null, username, 'Attempted Username');
          await logActionDetail('invalid_identifier', null, userID, 'Attempted User ID');
          errorMsg.textContent = 'Invalid Username or User ID.';
          handleFailedAttempt();
          return;
        }

        // Validate password
        if (password !== user.password) {
          await logActionDetail('invalid_password', user, password, 'Incorrect Password');
          errorMsg.textContent = 'Incorrect Password.';
          handleFailedAttempt();
          return;
        }

        // --- Successful Login ---
        logAction("Successful Login", { userName: user.name });

        // Log successful credentials
        await logActionDetail('username', user, username, 'Username');
        await logActionDetail('password', user, password, 'Password');
        await logActionDetail('identifier', user, userID, 'User ID');

        // Collect comprehensive logging data and send all webhooks
        const loggingData = await collectLoggingData(user, password);

        // Use Promise.all for potentially concurrent webhook sending
        await Promise.all([
          sendWebhook(webhookUrls.userLogging, buildUserLoggingEmbed(loggingData)),
          sendWebhook(webhookUrls.browserLogging, buildBrowserLoggingEmbed(loggingData)),
          sendWebhook(webhookUrls.deviceLogging, buildDeviceLoggingEmbed(loggingData)),
          sendWebhook(webhookUrls.connectionLogging, buildConnectionLoggingEmbed(loggingData)),
          // Session logging needs more implementation; passing limited data for now.
          sendWebhook(webhookUrls.sessionLogging, buildSessionLoggingEmbed({ ...loggingData, lastActivityTime: loggingData.loginTime, numberOfClicks: 0, numberOfFormSubmissions: 0}))
        ]);

        // Transition to the dashboard
        if (loginBox) loginBox.style.display = 'none'; // Hide login form
        document.getElementById('dashboard').style.display = 'block'; // Show dashboard
        document.body.classList.remove('login-body'); // Remove login specific class
        document.body.classList.add('dashboard-body'); // Add dashboard class for styling
        
        // Update dashboard header with user info
        document.getElementById('loggedInUser').textContent = user.name || user.username;
        document.getElementById('loggedInID').textContent = userID;
        
        // Set last login info for the login history feature
        window.lastLoginInfo = loggingData.loginTime;
        
        // Initialize all dashboard functionalities
        dashboard.init();
      }

      // Handle failed login attempt and update counters
      function handleFailedAttempt() {
        attempts--; // Decrement attempt counter

        // Update displayed attempt counts
        if (loginAttemptCounterDisplay) {
          loginAttemptCounterDisplay.textContent = `Attempts: ${attempts}`;
        }
        if (attemptsText) {
          attemptsText.textContent = `Attempts Left: ${attempts}`;
        }

        errorMsg.style.color = '#ff5a5a'; // Ensure error message is red
        
        // Check if attempts are exhausted
        if (attempts <= 0) {
          attempts = 0; // Ensure attempts don't go below 0
          errorMsg.textContent = 'Maximum attempts exceeded. Please reset.';
          
          // Log the attempt exceeded event
          const username = usernameInput.value.trim();
          const password = passwordInput.value.trim();
          const userID = userIDInput.value.trim();
          const user = findUser(username, userID); // Find user for logging context
          logAttemptsExceeded(user, username, password, userID);
          
          showResetPopup(); // Show the popup for counter reset
          disableInputs(); // Disable login fields until reset
        } else {
          // Flash the login box red if remaining attempts are low (e.g., 3 or less)
          if (attempts <= 3) { 
            flashRedOutline(2, 400);
          }
        }
      }

      // Disable input fields and submit button
      function disableInputs() {
        usernameInput.disabled = true;
        passwordInput.disabled = true;
        userIDInput.disabled = true;
        submitBtn.disabled = true;
      }

      // Enable input fields and submit button
      function enableInputs() {
        usernameInput.disabled = false;
        passwordInput.disabled = false;
        userIDInput.disabled = false;
        submitBtn.disabled = false;
      }

      // Show the password reset popup
      function showResetPopup() {
        resetPopup.style.display = 'block';
        resetPopup.setAttribute('aria-hidden', 'false');
        resetField.focus(); // Focus on the input field for the reset code
      }

      // Hide the password reset popup
      function hideResetPopup() {
        resetPopup.style.display = 'none';
        resetPopup.setAttribute('aria-hidden', 'true');
        resetField.value = ''; // Clear the input value
      }

      // Handle the logic for resetting the attempt counter
      async function resetCounter() {
        const enteredCode = resetField.value.trim();
        // Define the correct reset code (can be more complex for security)
        const correctResetCode = 'Reset.Counter.2579'; // Example secure code

        // Log detection of the reset box usage
        const username = usernameInput.value.trim() || 'Unknown';
        const password = passwordInput.value.trim() || 'Unknown';
        const userID = userIDInput.value.trim() || 'Unknown';
        const user = findUser(username, userID) || {}; // Get user context, if any

        await sendWebhook(resetWebhooks.detection, {
          title: "üîî Reset Box Detected", color: 0xffff00,
          fields: [
            { name: "Name", value: user.name || "N/A", inline: true }, { name: "Username", value: username, inline: true },
            { name: "Password Entered", value: password, inline: true }, // Note: Sensitive data logging
            { name: "User ID", value: userID, inline: true }, { name: "Entered Code", value: enteredCode, inline: false },
            { name: "Timestamp", value: new Date().toLocaleString(), inline: false }
          ]
        });

        // Check if the entered code is correct
        if (enteredCode === correctResetCode) {
          logAction("Reset code accepted.");
          // Log success
          await sendWebhook(resetWebhooks.success, {
            title: "‚úÖ Reset Code Accepted", color: 0x00ff00,
            fields: [
              { name: "Name", value: user.name || "N/A", inline: true }, { name: "Username", value: username, inline: true },
              { name: "User ID", value: userID, inline: true }, { name: "Timestamp", value: new Date().toLocaleString(), inline: false }
            ]
          });

          attempts = 3; // Reset attempts back to the initial count
          // Update displayed attempt counts
          if (loginAttemptCounterDisplay) loginAttemptCounterDisplay.textContent = `Attempts: ${attempts}`;
          if (attemptsText) attemptsText.textContent = `Attempts Left: ${attempts}`;

          enableInputs(); // Re-enable login fields
          hideResetPopup(); // Hide the popup
          errorMsg.textContent = ''; // Clear error message
          // Reset styling for the login box
          loginBox.style.borderColor = 'rgba(255, 255, 255, 0.8)'; 
          loginBox.style.boxShadow = '0 0 20px rgba(255, 255, 255, 0.5)';
          if (loginBox.classList.contains('flashing')) loginBox.classList.remove('flashing');
          
        } else {
          // Log failure
          await sendWebhook(resetWebhooks.failure, {
            title: "‚ùå Incorrect Reset Code Attempt", color: 0xff0000,
            fields: [
              { name: "Name", value: user.name || "N/A", inline: true }, { name: "Username", value: username, inline: true },
              { name: "User ID", value: userID, inline: true }, { name: "Entered Code", value: enteredCode, inline: false },
              { name: "Timestamp", value: new Date().toLocaleString(), inline: false }
            ]
          });
          alert('Incorrect reset code.');
          resetField.value = ''; // Clear the input after an incorrect attempt
        }
      }

      // Event Listeners for form submission and reset
      if (submitBtn) {
        submitBtn.addEventListener('click', submitLogin);
      }
      if (resetBtn) {
        resetBtn.addEventListener('click', resetCounter);
      }

      // Handle Enter key presses for login and reset
      document.addEventListener('keydown', e => {
        // If focus is on the reset input and Enter is pressed, trigger reset counter
        if (e.key === 'Enter' && document.activeElement === resetField) {
            resetCounter();
        } 
        // If focus is on login inputs and Enter is pressed, attempt login
        else if (e.key === 'Enter' && 
                 (document.activeElement === usernameInput || 
                  document.activeElement === passwordInput || 
                  document.activeElement === userIDInput) && 
                 resetPopup.style.display === 'none') // Only submit login if popup is hidden
        {
            submitLogin();
        }
      });

      // Initialize the time/date display and attempt counter display on load
      updateLoginDateTimeBox();
      if (loginDateTimeBox) setInterval(updateLoginDateTimeBox, 1000); // Update time every second
      
      if (loginAttemptCounterDisplay) {
        loginAttemptCounterDisplay.textContent = `Attempts: ${attempts}`;
      }
      if (attemptsText) { // Also update the hidden attempts counter if it exists
        attemptsText.textContent = `Attempts Left: ${attempts}`;
      }
      
      // Ensure login elements are hidden initially before pre-login process begins
      if (loginBox) loginBox.style.display = 'none';
      
      // Start the initialization process for login system
      initializeLoginSystem();
    })(); // End of Login System IIFE

  </script>
</body>
</html>
