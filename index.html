<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Enhanced Private System</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;500;700&display=swap');
    
    :root {
      --primary-bg: #0a0a0a;
      --secondary-bg: #1a1a1a;
      --accent-color: #ff4500;
      --accent-secondary: #ff6b35;
      --text-primary: #ffffff;
      --text-secondary: #cccccc;
      --border-color: #333;
      --success-color: #00ff41;
      --warning-color: #ffaa00;
      --error-color: #ff0040;
      --update-item-bg: #0d0d0d; /* Background for update items */
      --update-item-border: var(--accent-color); /* Border for update items */
      --notification-item-bg-info: #172a3b; /* Specific bg for blue notif */
      --notification-item-bg-success: #173b1a; /* Specific bg for green notif */
    }

    /* Light Theme Variables */
    body.light-theme {
      --primary-bg: #f0f2f5;
      --secondary-bg: #ffffff;
      --accent-color: #007bff; /* Using a blue accent for light mode as an example */
      --accent-secondary: #0056b3;
      --text-primary: #333333;
      --text-secondary: #666666;
      --border-color: #e0e0e0;
      --success-color: #28a745; /* Green for light theme success */
      --warning-color: #ffc107; /* Yellow for light theme warning */
      --error-color: #dc3545;   /* Red for light theme error */
      --update-item-bg: #e2e8f0; /* Light background for update items */
      --update-item-border: var(--accent-color); /* Keeps accent border */
      --notification-item-bg-info: #e0f2fe; /* Light bg for blue notif */
      --notification-item-bg-success: #e6ffed; /* Light bg for green notif */
    }

    /* Adjust specific elements for light theme */
    body.light-theme .login-box {
      background: rgba(255, 255, 255, 0.95);
      border: 3px solid var(--accent-color);
      box-shadow: 0 0 30px rgba(0, 123, 255, 0.3);
    }
    body.light-theme .login-box h2 {
      background: linear-gradient(45deg, var(--accent-color), #333);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    body.light-theme .login-box input {
      background: rgba(240, 240, 240, 0.8);
      border: 2px solid var(--border-color);
      color: #333;
    }
    body.light-theme .toggle-container span, body.light-theme .time-date-box .date-display {
      color: var(--text-primary);
    }
    body.light-theme .dashboard-header {
      background: linear-gradient(135deg, var(--accent-color), var(--accent-secondary));
      color: white; /* Keep header text white for contrast */
    }
    body.light-theme .quick-btn {
      background: var(--accent-color);
      color: white;
    }
    body.light-theme .quick-btn:hover {
      background: var(--accent-secondary);
    }
    body.light-theme .dashboard-quickbar {
        background: var(--secondary-bg);
        border-color: var(--border-color);
    }
    body.light-theme .search-bar {
      background: var(--primary-bg);
      border-color: var(--border-color);
      color: var(--text-primary);
    }
    body.light-theme .search-btn {
      background: var(--accent-color);
    }
    body.light-theme .search-btn:hover {
        background: var(--accent-secondary);
    }
    body.light-theme .quickbar-time-info {
        background-color: var(--primary-bg);
        border-color: var(--border-color);
        color: var(--text-primary);
    }
    body.light-theme .panels-grid {
      border: none;
    }
    body.light-theme .panel {
      background: var(--secondary-bg);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
    }
    body.light-theme .panel-title {
      color: var(--accent-color);
    }
    body.light-theme .panel-controls .panel-btn {
      background: var(--secondary-bg);
      border-color: var(--border-color);
      color: var(--text-secondary);
    }
    body.light-theme .panel-controls .panel-btn:hover {
      background: var(--accent-color);
      color: white;
    }
    body.light-theme .calendar-cell {
      background: var(--primary-bg);
      color: var(--text-primary);
    }
    body.light-theme .calendar-cell:hover, body.light-theme .calendar-cell.today {
      background: var(--accent-color);
      color: white;
    }
    body.light-theme .log-entry {
      background: var(--primary-bg);
      border-left-color: var(--accent-color); /* Kept accent for log importance */
      color: var(--text-primary);
    }
    body.light-theme .log-time {
      color: var(--text-secondary);
    }
    body.light-theme .login-entry-container {
        background-color: var(--primary-bg);
    }
    body.light-theme .login-entry-container.success {
        border-left: 4px solid var(--success-color);
    }
    body.light-theme .login-entry-container.failed {
        border-left: 4px solid var(--error-color);
    }
    body.light-theme .error-log-entry {
        background-color: var(--primary-bg);
        border-left: 4px solid var(--error-color);
        color: var(--text-primary);
    }

    /* Updated styling for .notification to be theme adaptive */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--secondary-bg);
      border: 2px solid var(--success-color);
      color: var(--text-primary);
      padding: 15px 25px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      animation: slideIn 0.5s ease;
      transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
    }

    /* Update Panel item styling */
    .update-item {
        padding: 8px;
        background-color: var(--update-item-bg);
        border-left: 4px solid var(--update-item-border);
        border-radius: 6px;
        color: var(--text-primary);
        margin-bottom: 8px; /* Tailwind `space-y-2` handles this */
    }

    /* Notifications list items (p-2 inside notificationsList) */
    #notificationsList > .p-2.bg-blue-900 {
        background-color: var(--notification-item-bg-info); /* The info notification */
    }
    #notificationsList > .p-2.bg-green-900 {
        background-color: var(--notification-item-bg-success); /* The success notification */
    }

    body.light-theme .settings-content {
      background: var(--secondary-bg);
      border-color: var(--accent-color);
      color: var(--text-primary);
    }
    body.light-theme .settings-content h2, body.light-theme .settings-content h3 {
      color: var(--accent-color);
    }
    body.light-theme .setting-item {
      background: var(--primary-bg);
      border-color: var(--border-color);
    }
    body.light-theme .tool-btn, body.light-theme .timer-controls .tool-btn {
      background: var(--accent-color);
      color: white;
    }
    body.light-theme .tool-btn:hover, body.light-theme .tool-btn.active, body.light-theme .timer-controls .tool-btn:hover {
      background: var(--accent-secondary);
    }
    body.light-theme #drawingCanvas {
      background: #f0f0f0; /* Ensure white canvas in light mode */
    }
    body.light-theme #textNotes {
      background: var(--primary-bg);
      color: var(--text-primary);
    }
    body.light-theme .calculator {
      background: var(--primary-bg);
    }
    body.light-theme .calc-display {
      background: var(--secondary-bg);
      border-color: var(--border-color);
      color: var(--accent-color);
    }
    body.light-theme .calc-buttons {
        border-color: var(--border-color);
    }
    body.light-theme .calc-btn {
      background: var(--secondary-bg);
      color: var(--text-primary);
    }
    body.light-theme .calc-btn:hover {
      background: var(--accent-color);
    }
    body.light-theme .calc-btn.operator {
      background: var(--accent-color);
    }
    body.light-theme .calc-btn.equals {
      background: var(--success-color);
      color: black;
    }
    body.light-theme .media-input {
      background: var(--secondary-bg);
      border-color: var(--border-color);
      color: var(--text-primary);
    }
    body.light-theme .media-frame {
      background: var(--secondary-bg);
    }
    body.light-theme .stat-item {
      background: var(--primary-bg);
      border-color: var(--border-color);
    }
    body.light-theme .keybind-input {
      background: var(--secondary-bg);
      border-color: var(--border-color);
      color: var(--text-primary);
    }
    /* Styles for new Important Dates panel elements */
    .important-date-input, .important-date-select, .important-date-event-input {
        background-color: var(--primary-bg);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
        padding: 8px;
        border-radius: 6px;
        margin-bottom: 8px;
        width: 100%;
    }
    .important-date-item {
        background-color: var(--primary-bg);
        border: 1px solid var(--border-color);
        padding: 10px;
        border-left: 4px solid var(--accent-color);
        border-radius: 6px;
        margin-bottom: 8px;
        font-size: 14px;
        color: var(--text-primary);
    }
    .important-date-item .date-time {
        font-weight: bold;
        color: var(--accent-color);
    }
    .important-date-item .event-description {
        font-style: italic;
        color: var(--text-secondary);
    }
    
    /* Mouse Clicker styles */
    .click-button {
        background: var(--accent-color);
        color: white;
        border: none;
        padding: 20px;
        border-radius: 15px;
        font-size: 24px;
        font-weight: bold;
        cursor: pointer;
        transition: background 0.3s ease;
        width: 100%;
        margin-top: 15px;
        text-align: center;
    }
    .click-button:hover {
        background: var(--accent-secondary);
    }
    .click-count-display {
        font-family: 'Orbitron', monospace;
        font-size: 48px;
        color: var(--success-color);
        text-align: center;
        margin-top: 20px;
    }
    .mouse-clicker-controls {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 15px;
    }

    /* Error Log styles */
    .error-log-entry {
      padding: 10px;
      background: var(--primary-bg);
      border-left: 4px solid var(--error-color);
      margin-bottom: 10px;
      border-radius: 6px;
      font-size: 12px;
      display: flex;
      justify-content: space-between;
      color: var(--text-primary);
    }
    .error-log-time {
        color: var(--text-secondary);
        font-size: 10px;
    }

    /* Code Rain animation - changed to go upwards */
    .code-char {
      position: absolute;
      color: var(--success-color);
      font-family: 'Courier New', monospace;
      font-size: 12px;
      animation: rise 3s linear infinite; /* Changed animation to 'rise' */
    }

    @keyframes rise {
      0% { transform: translateY(100vh); opacity: 0.8; } /* Start from bottom of screen */
      100% { transform: translateY(-100vh); opacity: 0; } /* Move upwards and fade */
    }


    /* Responsive adjustments for new panels */
    @media (max-width: 1200px) {
        .dashboard-quickbar .search-group {
            flex-direction: column;
            max-width: 100%;
            align-items: flex-start;
        }
        .dashboard-quickbar .quickbar-time-info {
            width: 100%;
            justify-content: space-between;
        }
        .dashboard-quickbar .quick-btn-group {
            width: 100%;
            justify-content: center;
        }
        .search-container {
            max-width: 100%;
        }
    }
    @media (max-width: 768px) {
      .login-box {
        width: 90%;
        margin: 20px auto;
      }
      .panels-grid {
        grid-template-columns: 1fr;
      }
      .dashboard-quickbar {
        flex-direction: column;
        gap: 10px;
      }
      .search-container {
        max-width: 100%;
      }
    }

    /* Loading Animation */
    .loading-cube {
      width: 60px;
      height: 60px;
      position: relative;
      transform-style: preserve-3d;
      animation: loadingRotate 1.5s infinite linear;
    }

    .loading-face {
      position: absolute;
      width: 60px;
      height: 60px;
      background: linear-gradient(45deg, var(--accent-color), var(--accent-secondary));
      border: 1px solid #fff;
      opacity: 0.9;
    }

    .loading-face.front { transform: rotateY(0deg) translateZ(30px); }
    .loading-face.back { transform: rotateY(180deg) translateZ(30px); }
    .loading-face.right { transform: rotateY(90deg) translateZ(30px); }
    .loading-face.left { transform: rotateY(-90deg) translateZ(30px); }
    .loading-face.top { transform: rotateX(90deg) translateZ(30px); }
    .loading-face.bottom { transform: rotateX(-90deg) translateZ(30px); }

    @keyframes loadingRotate {
      0% { transform: rotateX(0deg) rotateY(0deg); }
      100% { transform: rotateX(360deg) rotateY(360deg); }
    }

    /* Hidden by default */
    .hidden { display: none !important; }
  </style>
</head>
<body>

<!-- Initialization Screen -->
<div id="initScreen" class="init-screen">
  <div class="rotating-cube">
    <div class="cube-face front"></div>
    <div class="cube-face back"></div>
    <div class="cube-face right"></div>
    <div class="cube-face left"></div>
    <div class="cube-face top"></div>
    <div class="cube-face bottom"></div>
  </div>
  <div id="initText" class="init-text">Initializing System...</div>
  <div class="code-rain" id="codeRain"></div>
</div>

<!-- Login Screen -->
<div id="loginScreen" class="login-container hidden">
  <div class="login-quickbar">
    <div class="flex items-center gap-2">
      <button class="panic-btn" onclick="window.open('https://clever.com', '_blank')">
        <i class="fas fa-exclamation-triangle"></i> Panic
      </button>
    </div>
    <div class="flex items-center gap-2">
      <button onclick="adjustZoom(0.1)"><i class="fas fa-search-plus"></i> Zoom In</button>
      <button onclick="adjustZoom(-0.1)"><i class="fas fa-search-minus"></i> Zoom Out</button>
    </div>
  </div>

  <div class="login-box" id="loginBox">
    <h2><i class="fas fa-shield-alt"></i> Private System</h2>
    
    <div class="input-group">
      <input type="text" id="username" placeholder="Enter Username..." autocomplete="off">
    </div>
    
    <div class="input-group">
      <input type="password" id="password" placeholder="Enter Password..." autocomplete="off">
    </div>
    
    <div class="input-group">
      <input type="text" id="userID" placeholder="Enter User Identifier..." autocomplete="off">
    </div>

    <div class="toggle-container">
      <span>Show Password</span>
      <div class="toggle-switch" id="showPasswordToggle">
        <div class="toggle-slider"></div>
      </div>
    </div>

    <button class="submit-btn" id="submitBtn">
      <i class="fas fa-sign-in-alt"></i> ACCESS SYSTEM
    </button>

    <div id="errorMsg" class="text-red-400 mt-4 text-sm"></div>
    <div id="attemptsText" class="text-yellow-400 mt-2 text-sm">Attempts Left: 3</div>
  </div>

  <div class="time-date-box">
    <div class="time-display" id="currentTime">00:00:00</div>
    <div class="date-display" id="currentDate">Loading...</div>
    <div class="toggle-container mt-4">
      <span>24-Hour Format</span>
      <div class="toggle-switch" id="timeFormatToggle">
        <div class="toggle-slider"></div>
      </div>
    </div>
  </div>
</div>

<!-- Loading Screen -->
<div id="loadingScreen" class="init-screen hidden">
  <div class="loading-cube">
    <div class="loading-face front"></div>
    <div class="loading-face back"></div>
    <div class="loading-face right"></div>
    <div class="loading-face left"></div>
    <div class="loading-face top"></div>
    <div class="loading-face bottom"></div>
  </div>
  <div class="init-text">Loading Dashboard...</div>
  <div class="code-rain" id="loadingCodeRain"></div>
</div>

<!-- Dashboard -->
<div id="dashboard" class="dashboard">
  <!-- Welcome Notification -->
  <div id="welcomeNotification" class="notification">
    <i class="fas fa-user-check"></i> Welcome <span id="loggedUser">User</span>!
  </div>

  <!-- Dashboard Header -->
  <div class="dashboard-header">
    <div>
      <h1 class="text-2xl font-bold"><i class="fas fa-tachometer-alt"></i> Enhanced Private Dashboard</h1>
      <p class="text-sm opacity-80">User: <span id="currentUser">Beta.user</span> | ID: <span id="currentUserID">281573</span></p>
    </div>
    <div class="bg-white text-black px-4 py-2 rounded-lg font-bold">
      Version 2.0.0
    </div>
  </div>

  <!-- Quick Bar with Search, Session Time, Real Time, and Buttons -->
  <div class="dashboard-quickbar">
    <!-- Left Section: Search and Time Displays -->
    <div class="search-group">
        <div class="search-container">
            <input type="text" class="search-bar" id="searchBar" placeholder="Search panels, features...">
            <button class="search-btn" onclick="performSearch()"><i class="fas fa-search"></i></button>
        </div>
        <div class="quickbar-time-info">Session Time: <span id="quickbarSessionTime" class="quickbar-time-value">00:00:00</span></div>
        <div class="quickbar-time-info">Real Time: <span id="quickbarCurrentTime" class="quickbar-time-value">00:00:00</span></div>
    </div>
    
    <!-- Right Section: All other buttons -->
    <div class="quick-btn-group">
      <button class="quick-btn" onclick="togglePanel('settingsModal')">
        <i class="fas fa-cog"></i> Settings
      </button>
      <button class="quick-btn" onclick="togglePanel('timerPanel')">
        <i class="fas fa-stopwatch"></i> Timer
      </button>
      <button class="quick-btn" onclick="togglePanel('notesPanel')">
        <i class="fas fa-pen"></i> Notes
      </button>
      <button class="quick-btn" onclick="showStats()">
        <i class="fas fa-chart-bar"></i> Stats
      </button>
      <button class="quick-btn" onclick="takeScreenshot()">
          <i class="fas fa-camera"></i> Screenshot
      </button>
      <button class="quick-btn" onclick="togglePanelsGridVisibility()">
          <i class="fas fa-toggle-on"></i> Toggle Sections
      </button>
      <button class="quick-btn" onclick="adjustZoom(0.1)">
          <i class="fas fa-search-plus"></i> Zoom In
      </button>
      <button class="quick-btn" onclick="adjustZoom(-0.1)">
          <i class="fas fa-search-minus"></i> Zoom Out
      </button>
      <button class="quick-btn" onclick="restartSystem()">
          <i class="fas fa-redo-alt"></i> Restart
      </button>
      <button class="quick-btn panic-btn" onclick="window.open('https://clever.com', '_blank')">
          <i class="fas fa-exclamation-triangle"></i> Panic
      </button>
      <button class="quick-btn" onclick="toggleTheme()">
        <i class="fas fa-palette"></i> Theme
      </button>
      <button class="quick-btn" onclick="logout()">
        <i class="fas fa-sign-out-alt"></i> Logout
      </button>
    </div>
  </div>

  <!-- Main Panels Grid -->
  <div class="panels-grid" id="panelsGrid">
    <!-- Calendar Panel -->
    <div class="panel" data-panel="calendar">
      <div class="panel-header">
        <div class="panel-title"><i class="fas fa-calendar"></i> Calendar</div>
        <div class="panel-controls">
          <button class="panel-btn" onclick="minimizePanel(this)"><i class="fas fa-minus"></i></button>
          <button class="panel-btn" onclick="closePanel(this)"><i class="fas fa-times"></i></button>
        </div>
      </div>
      <div class="calendar-grid" id="calendarGrid">
        <!-- Calendar will be generated here -->
      </div>
    </div>

    <!-- Important Dates Panel -->
    <div class="panel" data-panel="importantDates">
      <div class="panel-header">
        <div class="panel-title"><i class="fas fa-star"></i> Important Dates</div>
        <div class="panel-controls">
          <button class="panel-btn" onclick="clearImportantDates()"><i class="fas fa-trash"></i></button>
          <button class="panel-btn" onclick="closePanel(this)"><i class="fas fa-times"></i></button>
        </div>
      </div>
      <div class="content">
        <input type="date" id="importantDateDay" class="important-date-input">
        <input type="time" id="importantDateTime" class="important-date-input">
        <input type="text" id="importantDateEvent" class="important-date-event-input" placeholder="Event Description...">
        <button class="quick-btn w-full mt-2" onclick="addImportantDate()">Add Event</button>
        <div id="importantDatesList" class="mt-4 max-h-40 overflow-y-auto space-y-2">
            <!-- Important dates will be populated here -->
        </div>
      </div>
    </div>

    <!-- Random Facts Panel -->
    <div class="panel" data-panel="facts">
      <div class="panel-header">
        <div class="panel-title"><i class="fas fa-lightbulb"></i> Random Facts</div>
        <div class="panel-controls">
          <button class="panel-btn" onclick="refreshFact()"><i class="fas fa-sync"></i></button>
          <button class="panel-btn" onclick="closePanel(this)"><i class="fas fa-times"></i></button>
        </div>
      </div>
      <div id="randomFact" class="text-sm">
        Did you know? The human brain contains approximately 86 billion neurons!
      </div>
    </div>

    <!-- Daily Quotes Panel -->
    <div class="panel" data-panel="quotes">
      <div class="panel-header">
        <div class="panel-title"><i class="fas fa-quote-left"></i> Daily Quote</div>
        <div class="panel-controls">
          <button class="panel-btn" onclick="refreshQuote()"><i class="fas fa-sync"></i></button>
          <button class="panel-btn" onclick="closePanel(this)"><i class="fas fa-times"></i></button>
        </div>
      </div>
      <div id="dailyQuote" class="text-sm italic">
        "The only way to do great work is to love what you do." - Steve Jobs
      </div>
    </div>

    <!-- Updates Panel -->
    <div class="panel" data-panel="updates">
      <div class="panel-header">
        <div class="panel-title"><i class="fas fa-sync-alt"></i> System Updates</div>
        <div class="panel-controls">
          <button class="panel-btn" onclick="closePanel(this)"><i class="fas fa-times"></i></button>
        </div>
      </div>
      <div class="space-y-2">
        <div class="update-item">Enhanced UI v2.0 Deployed</div>
        <div class="update-item">New Security Features Added</div>
        <div class="update-item">Performance Optimizations</div>
      </div>
    </div>

    <!-- Notifications Panel -->
    <div class="panel" data-panel="notifications">
      <div class="panel-header">
        <div class="panel-title"><i class="fas fa-bell"></i> Notifications</div>
        <div class="panel-controls">
          <button class="panel-btn" onclick="clearNotifications()"><i class="fas fa-trash"></i></button>
          <button class="panel-btn" onclick="closePanel(this)"><i class="fas fa-times"></i></button>
        </div>
      </div>
      <div id="notificationsList" class="space-y-2">
        <div class="p-2 bg-blue-900 rounded text-xs">System initialized successfully</div>
        <div class="p-2 bg-green-900 rounded text-xs">All security checks passed</div>
      </div>
    </div>

    <!-- Activity Logs Panel -->
    <div class="panel" data-panel="activityLogs">
      <div class="panel-header">
        <div class="panel-title"><i class="fas fa-list"></i> Activity Logs</div>
        <div class="panel-controls">
          <button class="panel-btn" onclick="downloadActivityLogs()"><i class="fas fa-download"></i></button>
          <button class="panel-btn" onclick="clearActivityLogs()"><i class="fas fa-trash"></i></button>
          <button class="panel-btn" onclick="closePanel(this)"><i class="fas fa-times"></i></button>
        </div>
      </div>
      <div id="activityLogsList" class="max-h-40 overflow-y-auto">
        <!-- Activity logs will be populated here -->
      </div>
    </div>

    <!-- Error Log Panel -->
    <div class="panel" data-panel="errorLog">
      <div class="panel-header">
        <div class="panel-title"><i class="fas fa-bug"></i> Error Log</div>
        <div class="panel-controls">
          <button class="panel-btn" onclick="downloadErrorLogs()"><i class="fas fa-download"></i></button>
          <button class="panel-btn" onclick="clearErrorLogs()"><i class="fas fa-trash"></i></button>
          <button class="panel-btn" onclick="closePanel(this)"><i class="fas fa-times"></i></button>
        </div>
      </div>
      <div id="errorLogsList" class="max-h-40 overflow-y-auto">
        <!-- Error logs will be populated here -->
      </div>
    </div>


    <!-- Login History Panel -->
    <div class="panel" data-panel="loginHistory">
      <div class="panel-header">
        <div class="panel-title"><i class="fas fa-history"></i> Login History</div>
        <div class="panel-controls">
          <button class="panel-btn" onclick="closePanel(this)"><i class="fas fa-times"></i></button>
        </div>
      </div>
      <div id="loginHistoryList" class="space-y-2 max-h-40 overflow-y-auto">
        <!-- Login history will be populated here -->
      </div>
    </div>

    <!-- Mouse Clicker Panel -->
    <div class="panel" data-panel="mouseClicker">
      <div class="panel-header">
        <div class="panel-title"><i class="fas fa-mouse-pointer"></i> Mouse Clicker</div>
        <div class="panel-controls">
          <button class="panel-btn" onclick="closePanel(this)"><i class="fas fa-times"></i></button>
        </div>
      </div>
      <div class="content">
        <div id="clickCountDisplay" class="click-count-display">0</div>
        <button class="click-button" onclick="incrementClickCounter()">Click Me!</button>
        <div class="mouse-clicker-controls">
            <button class="quick-btn mt-2" onclick="resetClickCounter()"><i class="fas fa-undo-alt"></i> Reset</button>
        </div>
      </div>
    </div>

  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="settings-modal">
    <div class="settings-content">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-orange-500"><i class="fas fa-cog"></i> System Settings</h2>
        <button onclick="togglePanel('settingsModal')" class="text-2xl text-gray-400 hover:text-white">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="settings-grid">
        <div class="setting-item">
          <span>Dark Mode</span>
          <div class="toggle-switch" onclick="toggleSetting(this)">
            <div class="toggle-slider"></div>
          </div>
        </div>
        <div class="setting-item">
          <span>Auto-save Notes</span>
          <div class="toggle-switch active" onclick="toggleSetting(this)">
            <div class="toggle-slider"></div>
          </div>
        </div>
        <div class="setting-item">
          <span>Sound Notifications</span>
          <div class="toggle-switch" onclick="toggleSetting(this)">
            <div class="toggle-slider"></div>
          </div>
        </div>
        <div class="setting-item">
          <span>Auto-refresh Data</span>
          <div class="toggle-switch active" onclick="toggleSetting(this)">
            <div class="toggle-slider"></div>
          </div>
        </div>
        <div class="setting-item">
          <span>Compact View</span>
          <div class="toggle-switch" onclick="toggleSetting(this)">
            <div class="toggle-slider"></div>
          </div>
        </div>
        <div class="setting-item">
          <span>Show Animations</span>
          <div class="toggle-switch active" onclick="toggleSetting(this)">
            <div class="toggle-slider"></div>
          </div>
        </div>
        <div class="setting-item">
          <span>High Contrast</span>
          <div class="toggle-switch" onclick="toggleSetting(this)">
            <div class="toggle-slider"></div>
          </div>
        </div>
        <div class="setting-item">
          <span>Auto-backup</span>
          <div class="toggle-switch active" onclick="toggleSetting(this)">
            <div class="toggle-slider"></div>
          </div>
        </div>
        <div class="setting-item">
          <span>Security Mode</span>
          <div class="toggle-switch active" onclick="toggleSetting(this)">
            <div class="toggle-slider"></div>
          </div>
        </div>
        <div class="setting-item">
          <span>Advanced Logging</span>
          <div class="toggle-switch" onclick="toggleSetting(this)">
            <div class="toggle-slider"></div>
          </div>
        </div>
        <div class="setting-item">
          <span>Performance Mode</span>
          <div class="toggle-switch" onclick="toggleSetting(this)">
            <div class="toggle-slider"></div>
          </div>
        </div>
        <div class="setting-item">
          <span>Developer Mode</span>
          <div class="toggle-switch" onclick="toggleSetting(this)">
            <div class="toggle-slider"></div>
          </div>
        </div>
        <div class="setting-item">
          <span>Experimental Features</span>
          <div class="toggle-switch" onclick="toggleSetting(this)">
            <div class="toggle-slider"></div>
          </div>
        </div>
        <div class="setting-item">
          <span>Data Compression</span>
          <div class="toggle-switch active" onclick="toggleSetting(this)">
            <div class="toggle-slider"></div>
          </div>
        </div>
        <div class="setting-item">
          <span>Real-time Sync</span>
          <div class="toggle-switch" onclick="toggleSetting(this)">
            <div class="toggle-slider"></div>
          </div>
        </div>
      </div>

      <!-- Keybinds Section -->
      <div class="mt-8">
        <h3 class="text-xl font-bold text-orange-500 mb-4"><i class="fas fa-keyboard"></i> Keybinds Configuration</h3>
        <div class="space-y-3" id="keybindsList">
          <div class="keybind-item">
            <span>Open Settings</span>
            <input type="text" class="keybind-input" value="Ctrl+," placeholder="Press keys...">
          </div>
          <div class="keybind-item">
            <span>Quick Search</span>
            <input type="text" class="keybind-input" value="Ctrl+K" placeholder="Press keys...">
          </div>
          <div class="keybind-item">
            <span>New Note</span>
            <input type="text" class="keybind-input" value="Ctrl+N" placeholder="Press keys...">
          </div>
          <div class="keybind-item">
            <span>Save All</span>
            <input type="text" class="keybind-input" value="Ctrl+S" placeholder="Press keys...">
          </div>
          <div class="keybind-item">
            <span>Toggle Theme</span>
            <input type="text" class="keybind-input" value="Ctrl+T" placeholder="Press keys...">
          </div>
        </div>
      </div>

      <!-- Theme Selector -->
      <div class="mt-8">
        <h3 class="text-xl font-bold text-orange-500 mb-4"><i class="fas fa-palette"></i> Accent Theme Selection</h3>
        <div class="theme-selector">
          <div class="theme-option active" style="background: linear-gradient(135deg, #ff4500, #ff6b35);" onclick="applyAccentTheme('orange', event)">Orange</div>
          <div class="theme-option" style="background: linear-gradient(135deg, #0066cc, #004499);" onclick="applyAccentTheme('blue', event)">Blue</div>
          <div class="theme-option" style="background: linear-gradient(135deg, #00cc44, #009933);" onclick="applyAccentTheme('green', event)">Green</div>
          <div class="theme-option" style="background: linear-gradient(135deg, #cc0044, #990033);" onclick="applyAccentTheme('red', event)">Red</div>
          <div class="theme-option" style="background: linear-gradient(135deg, #8800cc, #6600aa);" onclick="applyAccentTheme('purple', event)">Purple</div>
          <div class="theme-option" style="background: linear-gradient(135deg, #ffaa00, #ff8800);" onclick="applyAccentTheme('amber', event)">Amber</div>
          <div class="theme-option" style="background: linear-gradient(135deg, #00aaaa, #008888);" onclick="applyAccentTheme('teal', event)">Teal</div>
          <div class="theme-option" style="background: linear-gradient(135deg, #ff0088, #cc0066);" onclick="applyAccentTheme('pink', event)">Pink</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Timer Panel -->
  <div id="timerPanel" class="settings-modal">
    <div class="settings-content">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-orange-500"><i class="fas fa-stopwatch"></i> Timer & Stopwatch</h2>
        <button onclick="togglePanel('timerPanel')" class="text-2xl text-gray-400 hover:text-white">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- Stopwatch -->
        <div class="bg-gray-800 p-6 rounded-lg">
          <h3 class="text-lg font-bold mb-4 text-center">Stopwatch</h3>
          <div class="timer-display" id="stopwatchDisplay">00:00:00</div>
          <div class="timer-controls">
            <button class="tool-btn" onclick="startStopwatch()"><i class="fas fa-play"></i> Start</button>
            <button class="tool-btn" onclick="pauseStopwatch()"><i class="fas fa-pause"></i> Pause</button>
            <button class="tool-btn" onclick="resetStopwatch()"><i class="fas fa-stop"></i> Reset</button>
          </div>
        </div>

        <!-- Timer -->
        <div class="bg-gray-800 p-6 rounded-lg">
          <h3 class="text-lg font-bold mb-4 text-center">Countdown Timer</h3>
          <div class="timer-display" id="timerDisplay">00:00:00</div>
          <div class="flex justify-center gap-2 mb-4">
            <input type="number" id="timerHours" class="w-16 p-2 bg-gray-700 rounded text-center" placeholder="HH" min="0" max="23">
            <input type="number" id="timerMinutes" class="w-16 p-2 bg-gray-700 rounded text-center" placeholder="MM" min="0" max="59">
            <input type="number" id="timerSeconds" class="w-16 p-2 bg-gray-700 rounded text-center" placeholder="SS" min="0" max="59">
          </div>
          <div class="timer-controls">
            <button class="tool-btn" onclick="startTimer()"><i class="fas fa-play"></i> Start</button>
            <button class="tool-btn" onclick="pauseTimer()"><i class="fas fa-pause"></i> Pause</button>
            <button class="tool-btn" onclick="resetTimer()"><i class="fas fa-stop"></i> Reset</button>
          </div>
        </div>
      </div>

      <!-- Reminders -->
      <div class="mt-8">
        <h3 class="text-lg font-bold mb-4"><i class="fas fa-bell"></i> Reminders</h3>
        <div class="flex gap-2 mb-4">
          <input type="text" id="reminderText" class="flex-1 p-2 bg-gray-700 rounded" placeholder="Reminder text...">
          <input type="datetime-local" id="reminderTime" class="p-2 bg-gray-700 rounded">
          <button class="tool-btn" onclick="addReminder()"><i class="fas fa-plus"></i> Add</button>
        </div>
        <div id="remindersList" class="space-y-2">
          <!-- Reminders will be populated here -->
        </div>
      </div>
    </div>
  </div>

  <!-- Notes Panel -->
  <div id="notesPanel" class="settings-modal">
    <div class="settings-content">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-orange-500"><i class="fas fa-pen"></i> Enhanced Notes</h2>
        <button onclick="togglePanel('notesPanel')" class="text-2xl text-gray-400 hover:text-white">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="drawing-tools">
        <button class="tool-btn active" data-tool="pen" onclick="selectTool(this, 'pen')">
          <i class="fas fa-pen"></i> Pen
        </button>
        <button class="tool-btn" data-tool="brush" onclick="selectTool(this, 'brush')">
          <i class="fas fa-paint-brush"></i> Brush
        </button>
        <button class="tool-btn" data-tool="eraser" onclick="selectTool(this, 'eraser')">
          <i class="fas fa-eraser"></i> Eraser
        </button>
        <button class="tool-btn" data-tool="text" onclick="selectTool(this, 'text')">
          <i class="fas fa-text-height"></i> Text
        </button>
        <button class="tool-btn" data-tool="line" onclick="selectTool(this, 'line')">
          <i class="fas fa-minus"></i> Line
        </button>
        <button class="tool-btn" data-tool="rectangle" onclick="selectTool(this, 'rectangle')">
          <i class="fas fa-square"></i> Rectangle
        </button>
        <button class="tool-btn" data-tool="circle" onclick="selectTool(this, 'circle')">
          <i class="fas fa-circle"></i> Circle
        </button>
        
        <div class="flex items-center gap-2">
          <label class="text-sm">Color:</label>
          <input type="color" id="penColor" class="color-picker" value="#ff4500">
        </div>
        
        <div class="flex items-center gap-2">
          <label class="text-sm">Thickness:</label>
          <input type="range" id="penThickness" class="thickness-slider" min="1" max="20" value="2">
        </div>
        
        <div class="flex items-center gap-2">
          <label class="text-sm">Material:</label>
          <select id="penMaterial" class="bg-gray-700 text-white p-1 rounded">
            <option value="solid">Solid</option>
            <option value="dashed">Dashed</option>
            <option value="dotted">D-otted</option>
          </select>
        </div>
        
        <button class="tool-btn" onclick="clearCanvas()">
          <i class="fas fa-trash"></i> Clear
        </button>
        <button class="tool-btn" onclick="saveCanvas()">
          <i class="fas fa-save"></i> Save
        </button>
      </div>
      
      <canvas id="drawingCanvas" width="760" height="400" class="w-full border border-gray-600 rounded mt-4 bg-white cursor-crosshair"></canvas>
      
      <!-- Text Notes Section -->
      <div class="mt-6">
        <h3 class="text-lg font-bold mb-2"><i class="fas fa-sticky-note"></i> Text Notes</h3>
        <textarea id="textNotes" class="w-full h-32 p-3 bg-gray-700 rounded resize-none" placeholder="Type your notes here..."></textarea>
        <div class="flex gap-2 mt-2">
          <button class="tool-btn" onclick="saveTextNotes()"><i class="fas fa-save"></i> Save Notes</button>
          <button class="tool-btn" onclick="clearTextNotes()"><i class="fas fa-trash"></i> Clear Notes</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Calculator Panel (Removed from quickbar, still available in code for direct call if needed) -->
  <div id="calculatorPanel" class="settings-modal" style="display:none;"> 
    <div class="settings-content">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-orange-500"><i class="fas fa-calculator"></i> Calculator & Converter</h2>
        <button onclick="togglePanel('calculatorPanel')" class="text-2xl text-gray-400 hover:text-white">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Calculator -->
        <div class="calculator">
          <h3 class="text-lg font-bold mb-4 text-center">Calculator</h3>
          <div class="calc-display" id="calcDisplay">0</div>
          <div class="calc-buttons">
            <button class="calc-btn" onclick="clearCalc()">C</button>
            <button class="calc-btn" onclick="deleteLast()">⌫</button>
            <button class="calc-btn operator" onclick="appendToCalc('/')">/</button>
            <button class="calc-btn operator" onclick="appendToCalc('*')">×</button>
            
            <button class="calc-btn" onclick="appendToCalc('7')">7</button>
            <button class="calc-btn" onclick="appendToCalc('8')">8</button>
            <button class="calc-btn" onclick="appendToCalc('9')">9</button>
            <button class="calc-btn operator" onclick="appendToCalc('-')">-</button>
            
            <button class="calc-btn" onclick="appendToCalc('4')">4</button>
            <button class="calc-btn" onclick="appendToCalc('5')">5</button>
            <button class="calc-btn" onclick="appendToCalc('6')">6</button>
            <button class="calc-btn operator" onclick="appendToCalc('+')">+</button>
            
            <button class="calc-btn" onclick="appendToCalc('1')">1</button>
            <button class="calc-btn" onclick="appendToCalc('2')">2</button>
            <button class="calc-btn" onclick="appendToCalc('3')">3</button>
            <button class="calc-btn equals" onclick="calculateResult()" rowspan="2">=</button>
            
            <button class="calc-btn" onclick="appendToCalc('0')" style="grid-column: span 2;">0</button>
            <button class="calc-btn" onclick="appendToCalc('.')">.</button>
          </div>
        </div>

        <!-- Unit Converter -->
        <div class="bg-gray-800 p-6 rounded-lg">
          <h3 class="text-lg font-bold mb-4 text-center">Unit Converter</h3>
          <div class="space-y-4">
            <select id="conversionType" class="w-full p-2 bg-gray-700 rounded" onchange="updateConversionUnits()">
              <option value="length">Length</option>
              <option value="weight">Weight</option>
              <option value="temperature">Temperature</option>
              <option value="volume">Volume</option>
            </select>
            
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm mb-1">From:</label>
                <select id="fromUnit" class="w-full p-2 bg-gray-700 rounded">
                  <option value="m">Meters</option>
                  <option value="km">Kilometers</option>
                  <option value="cm">Centimeters</option>
                  <option value="mm">Millimeters</option>
                  <option value="in">Inches</option>
                  <option value="ft">Feet</option>
                </select>
                <input type="number" id="fromValue" class="w-full p-2 bg-gray-700 rounded mt-2" placeholder="Enter value" oninput="convertUnits()">
              </div>
              
              <div>
                <label class="block text-sm mb-1">To:</label>
                <select id="toUnit" class="w-full p-2 bg-gray-700 rounded" onchange="convertUnits()">
                  <option value="m">Meters</option>
                  <option value="km">Kilometers</option>
                  <option value="cm">Centimeters</option>
                  <option value="mm">Millimeters</option>
                  <option value="in">Inches</option>
                  <option value="ft">Feet</option>
                </select>
                <input type="number" id="toValue" class="w-full p-2 bg-gray-700 rounded mt-2" readonly>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Media Panel (Removed from quickbar, still available in code for direct call if needed) -->
  <div id="mediaPanel" class="settings-modal" style="display:none;">
    <div class="settings-content">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-orange-500"><i class="fas fa-play"></i> Media Player</h2>
        <button onclick="togglePanel('mediaPanel')" class="text-2xl text-gray-400 hover:text-white">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="media-container">
        <div class="flex gap-2 mb-4">
          <input type="url" id="mediaUrl" class="media-input" placeholder="Enter YouTube URL...">
          <button class="tool-btn" onclick="loadMedia()"><i class="fas fa-play"></i> Load</button>
        </div>
        <iframe id="mediaFrame" class="media-frame" src="" frameborder="0" allowfullscreen></iframe>
      </div>
    </div>
  </div>

  <!-- Stats Panel -->
  <div id="statsPanel" class="settings-modal">
    <div class="settings-content">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-orange-500"><i class="fas fa-chart-bar"></i> Usage Statistics</h2>
        <button onclick="togglePanel('statsPanel')" class="text-2xl text-gray-400 hover:text-white">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-number" id="buttonPresses">0</div>
          <div class="stat-label">Button Presses</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="toggleSwitches">0</div>
          <div class="stat-label">Toggle Switches</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="panelsOpened">0</div>
          <div class="stat-label">Panels Opened</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="panelsClosed">0</div>
          <div class="stat-label">Panels Closed</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="searchQueries">0</div>
          <div class="stat-label">Search Queries</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="sessionTime">00:00:00</div>
          <div class="stat-label">Session Time</div>
        </div>
      </div>

      <!-- Chart -->
      <div class="mt-8">
        <canvas id="statsChart" style="height: 400px;"></canvas>
      </div>
    </div>
  </div>
</div>

<script>
// Global variables
let currentUser = '';
let currentUserID = '';
let loginAttempts = 3;
let is24HourFormat = false;
let currentZoom = 1;
let activityLogs = [];
let loginHistory = [];
let importantDates = []; // New array for important dates
let clickCount = 0; // New variable for mouse clicker
let errorLogs = []; // New array for error logs

let stats = {
  buttonPresses: 0,
  toggleSwitches: 0,
  panelsOpened: 0,
  panelsClosed: 0,
  searchQueries: 0,
  sessionStartTime: null
};
let isLightMode = false; // Added to track current theme

// Timer variables
let stopwatchInterval = null;
let stopwatchTime = 0;
let timerInterval = null;
let timerTime = 0;
let isStopwatchRunning = false;
let isTimerRunning = false;

// Drawing variables
let isDrawing = false;
let currentTool = 'pen';
let currentColor = '#ff4500';
let currentThickness = 2;
let canvas, ctx;

// Calculator variables
let calcDisplay = '';
let calcOperation = '';

// Initialization sequence
window.addEventListener('load', () => {
  startInitialization();
  loadLoginHistoryFromStorage();
  loadImportantDatesFromStorage();
  loadClickCountFromStorage();
  loadErrorLogsFromStorage();
});

function startInitialization() {
  generateCodeRain('codeRain');
  
  setTimeout(() => {
    document.getElementById('initText').textContent = 'Initializing Login Page...';
    setTimeout(() => {
      document.getElementById('initScreen').classList.add('hidden');
      document.getElementById('loginScreen').classList.remove('hidden');
      startClock();
    }, 2000);
  }, 3000);
}

function generateCodeRain(containerId) {
  const container = document.getElementById(containerId);
  // Ensure the container exists before attempting to add children
  if (!container) return;

  const chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
  
  setInterval(() => {
    // Only generate new characters if the initial screen is visible or loading screen is visible
    if (document.getElementById('initScreen') && !document.getElementById('initScreen').classList.contains('hidden') ||
        document.getElementById('loadingScreen') && !document.getElementById('loadingScreen').classList.contains('hidden')) {
        const char = document.createElement('div');
        char.className = 'code-char';
        char.textContent = chars[Math.floor(Math.random() * chars.length)];
        char.style.left = Math.random() * 100 + '%';
        char.style.animationDelay = Math.random() * 2 + 's';
        container.appendChild(char);
        
        setTimeout(() => {
        if (char.parentNode) {
            char.parentNode.removeChild(char);
        }
        }, 3000);
    } else {
        // Clear all code rain characters if not on an init/loading screen
        container.innerHTML = ''; 
    }
  }, 100);
}

function startClock() {
  updateClock();
  setInterval(updateClock, 1000);
}

function updateClock() {
  const now = new Date();
  const timeOptions = { hour12: !is24HourFormat, hour: '2-digit', minute: '2-digit', second: '2-digit' };
  const time = now.toLocaleTimeString('en-US', timeOptions);
  
  const date = now.toLocaleDateString('en-US', { 
    weekday: 'long', 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric' 
  });
  
  // Update login screen time
  document.getElementById('currentTime').textContent = time;
  document.getElementById('currentDate').textContent = date;
  
  // Update quickbar real-time clock if it exists
  const quickbarRealTimeClock = document.getElementById('quickbarCurrentTime');
  if (quickbarRealTimeClock) {
    quickbarRealTimeClock.textContent = time;
  }
}

function adjustZoom(delta) {
  currentZoom = Math.max(0.5, Math.min(2, currentZoom + delta));
  document.body.style.zoom = currentZoom;
  logActivity('Zoom adjusted to ' + Math.round(currentZoom * 100) + '%');
}

// Toggle functions
function setupToggles() {
  // Show password toggle
  document.getElementById('showPasswordToggle').addEventListener('click', function() {
    this.classList.toggle('active');
    const passwordField = document.getElementById('password');
    passwordField.type = this.classList.contains('active') ? 'text' : 'password';
    stats.toggleSwitches++;
    logActivity('Password visibility toggled');
  });

  // 24-hour format toggle
  document.getElementById('timeFormatToggle').addEventListener('click', function() {
    this.classList.toggle('active');
    is24HourFormat = this.classList.contains('active');
    stats.toggleSwitches++;
    logActivity('Time format toggled to ' + (is24HourFormat ? '24-hour' : '12-hour'));
  });
}

// Login function
function attemptLogin() {
  const username = document.getElementById('username').value;
  const password = document.getElementById('password').value;
  const userID = document.getElementById('userID').value;
  
  if (!username || !password || !userID) {
    showError('Please fill all fields');
    return;
  }

  // Simulate login validation (replace with real authentication)
  if (username === 'admin' && password === 'admin123' && userID === '12345') {
    successfulLogin(username, userID);
  } else {
    failedLogin();
  }
}

function successfulLogin(username, userID) {
  currentUser = username;
  currentUserID = userID;
  
  // Add to login history
  loginHistory.unshift({
    time: new Date().toISOString(),
    success: true,
    username: username
  });
  saveLoginHistoryToStorage(); // Save history to local storage
  
  // Show loading screen
  document.getElementById('loginScreen').classList.add('hidden');
  document.getElementById('loadingScreen').classList.remove('hidden');
  // Re-generate code rain for loading screen
  const loadingCodeRainContainer = document.getElementById('loadingCodeRain');
  if (loadingCodeRainContainer) {
      loadingCodeRainContainer.innerHTML = ''; // Clear previous
      generateCodeRain('loadingCodeRain');
  }

  setTimeout(() => {
    document.getElementById('loadingScreen').classList.add('hidden');
    document.getElementById('dashboard').classList.add('active');
    initializeDashboard();
  }, 3000);
}

function failedLogin() {
  loginAttempts--;
  const errorMsg = 'Invalid credentials';
  document.getElementById('attemptsText').textContent = `Attempts Left: ${loginAttempts}`;
  document.getElementById('loginBox').classList.add('error-shake');
  
  setTimeout(() => {
    document.getElementById('loginBox').classList.remove('error-shake');
  }, 500);
  
  if (loginAttempts <= 0) {
    const lockMsg = 'No attempts remaining. System locked.';
    showError(lockMsg); // Will also log to error log
    document.getElementById('submitBtn').disabled = true;
  } else {
    showError(errorMsg); // Will also log to error log
  }
  
  // Add to login history
  loginHistory.unshift({
    time: new Date().toISOString(),
    success: false,
    username: document.getElementById('username').value // Log the entered username
  });
  saveLoginHistoryToStorage(); // Save history to local storage
}

function showError(message) {
  const errorDisplay = document.getElementById('errorMsg');
  if (errorDisplay) {
      errorDisplay.textContent = message;
      logError(message); // Log to the new error log panel
      setTimeout(() => {
        errorDisplay.textContent = '';
      }, 3000);
  } else {
      console.error("Error display element not found:", message);
      logError(message); // Still log if UI display is missing
  }
}

// Dashboard initialization
function initializeDashboard() {
  stats.sessionStartTime = Date.now();
  
  // Show welcome notification
  const welcomeNotification = document.getElementById('welcomeNotification');
  if (welcomeNotification) {
      document.getElementById('loggedUser').textContent = currentUser;
      document.getElementById('currentUser').textContent = currentUser;
      document.getElementById('currentUserID').textContent = currentUserID;
      welcomeNotification.style.display = 'block'; // Make sure it's visible initially

      setTimeout(() => {
        welcomeNotification.style.display = 'none';
      }, 5000);
  }
  
  // Initialize components
  generateCalendar();
  initializeCanvas();
  startSessionTimer(); 
  updateClock(); 
  // No need for setInterval here as it's already set in startClock, which is called once initially.
  // Instead, the startClock function's setInterval handles continuous updates.
  updateStats();
  updateLoginHistoryDisplay();
  updateImportantDatesDisplay(); // Update important dates display
  updateClickCountDisplay(); // Update click count display
  updateErrorLogDisplay(); // Update error logs display
  
  logActivity('Dashboard initialized');
}

function generateCalendar() {
  const calendar = document.getElementById('calendarGrid');
  if (!calendar) return;

  calendar.innerHTML = '';
  
  const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
  const today = new Date();
  const currentMonth = today.getMonth();
  const currentYear = today.getFullYear();
  
  // Add day headers
  days.forEach(day => {
    const dayElement = document.createElement('div');
    dayElement.textContent = day;
    dayElement.className = 'calendar-cell text-xs font-bold text-gray-400';
    calendar.appendChild(dayElement);
  });
  
  // Add calendar days
  const firstDay = new Date(currentYear, currentMonth, 1).getDay();
  const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
  
  // Empty cells for days before month starts
  for (let i = 0; i < firstDay; i++) {
    const emptyCell = document.createElement('div');
    emptyCell.className = 'calendar-cell';
    calendar.appendChild(emptyCell);
  }
  
  // Days of the month
  for (let day = 1; day <= daysInMonth; day++) {
    const dayCell = document.createElement('div');
    dayCell.textContent = day;
    dayCell.className = 'calendar-cell';
    
    if (day === today.getDate()) {
      dayCell.classList.add('today');
    }
    
    calendar.appendChild(dayCell);
  }
}

function initializeCanvas() {
  canvas = document.getElementById('drawingCanvas');
  if (!canvas) return; // Safely exit if canvas element is not present
  ctx = canvas.getContext('2d');
  
  canvas.addEventListener('mousedown', startDrawing);
  canvas.addEventListener('mousemove', draw);
  canvas.addEventListener('mouseup', stopDrawing);
  canvas.addEventListener('mouseout', stopDrawing);
}

function startDrawing(e) {
  isDrawing = true;
  if (!canvas) return;
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  
  ctx.beginPath();
  ctx.moveTo(x, y);
}

function draw(e) {
  if (!isDrawing || !canvas) return;
  
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  
  ctx.lineWidth = currentThickness;
  ctx.lineCap = 'round';
  ctx.strokeStyle = currentTool === 'eraser' ? 'white' : currentColor;
  
  ctx.lineTo(x, y);
  ctx.stroke();
  ctx.beginPath();
  ctx.moveTo(x, y);
}

function stopDrawing() {
  isDrawing = false;
  if (ctx) { // Ensure context exists before trying to access it
    ctx.beginPath();
  }
}

function startSessionTimer() {
  // Clear any existing session timer interval to prevent duplicates
  if (this.sessionTimerInterval) clearInterval(this.sessionTimerInterval); 
  
  this.sessionTimerInterval = setInterval(() => { // Store interval ID on `this` (window)
    if (stats.sessionStartTime) {
      const elapsed = Math.floor((Date.now() - stats.sessionStartTime) / 1000);
      const hours = Math.floor(elapsed / 3600);
      const minutes = Math.floor((elapsed % 3600) / 60);
      const seconds = elapsed % 60;
      
      const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      
      const mainSessionTime = document.getElementById('sessionTime');
      if (mainSessionTime) {
          mainSessionTime.textContent = timeString;
      }
      
      const quickbarSessionTime = document.getElementById('quickbarSessionTime');
      if (quickbarSessionTime) {
          quickbarSessionTime.textContent = timeString;
      }
    }
  }, 1000);
}

// Utility functions
function togglePanel(panelId) {
  const panel = document.getElementById(panelId);
  if (!panel) {
      console.warn(`Panel with ID ${panelId} not found.`);
      return;
  }
  const isVisible = panel.style.display === 'flex' || panel.style.display === 'block';
  
  if (panel.classList.contains('settings-modal')) {
    panel.style.display = isVisible ? 'none' : 'flex';
  } else {
    panel.style.display = isVisible ? 'none' : 'block';
  }

  if (!isVisible) {
    stats.panelsOpened++;
    logActivity(`Panel opened: ${panelId}`);
  } else {
    stats.panelsClosed++;
    logActivity(`Panel closed: ${panelId}`);
  }
  
  updateStats();
}


function minimizePanel(button) {
  const panel = button.closest('.panel');
  if (!panel) return;
  const content = panel.querySelector('.panel-header').nextElementSibling;
  
  if (content.style.display === 'none') {
    content.style.display = 'block';
    button.innerHTML = '<i class="fas fa-minus"></i>';
  } else {
    content.style.display = 'none';
    button.innerHTML = '<i class="fas fa-plus"></i>';
  }
  
  stats.buttonPresses++;
  logActivity('Panel minimized/restored');
}

function closePanel(button) {
  const panel = button.closest('.panel');
  if (!panel) return;
  panel.style.display = 'none';
  stats.panelsClosed++;
  stats.buttonPresses++;
  logActivity(`Panel closed: ${panel.dataset.panel}`);
  updateStats();
}

function performSearch() {
  const queryBar = document.getElementById('searchBar');
  if (!queryBar) return;

  const query = queryBar.value.toLowerCase();
  if (!query) return;
  
  stats.searchQueries++;
  logActivity(`Searched for: ${query}`);
  
  const panels = document.querySelectorAll('.panels-grid > .panel'); 
  let found = false;
  panels.forEach(panel => {
    // Only check if panel has a title for comparison, exclude general body.
    const panelTitleElement = panel.querySelector('.panel-title');
    const panelTitle = panelTitleElement ? panelTitleElement.textContent.toLowerCase() : '';
    
    // Attempt to get text from children, but exclude potentially long/irrelevant data for searching (e.g. text areas)
    const panelContentText = panel.textContent.toLowerCase(); 

    if (panelContentText.includes(query) || panelTitle.includes(query)) {
      panel.style.display = 'block'; 
      panel.style.border = '2px solid var(--accent-color)'; 
      found = true;
      setTimeout(() => {
        panel.style.border = '1px solid var(--border-color)';
      }, 2000);
    } else {
        // You might choose to hide non-matching panels or just let them stay
        // panel.style.display = 'none'; 
    }
  });

  if (!found) {
      showNotification("No matching panels found for '" + query + "'.");
      logError("Search failed: No matching panels found for query '" + query + "'.");
  }
  
  updateStats();
}

function logActivity(activity) {
  const timestamp = new Date().toISOString();
  activityLogs.unshift({
    timestamp,
    activity,
    id: Date.now()
  });
  
  if (activityLogs.length > 100) {
    activityLogs = activityLogs.slice(0, 100);
  }
  
  updateActivityLogDisplay();
}

function updateActivityLogDisplay() {
  const container = document.getElementById('activityLogsList');
  if (!container) return;
  container.innerHTML = '';
  
  activityLogs.slice(0, 10).forEach(log => {
    const logElement = document.createElement('div');
    logElement.className = 'log-entry';
    logElement.innerHTML = `
      <span>${log.activity}</span>
      <span class="log-time">${new Date(log.timestamp).toLocaleTimeString()}</span>
    `;
    container.appendChild(logElement);
  });
}

function logError(message) {
    const timestamp = new Date().toISOString();
    errorLogs.unshift({
        timestamp,
        message,
        id: Date.now()
    });

    if (errorLogs.length > 100) { // Keep last 100 errors
        errorLogs = errorLogs.slice(0, 100);
    }
    saveErrorLogsToStorage(); // Persist changes
    updateErrorLogDisplay();
}

function updateErrorLogDisplay() {
    const container = document.getElementById('errorLogsList');
    if (!container) return;
    container.innerHTML = '';

    errorLogs.slice(0, 10).forEach(err => {
        const errorElement = document.createElement('div');
        errorElement.className = 'error-log-entry';
        errorElement.innerHTML = `
            <span>${err.message}</span>
            <span class="error-log-time">${new Date(err.timestamp).toLocaleTimeString()}</span>
        `;
        container.appendChild(errorElement);
    });
}

function clearErrorLogs() {
    errorLogs = [];
    saveErrorLogsToStorage();
    updateErrorLogDisplay();
    showNotification("Error logs cleared.");
    logActivity("Error logs cleared.");
}

function downloadErrorLogs() {
    const data = {
        errorLogs: errorLogs,
        timestamp: new Date().toISOString()
    };
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `error_logs_${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);

    showNotification("Error logs downloaded.");
    logActivity("Error logs downloaded.");
    stats.buttonPresses++;
    updateStats();
}


function saveLoginHistoryToStorage() {
  localStorage.setItem('loginHistory', JSON.stringify(loginHistory));
}

function loadLoginHistoryFromStorage() {
  const storedHistory = localStorage.getItem('loginHistory');
  if (storedHistory) {
    loginHistory = JSON.parse(storedHistory);
  }
  updateLoginHistoryDisplay();
}

function saveImportantDatesToStorage() {
    localStorage.setItem('importantDates', JSON.stringify(importantDates));
}

function loadImportantDatesFromStorage() {
    const storedDates = localStorage.getItem('importantDates');
    if (storedDates) {
        importantDates = JSON.parse(storedDates);
    }
    updateImportantDatesDisplay();
}

function saveClickCountToStorage() {
    localStorage.setItem('mouseClickCount', clickCount);
}

function loadClickCountFromStorage() {
    const storedClickCount = localStorage.getItem('mouseClickCount');
    if (storedClickCount !== null) {
        clickCount = parseInt(storedClickCount);
    }
    updateClickCountDisplay();
}

function saveErrorLogsToStorage() {
    localStorage.setItem('errorLogs', JSON.stringify(errorLogs));
}

function loadErrorLogsFromStorage() {
    const storedErrorLogs = localStorage.getItem('errorLogs');
    if (storedErrorLogs) {
        errorLogs = JSON.parse(storedErrorLogs);
    }
    updateErrorLogDisplay();
}


function updateLoginHistoryDisplay() {
  const container = document.getElementById('loginHistoryList');
  if (!container) return;
  container.innerHTML = '';

  loginHistory.slice(0, 10).forEach(entry => { 
    const logElement = document.createElement('div');
    const statusClass = entry.success ? 'success' : 'failed';
    logElement.className = `login-entry-container ${statusClass}`;
    logElement.innerHTML = `
      <div class="flex-grow">
        <span class="login-entry-status">${entry.success ? 'SUCCESS' : 'FAILED'}:</span> 
        <span>User "${entry.username || 'unknown'}"</span>
      </div>
      <span class="login-entry-time">${new Date(entry.time).toLocaleString()}</span>
    `;
    container.appendChild(logElement);
  });
}

// New Important Dates functions
function addImportantDate() {
    const dateInput = document.getElementById('importantDateDay');
    const timeInput = document.getElementById('importantDateTime');
    const eventInput = document.getElementById('importantDateEvent');

    if (dateInput.value && timeInput.value && eventInput.value) {
        const fullDate = `${dateInput.value}T${timeInput.value}`; // Format for Date object
        const newDate = {
            id: Date.now(),
            datetime: new Date(fullDate).toISOString(),
            event: eventInput.value
        };
        importantDates.unshift(newDate); // Add to the beginning
        importantDates.sort((a, b) => new Date(a.datetime) - new Date(b.datetime)); // Keep sorted by date
        saveImportantDatesToStorage();
        updateImportantDatesDisplay();
        logActivity(`Added important date: ${eventInput.value} on ${new Date(fullDate).toLocaleString()}`);
        showNotification("Important date added!");

        // Clear inputs
        const today = new Date();
        dateInput.value = today.toISOString().split('T')[0];
        timeInput.value = "09:00"; // Default to 9 AM for easier entry
        eventInput.value = '';
    } else {
        showError("Please fill in all important date fields.");
    }
}

function clearImportantDates() {
    if (confirm("Are you sure you want to clear all important dates?")) {
        importantDates = [];
        saveImportantDatesToStorage();
        updateImportantDatesDisplay();
        logActivity("All important dates cleared.");
        showNotification("All important dates cleared.");
    }
}

function updateImportantDatesDisplay() {
    const container = document.getElementById('importantDatesList');
    if (!container) return;
    container.innerHTML = '';

    importantDates.forEach(dateEntry => {
        const entryElement = document.createElement('div');
        entryElement.className = 'important-date-item';
        const formattedDate = new Date(dateEntry.datetime).toLocaleString();
        entryElement.innerHTML = `
            <div class="date-time">${formattedDate}</div>
            <div class="event-description">${dateEntry.event}</div>
        `;
        container.appendChild(entryElement);
    });
}


// New Mouse Clicker functions
function incrementClickCounter() {
    clickCount++;
    updateClickCountDisplay();
    saveClickCountToStorage();
    logActivity('Mouse click incremented');
}

function resetClickCounter() {
    if (confirm("Are you sure you want to reset the click counter?")) {
        clickCount = 0;
        updateClickCountDisplay();
        saveClickCountToStorage();
        logActivity('Mouse clicker reset');
        showNotification("Click counter reset!");
    }
}

function updateClickCountDisplay() {
    const display = document.getElementById('clickCountDisplay');
    if (display) {
        display.textContent = clickCount;
    }
}


function updateStats() {
  document.getElementById('buttonPresses').textContent = stats.buttonPresses;
  document.getElementById('toggleSwitches').textContent = stats.toggleSwitches;
  document.getElementById('panelsOpened').textContent = stats.panelsOpened;
  document.getElementById('panelsClosed').textContent = stats.panelsClosed;
  document.getElementById('searchQueries').textContent = stats.searchQueries;
}

function downloadActivityLogs() {
  const data = {
    activityLogs,
    loginHistory, 
    importantDates,
    mouseClickCount: clickCount,
    errorLogs,
    stats,
    timestamp: new Date().toISOString()
  };
  
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `activity_logs_${new Date().toISOString().split('T')[0]}.json`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  
  stats.buttonPresses++;
  logActivity('Activity logs downloaded');
  showNotification('Activity logs downloaded!');
  updateStats();
}

function showStats() {
  togglePanel('statsPanel');
  
  // Create stats chart
  const ctx = document.getElementById('statsChart').getContext('2d');
  if (Chart.getChart(ctx)) {
    Chart.getChart(ctx).destroy();
  }
  new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: ['Button Presses', 'Toggle Switches', 'Panels Opened', 'Panels Closed', 'Search Queries', 'Mouse Clicks'], // Added Mouse Clicks
      datasets: [{
        data: [stats.buttonPresses, stats.toggleSwitches, stats.panelsOpened, stats.panelsClosed, stats.searchQueries, clickCount], // Included clickCount
        backgroundColor: ['#ff4500', '#ff6b35', '#00ff41', '#ffaa00', '#0066cc', '#8800cc'] // Added a color
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          labels: {
            color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary')
          }
        }
      }
    }
  });
}

// Timer functions
function startStopwatch() {
  if (!isStopwatchRunning) {
    isStopwatchRunning = true;
    stopwatchInterval = setInterval(() => {
      stopwatchTime++;
      updateStopwatchDisplay();
    }, 10);
    logActivity('Stopwatch started');
  }
}

function pauseStopwatch() {
  if (isStopwatchRunning) {
    isStopwatchRunning = false;
    clearInterval(stopwatchInterval);
    logActivity('Stopwatch paused');
  }
}

function resetStopwatch() {
  isStopwatchRunning = false;
  clearInterval(stopwatchInterval);
  stopwatchTime = 0;
  updateStopwatchDisplay();
  logActivity('Stopwatch reset');
}

function updateStopwatchDisplay() {
  const totalSeconds = Math.floor(stopwatchTime / 100);
  const hours = Math.floor(totalSeconds / 3600);
  const minutes = Math.floor((totalSeconds % 3600) / 60);
  const seconds = totalSeconds % 60;
  const centiseconds = stopwatchTime % 100;
  
  document.getElementById('stopwatchDisplay').textContent = 
    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}.${centiseconds.toString().padStart(2, '0')}`;
}

function startTimer() {
  const hoursInput = document.getElementById('timerHours');
  const minutesInput = document.getElementById('timerMinutes');
  const secondsInput = document.getElementById('timerSeconds');

  const hours = parseInt(hoursInput.value) || 0;
  const minutes = parseInt(minutesInput.value) || 0;
  const seconds = parseInt(secondsInput.value) || 0;
  
  timerTime = (hours * 3600) + (minutes * 60) + seconds;
  
  if (timerTime > 0 && !isTimerRunning) {
    isTimerRunning = true;
    timerInterval = setInterval(() => {
      timerTime--;
      updateTimerDisplay();
      
      if (timerTime <= 0) {
        pauseTimer();
        showNotification('Timer finished!');
        logActivity('Timer completed');
        // Clear inputs after timer finishes
        hoursInput.value = '';
        minutesInput.value = '';
        secondsInput.value = '';
      }
    }, 1000);
    logActivity('Timer started');
  }
}

function pauseTimer() {
  isTimerRunning = false;
  clearInterval(timerInterval);
  logActivity('Timer paused');
}

function resetTimer() {
  isTimerRunning = false;
  clearInterval(timerInterval);
  timerTime = 0;
  updateTimerDisplay();
  logActivity('Timer reset');

  // Clear inputs on reset
  document.getElementById('timerHours').value = '';
  document.getElementById('timerMinutes').value = '';
  document.getElementById('timerSeconds').value = '';
}

function updateTimerDisplay() {
  const hours = Math.floor(timerTime / 3600);
  const minutes = Math.floor((timerTime % 3600) / 60);
  const seconds = timerTime % 60;
  
  document.getElementById('timerDisplay').textContent = 
    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}

function addReminder() {
  const text = document.getElementById('reminderText').value;
  const time = document.getElementById('reminderTime').value;
  
  if (text && time) {
    const reminderTime = new Date(time);
    const now = new Date();
    
    if (reminderTime > now) {
      const timeout = reminderTime.getTime() - now.getTime();
      
      setTimeout(() => {
        showNotification(`Reminder: ${text}`);
      }, timeout);
      
      const reminderElement = document.createElement('div');
      reminderElement.className = 'p-2 bg-gray-700 rounded'; // Keep a consistent styling for reminder elements
      reminderElement.innerHTML = `
        <div class="font-semibold">${text}</div>
        <div class="text-sm text-gray-400">${reminderTime.toLocaleString()}</div>
      `;
      
      document.getElementById('remindersList').appendChild(reminderElement);
      
      document.getElementById('reminderText').value = '';
      document.getElementById('reminderTime').value = '';
      
      logActivity(`Reminder set: ${text}`);
    } else {
        showError("Reminder time must be in the future.");
    }
  } else {
    showError("Please enter both reminder text and a time.");
  }
}

// Drawing tools
function selectTool(button, tool) {
  document.querySelectorAll('.tool-btn[data-tool]').forEach(btn => btn.classList.remove('active'));
  button.classList.add('active');
  currentTool = tool;
  
  const canvasElement = document.getElementById('drawingCanvas');
  if (canvasElement) {
    canvasElement.style.cursor = tool === 'eraser' ? 'crosshair' : 'crosshair';
  }
  
  logActivity(`Drawing tool changed to: ${tool}`);
}

function clearCanvas() {
  if (ctx && canvas) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    logActivity('Canvas cleared');
  } else {
    logError("Attempted to clear canvas but canvas context is not initialized.");
  }
}

function saveCanvas() {
  if (!canvas) {
      logError("Attempted to save canvas but canvas element is not initialized.");
      return;
  }
  const link = document.createElement('a');
  link.download = `drawing_${Date.now()}.png`;
  link.href = canvas.toDataURL();
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  logActivity('Canvas saved');
  showNotification("Canvas saved!");
}

// Calculator functions (still in code but not exposed via quickbar buttons)
function appendToCalc(value) {
  const display = document.getElementById('calcDisplay');
  if (!display) return;
  if (display.textContent === '0' && value !== '.') { 
    display.textContent = value;
  } else {
    display.textContent += value;
  }
}

function clearCalc() {
  const display = document.getElementById('calcDisplay');
  if (display) display.textContent = '0';
}

function deleteLast() {
  const display = document.getElementById('calcDisplay');
  if (!display) return;
  if (display.textContent.length > 1) {
    display.textContent = display.textContent.slice(0, -1);
  } else {
    display.textContent = '0';
  }
}

function calculateResult() {
  const display = document.getElementById('calcDisplay');
  if (!display) return;
  try {
    // Basic evaluation for demo, caution in production with eval()
    const result = eval(display.textContent.replace(/×/g, '*').replace(/÷/g, '/')); 
    display.textContent = result;
    logActivity(`Calculation performed: ${display.textContent} = ${result}`);
  } catch (error) {
    display.textContent = 'Error';
    logError(`Calculator error: ${error.message} for expression '${display.textContent}'`);
  }
}

// Unit converter (still in code but not exposed via quickbar buttons)
function updateConversionUnits() {
  const conversionType = document.getElementById('conversionType');
  const fromUnit = document.getElementById('fromUnit');
  const toUnit = document.getElementById('toUnit');

  if (!conversionType || !fromUnit || !toUnit) return;
  const type = conversionType.value;
  
  const units = {
    length: [
      { value: 'm', text: 'Meters' },
      { value: 'km', text: 'Kilometers' },
      { value: 'cm', text: 'Centimeters' },
      { value: 'mm', text: 'Millimeters' },
      { value: 'in', text: 'Inches' },
      { value: 'ft', text: 'Feet' }
    ],
    weight: [
      { value: 'kg', text: 'Kilograms' },
      { value: 'g', text: 'Grams' },
      { value: 'lb', text: 'Pounds' },
      { value: 'oz', text: 'Ounces' }
    ],
    temperature: [
      { value: 'c', text: 'Celsius' },
      { value: 'f', text: 'Fahrenheit' },
      { value: 'k', text: 'Kelvin' }
    ],
    volume: [
      { value: 'l', text: 'Liters' },
      { value: 'ml', text: 'Milliliters' },
      { value: 'gal', text: 'Gallons' },
      { value: 'qt', text: 'Quarts' }
    ]
  };
  
  fromUnit.innerHTML = '';
  toUnit.innerHTML = '';
  
  units[type].forEach(unit => {
    fromUnit.innerHTML += `<option value="${unit.value}">${unit.text}</option>`;
    toUnit.innerHTML += `<option value="${unit.value}">${unit.text}</option>`;
  });
  convertUnits(); 
}

function convertUnits() {
  const fromValueInput = document.getElementById('fromValue');
  const fromUnitSelect = document.getElementById('fromUnit');
  const toUnitSelect = document.getElementById('toUnit');
  const toValueInput = document.getElementById('toValue');
  const conversionType = document.getElementById('conversionType');

  if (!fromValueInput || !fromUnitSelect || !toUnitSelect || !toValueInput || !conversionType) return;


  const fromValue = parseFloat(fromValueInput.value);
  const fromUnit = fromUnitSelect.value;
  const toUnit = toUnitSelect.value;
  const type = conversionType.value;
  
  if (isNaN(fromValue)) {
    toValueInput.value = '';
    return;
  }
  
  let result = fromValue;
  
  const factors = {
    length: { 
      'm': 1, 'km': 1000, 'cm': 0.01, 'mm': 0.001, 'in': 0.0254, 'ft': 0.3048
    },
    weight: { 
      'kg': 1000, 'g': 1, 'lb': 453.592, 'oz': 28.3495
    },
    volume: { 
        'l': 1, 'ml': 0.001, 'gal': 3.78541, 'qt': 0.946353
    }
  };
  
  if (type === 'length') {
    result = fromValue * factors.length[fromUnit] / factors.length[toUnit];
  } else if (type === 'weight') {
    result = fromValue * factors.weight[fromUnit] / factors.weight[toUnit];
  } else if (type === 'volume') {
    result = fromValue * factors.volume[fromUnit] / factors.volume[toUnit];
  } else if (type === 'temperature') {
      let tempInC;
      if (fromUnit === 'c') tempInC = fromValue;
      else if (fromUnit === 'f') tempInC = (fromValue - 32) * 5/9;
      else if (fromUnit === 'k') tempInC = fromValue - 273.15;

      if (toUnit === 'c') result = tempInC;
      else if (toUnit === 'f') result = (tempInC * 9/5) + 32;
      else if (toUnit === 'k') result = tempInC + 273.15;
  }
  
  toValueInput.value = result.toFixed(6);
  logActivity(`Unit converted: ${fromValue} ${fromUnit} to ${result.toFixed(6)} ${toUnit}`);
}

// Theme functions
function toggleTheme() {
  document.body.classList.toggle('light-theme');
  isLightMode = document.body.classList.contains('light-theme');
  logActivity('Theme toggled to ' + (isLightMode ? 'Light Mode' : 'Dark Mode'));
  updateStatsChartTheme(); 
}

function applyAccentTheme(theme, event) {
  const root = document.documentElement;
  
  const themes = {
    orange: { primary: '#ff4500', secondary: '#ff6b35' },
    blue: { primary: '#0066cc', secondary: '#004499' },
    green: { primary: '#00cc44', secondary: '#009933' },
    red: { primary: '#cc0044', secondary: '#990033' },
    purple: { primary: '#8800cc', secondary: '#6600aa' },
    amber: { primary: '#ffaa00', secondary: '#ff8800' },
    teal: { primary: '#00aaaa', secondary: '#008888' },
    pink: { primary: '#ff0088', secondary: '#cc0066' }
  };
  
  if (themes[theme]) {
    root.style.setProperty('--accent-color', themes[theme].primary);
    root.style.setProperty('--accent-secondary', themes[theme].secondary);
    
    // For light theme, update these too for a new accent
    if (document.body.classList.contains('light-theme')) {
        root.style.setProperty('--success-color', themes[theme].primary); 
        root.style.setProperty('--error-color', themes[theme].primary);   
        root.style.setProperty('--warning-color', themes[theme].primary); 
    } else {
        root.style.setProperty('--success-color', '#00ff41'); 
        root.style.setProperty('--error-color', '#ff0040');   
        root.style.setProperty('--warning-color', '#ffaa00');
    }

    document.querySelectorAll('.theme-option').forEach(opt => opt.classList.remove('active'));
    // event.target could be an <i> tag if inside button, ensure it's the button itself
    (event.target.closest('.theme-option') || event.target).classList.add('active'); 
    
    logActivity(`Accent theme changed to: ${theme}`);
    updateStatsChartTheme(); 
  }
}

function updateStatsChartTheme() {
    const chart = Chart.getChart('statsChart');
    if (chart) {
        chart.options.plugins.legend.labels.color = getComputedStyle(document.documentElement).getPropertyValue('--text-primary');
        chart.update();
    }
}

function toggleSetting(toggle) {
  if (!toggle) return;
  toggle.classList.toggle('active');
  stats.toggleSwitches++;
  // Ensure previousElementSibling exists before accessing textContent
  const settingName = toggle.previousElementSibling ? toggle.previousElementSibling.textContent : 'Unknown Setting';
  logActivity(`Setting toggled: ${settingName}`);
  updateStats();
}

// Refresh functions
function refreshFact() {
  const facts = [
    "Honey never spoils. Archaeologists have found pots of honey in ancient Egyptian tombs that are over 3000 years old and still perfectly edible.",
    "A group of flamingos is called a 'flamboyance'.",
    "Bananas are berries, but strawberries aren't.",
    "The shortest war in history lasted only 38-45 minutes.",
    "A single cloud can weigh more than a million pounds."
  ];
  
  const randomFactElement = document.getElementById('randomFact');
  if (randomFactElement) {
    randomFactElement.textContent = facts[Math.floor(Math.random() * facts.length)];
    logActivity('Random fact refreshed');
  }
}

function refreshQuote() {
  const quotes = [
    "\"The only way to do great work is to love what you do.\" - Steve Jobs",
    "\"Innovation distinguishes between a leader and a follower.\" - Steve Jobs",
    "\"Life is what happens to you while you're busy making other plans.\" - John Lennon",
    "\"The future belongs to those who believe in the beauty of their dreams.\" - Eleanor Roosevelt",
    "\"It is during our darkest moments that we must focus to see the light.\" - Aristotle"
  ];
  
  const dailyQuoteElement = document.getElementById('dailyQuote');
  if (dailyQuoteElement) {
    dailyQuoteElement.textContent = quotes[Math.floor(Math.random() * quotes.length)];
    logActivity('Daily quote refreshed');
  }
}

function clearNotifications() {
  const notificationsList = document.getElementById('notificationsList');
  if (notificationsList) {
    notificationsList.innerHTML = '';
    logActivity('Notifications cleared');
  }
}

function clearActivityLogs() {
  activityLogs = [];
  updateActivityLogDisplay();
  logActivity('Activity logs cleared');
  showNotification("Activity logs cleared.");
}

function saveTextNotes() {
  const textNotesElement = document.getElementById('textNotes');
  if (textNotesElement) {
    const notes = textNotesElement.value;
    localStorage.setItem('textNotes', notes);
    showNotification('Notes saved successfully');
    logActivity('Text notes saved');
  }
}

function clearTextNotes() {
  const textNotesElement = document.getElementById('textNotes');
  if (textNotesElement) {
    textNotesElement.value = '';
    logActivity('Text notes cleared');
  }
}

function showNotification(message) {
  const notification = document.createElement('div');
  notification.className = 'notification';
  notification.innerHTML = `<i class="fas fa-info-circle"></i> ${message}`;
  document.body.appendChild(notification);
  
  setTimeout(() => {
    notification.remove();
  }, 3000);
}

function logout() {
  if (confirm('Are you sure you want to logout?')) {
    logActivity('System logged out');
    // Clear the loading rain characters if they are still running from login
    const loadingCodeRainContainer = document.getElementById('loadingCodeRain');
    if (loadingCodeRainContainer) {
        loadingCodeRainContainer.innerHTML = ''; 
    }
    location.reload();
  }
}

// New functions requested by user
function takeScreenshot() {
    html2canvas(document.body).then(function(canvas) {
        const link = document.createElement('a');
        link.download = `screenshot_${Date.now()}.png`;
        link.href = canvas.toDataURL('image/png');
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        showNotification('Screenshot saved!');
        logActivity('Screenshot taken');
        stats.buttonPresses++;
        updateStats();
    });
}

function togglePanelsGridVisibility() {
    const panelsGrid = document.getElementById('panelsGrid');
    if (!panelsGrid) return;

    if (panelsGrid.style.display === 'none' || panelsGrid.style.opacity === '0') {
        panelsGrid.style.display = 'grid';
        panelsGrid.style.opacity = '1';
        showNotification('Sections are now visible.');
        logActivity('Sections toggled ON');
    } else {
        panelsGrid.style.opacity = '0'; 
        setTimeout(() => {
            panelsGrid.style.display = 'none';
        }, 300);
        showNotification('Sections are now hidden.');
        logActivity('Sections toggled OFF');
    }
    stats.buttonPresses++;
    updateStats();
}

function restartSystem() {
    if (confirm('Are you sure you want to restart the system? You will be logged out and all unsaved data will be lost.')) {
        logActivity('System restarted');
        localStorage.clear(); 
        location.reload(); 
    }
}


// Event listeners
document.addEventListener('DOMContentLoaded', () => {
  setupToggles();
  
  document.getElementById('submitBtn').addEventListener('click', (e) => {
    e.preventDefault();
    stats.buttonPresses++;
    attemptLogin();
  });
  
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !document.getElementById('loginScreen').classList.contains('hidden')) {
      attemptLogin();
    }
  });
  
  document.getElementById('penColor').addEventListener('change', (e) => {
    currentColor = e.target.value;
  });
  
  document.getElementById('penThickness').addEventListener('input', (e) => {
    currentThickness = parseInt(e.target.value);
  });
  
  const savedNotes = localStorage.getItem('textNotes');
  if (savedNotes) {
    const textNotesElement = document.getElementById('textNotes');
    if (textNotesElement) {
        textNotesElement.value = savedNotes;
    }
  }
  
  document.addEventListener('click', (e) => {
    // Only increment stats if the click target is a button, but exclude specific elements if they already increment stats elsewhere (like login)
    // and ensure it's not a panel-btn as these are handled separately within their panel functions
    if ((e.target.tagName === 'BUTTON' && !e.target.closest('.panel-controls') && !e.target.classList.contains('submit-btn')) || e.target.closest('.quick-btn')) {
        // Prevent double counting if quick-btn handler also has a specific handler
        // Don't track submit button here, it's tracked in its specific function
        stats.buttonPresses++;
        updateStats();
    }
  });
  // Set default values for Important Dates inputs (current date and a default time)
  const today = new Date();
  const importantDateDay = document.getElementById('importantDateDay');
  const importantDateTime = document.getElementById('importantDateTime');
  if (importantDateDay) {
      importantDateDay.value = today.toISOString().split('T')[0];
  }
  if (importantDateTime) {
      importantDateTime.value = "09:00"; // Default to 9 AM
  }

});
</script>

</body>
</html>
