javascript:(async()=>{let e=0,o=Date.now(),t=Date.now();window.options={renderBlockedLines:!0,autoAim:{scaleFactor:2.5,predictMovement:!1},renderPlayers:!0,renderTargets:!0,renderPowerups:!0,scrollZoom:!0,scrollSensitivity:70,freeCamSensitivity:12,spectatingPlayer:null,autoShoot:!1,autoAnswer:!0};let n=Object.values(document.querySelector("#phaser-laserGame"))[0].return.updateQueue.lastEffect.deps[1].current.game.scene.scenes[1],r=n.localPlayer;const i=[...document.querySelectorAll("link")].filter((e=>e.href.includes("colyseus-")))[0].href,s=await import(i);let a=s.a().Room.prototype.send;function l(e,o){return Math.atan2(e[1].y-o[1].y,e[1].x-o[1].x)}function p(e,o){let t=e[0],n=0;for(let s=0;s<e.length;s++){let a=(r=e[s],i=o,Math.hypot(r[1].x-i[1].x,r[1].y-i[1].y));a<t&&(n=s,t=a)}var r,i;return e[n]}function c(){return[...n.players].map((e=>e[1])).filter((e=>e.player.sessionId))}window.room=void 0,s.a().Room.prototype.send=function(n){if(window.room=this,e<1&&(room.state.map.cells.forEach((e=>e.listen("powerup",(()=>{f.forEach((e=>e.visible=!1)),m.forEach((e=>e[1].clear())),m=[],f=[],E().forEach((e=>{k(e),L(e)}))})))),room.onMessage("showQuestion",(e=>{if(!e)return;P=e;let o=S.get(e.number);o&&options.autoAnswer&&room.send("playerAnswerQuestion",{answer:o[0]})})),room.onMessage("answerResult",(e=>{e.correctAnswers&&S.set(P.number,e.correctAnswers),room.send("playerAnswerNext",null),r.respawning=!1})),room.onMessage("playerPosUpdate",(()=>{if(options.autoShoot){let e=[null,r.player],n=0,i=Array.from(room.state.players).filter((o=>o[1].sessionId&&o[1]!==e[1]&&!o[1].invulnerable&&!C({x1:e[1].x,y1:e[1].y,x2:o[1].x,y2:o[1].y})));if(i.length<1){let o=Array.from(room.state.targets).filter((o=>!o[1].isHit&&!C({x1:e[1].x,y1:e[1].y,x2:o[1].x,y2:o[1].y})));if(o.length<1)return;n=l(p(o,e),e)}else{let o=room.state.players.get(p(i,e)[1].name);if(options.autoAim.predictMovement){let t={x:o.x,y:o.y};t={x:o.x+o.velocity.x*options.autoAim.scaleFactor,y:o.y+o.velocity.y*options.autoAim.scaleFactor},n=l([null,t],e)}else n=l(p(i,e),e)}a.apply(room,["playerMouseUpdate",{mouseAngle:n}]),t=Date.now(),Date.now()-o>50&&(room.send("playerMouseUpdate",{mouseAngle:n}),room.send("playerMouseClick",null),o=Date.now())}})),e=1),!(options.autoShoot&&"playerMouseUpdate"==n||options.freeCam&&"playerMoveInput"==n))return a.apply(this,arguments)};let y=[],u=[],d=[],h=[],m=[],f=[];function w(e){let o=n.add.graphics();o.lineStyle(2,65280),o.strokeRect(-40,-40,80,84),d.push(o),e.container.add(o)}function g(e){let o=n.add.graphics(),t=new Phaser.Geom.Line(r.container.x,r.container.y,e.container.x,e.container.y);const i=!!options.renderBlockedLines&&C(t);o.lineStyle(2,i?26112:65280),o.setDepth(99999),options.renderPlayers&&o.strokeLineShape(t),y.push([e,o,t])}function x(){d.forEach((e=>e.visible=options.renderPlayers)),y.forEach((e=>{let o=e[1],t=e[2];if(t.setTo(r.container.x,r.container.y,e[0].container.x,e[0].container.y),o.clear(),options.renderPlayers){const e=!!options.renderBlockedLines&&C(t);o.lineStyle(2,e?26112:65280),o.strokeLineShape(t)}}))}document.addEventListener("keydown",(e=>{switch(e.key){case"f":room.send("playerMoveInput",{moving:!1,inputX:0,inputY:0}),options.freeCam=!options.freeCam,r.applyMovement(0,0);break;case"g":options.autoShoot=!options.autoShoot;break;case"1":options.renderPlayers=!options.renderPlayers,x();break;case"2":options.renderTargets=!options.renderTargets,v();break;case"3":options.renderPowerups=!options.renderPowerups,M();break;case"4":options.renderBlockedLines=!options.renderBlockedLines,x(),v(),M()}}));let S=new Map,P={};function v(){h.forEach((e=>e.visible=options.renderTargets)),u.forEach((e=>{let o=e[1],t=e[2];if(t.setTo(r.container.x,r.container.y,e[0].container.x,e[0].container.y),o.clear(),options.renderTargets){const e=!!options.renderBlockedLines&&C(t);o.lineStyle(2,e?6684672:16711680),o.strokeLineShape(t)}}))}function k(e){let o=n.add.graphics(),t=e.powerupSprite;o.lineStyle(2,255),o.strokeRect(t.x-t.width/2,t.y-t.height/2,t.width,t.height),f.push(o)}function L(e){let o=n.add.graphics(),t=new Phaser.Geom.Line(r.container.x,r.container.y,e.powerupSprite.x,e.powerupSprite.y);const i=!!options.renderBlockedLines&&C(t);o.lineStyle(2,i?102:255),o.setDepth(99999),options.renderPowerups&&o.strokeLineShape(t),m.push([e,o,t])}function M(){f.forEach((e=>e.visible=options.renderPowerups)),m.forEach((e=>{let o=e[1],t=e[2];if(t.setTo(r.container.x,r.container.y,e[0].powerupSprite.x,e[0].powerupSprite.y),o.clear(),options.renderPowerups){const e=!!options.renderBlockedLines&&C(t);o.lineStyle(2,e?102:255),o.strokeLineShape(t)}}))}function E(){return[...n.mapCells].map((e=>e[1])).filter((e=>e.powerupSprite)).filter((e=>e.cell.powerup))}window.exportAnswers=()=>btoa(JSON.stringify([...S])),window.importAnswers=e=>{try{S.clear(),JSON.parse(atob(e)).forEach((e=>S.set(e[0],e[1])))}catch(e){}},n.localPlayer.applyMovement2||(n.localPlayer.applyMovement2=n.localPlayer.applyMovement,n.localPlayer.applyMovement=function(e,o){if(n.cameras.main._follow=options.freeCam?null:options.spectatingPlayer?options.spectatingPlayer.container:r.container,!options.freeCam)return n.localPlayer.applyMovement2.apply(this,arguments);!function(e,o){n.cameras.main.scrollX+=e*options.freeCamSensitivity,n.cameras.main.scrollY+=o*options.freeCamSensitivity}(e,o)});let A=[...n.mapCells].map((e=>e[1])).filter((e=>e.cell.isWall)).map((e=>({x:100*e.cell.x,y:100*e.cell.y,width:e.cell.width,height:e.cell.height})));function b(e,o){return Phaser.Geom.Intersects.LineToRectangle(e,new Phaser.Geom.Rectangle(o.x,o.y,o.width,o.height))}function C(e){for(let o=0;o<A.length;o++)if(b(e,A[o]))return 1;return 0}Date.now();let T=c().length;function B(){options.renderPlayers&&x(),options.renderTargets&&v(),options.renderPowerups&&M(),n.input._events.wheel||n.input.on("wheel",(e=>{options.scrollZoom&&(n.cameras.main.zoom-=e.deltaY/2e5*options.scrollSensitivity)})),T!==c().length&&(y.forEach((e=>e[1].clear())),y=[],d=[],c().forEach((e=>{w(e),g(e),D(e)}))),T=c().length}function D(e){e.container.setPosition2||(e.container.setPosition2=e.container.setPosition,e.container.setPosition=function(){e.container.setPosition2.apply(this,arguments),B()},console.log(window.room))}c().forEach((e=>{w(e),g(e),D(e)})),[...n.targets].map((e=>e[1])).forEach((e=>{!function(e){let o=n.add.graphics();o.lineStyle(2,16711680),o.strokeRect(-40,-40,80,84),h.push(o),e.container.add(o)}(e),function(e){let o=n.add.graphics(),t=new Phaser.Geom.Line(r.container.x,r.container.y,e.container.x,e.container.y);const i=!!options.renderBlockedLines&&C(t);o.lineStyle(2,i?6684672:16711680),o.setDepth(99999),options.renderTargets&&o.strokeLineShape(t),u.push([e,o,t])}(e)})),E().forEach((e=>{k(e),L(e)})),D(r)})();
